var IS=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var F6=IS((oY,yS)=>{function ax(n,e){return function(){return n.apply(e,arguments)}}const{toString:MS}=Object.prototype,{getPrototypeOf:op}=Object,{iterator:yc,toStringTag:lx}=Symbol,bc=(n=>e=>{const t=MS.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),lr=n=>(n=n.toLowerCase(),e=>bc(e)===n),xc=n=>e=>typeof e===n,{isArray:Ms}=Array,xs=xc("undefined");function $a(n){return n!==null&&!xs(n)&&n.constructor!==null&&!xs(n.constructor)&&wn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ux=lr("ArrayBuffer");function OS(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ux(n.buffer),e}const PS=xc("string"),wn=xc("function"),cx=xc("number"),Ga=n=>n!==null&&typeof n=="object",NS=n=>n===!0||n===!1,su=n=>{if(bc(n)!=="object")return!1;const e=op(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(lx in n)&&!(yc in n)},FS=n=>{if(!Ga(n)||$a(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},LS=lr("Date"),BS=lr("File"),HS=lr("Blob"),WS=lr("FileList"),zS=n=>Ga(n)&&wn(n.pipe),VS=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||wn(n.append)&&((e=bc(n))==="formdata"||e==="object"&&wn(n.toString)&&n.toString()==="[object FormData]"))},US=lr("URLSearchParams"),[jS,$S,GS,qS]=["ReadableStream","Request","Response","Headers"].map(lr),YS=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qa(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,i;if(typeof n!="object"&&(n=[n]),Ms(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{if($a(n))return;const o=t?Object.getOwnPropertyNames(n):Object.keys(n),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,n[a],a,n)}}function dx(n,e){if($a(n))return null;e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const ho=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,hx=n=>!xs(n)&&n!==ho;function zh(){const{caseless:n,skipUndefined:e}=hx(this)&&this||{},t={},r=(i,o)=>{const s=n&&dx(t,o)||o;su(t[s])&&su(i)?t[s]=zh(t[s],i):su(i)?t[s]=zh({},i):Ms(i)?t[s]=i.slice():(!e||!xs(i))&&(t[s]=i)};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&qa(arguments[i],r);return t}const XS=(n,e,t,{allOwnKeys:r}={})=>(qa(e,(i,o)=>{t&&wn(i)?n[o]=ax(i,t):n[o]=i},{allOwnKeys:r}),n),KS=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),QS=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},JS=(n,e,t,r)=>{let i,o,s;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),o=i.length;o-- >0;)s=i[o],(!r||r(s,n,e))&&!a[s]&&(e[s]=n[s],a[s]=!0);n=t!==!1&&op(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},ZS=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},eD=n=>{if(!n)return null;if(Ms(n))return n;let e=n.length;if(!cx(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},tD=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&op(Uint8Array)),nD=(n,e)=>{const r=(n&&n[yc]).call(n);let i;for(;(i=r.next())&&!i.done;){const o=i.value;e.call(n,o[0],o[1])}},rD=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},iD=lr("HTMLFormElement"),oD=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),pm=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),sD=lr("RegExp"),fx=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};qa(t,(i,o)=>{let s;(s=e(i,o,n))!==!1&&(r[o]=s||i)}),Object.defineProperties(n,r)},aD=n=>{fx(n,(e,t)=>{if(wn(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(wn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},lD=(n,e)=>{const t={},r=i=>{i.forEach(o=>{t[o]=!0})};return Ms(n)?r(n):r(String(n).split(e)),t},uD=()=>{},cD=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function dD(n){return!!(n&&wn(n.append)&&n[lx]==="FormData"&&n[yc])}const hD=n=>{const e=new Array(10),t=(r,i)=>{if(Ga(r)){if(e.indexOf(r)>=0)return;if($a(r))return r;if(!("toJSON"in r)){e[i]=r;const o=Ms(r)?[]:{};return qa(r,(s,a)=>{const l=t(s,i+1);!xs(l)&&(o[a]=l)}),e[i]=void 0,o}}return r};return t(n,0)},fD=lr("AsyncFunction"),pD=n=>n&&(Ga(n)||wn(n))&&wn(n.then)&&wn(n.catch),px=((n,e)=>n?setImmediate:e?((t,r)=>(ho.addEventListener("message",({source:i,data:o})=>{i===ho&&o===t&&r.length&&r.shift()()},!1),i=>{r.push(i),ho.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",wn(ho.postMessage)),gD=typeof queueMicrotask<"u"?queueMicrotask.bind(ho):typeof process<"u"&&process.nextTick||px,mD=n=>n!=null&&wn(n[yc]),$={isArray:Ms,isArrayBuffer:ux,isBuffer:$a,isFormData:VS,isArrayBufferView:OS,isString:PS,isNumber:cx,isBoolean:NS,isObject:Ga,isPlainObject:su,isEmptyObject:FS,isReadableStream:jS,isRequest:$S,isResponse:GS,isHeaders:qS,isUndefined:xs,isDate:LS,isFile:BS,isBlob:HS,isRegExp:sD,isFunction:wn,isStream:zS,isURLSearchParams:US,isTypedArray:tD,isFileList:WS,forEach:qa,merge:zh,extend:XS,trim:YS,stripBOM:KS,inherits:QS,toFlatObject:JS,kindOf:bc,kindOfTest:lr,endsWith:ZS,toArray:eD,forEachEntry:nD,matchAll:rD,isHTMLForm:iD,hasOwnProperty:pm,hasOwnProp:pm,reduceDescriptors:fx,freezeMethods:aD,toObjectSet:lD,toCamelCase:oD,noop:uD,toFiniteNumber:cD,findKey:dx,global:ho,isContextDefined:hx,isSpecCompliantForm:dD,toJSONObject:hD,isAsyncFn:fD,isThenable:pD,setImmediate:px,asap:gD,isIterable:mD};function Ee(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}$.inherits(Ee,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:$.toJSONObject(this.config),code:this.code,status:this.status}}});const gx=Ee.prototype,mx={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{mx[n]={value:n}});Object.defineProperties(Ee,mx);Object.defineProperty(gx,"isAxiosError",{value:!0});Ee.from=(n,e,t,r,i,o)=>{const s=Object.create(gx);$.toFlatObject(n,s,function(c){return c!==Error.prototype},u=>u!=="isAxiosError");const a=n&&n.message?n.message:"Error",l=e==null&&n?n.code:e;return Ee.call(s,a,l,t,r,i),n&&s.cause==null&&Object.defineProperty(s,"cause",{value:n,configurable:!0}),s.name=n&&n.name||"Error",o&&Object.assign(s,o),s};const vD=null;function Vh(n){return $.isPlainObject(n)||$.isArray(n)}function vx(n){return $.endsWith(n,"[]")?n.slice(0,-2):n}function gm(n,e,t){return n?n.concat(e).map(function(i,o){return i=vx(i),!t&&o?"["+i+"]":i}).join(t?".":""):e}function yD(n){return $.isArray(n)&&!n.some(Vh)}const bD=$.toFlatObject($,{},null,function(e){return/^is[A-Z]/.test(e)});function wc(n,e,t){if(!$.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=$.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,m){return!$.isUndefined(m[g])});const r=t.metaTokens,i=t.visitor||c,o=t.dots,s=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&$.isSpecCompliantForm(e);if(!$.isFunction(i))throw new TypeError("visitor must be a function");function u(p){if(p===null)return"";if($.isDate(p))return p.toISOString();if($.isBoolean(p))return p.toString();if(!l&&$.isBlob(p))throw new Ee("Blob is not supported. Use a Buffer instead.");return $.isArrayBuffer(p)||$.isTypedArray(p)?l&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function c(p,g,m){let v=p;if(p&&!m&&typeof p=="object"){if($.endsWith(g,"{}"))g=r?g:g.slice(0,-2),p=JSON.stringify(p);else if($.isArray(p)&&yD(p)||($.isFileList(p)||$.endsWith(g,"[]"))&&(v=$.toArray(p)))return g=vx(g),v.forEach(function(b,x){!($.isUndefined(b)||b===null)&&e.append(s===!0?gm([g],x,o):s===null?g:g+"[]",u(b))}),!1}return Vh(p)?!0:(e.append(gm(m,g,o),u(p)),!1)}const d=[],h=Object.assign(bD,{defaultVisitor:c,convertValue:u,isVisitable:Vh});function f(p,g){if(!$.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(p),$.forEach(p,function(v,y){(!($.isUndefined(v)||v===null)&&i.call(e,v,$.isString(y)?y.trim():y,g,h))===!0&&f(v,g?g.concat(y):[y])}),d.pop()}}if(!$.isObject(n))throw new TypeError("data must be an object");return f(n),e}function mm(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function sp(n,e){this._pairs=[],n&&wc(n,this,e)}const yx=sp.prototype;yx.append=function(e,t){this._pairs.push([e,t])};yx.toString=function(e){const t=e?function(r){return e.call(this,r,mm)}:mm;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function xD(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function bx(n,e,t){if(!e)return n;const r=t&&t.encode||xD;$.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let o;if(i?o=i(e,t):o=$.isURLSearchParams(e)?e.toString():new sp(e,t).toString(r),o){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}class vm{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){$.forEach(this.handlers,function(r){r!==null&&e(r)})}}const xx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wD=typeof URLSearchParams<"u"?URLSearchParams:sp,_D=typeof FormData<"u"?FormData:null,CD=typeof Blob<"u"?Blob:null,ED={isBrowser:!0,classes:{URLSearchParams:wD,FormData:_D,Blob:CD},protocols:["http","https","file","blob","url","data"]},ap=typeof window<"u"&&typeof document<"u",Uh=typeof navigator=="object"&&navigator||void 0,SD=ap&&(!Uh||["ReactNative","NativeScript","NS"].indexOf(Uh.product)<0),DD=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",AD=ap&&window.location.href||"http://localhost",kD=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ap,hasStandardBrowserEnv:SD,hasStandardBrowserWebWorkerEnv:DD,navigator:Uh,origin:AD},Symbol.toStringTag,{value:"Module"})),Xt={...kD,...ED};function RD(n,e){return wc(n,new Xt.classes.URLSearchParams,{visitor:function(t,r,i,o){return Xt.isNode&&$.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)},...e})}function TD(n){return $.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ID(n){const e={},t=Object.keys(n);let r;const i=t.length;let o;for(r=0;r<i;r++)o=t[r],e[o]=n[o];return e}function wx(n){function e(t,r,i,o){let s=t[o++];if(s==="__proto__")return!0;const a=Number.isFinite(+s),l=o>=t.length;return s=!s&&$.isArray(i)?i.length:s,l?($.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!$.isObject(i[s]))&&(i[s]=[]),e(t,r,i[s],o)&&$.isArray(i[s])&&(i[s]=ID(i[s])),!a)}if($.isFormData(n)&&$.isFunction(n.entries)){const t={};return $.forEachEntry(n,(r,i)=>{e(TD(r),i,t,0)}),t}return null}function MD(n,e,t){if($.isString(n))try{return(e||JSON.parse)(n),$.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Ya={transitional:xx,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,o=$.isObject(e);if(o&&$.isHTMLForm(e)&&(e=new FormData(e)),$.isFormData(e))return i?JSON.stringify(wx(e)):e;if($.isArrayBuffer(e)||$.isBuffer(e)||$.isStream(e)||$.isFile(e)||$.isBlob(e)||$.isReadableStream(e))return e;if($.isArrayBufferView(e))return e.buffer;if($.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return RD(e,this.formSerializer).toString();if((a=$.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return wc(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),MD(e)):e}],transformResponse:[function(e){const t=this.transitional||Ya.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if($.isResponse(e)||$.isReadableStream(e))return e;if(e&&$.isString(e)&&(r&&!this.responseType||i)){const s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(a){if(s)throw a.name==="SyntaxError"?Ee.from(a,Ee.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Xt.classes.FormData,Blob:Xt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};$.forEach(["delete","get","head","post","put","patch"],n=>{Ya.headers[n]={}});const OD=$.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),PD=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),r=s.substring(i+1).trim(),!(!t||e[t]&&OD[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ym=Symbol("internals");function zs(n){return n&&String(n).trim().toLowerCase()}function au(n){return n===!1||n==null?n:$.isArray(n)?n.map(au):String(n)}function ND(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const FD=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function fd(n,e,t,r,i){if($.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!$.isString(e)){if($.isString(r))return e.indexOf(r)!==-1;if($.isRegExp(r))return r.test(e)}}function LD(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function BD(n,e){const t=$.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}let _n=class{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function o(a,l,u){const c=zs(l);if(!c)throw new Error("header name must be a non-empty string");const d=$.findKey(i,c);(!d||i[d]===void 0||u===!0||u===void 0&&i[d]!==!1)&&(i[d||l]=au(a))}const s=(a,l)=>$.forEach(a,(u,c)=>o(u,c,l));if($.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if($.isString(e)&&(e=e.trim())&&!FD(e))s(PD(e),t);else if($.isObject(e)&&$.isIterable(e)){let a={},l,u;for(const c of e){if(!$.isArray(c))throw TypeError("Object iterator must return a key-value pair");a[u=c[0]]=(l=a[u])?$.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}s(a,t)}else e!=null&&o(t,e,r);return this}get(e,t){if(e=zs(e),e){const r=$.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return ND(i);if($.isFunction(t))return t.call(this,i,r);if($.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=zs(e),e){const r=$.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||fd(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function o(s){if(s=zs(s),s){const a=$.findKey(r,s);a&&(!t||fd(r,r[a],a,t))&&(delete r[a],i=!0)}}return $.isArray(e)?e.forEach(o):o(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const o=t[r];(!e||fd(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const t=this,r={};return $.forEach(this,(i,o)=>{const s=$.findKey(r,o);if(s){t[s]=au(i),delete t[o];return}const a=e?LD(o):String(o).trim();a!==o&&delete t[o],t[a]=au(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return $.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&$.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[ym]=this[ym]={accessors:{}}).accessors,i=this.prototype;function o(s){const a=zs(s);r[a]||(BD(i,s),r[a]=!0)}return $.isArray(e)?e.forEach(o):o(e),this}};_n.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);$.reduceDescriptors(_n.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});$.freezeMethods(_n);function pd(n,e){const t=this||Ya,r=e||t,i=_n.from(r.headers);let o=r.data;return $.forEach(n,function(a){o=a.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function _x(n){return!!(n&&n.__CANCEL__)}function Os(n,e,t){Ee.call(this,n??"canceled",Ee.ERR_CANCELED,e,t),this.name="CanceledError"}$.inherits(Os,Ee,{__CANCEL__:!0});function Cx(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ee("Request failed with status code "+t.status,[Ee.ERR_BAD_REQUEST,Ee.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function HD(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function WD(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[o];s||(s=u),t[i]=l,r[i]=u;let d=o,h=0;for(;d!==i;)h+=t[d++],d=d%n;if(i=(i+1)%n,i===o&&(o=(o+1)%n),u-s<e)return;const f=c&&u-c;return f?Math.round(h*1e3/f):void 0}}function zD(n,e){let t=0,r=1e3/e,i,o;const s=(u,c=Date.now())=>{t=c,i=null,o&&(clearTimeout(o),o=null),n(...u)};return[(...u)=>{const c=Date.now(),d=c-t;d>=r?s(u,c):(i=u,o||(o=setTimeout(()=>{o=null,s(i)},r-d)))},()=>i&&s(i)]}const xu=(n,e,t=3)=>{let r=0;const i=WD(50,250);return zD(o=>{const s=o.loaded,a=o.lengthComputable?o.total:void 0,l=s-r,u=i(l),c=s<=a;r=s;const d={loaded:s,total:a,progress:a?s/a:void 0,bytes:l,rate:u||void 0,estimated:u&&a&&c?(a-s)/u:void 0,event:o,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(d)},t)},bm=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},xm=n=>(...e)=>$.asap(()=>n(...e)),VD=Xt.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,Xt.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(Xt.origin),Xt.navigator&&/(msie|trident)/i.test(Xt.navigator.userAgent)):()=>!0,UD=Xt.hasStandardBrowserEnv?{write(n,e,t,r,i,o){const s=[n+"="+encodeURIComponent(e)];$.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),$.isString(r)&&s.push("path="+r),$.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function jD(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function $D(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ex(n,e,t){let r=!jD(e);return n&&(r||t==!1)?$D(n,e):e}const wm=n=>n instanceof _n?{...n}:n;function _o(n,e){e=e||{};const t={};function r(u,c,d,h){return $.isPlainObject(u)&&$.isPlainObject(c)?$.merge.call({caseless:h},u,c):$.isPlainObject(c)?$.merge({},c):$.isArray(c)?c.slice():c}function i(u,c,d,h){if($.isUndefined(c)){if(!$.isUndefined(u))return r(void 0,u,d,h)}else return r(u,c,d,h)}function o(u,c){if(!$.isUndefined(c))return r(void 0,c)}function s(u,c){if($.isUndefined(c)){if(!$.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function a(u,c,d){if(d in e)return r(u,c);if(d in n)return r(void 0,u)}const l={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(u,c,d)=>i(wm(u),wm(c),d,!0)};return $.forEach(Object.keys({...n,...e}),function(c){const d=l[c]||i,h=d(n[c],e[c],c);$.isUndefined(h)&&d!==a||(t[c]=h)}),t}const Sx=n=>{const e=_o({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:o,headers:s,auth:a}=e;if(e.headers=s=_n.from(s),e.url=bx(Ex(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),a&&s.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),$.isFormData(t)){if(Xt.hasStandardBrowserEnv||Xt.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if($.isFunction(t.getHeaders)){const l=t.getHeaders(),u=["content-type","content-length"];Object.entries(l).forEach(([c,d])=>{u.includes(c.toLowerCase())&&s.set(c,d)})}}if(Xt.hasStandardBrowserEnv&&(r&&$.isFunction(r)&&(r=r(e)),r||r!==!1&&VD(e.url))){const l=i&&o&&UD.read(o);l&&s.set(i,l)}return e},GD=typeof XMLHttpRequest<"u",qD=GD&&function(n){return new Promise(function(t,r){const i=Sx(n);let o=i.data;const s=_n.from(i.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:u}=i,c,d,h,f,p;function g(){f&&f(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let m=new XMLHttpRequest;m.open(i.method.toUpperCase(),i.url,!0),m.timeout=i.timeout;function v(){if(!m)return;const b=_n.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders()),w={data:!a||a==="text"||a==="json"?m.responseText:m.response,status:m.status,statusText:m.statusText,headers:b,config:n,request:m};Cx(function(C){t(C),g()},function(C){r(C),g()},w),m=null}"onloadend"in m?m.onloadend=v:m.onreadystatechange=function(){!m||m.readyState!==4||m.status===0&&!(m.responseURL&&m.responseURL.indexOf("file:")===0)||setTimeout(v)},m.onabort=function(){m&&(r(new Ee("Request aborted",Ee.ECONNABORTED,n,m)),m=null)},m.onerror=function(x){const w=x&&x.message?x.message:"Network Error",_=new Ee(w,Ee.ERR_NETWORK,n,m);_.event=x||null,r(_),m=null},m.ontimeout=function(){let x=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const w=i.transitional||xx;i.timeoutErrorMessage&&(x=i.timeoutErrorMessage),r(new Ee(x,w.clarifyTimeoutError?Ee.ETIMEDOUT:Ee.ECONNABORTED,n,m)),m=null},o===void 0&&s.setContentType(null),"setRequestHeader"in m&&$.forEach(s.toJSON(),function(x,w){m.setRequestHeader(w,x)}),$.isUndefined(i.withCredentials)||(m.withCredentials=!!i.withCredentials),a&&a!=="json"&&(m.responseType=i.responseType),u&&([h,p]=xu(u,!0),m.addEventListener("progress",h)),l&&m.upload&&([d,f]=xu(l),m.upload.addEventListener("progress",d),m.upload.addEventListener("loadend",f)),(i.cancelToken||i.signal)&&(c=b=>{m&&(r(!b||b.type?new Os(null,n,m):b),m.abort(),m=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const y=HD(i.url);if(y&&Xt.protocols.indexOf(y)===-1){r(new Ee("Unsupported protocol "+y+":",Ee.ERR_BAD_REQUEST,n));return}m.send(o||null)})},YD=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,i;const o=function(u){if(!i){i=!0,a();const c=u instanceof Error?u:this.reason;r.abort(c instanceof Ee?c:new Os(c instanceof Error?c.message:c))}};let s=e&&setTimeout(()=>{s=null,o(new Ee(`timeout ${e} of ms exceeded`,Ee.ETIMEDOUT))},e);const a=()=>{n&&(s&&clearTimeout(s),s=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),n=null)};n.forEach(u=>u.addEventListener("abort",o));const{signal:l}=r;return l.unsubscribe=()=>$.asap(a),l}},XD=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,i;for(;r<t;)i=r+e,yield n.slice(r,i),r=i},KD=async function*(n,e){for await(const t of QD(n))yield*XD(t,e)},QD=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},_m=(n,e,t,r)=>{const i=KD(n,e);let o=0,s,a=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await i.next();if(u){a(),l.close();return}let d=c.byteLength;if(t){let h=o+=d;t(h)}l.enqueue(new Uint8Array(c))}catch(u){throw a(u),u}},cancel(l){return a(l),i.return()}},{highWaterMark:2})},Cm=64*1024,{isFunction:fl}=$,JD=(({Request:n,Response:e})=>({Request:n,Response:e}))($.global),{ReadableStream:Em,TextEncoder:Sm}=$.global,Dm=(n,...e)=>{try{return!!n(...e)}catch{return!1}},ZD=n=>{n=$.merge.call({skipUndefined:!0},JD,n);const{fetch:e,Request:t,Response:r}=n,i=e?fl(e):typeof fetch=="function",o=fl(t),s=fl(r);if(!i)return!1;const a=i&&fl(Em),l=i&&(typeof Sm=="function"?(p=>g=>p.encode(g))(new Sm):async p=>new Uint8Array(await new t(p).arrayBuffer())),u=o&&a&&Dm(()=>{let p=!1;const g=new t(Xt.origin,{body:new Em,method:"POST",get duplex(){return p=!0,"half"}}).headers.has("Content-Type");return p&&!g}),c=s&&a&&Dm(()=>$.isReadableStream(new r("").body)),d={stream:c&&(p=>p.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(p=>{!d[p]&&(d[p]=(g,m)=>{let v=g&&g[p];if(v)return v.call(g);throw new Ee(`Response type '${p}' is not supported`,Ee.ERR_NOT_SUPPORT,m)})});const h=async p=>{if(p==null)return 0;if($.isBlob(p))return p.size;if($.isSpecCompliantForm(p))return(await new t(Xt.origin,{method:"POST",body:p}).arrayBuffer()).byteLength;if($.isArrayBufferView(p)||$.isArrayBuffer(p))return p.byteLength;if($.isURLSearchParams(p)&&(p=p+""),$.isString(p))return(await l(p)).byteLength},f=async(p,g)=>{const m=$.toFiniteNumber(p.getContentLength());return m??h(g)};return async p=>{let{url:g,method:m,data:v,signal:y,cancelToken:b,timeout:x,onDownloadProgress:w,onUploadProgress:_,responseType:C,headers:E,withCredentials:S="same-origin",fetchOptions:D}=Sx(p),k=e||fetch;C=C?(C+"").toLowerCase():"text";let M=YD([y,b&&b.toAbortSignal()],x),B=null;const H=M&&M.unsubscribe&&(()=>{M.unsubscribe()});let F;try{if(_&&u&&m!=="get"&&m!=="head"&&(F=await f(E,v))!==0){let J=new t(g,{method:"POST",body:v,duplex:"half"}),ee;if($.isFormData(v)&&(ee=J.headers.get("content-type"))&&E.setContentType(ee),J.body){const[re,fe]=bm(F,xu(xm(_)));v=_m(J.body,Cm,re,fe)}}$.isString(S)||(S=S?"include":"omit");const W=o&&"credentials"in t.prototype,j={...D,signal:M,method:m.toUpperCase(),headers:E.normalize().toJSON(),body:v,duplex:"half",credentials:W?S:void 0};B=o&&new t(g,j);let U=await(o?k(B,D):k(g,j));const q=c&&(C==="stream"||C==="response");if(c&&(w||q&&H)){const J={};["status","statusText","headers"].forEach(pe=>{J[pe]=U[pe]});const ee=$.toFiniteNumber(U.headers.get("content-length")),[re,fe]=w&&bm(ee,xu(xm(w),!0))||[];U=new r(_m(U.body,Cm,re,()=>{fe&&fe(),H&&H()}),J)}C=C||"text";let K=await d[$.findKey(d,C)||"text"](U,p);return!q&&H&&H(),await new Promise((J,ee)=>{Cx(J,ee,{data:K,headers:_n.from(U.headers),status:U.status,statusText:U.statusText,config:p,request:B})})}catch(W){throw H&&H(),W&&W.name==="TypeError"&&/Load failed|fetch/i.test(W.message)?Object.assign(new Ee("Network Error",Ee.ERR_NETWORK,p,B),{cause:W.cause||W}):Ee.from(W,W&&W.code,p,B)}}},eA=new Map,Dx=n=>{let e=n?n.env:{};const{fetch:t,Request:r,Response:i}=e,o=[r,i,t];let s=o.length,a=s,l,u,c=eA;for(;a--;)l=o[a],u=c.get(l),u===void 0&&c.set(l,u=a?new Map:ZD(e)),c=u;return u};Dx();const jh={http:vD,xhr:qD,fetch:{get:Dx}};$.forEach(jh,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Am=n=>`- ${n}`,tA=n=>$.isFunction(n)||n===null||n===!1,Ax={getAdapter:(n,e)=>{n=$.isArray(n)?n:[n];const{length:t}=n;let r,i;const o={};for(let s=0;s<t;s++){r=n[s];let a;if(i=r,!tA(r)&&(i=jh[(a=String(r)).toLowerCase()],i===void 0))throw new Ee(`Unknown adapter '${a}'`);if(i&&($.isFunction(i)||(i=i.get(e))))break;o[a||"#"+s]=i}if(!i){const s=Object.entries(o).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let a=t?s.length>1?`since :
`+s.map(Am).join(`
`):" "+Am(s[0]):"as no adapter specified";throw new Ee("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return i},adapters:jh};function gd(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Os(null,n)}function km(n){return gd(n),n.headers=_n.from(n.headers),n.data=pd.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Ax.getAdapter(n.adapter||Ya.adapter,n)(n).then(function(r){return gd(n),r.data=pd.call(n,n.transformResponse,r),r.headers=_n.from(r.headers),r},function(r){return _x(r)||(gd(n),r&&r.response&&(r.response.data=pd.call(n,n.transformResponse,r.response),r.response.headers=_n.from(r.response.headers))),Promise.reject(r)})}const kx="1.12.2",_c={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{_c[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const Rm={};_c.transitional=function(e,t,r){function i(o,s){return"[Axios v"+kx+"] Transitional option '"+o+"'"+s+(r?". "+r:"")}return(o,s,a)=>{if(e===!1)throw new Ee(i(s," has been removed"+(t?" in "+t:"")),Ee.ERR_DEPRECATED);return t&&!Rm[s]&&(Rm[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,s,a):!0}};_c.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function nA(n,e,t){if(typeof n!="object")throw new Ee("options must be an object",Ee.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=n[o],l=a===void 0||s(a,o,n);if(l!==!0)throw new Ee("option "+o+" must be "+l,Ee.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ee("Unknown option "+o,Ee.ERR_BAD_OPTION)}}const lu={assertOptions:nA,validators:_c},pr=lu.validators;let go=class{constructor(e){this.defaults=e||{},this.interceptors={request:new vm,response:new vm}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=_o(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:o}=t;r!==void 0&&lu.assertOptions(r,{silentJSONParsing:pr.transitional(pr.boolean),forcedJSONParsing:pr.transitional(pr.boolean),clarifyTimeoutError:pr.transitional(pr.boolean)},!1),i!=null&&($.isFunction(i)?t.paramsSerializer={serialize:i}:lu.assertOptions(i,{encode:pr.function,serialize:pr.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),lu.assertOptions(t,{baseUrl:pr.spelling("baseURL"),withXsrfToken:pr.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=o&&$.merge(o.common,o[t.method]);o&&$.forEach(["delete","get","head","post","put","patch","common"],p=>{delete o[p]}),t.headers=_n.concat(s,o);const a=[];let l=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(l=l&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});const u=[];this.interceptors.response.forEach(function(g){u.push(g.fulfilled,g.rejected)});let c,d=0,h;if(!l){const p=[km.bind(this),void 0];for(p.unshift(...a),p.push(...u),h=p.length,c=Promise.resolve(t);d<h;)c=c.then(p[d++],p[d++]);return c}h=a.length;let f=t;for(;d<h;){const p=a[d++],g=a[d++];try{f=p(f)}catch(m){g.call(this,m);break}}try{c=km.call(this,f)}catch(p){return Promise.reject(p)}for(d=0,h=u.length;d<h;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=_o(this.defaults,e);const t=Ex(e.baseURL,e.url,e.allowAbsoluteUrls);return bx(t,e.params,e.paramsSerializer)}};$.forEach(["delete","get","head","options"],function(e){go.prototype[e]=function(t,r){return this.request(_o(r||{},{method:e,url:t,data:(r||{}).data}))}});$.forEach(["post","put","patch"],function(e){function t(r){return function(o,s,a){return this.request(_o(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}go.prototype[e]=t(),go.prototype[e+"Form"]=t(!0)});let rA=class Rx{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(o,s,a){r.reason||(r.reason=new Os(o,s,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Rx(function(i){e=i}),cancel:e}}};function iA(n){return function(t){return n.apply(null,t)}}function oA(n){return $.isObject(n)&&n.isAxiosError===!0}const $h={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($h).forEach(([n,e])=>{$h[e]=n});function Tx(n){const e=new go(n),t=ax(go.prototype.request,e);return $.extend(t,go.prototype,e,{allOwnKeys:!0}),$.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return Tx(_o(n,i))},t}const _t=Tx(Ya);_t.Axios=go;_t.CanceledError=Os;_t.CancelToken=rA;_t.isCancel=_x;_t.VERSION=kx;_t.toFormData=wc;_t.AxiosError=Ee;_t.Cancel=_t.CanceledError;_t.all=function(e){return Promise.all(e)};_t.spread=iA;_t.isAxiosError=oA;_t.mergeConfig=_o;_t.AxiosHeaders=_n;_t.formToJSON=n=>wx($.isHTMLForm(n)?new FormData(n):n);_t.getAdapter=Ax.getAdapter;_t.HttpStatusCode=$h;_t.default=_t;const{Axios:W6,AxiosError:z6,CanceledError:V6,isCancel:U6,CancelToken:j6,VERSION:$6,all:G6,Cancel:q6,isAxiosError:Y6,spread:X6,toFormData:K6,AxiosHeaders:Q6,HttpStatusCode:J6,formToJSON:Z6,getAdapter:eY,mergeConfig:tY}=_t;window.axios=_t;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";var sA=Object.defineProperty,aA=(n,e,t)=>e in n?sA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ts=(n,e,t)=>aA(n,typeof e!="symbol"?e+"":e,t);document.addEventListener("alpine:init",()=>{window.Alpine.store("editOnClickValidation",{pending:[],set(n,e){this.pending=this.pending.filter(t=>t.value!==n),this.pending.push({value:n,textContent:e})},has(n){return this.pending.some(e=>e.value===n)},get(n){return this.pending.find(e=>e.value===n)},notContains(n){return this.pending.length>0&&!this.has(n)},clear(){this.pending=[]},getTextContent(n){const e=this.pending.find(t=>t.value===n);return e?e.textContent:null}}),window.editOnClickValidation=window.Alpine.store("editOnClickValidation")});document.addEventListener("alpine:init",()=>{window.Alpine.store("pgBulkActions",{selected:[],init(){window.addEventListener("pgBulkActions::addMore",n=>{const e=n.__livewire.params[0];typeof this.selected[e.tableName]>"u"&&(this.selected[e.tableName]=[]),this.selected[e.tableName].push(e.value)}),window.addEventListener("pgBulkActions::clear",n=>{this.clear(n.detail)}),window.addEventListener("pgBulkActions::clearAll",()=>{this.clearAll()})},add(n,e){if(typeof this.selected[e]>"u"&&(this.selected[e]=[]),!this.selected[e].includes(n)){this.selected[e].push(n);return}this.remove(n,e)},remove(n,e){const t=this.selected[e].indexOf(n);t>-1&&this.selected[e].splice(t,1)},get(n){return this.selected[n]??""},count(n){return typeof this.selected[n]>"u"?0:this.selected[n].length},clear(n){this.selected[n]=[]},clearAll(){this.selected=[]}}),window.pgBulkActions=window.Alpine.store("pgBulkActions")});const lA=n=>({field:n.field??null,tableName:n.tableName??null,enabled:n.enabled??!1,id:n.id,trueValue:n.trueValue,falseValue:n.falseValue,toggle:n.toggle,save(){this.toggle=this.toggle===0?1:0,this.$wire.dispatch("pg:toggleable-"+this.tableName,{id:this.id,field:this.field,value:this.toggle})}}),uA=(n,e,t)=>{const r=n[e];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((i,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})},cA=n=>({dataField:n.dataField,tableName:n.tableName,label:n.label??null,locale:n.locale??{locale:"default",dateFormat:"Y-m-d H:i",time_24hr:!1,enableTime:!0},onlyFuture:n.onlyFuture??!1,noWeekEnds:n.noWeekEnds??!1,customConfig:n.customConfig??null,type:n.type,element:null,selectedDates:null,async init(){typeof flatpickr>"u"&&(console.log("%c%s","color: #f59e0c; font-size: 1.2em; font-weight: bold; line-height: 1.5"," PowerGrid"),console.error("%c%s","font-size: 1em; line-height: 1.5",`
Failed to mount filter: Filter::datetime('${this.dataField}') on table ['${this.tableName}']

• Install flatpickr: npm install flatpickr

• Add 'import flatpickr from "flatpickr"' in resources/js/app.js file
  `)),window.addEventListener(`pg:clear_flatpickr::${this.tableName}:${this.dataField}`,()=>{this.$refs.rangeInput&&this.element&&this.element.clear()}),window.addEventListener(`pg:clear_all_flatpickr::${this.tableName}`,()=>{this.$refs.rangeInput&&this.element&&this.element.clear()});try{const t=await uA(Object.assign({}),`./flatpickr/dist/l10n/${this.locale.locale}.js`,5);flatpickr.localize(t.default||t)}catch{}const e=this.getOptions();this.$refs.rangeInput&&typeof flatpickr<"u"&&(this.element=flatpickr(this.$refs.rangeInput,e),this.selectedDates=this.$wire.get(`filters.${this.type}.${this.dataField}.formatted`),this.element.setDate(this.selectedDates))},getOptions(){const e={mode:"range",defaultHour:0,...this.locale,...this.customConfig};return this.onlyFuture&&(e.minDate="today"),this.noWeekEnds&&(e.disable=[function(t){return t.getDay()===0||t.getDay()===6}]),e.onClose=(t,r,i)=>{t=t.map(o=>this.element.formatDate(o,"Y-m-d")),t.length>0&&this.selectedDates!==r&&Livewire.dispatch("pg:datePicker-"+this.tableName,{selectedDates:t,dateStr:r,timezone:this.customConfig.timezone??new Date().toString().match(/([-\+][0-9]+)\s/)[1],type:this.type,field:this.dataField,label:this.label,dateFormat:this.locale.dateFormat??"Y-m-d H:i"})},e}}),dA=n=>({theme:n.theme,id:n.id??null,dataField:n.dataField??null,content:n.content,fallback:n.fallback,inputClass:n.inputClass,saveOnMouseOut:n.saveOnMouseOut,oldContent:null,editable:!1,hash:null,hashError:!0,showEditable:!1,editableInput:"",init(){this.content.length===0&&this.fallback&&(this.content=this.htmlSpecialChars(this.fallback)),this.hash=this.dataField+"-"+this.id,window.addEventListener("toggle-"+this.hash,()=>{this.observe(()=>document.getElementById("clickable-"+this.hash),e=>{e.click(),this.observe(()=>document.getElementById("editable-"+this.hash),t=>{setTimeout(()=>this.setFocusToEnd(t),100)})})}),this.$watch("editable",e=>{if(e){let t=!1;if(this.showEditable=!1,this.content=this.htmlSpecialChars(this.content),this.oldContent=this.content,this.hashError=this.store().notContains(this.hash),this.observe(()=>document.getElementById("editable-"+this.hash),r=>{setTimeout(()=>{this.setFocusToEnd(r),this.store().getTextContent(this.hash)&&(r.textContent=this.store().getTextContent(this.hash))},30)}),this.hashError){const r=this.store().get(this.hash),i=document.getElementById("clickable-"+r);i&&i.click()}t=!0,this.editableInput=`
                <div
                    x-ref="editable"
                    x-text="content"
                    value="${this.content}"
                    placeholder="${this.content}"
                    contenteditable
                    class="pg-single-line ${this.inputClass}"
                    ${this.saveOnMouseOut?'x-on:mousedown.outside="save()"':""}
                    x-on:keydown.enter="save()"
                    id="${"editable-"+this.dataField+"-"+this.id}"
                    x-on:keydown.esc="cancel"
                >
                </div>`,this.$nextTick(()=>setTimeout(()=>{this.showEditable=t,this.focus()},150))}}),this.content=this.htmlSpecialChars(this.content)},store(){return window.editOnClickValidation},save(){this.store().clear(),this.store().set(this.hash,this.$el.textContent),this.observe(()=>document.getElementById("clickable-"+this.hash),e=>{e.textContent=this.$el.textContent}),window.addEventListener("pg:editable-close-"+this.id,()=>{this.store().clear(),this.editable=!1,this.showEditable=!1}),this.store().has(this.hash)||this.store().set(this.hash,this.$el.textContent),this.$wire.dispatch("pg:editable-"+this.$wire.tableName,{id:this.id,value:this.$el.textContent,field:this.dataField}),this.oldContent=this.store().getTextContent(this.hash),this.$nextTick(()=>{this.focus(),this.$el.setAttribute("value","")}),this.content=this.htmlSpecialChars(this.$el.textContent)},focus(){this.setFocusToEnd(this.$el)},cancel(){this.store().clear(),this.$refs.editable.textContent=this.oldContent,this.content=this.oldContent,this.editable=!1,this.showEditable=!1,this.$refs.error&&(this.$refs.error.innerHTML="")},htmlSpecialChars(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent},observe(e,t){new MutationObserver((r,i)=>{for(let o of r)if(o.type==="childList"){const s=e();if(s){t(s),i.disconnect();break}}}).observe(document.body,{childList:!0,subtree:!0})},setFocusToEnd(e){if(!e)return;const t=window.getSelection(),r=document.createRange();r.selectNodeContents(e),r.collapse(!1),t.removeAllRanges(),t.addRange(r),e.focus()}});function hA(n){n.querySelectorAll("tbody tr td").forEach(e=>{e.classList.remove("hidden")}),n.querySelectorAll("thead tr th").forEach(e=>{e.classList.remove("hidden")})}function fA(n){let e=0;const t=n.querySelectorAll("table thead tr:nth-child(1) th[fixed]"),r=Gh(n);return t.forEach(i=>{e+=Gh(i)}),r-e}function pA(n,e){const t=[].slice.call(n.querySelectorAll("table thead tr:nth-child(1) th")),r=Array.from(t).filter(l=>getComputedStyle(l).display!=="none"),i=[].slice.call(r).sort(function(l,u){const c=l.getAttribute("sort_order")??999,d=u.getAttribute("sort_order")??999;return c-d});let o=0,s=!0;const a=[];return i.forEach(l=>{const u=Gh(l);l.getAttribute("fixed")===null&&(s&&o<=e&&o+u<=e?o+=u:(a.push(r.indexOf(l)+1),s=!1))}),a}function gA(n,e){for(const t of e)n.querySelectorAll(`tbody:not(tbody[expand]) tr td:nth-child(${t})`).forEach(r=>{r.classList.add("hidden")}),n.querySelectorAll(`thead tr th:nth-child(${t})`).forEach(r=>{r.classList.add("hidden")})}function mA(n,e){var t,r;if(n.querySelectorAll("table tbody[expand] tr td div").length){for(const i of n.querySelectorAll("table tbody[expand] tr td div"))i.innerHTML="";if(e.length)for(const i of e){const o=n.querySelectorAll("table tbody:not(tbody[expand])");for(const s of o){const a=(t=s.nextElementSibling)==null?void 0:t.querySelector("tr td div");if(!a)continue;let l=n.querySelector(`table thead tr th:nth-child(${i}) span[data-value]`).textContent;const u=(r=s.querySelector(`tr:last-child td:nth-child(${i})`))==null?void 0:r.innerHTML;l.length&&(l+=":"),a.querySelector(`div[data-expand-item-${i}]`)||(a.innerHTML+=`<div class="responsive-row-expand-item-container" data-expand-item-${i}>
                    <span class="font-bold responsive-row-expand-item-name">${l}</span>
                    <span class="responsive-row-expand-item-value">${u}</span>
                </div>`)}}}}function Gh(n){return parseFloat(n.getBoundingClientRect().width.toFixed(2))}function vA(n){hA(n);const e=fA(n),t=pA(n,e);mA(n,t),gA(n,t)}const yA=()=>({running:!1,expanded:null,element:null,hasHiddenElements:!1,size:0,toggleExpanded(n){this.expanded=this.expanded==n?null:n},init(){this.$nextTick(()=>{this.handleResize(),this.observeElement(),window.addEventListener("pg-livewire-request-finished",()=>{setTimeout(()=>this.handleResize(),5)})})},handleResize(){var n;const e=this.$el;vA(e),this.hasHiddenElements=(n=e.querySelector("table tbody[expand] tr td div"))==null?void 0:n.innerHTML,this.hasHiddenElements||(this.expanded=null)},observeElement(){new ResizeObserver(n=>{n.forEach(e=>{if(e.contentRect.width>0){if(this.size===this.$el.getBoundingClientRect().width)return;this.size=this.$el.getBoundingClientRect().width,this.handleResize()}})}).observe(this.$el)}}),bA=(n,e,t)=>{Livewire.dispatch(`${n}-${e.tableName}`,{label:e.label,field:e.dataField,values:t})},Ix=(n,e)=>{bA("pg:multiSelect",n,e)};function md(n,e){n.split(/\s+/).forEach(t=>{e(t)})}class xA{constructor(){this._events={}}on(e,t){md(e,r=>{const i=this._events[r]||[];i.push(t),this._events[r]=i})}off(e,t){var r=arguments.length;if(r===0){this._events={};return}md(e,i=>{if(r===1){delete this._events[i];return}const o=this._events[i];o!==void 0&&(o.splice(o.indexOf(t),1),this._events[i]=o)})}trigger(e,...t){var r=this;md(e,i=>{const o=r._events[i];o!==void 0&&o.forEach(s=>{s.apply(r,t)})})}}function wA(n){return n.plugins={},class extends n{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){n.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,r;const i=this,o=[];if(Array.isArray(e))e.forEach(s=>{typeof s=="string"?o.push(s):(i.plugins.settings[s.name]=s.options,o.push(s.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(i.plugins.settings[t]=e[t],o.push(t));for(;r=o.shift();)i.require(r)}loadPlugin(e){var t=this,r=t.plugins,i=n.plugins[e];if(!n.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');r.requested[e]=!0,r.loaded[e]=i.fn.apply(t,[t.plugins.settings[e]||{}]),r.names.push(e)}require(e){var t=this,r=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(r.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return r.loaded[e]}}}const Cc=n=>(n=n.filter(Boolean),n.length<2?n[0]||"":CA(n)==1?"["+n.join("")+"]":"(?:"+n.join("|")+")"),Mx=n=>{if(!_A(n))return n.join("");let e="",t=0;const r=()=>{t>1&&(e+="{"+t+"}")};return n.forEach((i,o)=>{if(i===n[o-1]){t++;return}r(),e+=i,t=1}),r(),e},Ox=n=>{let e=Array.from(n);return Cc(e)},_A=n=>new Set(n).size!==n.length,xa=n=>(n+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),CA=n=>n.reduce((e,t)=>Math.max(e,EA(t)),0),EA=n=>Array.from(n).length,Px=n=>{if(n.length===1)return[[n]];let e=[];const t=n.substring(1);return Px(t).forEach(function(r){let i=r.slice(0);i[0]=n.charAt(0)+i[0],e.push(i),i=r.slice(0),i.unshift(n.charAt(0)),e.push(i)}),e},SA=[[0,65535]],DA="[̀-ͯ·ʾʼ]";let wu,Nx;const AA=3,lp={},Tm={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let n in Tm){let e=Tm[n]||"";for(let t=0;t<e.length;t++){let r=e.substring(t,t+1);lp[r]=n}}const kA=new RegExp(Object.keys(lp).join("|")+"|"+DA,"gu"),RA=n=>{wu===void 0&&(wu=OA(SA))},Im=(n,e="NFKD")=>n.normalize(e),_u=n=>Array.from(n).reduce((e,t)=>e+TA(t),""),TA=n=>(n=Im(n).toLowerCase().replace(kA,e=>lp[e]||""),Im(n,"NFC"));function*IA(n){for(const[e,t]of n)for(let r=e;r<=t;r++){let i=String.fromCharCode(r),o=_u(i);o!=i.toLowerCase()&&(o.length>AA||o.length!=0&&(yield{folded:o,composed:i,code_point:r}))}}const MA=n=>{const e={},t=(r,i)=>{const o=e[r]||new Set,s=new RegExp("^"+Ox(o)+"$","iu");i.match(s)||(o.add(xa(i)),e[r]=o)};for(let r of IA(n))t(r.folded,r.folded),t(r.folded,r.composed);return e},OA=n=>{const e=MA(n),t={};let r=[];for(let o in e){let s=e[o];s&&(t[o]=Ox(s)),o.length>1&&r.push(xa(o))}r.sort((o,s)=>s.length-o.length);const i=Cc(r);return Nx=new RegExp("^"+i,"u"),t},PA=(n,e=1)=>{let t=0;return n=n.map(r=>(wu[r]&&(t+=r.length),wu[r]||r)),t>=e?Mx(n):""},NA=(n,e=1)=>(e=Math.max(e,n.length-1),Cc(Px(n).map(t=>PA(t,e)))),Mm=(n,e=!0)=>{let t=n.length>1?1:0;return Cc(n.map(r=>{let i=[];const o=e?r.length():r.length()-1;for(let s=0;s<o;s++)i.push(NA(r.substrs[s]||"",t));return Mx(i)}))},FA=(n,e)=>{for(const t of e){if(t.start!=n.start||t.end!=n.end||t.substrs.join("")!==n.substrs.join(""))continue;let r=n.parts;const i=o=>{for(const s of r){if(s.start===o.start&&s.substr===o.substr)return!1;if(!(o.length==1||s.length==1)&&(o.start<s.start&&o.end>s.start||s.start<o.start&&s.end>o.start))return!0}return!1};if(!(t.parts.filter(i).length>0))return!0}return!1};let Om=class Fx{constructor(){ts(this,"parts"),ts(this,"substrs"),ts(this,"start"),ts(this,"end"),this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let r=new Fx,i=JSON.parse(JSON.stringify(this.parts)),o=i.pop();for(const l of i)r.add(l);let s=t.substr.substring(0,e-o.start),a=s.length;return r.add({start:o.start,end:o.start+a,length:a,substr:s}),r}};const LA=n=>{RA(),n=_u(n);let e="",t=[new Om];for(let r=0;r<n.length;r++){let i=n.substring(r).match(Nx);const o=n.substring(r,r+1),s=i?i[0]:null;let a=[],l=new Set;for(const u of t){const c=u.last();if(!c||c.length==1||c.end<=r)if(s){const d=s.length;u.add({start:r,end:r+d,length:d,substr:s}),l.add("1")}else u.add({start:r,end:r+1,length:1,substr:o}),l.add("2");else if(s){let d=u.clone(r,c);const h=s.length;d.add({start:r,end:r+h,length:h,substr:s}),a.push(d)}else l.add("3")}if(a.length>0){a=a.sort((u,c)=>u.length()-c.length());for(let u of a)FA(u,t)||t.push(u);continue}if(r>0&&l.size==1&&!l.has("3")){e+=Mm(t,!1);let u=new Om;const c=t[0];c&&u.add(c.last()),t=[u]}}return e+=Mm(t,!0),e},BA=(n,e)=>{if(n)return n[e]},HA=(n,e)=>{if(n){for(var t,r=e.split(".");(t=r.shift())&&(n=n[t]););return n}},vd=(n,e,t)=>{var r,i;return!n||(n=n+"",e.regex==null)||(i=n.search(e.regex),i===-1)?0:(r=e.string.length/n.length,i===0&&(r+=.5),r*t)},yd=(n,e)=>{var t=n[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(n[e]=[t])},pl=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},WA=(n,e)=>typeof n=="number"&&typeof e=="number"?n>e?1:n<e?-1:0:(n=_u(n+"").toLowerCase(),e=_u(e+"").toLowerCase(),n>e?1:e>n?-1:0);let zA=class{constructor(e,t){ts(this,"items"),ts(this,"settings"),this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,r){if(!e||!e.length)return[];const i=[],o=e.split(/\s+/);var s;return r&&(s=new RegExp("^("+Object.keys(r).map(xa).join("|")+"):(.*)$")),o.forEach(a=>{let l,u=null,c=null;s&&(l=a.match(s))&&(u=l[1],a=l[2]),a.length>0&&(this.settings.diacritics?c=LA(a)||null:c=xa(a),c&&t&&(c="\\b"+c)),i.push({string:a,regex:c?new RegExp(c,"iu"):null,field:u})}),i}getScoreFunction(e,t){var r=this.prepareSearch(e,t);return this._getScoreFunction(r)}_getScoreFunction(e){const t=e.tokens,r=t.length;if(!r)return function(){return 0};const i=e.options.fields,o=e.weights,s=i.length,a=e.getAttrFn;if(!s)return function(){return 1};const l=(function(){return s===1?function(u,c){const d=i[0].field;return vd(a(c,d),u,o[d]||1)}:function(u,c){var d=0;if(u.field){const h=a(c,u.field);!u.regex&&h?d+=1/s:d+=vd(h,u,1)}else pl(o,(h,f)=>{d+=vd(a(c,f),u,h)});return d/s}})();return r===1?function(u){return l(t[0],u)}:e.options.conjunction==="and"?function(u){var c,d=0;for(let h of t){if(c=l(h,u),c<=0)return 0;d+=c}return d/r}:function(u){var c=0;return pl(t,d=>{c+=l(d,u)}),c/r}}getSortFunction(e,t){var r=this.prepareSearch(e,t);return this._getSortFunction(r)}_getSortFunction(e){var t,r=[];const i=this,o=e.options,s=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof s=="function")return s.bind(this);const a=function(l,u){return l==="$score"?u.score:e.getAttrFn(i.items[u.id],l)};if(s)for(let l of s)(e.query||l.field!=="$score")&&r.push(l);if(e.query){t=!0;for(let l of r)if(l.field==="$score"){t=!1;break}t&&r.unshift({field:"$score",direction:"desc"})}else r=r.filter(l=>l.field!=="$score");return r.length?function(l,u){var c,d;for(let h of r)if(d=h.field,c=(h.direction==="desc"?-1:1)*WA(a(d,l),a(d,u)),c)return c;return 0}:null}prepareSearch(e,t){const r={};var i=Object.assign({},t);if(yd(i,"sort"),yd(i,"sort_empty"),i.fields){yd(i,"fields");const o=[];i.fields.forEach(s=>{typeof s=="string"&&(s={field:s,weight:1}),o.push(s),r[s.field]="weight"in s?s.weight:1}),i.fields=o}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,r),total:0,items:[],weights:r,getAttrFn:i.nesting?HA:BA}}search(e,t){var r=this,i,o;o=this.prepareSearch(e,t),t=o.options,e=o.query;const s=t.score||r._getScoreFunction(o);e.length?pl(r.items,(l,u)=>{i=s(l),(t.filter===!1||i>0)&&o.items.push({score:i,id:u})}):pl(r.items,(l,u)=>{o.items.push({score:1,id:u})});const a=r._getSortFunction(o);return a&&o.items.sort(a),o.total=o.items.length,typeof t.limit=="number"&&(o.items=o.items.slice(0,t.limit)),o}};const er=n=>typeof n>"u"||n===null?null:uu(n),uu=n=>typeof n=="boolean"?n?"1":"0":n+"",bd=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),VA=(n,e)=>e>0?window.setTimeout(n,e):(n.call(null),null),UA=(n,e)=>{var t;return function(r,i){var o=this;t&&(o.loading=Math.max(o.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,o.loadedSearches[r]=!0,n.call(o,r,i)},e)}},Pm=(n,e,t)=>{var r,i=n.trigger,o={};n.trigger=function(){var s=arguments[0];if(e.indexOf(s)!==-1)o[s]=arguments;else return i.apply(n,arguments)},t.apply(n,[]),n.trigger=i;for(r of e)r in o&&i.apply(n,o[r])},jA=n=>({start:n.selectionStart||0,length:(n.selectionEnd||0)-(n.selectionStart||0)}),bt=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},on=(n,e,t,r)=>{n.addEventListener(e,t,r)},$i=(n,e)=>{if(!e||!e[n])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},xd=(n,e)=>n.getAttribute("id")||(n.setAttribute("id",e),e),Nm=n=>n.replace(/[\\"']/g,"\\$&"),Gi=(n,e)=>{e&&n.append(e)},Ht=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},gr=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Lx(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Lx=n=>typeof n=="string"&&n.indexOf("<")>-1,$A=n=>n.replace(/['"\\]/g,"\\$&"),wd=(n,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),n.dispatchEvent(t)},gl=(n,e)=>{Object.assign(n.style,e)},Tn=(n,...e)=>{var t=Bx(e);n=Hx(n),n.map(r=>{t.map(i=>{r.classList.add(i)})})},ci=(n,...e)=>{var t=Bx(e);n=Hx(n),n.map(r=>{t.map(i=>{r.classList.remove(i)})})},Bx=n=>{var e=[];return Ht(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Hx=n=>(Array.isArray(n)||(n=[n]),n),_d=(n,e,t)=>{if(!(t&&!t.contains(n)))for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},Fm=(n,e=0)=>e>0?n[n.length-1]:n[0],GA=n=>Object.keys(n).length===0,Lm=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t},it=(n,e)=>{Ht(e,(t,r)=>{t==null?n.removeAttribute(r):n.setAttribute(r,""+t)})},qh=(n,e)=>{n.parentNode&&n.parentNode.replaceChild(e,n)},qA=(n,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=o=>{var s=o.data.match(e);if(s&&o.data.length>0){var a=document.createElement("span");a.className="highlight";var l=o.splitText(s.index);l.splitText(s[0].length);var u=l.cloneNode(!0);return a.appendChild(u),qh(l,a),1}return 0},r=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(s=>{i(s)})},i=o=>o.nodeType===3?t(o):(r(o),0);i(n)},YA=n=>{var e=n.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var r=t.parentNode;r.replaceChild(t.firstChild,t),r.normalize()})},XA=65,KA=13,QA=27,JA=37,ZA=38,ek=39,tk=40,Bm=8,nk=46,Hm=9,rk=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),ml=rk?"metaKey":"ctrlKey",Wm={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(n){return n.length>0},render:{}};function zm(n,e){var t=Object.assign({},Wm,e),r=t.dataAttr,i=t.labelField,o=t.valueField,s=t.disabledField,a=t.optgroupField,l=t.optgroupLabelField,u=t.optgroupValueField,c=n.tagName.toLowerCase(),d=n.getAttribute("placeholder")||n.getAttribute("data-placeholder");if(!d&&!t.allowEmptyOption){let g=n.querySelector('option[value=""]');g&&(d=g.textContent)}var h={placeholder:d,options:[],optgroups:[],items:[],maxItems:null},f=()=>{var g,m=h.options,v={},y=1;let b=0;var x=C=>{var E=Object.assign({},C.dataset),S=r&&E[r];return typeof S=="string"&&S.length&&(E=Object.assign(E,JSON.parse(S))),E},w=(C,E)=>{var S=er(C.value);if(S!=null&&!(!S&&!t.allowEmptyOption)){if(v.hasOwnProperty(S)){if(E){var D=v[S][a];D?Array.isArray(D)?D.push(E):v[S][a]=[D,E]:v[S][a]=E}}else{var k=x(C);k[i]=k[i]||C.textContent,k[o]=k[o]||S,k[s]=k[s]||C.disabled,k[a]=k[a]||E,k.$option=C,k.$order=k.$order||++b,v[S]=k,m.push(k)}C.selected&&h.items.push(S)}},_=C=>{var E,S;S=x(C),S[l]=S[l]||C.getAttribute("label")||"",S[u]=S[u]||y++,S[s]=S[s]||C.disabled,S.$order=S.$order||++b,h.optgroups.push(S),E=S[u],Ht(C.children,D=>{w(D,E)})};h.maxItems=n.hasAttribute("multiple")?null:1,Ht(n.children,C=>{g=C.tagName.toLowerCase(),g==="optgroup"?_(C):g==="option"&&w(C)})},p=()=>{const g=n.getAttribute(r);if(g)h.options=JSON.parse(g),Ht(h.options,v=>{h.items.push(v[o])});else{var m=n.value.trim()||"";if(!t.allowEmptyOption&&!m.length)return;const v=m.split(t.delimiter);Ht(v,y=>{const b={};b[i]=y,b[o]=y,h.options.push(b)}),h.items=v}};return c==="select"?f():p(),Object.assign({},Wm,h,e)}var Vm=0;let cn=class extends wA(xA){constructor(e,t){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Vm++;var r,i=gr(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(i,null);r=o.getPropertyValue("direction");const s=zm(i,t);this.settings=s,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(r),this.inputId=xd(i,"tomselect-"+Vm),this.isRequired=i.required,this.sifter=new zA(this.options,{diacritics:s.diacritics}),s.mode=s.mode||(s.maxItems===1?"single":"multi"),typeof s.hideSelected!="boolean"&&(s.hideSelected=s.mode==="multi"),typeof s.hidePlaceholder!="boolean"&&(s.hidePlaceholder=s.mode!=="multi");var a=s.createFilter;typeof a!="function"&&(typeof a=="string"&&(a=new RegExp(a)),a instanceof RegExp?s.createFilter=m=>a.test(m):s.createFilter=m=>this.settings.duplicates||!this.options[m]),this.initializePlugins(s.plugins),this.setupCallbacks(),this.setupTemplates();const l=gr("<div>"),u=gr("<div>"),c=this._render("dropdown"),d=gr('<div role="listbox" tabindex="-1">'),h=this.input.getAttribute("class")||"",f=s.mode;var p;if(Tn(l,s.wrapperClass,h,f),Tn(u,s.controlClass),Gi(l,u),Tn(c,s.dropdownClass,f),s.copyClassesToDropdown&&Tn(c,h),Tn(d,s.dropdownContentClass),Gi(c,d),gr(s.dropdownParent||l).appendChild(c),Lx(s.controlInput)){p=gr(s.controlInput);var g=["autocorrect","autocapitalize","autocomplete","spellcheck"];Ht(g,m=>{i.getAttribute(m)&&it(p,{[m]:i.getAttribute(m)})}),p.tabIndex=-1,u.appendChild(p),this.focus_node=p}else s.controlInput?(p=gr(s.controlInput),this.focus_node=p):(p=gr("<input/>"),this.focus_node=u);this.wrapper=l,this.dropdown=c,this.dropdown_content=d,this.control=u,this.control_input=p,this.setup()}setup(){const e=this,t=e.settings,r=e.control_input,i=e.dropdown,o=e.dropdown_content,s=e.wrapper,a=e.control,l=e.input,u=e.focus_node,c={passive:!0},d=e.inputId+"-ts-dropdown";it(o,{id:d}),it(u,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":d});const h=xd(u,e.inputId+"-ts-control"),f="label[for='"+$A(e.inputId)+"']",p=document.querySelector(f),g=e.focus.bind(e);if(p){on(p,"click",g),it(p,{for:h});const y=xd(p,e.inputId+"-ts-label");it(u,{"aria-labelledby":y}),it(o,{"aria-labelledby":y})}if(s.style.width=l.style.width,e.plugins.names.length){const y="plugin-"+e.plugins.names.join(" plugin-");Tn([s,i],y)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&it(l,{multiple:"multiple"}),t.placeholder&&it(r,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+xa(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=UA(t.load,t.loadThrottle)),on(i,"mousemove",()=>{e.ignoreHover=!1}),on(i,"mouseenter",y=>{var b=_d(y.target,"[data-selectable]",i);b&&e.onOptionHover(y,b)},{capture:!0}),on(i,"click",y=>{const b=_d(y.target,"[data-selectable]");b&&(e.onOptionSelect(y,b),bt(y,!0))}),on(a,"click",y=>{var b=_d(y.target,"[data-ts-item]",a);if(b&&e.onItemSelect(y,b)){bt(y,!0);return}r.value==""&&(e.onClick(),bt(y,!0))}),on(u,"keydown",y=>e.onKeyDown(y)),on(r,"keypress",y=>e.onKeyPress(y)),on(r,"input",y=>e.onInput(y)),on(u,"blur",y=>e.onBlur(y)),on(u,"focus",y=>e.onFocus(y)),on(r,"paste",y=>e.onPaste(y));const m=y=>{const b=y.composedPath()[0];if(!s.contains(b)&&!i.contains(b)){e.isFocused&&e.blur(),e.inputState();return}b==r&&e.isOpen?y.stopPropagation():bt(y,!0)},v=()=>{e.isOpen&&e.positionDropdown()};on(document,"mousedown",m),on(window,"scroll",v,c),on(window,"resize",v,c),this._destroy=()=>{document.removeEventListener("mousedown",m),window.removeEventListener("scroll",v),window.removeEventListener("resize",v),p&&p.removeEventListener("click",g)},this.revertSettings={innerHTML:l.innerHTML,tabIndex:l.tabIndex},l.tabIndex=-1,l.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,on(l,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,l.disabled?e.disable():l.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),Tn(l,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),Ht(t,r=>{this.registerOptionGroup(r)})}setupTemplates(){var e=this,t=e.settings.labelField,r=e.settings.optgroupLabelField,i={optgroup:o=>{let s=document.createElement("div");return s.className="optgroup",s.appendChild(o.options),s},optgroup_header:(o,s)=>'<div class="optgroup-header">'+s(o[r])+"</div>",option:(o,s)=>"<div>"+s(o[t])+"</div>",item:(o,s)=>"<div>"+s(o[t])+"</div>",option_create:(o,s)=>'<div class="create">Add <strong>'+s(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,t,r={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in r)t=this.settings[r[e]],t&&this.on(e,t)}sync(e=!0){const t=this,r=e?zm(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(r.options,r.optgroups),t.setValue(r.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){wd(this.input,"input"),wd(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){bt(e);return}t.settings.splitOn&&setTimeout(()=>{var r=t.inputValue();if(r.match(t.settings.splitOn)){var i=r.trim().split(t.settings.splitOn);Ht(i,o=>{er(o)&&(this.options[o]?t.addItem(o):t.createItem(o))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){bt(e);return}var r=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&r===t.settings.delimiter){t.createItem(),bt(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==Hm&&bt(e);return}switch(e.keyCode){case XA:if($i(ml,e)&&t.control_input.value==""){bt(e),t.selectAll();return}break;case QA:t.isOpen&&(bt(e,!0),t.close()),t.clearActiveItems();return;case tk:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let r=t.getAdjacent(t.activeOption,1);r&&t.setActiveOption(r)}bt(e);return;case ZA:if(t.activeOption){let r=t.getAdjacent(t.activeOption,-1);r&&t.setActiveOption(r)}bt(e);return;case KA:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),bt(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&bt(e);return;case JA:t.advanceSelection(-1,e);return;case ek:t.advanceSelection(1,e);return;case Hm:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),bt(e)),t.settings.create&&t.createItem()&&bt(e));return;case Bm:case nk:t.deleteSelection(e);return}t.isInputHidden&&!$i(ml,e)&&bt(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=VA(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,r=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),bt(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),r||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var r=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,r):r()}}}onOptionSelect(e,t){var r,i=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(r=t.dataset.value,typeof r<"u"&&(i.lastQuery=null,i.addItem(r),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var r=this;return!r.isLocked&&r.settings.mode==="multi"?(bt(e),r.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;Tn(t.wrapper,t.settings.loadingClass),t.loading++;const r=t.loadCallback.bind(t);t.settings.load.call(t,e,r)}loadCallback(e,t){const r=this;r.loading=Math.max(r.loading-1,0),r.lastQuery=null,r.clearActiveOption(),r.setupOptions(e,t),r.refreshOptions(r.isFocused&&!r.isInputHidden),r.loading||ci(r.wrapper,r.settings.loadingClass),r.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,r=t.value!==e;r&&(t.value=e,wd(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var r=t?[]:["change"];Pm(this,r,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var r=this,i,o,s,a,l,u;if(r.settings.mode!=="single"){if(!e){r.clearActiveItems(),r.isFocused&&r.inputState();return}if(i=t&&t.type.toLowerCase(),i==="click"&&$i("shiftKey",t)&&r.activeItems.length){for(u=r.getLastActive(),s=Array.prototype.indexOf.call(r.control.children,u),a=Array.prototype.indexOf.call(r.control.children,e),s>a&&(l=s,s=a,a=l),o=s;o<=a;o++)e=r.control.children[o],r.activeItems.indexOf(e)===-1&&r.setActiveItemClass(e);bt(t)}else i==="click"&&$i(ml,t)||i==="keydown"&&$i("shiftKey",t)?e.classList.contains("active")?r.removeActiveItem(e):r.setActiveItemClass(e):(r.clearActiveItems(),r.setActiveItemClass(e));r.inputState(),r.isFocused||r.focus()}}setActiveItemClass(e){const t=this,r=t.control.querySelector(".last-active");r&&ci(r,"last-active"),Tn(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),ci(e,"active")}clearActiveItems(){ci(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,it(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),it(e,{"aria-selected":"true"}),Tn(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const r=this.dropdown_content,i=r.clientHeight,o=r.scrollTop||0,s=e.offsetHeight,a=e.getBoundingClientRect().top-r.getBoundingClientRect().top+o;a+s>i+o?this.scroll(a-i+s,t):a<o&&this.scroll(a,t)}scroll(e,t){const r=this.dropdown_content;t&&(r.style.scrollBehavior=t),r.scrollTop=e,r.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(ci(this.activeOption,"active"),it(this.activeOption,{"aria-selected":null})),this.activeOption=null,it(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,Ht(t,r=>{e.setActiveItemClass(r)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(it(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&it(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,r,i=this,o=this.getSearchOptions();if(i.settings.score&&(r=i.settings.score.call(i,e),typeof r!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,t=i.sifter.search(e,Object.assign(o,{score:r})),i.currentResults=t):t=Object.assign({},i.currentResults),i.settings.hideSelected&&(t.items=t.items.filter(s=>{let a=er(s.id);return!(a&&i.items.indexOf(a)!==-1)})),t}refreshOptions(e=!0){var t,r,i,o,s,a,l,u,c,d;const h={},f=[];var p=this,g=p.inputValue();const m=g===p.lastQuery||g==""&&p.lastQuery==null;var v=p.search(g),y=null,b=p.settings.shouldOpen||!1,x=p.dropdown_content;m&&(y=p.activeOption,y&&(c=y.closest("[data-group]"))),o=v.items.length,typeof p.settings.maxOptions=="number"&&(o=Math.min(o,p.settings.maxOptions)),o>0&&(b=!0);const w=(C,E)=>{let S=h[C];if(S!==void 0){let k=f[S];if(k!==void 0)return[S,k.fragment]}let D=document.createDocumentFragment();return S=f.length,f.push({fragment:D,order:E,optgroup:C}),[S,D]};for(t=0;t<o;t++){let C=v.items[t];if(!C)continue;let E=C.id,S=p.options[E];if(S===void 0)continue;let D=uu(E),k=p.getOption(D,!0);for(p.settings.hideSelected||k.classList.toggle("selected",p.items.includes(D)),s=S[p.settings.optgroupField]||"",a=Array.isArray(s)?s:[s],r=0,i=a&&a.length;r<i;r++){s=a[r];let M=S.$order,B=p.optgroups[s];B===void 0?s="":M=B.$order;const[H,F]=w(s,M);r>0&&(k=k.cloneNode(!0),it(k,{id:S.$id+"-clone-"+r,"aria-selected":null}),k.classList.add("ts-cloned"),ci(k,"active"),p.activeOption&&p.activeOption.dataset.value==E&&c&&c.dataset.group===s.toString()&&(y=k)),F.appendChild(k),s!=""&&(h[s]=H)}}p.settings.lockOptgroupOrder&&f.sort((C,E)=>C.order-E.order),l=document.createDocumentFragment(),Ht(f,C=>{let E=C.fragment,S=C.optgroup;if(!E||!E.children.length)return;let D=p.optgroups[S];if(D!==void 0){let k=document.createDocumentFragment(),M=p.render("optgroup_header",D);Gi(k,M),Gi(k,E);let B=p.render("optgroup",{group:D,options:k});Gi(l,B)}else Gi(l,E)}),x.innerHTML="",Gi(x,l),p.settings.highlight&&(YA(x),v.query.length&&v.tokens.length&&Ht(v.tokens,C=>{qA(x,C.regex)}));var _=C=>{let E=p.render(C,{input:g});return E&&(b=!0,x.insertBefore(E,x.firstChild)),E};if(p.loading?_("loading"):p.settings.shouldLoad.call(p,g)?v.items.length===0&&_("no_results"):_("not_loading"),u=p.canCreate(g),u&&(d=_("option_create")),p.hasOptions=v.items.length>0||u,b){if(v.items.length>0){if(!y&&p.settings.mode==="single"&&p.items[0]!=null&&(y=p.getOption(p.items[0])),!x.contains(y)){let C=0;d&&!p.settings.addPrecedence&&(C=1),y=p.selectable()[C]}}else d&&(y=d);e&&!p.isOpen&&(p.open(),p.scrollToOption(y,"auto")),p.setActiveOption(y)}else p.clearActiveOption(),e&&p.isOpen&&p.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const r=this;if(Array.isArray(e))return r.addOptions(e,t),!1;const i=er(e[r.settings.valueField]);return i===null||r.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++r.order,e.$id=r.inputId+"-opt-"+e.$order,r.options[i]=e,r.lastQuery=null,t&&(r.userOptions[i]=t,r.trigger("option_add",i,e)),i)}addOptions(e,t=!1){Ht(e,r=>{this.addOption(r,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=er(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var r;t[this.settings.optgroupValueField]=e,(r=this.registerOptionGroup(t))&&this.trigger("optgroup_add",r,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const r=this;var i,o;const s=er(e),a=er(t[r.settings.valueField]);if(s===null)return;const l=r.options[s];if(l==null)return;if(typeof a!="string")throw new Error("Value must be set in option data");const u=r.getOption(s),c=r.getItem(s);if(t.$order=t.$order||l.$order,delete r.options[s],r.uncacheValue(a),r.options[a]=t,u){if(r.dropdown_content.contains(u)){const d=r._render("option",t);qh(u,d),r.activeOption===u&&r.setActiveOption(d)}u.remove()}c&&(o=r.items.indexOf(s),o!==-1&&r.items.splice(o,1,a),i=r._render("item",t),c.classList.contains("active")&&Tn(i,"active"),qh(c,i)),r.lastQuery=null}removeOption(e,t){const r=this;e=uu(e),r.uncacheValue(e),delete r.userOptions[e],delete r.options[e],r.lastQuery=null,r.trigger("option_remove",e),r.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const r={};Ht(this.options,(i,o)=>{t(i,o)&&(r[o]=i)}),this.options=this.sifter.items=r,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const r=er(e);if(r===null)return null;const i=this.options[r];if(i!=null){if(i.$div)return i.$div;if(t)return this._render("option",i)}return null}getAdjacent(e,t,r="option"){var i=this,o;if(!e)return null;r=="item"?o=i.controlChildren():o=i.dropdown_content.querySelectorAll("[data-selectable]");for(let s=0;s<o.length;s++)if(o[s]==e)return t>0?o[s+1]:o[s-1];return null}getItem(e){if(typeof e=="object")return e;var t=er(e);return t!==null?this.control.querySelector(`[data-value="${Nm(t)}"]`):null}addItems(e,t){var r=this,i=Array.isArray(e)?e:[e];i=i.filter(s=>r.items.indexOf(s)===-1);const o=i[i.length-1];i.forEach(s=>{r.isPending=s!==o,r.addItem(s,t)})}addItem(e,t){var r=t?[]:["change","dropdown_close"];Pm(this,r,()=>{var i,o;const s=this,a=s.settings.mode,l=er(e);if(!(l&&s.items.indexOf(l)!==-1&&(a==="single"&&s.close(),a==="single"||!s.settings.duplicates))&&!(l===null||!s.options.hasOwnProperty(l))&&(a==="single"&&s.clear(t),!(a==="multi"&&s.isFull()))){if(i=s._render("item",s.options[l]),s.control.contains(i)&&(i=i.cloneNode(!0)),o=s.isFull(),s.items.splice(s.caretPos,0,l),s.insertAtCaret(i),s.isSetup){if(!s.isPending&&s.settings.hideSelected){let u=s.getOption(l),c=s.getAdjacent(u,1);c&&s.setActiveOption(c)}!s.isPending&&!s.settings.closeAfterSelect&&s.refreshOptions(s.isFocused&&a!=="single"),s.settings.closeAfterSelect!=!1&&s.isFull()?s.close():s.isPending||s.positionDropdown(),s.trigger("item_add",l,i),s.isPending||s.updateOriginalInput({silent:t})}(!s.isPending||!o&&s.isFull())&&(s.inputState(),s.refreshState())}})}removeItem(e=null,t){const r=this;if(e=r.getItem(e),!e)return;var i,o;const s=e.dataset.value;i=Lm(e),e.remove(),e.classList.contains("active")&&(o=r.activeItems.indexOf(e),r.activeItems.splice(o,1),ci(e,"active")),r.items.splice(i,1),r.lastQuery=null,!r.settings.persist&&r.userOptions.hasOwnProperty(s)&&r.removeOption(s,t),i<r.caretPos&&r.setCaret(r.caretPos-1),r.updateOriginalInput({silent:t}),r.refreshState(),r.positionDropdown(),r.trigger("item_remove",s,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var r=this,i=r.caretPos,o;if(e=e||r.inputValue(),!r.canCreate(e))return t(),!1;r.lock();var s=!1,a=l=>{if(r.unlock(),!l||typeof l!="object")return t();var u=er(l[r.settings.valueField]);if(typeof u!="string")return t();r.setTextboxValue(),r.addOption(l,!0),r.setCaret(i),r.addItem(u),t(l),s=!0};return typeof r.settings.create=="function"?o=r.settings.create.call(this,e,a):o={[r.settings.labelField]:e,[r.settings.valueField]:e},s||a(o),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),r=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",r),i.toggle("full",t),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",GA(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var r,i;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){let s=function(u,c,d){return u||(u=gr('<option value="'+bd(c)+'">'+bd(d)+"</option>")),u!=o&&t.input.append(u),a.push(u),(u!=o||l>0)&&(u.selected=!0),u};const a=[],l=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(u=>{u.selected=!1}),t.items.length==0&&t.settings.mode=="single"?s(o,"",""):t.items.forEach(u=>{if(r=t.options[u],i=r[t.settings.labelField]||"",a.includes(r.$option)){const c=t.input.querySelector(`option[value="${Nm(u)}"]:not(:checked)`);s(c,u,i)}else r.$option=s(r.$option,u,i)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,it(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),gl(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),gl(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,r=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,it(t.focus_node,{"aria-expanded":"false"}),gl(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),r&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),r=e.offsetHeight+t.top+window.scrollY,i=t.left+window.scrollX;gl(this.dropdown,{width:t.width+"px",top:r+"px",left:i+"px"})}}clear(e){var t=this;if(t.items.length){var r=t.controlChildren();Ht(r,i=>{t.removeItem(i,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,r=t.caretPos,i=t.control;i.insertBefore(e,i.children[r]||null),t.setCaret(r+1)}deleteSelection(e){var t,r,i,o,s=this;t=e&&e.keyCode===Bm?-1:1,r=jA(s.control_input);const a=[];if(s.activeItems.length)o=Fm(s.activeItems,t),i=Lm(o),t>0&&i++,Ht(s.activeItems,l=>a.push(l));else if((s.isFocused||s.settings.mode==="single")&&s.items.length){const l=s.controlChildren();let u;t<0&&r.start===0&&r.length===0?u=l[s.caretPos-1]:t>0&&r.start===s.inputValue().length&&(u=l[s.caretPos]),u!==void 0&&a.push(u)}if(!s.shouldDelete(a,e))return!1;for(bt(e,!0),typeof i<"u"&&s.setCaret(i);a.length;)s.removeItem(a.pop());return s.inputState(),s.positionDropdown(),s.refreshOptions(!1),!0}shouldDelete(e,t){const r=e.map(i=>i.dataset.value);return!(!r.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(r,t)===!1)}advanceSelection(e,t){var r,i,o=this;o.rtl&&(e*=-1),!o.inputValue().length&&($i(ml,t)||$i("shiftKey",t)?(r=o.getLastActive(e),r?r.classList.contains("active")?i=o.getAdjacent(r,e,"item"):i=r:e>0?i=o.control_input.nextElementSibling:i=o.control_input.previousElementSibling,i&&(i.classList.contains("active")&&o.removeActiveItem(r),o.setActiveItemClass(i))):o.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var r=this.control.querySelectorAll(".active");if(r)return Fm(r,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,ci(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var r,i;const o=this;if(typeof this.settings.render[e]!="function"||(i=o.settings.render[e].call(this,t,bd),!i))return null;if(i=gr(i),e==="option"||e==="option_create"?t[o.settings.disabledField]?it(i,{"aria-disabled":"true"}):it(i,{"data-selectable":""}):e==="optgroup"&&(r=t.group[o.settings.optgroupValueField],it(i,{"data-group":r}),t.group[o.settings.disabledField]&&it(i,{"data-disabled":""})),e==="option"||e==="item"){const s=uu(t[o.settings.valueField]);it(i,{"data-value":s}),e==="item"?(Tn(i,o.settings.itemClass),it(i,{"data-ts-item":""})):(Tn(i,o.settings.optionClass),it(i,{role:"option",id:t.$id}),t.$div=i,o.options[s]=t)}return i}_render(e,t){const r=this.render(e,t);if(r==null)throw"HTMLElement expected";return r}clearCache(){Ht(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,r){var i=this,o=i[t];i[t]=function(){var s,a;return e==="after"&&(s=o.apply(i,arguments)),a=r.apply(i,arguments),e==="instead"?a:(e==="before"&&(s=o.apply(i,arguments)),s)}}};const ik=(n,e,t,r)=>{n.addEventListener(e,t,r)};function ok(){ik(this.input,"change",()=>{this.sync()})}const sk=n=>typeof n>"u"||n===null?null:ak(n),ak=n=>typeof n=="boolean"?n?"1":"0":n+"",Um=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},lk=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(uk(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},uk=n=>typeof n=="string"&&n.indexOf("<")>-1;function ck(n){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const r=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},n);var i=function(s,a){a?(s.checked=!0,r.uncheckedClassNames&&s.classList.remove(...r.uncheckedClassNames),r.checkedClassNames&&s.classList.add(...r.checkedClassNames)):(s.checked=!1,r.checkedClassNames&&s.classList.remove(...r.checkedClassNames),r.uncheckedClassNames&&s.classList.add(...r.uncheckedClassNames))},o=function(s){setTimeout(()=>{var a=s.querySelector("input."+r.className);a instanceof HTMLInputElement&&i(a,s.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var s=e.settings.render.option;e.settings.render.option=(a,l)=>{var u=lk(s.call(e,a,l)),c=document.createElement("input");r.className&&c.classList.add(r.className),c.addEventListener("click",function(h){Um(h)}),c.type="checkbox";const d=sk(a[e.settings.valueField]);return i(c,!!(d&&e.items.indexOf(d)>-1)),u.prepend(c),u}}),e.on("item_remove",s=>{var a=e.getOption(s);a&&(a.classList.remove("selected"),o(a))}),e.on("item_add",s=>{var a=e.getOption(s);a&&o(a)}),e.hook("instead","onOptionSelect",(s,a)=>{if(a.classList.contains("selected")){a.classList.remove("selected"),e.removeItem(a.dataset.value),e.refreshOptions(),Um(s,!0);return}t.call(e,s,a),o(a)})}const dk=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(hk(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},hk=n=>typeof n=="string"&&n.indexOf("<")>-1;function fk(n){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:r=>`<div class="${r.className}" title="${r.title}">&#10799;</div>`},n);e.on("initialize",()=>{var r=dk(t.html(t));r.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(r)})}const pk=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},zo=(n,e,t,r)=>{n.addEventListener(e,t,r)},gk=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},mk=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(vk(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},vk=n=>typeof n=="string"&&n.indexOf("<")>-1,yk=(n,e)=>{gk(e,(t,r)=>{t==null?n.removeAttribute(r):n.setAttribute(r,""+t)})},bk=(n,e)=>{var t;(t=n.parentNode)==null||t.insertBefore(e,n.nextSibling)},xk=(n,e)=>{var t;(t=n.parentNode)==null||t.insertBefore(e,n)},wk=(n,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,n==e)return!0}while(e&&e.previousElementSibling);return!1};function _k(){var n=this;if(n.settings.mode!=="multi")return;var e=n.lock,t=n.unlock;let r=!0,i;n.hook("after","setupTemplates",()=>{var o=n.settings.render.item;n.settings.render.item=(s,a)=>{const l=mk(o.call(n,s,a));yk(l,{draggable:"true"});const u=g=>{r||pk(g),g.stopPropagation()},c=g=>{i=l,setTimeout(()=>{l.classList.add("ts-dragging")},0)},d=g=>{g.preventDefault(),l.classList.add("ts-drag-over"),f(l,i)},h=()=>{l.classList.remove("ts-drag-over")},f=(g,m)=>{m!==void 0&&(wk(m,l)?bk(g,m):xk(g,m))},p=()=>{var g;document.querySelectorAll(".ts-drag-over").forEach(v=>v.classList.remove("ts-drag-over")),(g=i)==null||g.classList.remove("ts-dragging"),i=void 0;var m=[];n.control.querySelectorAll("[data-value]").forEach(v=>{if(v.dataset.value){let y=v.dataset.value;y&&m.push(y)}}),n.setValue(m)};return zo(l,"mousedown",u),zo(l,"dragstart",c),zo(l,"dragenter",d),zo(l,"dragover",d),zo(l,"dragleave",h),zo(l,"dragend",p),l}}),n.hook("instead","lock",()=>(r=!1,e.call(n))),n.hook("instead","unlock",()=>(r=!0,t.call(n)))}const Ck=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Ek=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Sk(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Sk=n=>typeof n=="string"&&n.indexOf("<")>-1;function Dk(n){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:r=>'<div class="'+r.headerClass+'"><div class="'+r.titleRowClass+'"><span class="'+r.labelClass+'">'+r.title+'</span><a class="'+r.closeClass+'">&times;</a></div></div>'},n);e.on("initialize",()=>{var r=Ek(t.html(t)),i=r.querySelector("."+t.closeClass);i&&i.addEventListener("click",o=>{Ck(o,!0),e.close()}),e.dropdown.insertBefore(r,e.dropdown.firstChild)})}const Ak=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},kk=(n,...e)=>{var t=Rk(e);n=Tk(n),n.map(r=>{t.map(i=>{r.classList.remove(i)})})},Rk=n=>{var e=[];return Ak(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Tk=n=>(Array.isArray(n)||(n=[n]),n),Ik=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t};function Mk(){var n=this;n.hook("instead","setCaret",e=>{n.settings.mode==="single"||!n.control.contains(n.control_input)?e=n.items.length:(e=Math.max(0,Math.min(n.items.length,e)),e!=n.caretPos&&!n.isPending&&n.controlChildren().forEach((t,r)=>{r<e?n.control_input.insertAdjacentElement("beforebegin",t):n.control.appendChild(t)})),n.caretPos=e}),n.hook("instead","moveCaret",e=>{if(!n.isFocused)return;const t=n.getLastActive(e);if(t){const r=Ik(t);n.setCaret(e>0?r+1:r),n.setActiveItem(),kk(t,"last-active")}else n.setCaret(n.caretPos+e)})}const Ok=27,Pk=9,Nk=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Fk=(n,e,t,r)=>{n.addEventListener(e,t,r)},Lk=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},jm=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Bk(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Bk=n=>typeof n=="string"&&n.indexOf("<")>-1,Hk=(n,...e)=>{var t=Wk(e);n=zk(n),n.map(r=>{t.map(i=>{r.classList.add(i)})})},Wk=n=>{var e=[];return Lk(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},zk=n=>(Array.isArray(n)||(n=[n]),n);function Vk(){const n=this;n.settings.shouldOpen=!0,n.hook("before","setup",()=>{n.focus_node=n.control,Hk(n.control_input,"dropdown-input");const e=jm('<div class="dropdown-input-wrap">');e.append(n.control_input),n.dropdown.insertBefore(e,n.dropdown.firstChild);const t=jm('<input class="items-placeholder" tabindex="-1" />');t.placeholder=n.settings.placeholder||"",n.control.append(t)}),n.on("initialize",()=>{n.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case Ok:n.isOpen&&(Nk(t,!0),n.close()),n.clearActiveItems();return;case Pk:n.focus_node.tabIndex=-1;break}return n.onKeyDown.call(n,t)}),n.on("blur",()=>{n.focus_node.tabIndex=n.isDisabled?-1:n.tabIndex}),n.on("dropdown_open",()=>{n.control_input.focus()});const e=n.onBlur;n.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==n.control_input))return e.call(n)}),Fk(n.control_input,"blur",()=>n.onBlur()),n.hook("before","close",()=>{n.isOpen&&n.focus_node.focus({preventScroll:!0})})})}const vl=(n,e,t,r)=>{n.addEventListener(e,t,r)};function Uk(){var n=this;n.on("initialize",()=>{var e=document.createElement("span"),t=n.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",n.wrapper.appendChild(e);var r=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of r)e.style[o]=t.style[o];var i=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};i(),n.on("update item_add item_remove",i),vl(t,"input",i),vl(t,"keyup",i),vl(t,"blur",i),vl(t,"update",i)})}function jk(){var n=this,e=n.deleteSelection;this.hook("instead","deleteSelection",t=>n.activeItems.length?e.call(n,t):!1)}function $k(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const $m=37,Gk=39,qk=(n,e,t)=>{for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},Yk=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t};function Xk(){var n=this,e=n.onKeyDown;n.hook("instead","onKeyDown",t=>{var r,i,o,s;if(!n.isOpen||!(t.keyCode===$m||t.keyCode===Gk))return e.call(n,t);n.ignoreHover=!0,s=qk(n.activeOption,"[data-group]"),r=Yk(n.activeOption,"[data-selectable]"),s&&(t.keyCode===$m?s=s.previousSibling:s=s.nextSibling,s&&(o=s.querySelectorAll("[data-selectable]"),i=o[Math.min(o.length-1,r)],i&&n.setActiveOption(i)))})}const Kk=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Gm=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},qm=(n,e,t,r)=>{n.addEventListener(e,t,r)},Ym=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Qk(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Qk=n=>typeof n=="string"&&n.indexOf("<")>-1;function Jk(n){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},n);var t=this;if(e.append){var r='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Kk(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var i=t.settings.render.item;t.settings.render.item=(o,s)=>{var a=Ym(i.call(t,o,s)),l=Ym(r);return a.appendChild(l),qm(l,"mousedown",u=>{Gm(u,!0)}),qm(l,"click",u=>{t.isLocked||(Gm(u,!0),!t.isLocked&&t.shouldDelete([a],u)&&(t.removeItem(a),t.refreshOptions(!1),t.inputState()))}),a}})}}function Zk(n){const e=this,t=Object.assign({text:r=>r[e.settings.labelField]},n);e.on("item_remove",function(r){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[r];i&&e.setTextboxValue(t.text.call(e,i))}})}const eR=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},tR=(n,...e)=>{var t=nR(e);n=rR(n),n.map(r=>{t.map(i=>{r.classList.add(i)})})},nR=n=>{var e=[];return eR(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},rR=n=>(Array.isArray(n)||(n=[n]),n);function iR(){const n=this,e=n.canLoad,t=n.clearActiveOption,r=n.loadCallback;var i={},o,s=!1,a,l=[];if(n.settings.shouldLoadMore||(n.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(n.activeOption){var d=n.selectable(),h=Array.from(d).indexOf(n.activeOption);if(h>=d.length-2)return!0}return!1}),!n.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";n.settings.sortField=[{field:"$order"},{field:"$score"}];const u=d=>typeof n.settings.maxOptions=="number"&&o.children.length>=n.settings.maxOptions?!1:!!(d in i&&i[d]),c=(d,h)=>n.items.indexOf(h)>=0||l.indexOf(h)>=0;n.setNextUrl=(d,h)=>{i[d]=h},n.getUrl=d=>{if(d in i){const h=i[d];return i[d]=!1,h}return n.clearPagination(),n.settings.firstUrl.call(n,d)},n.clearPagination=()=>{i={}},n.hook("instead","clearActiveOption",()=>{if(!s)return t.call(n)}),n.hook("instead","canLoad",d=>d in i?u(d):e.call(n,d)),n.hook("instead","loadCallback",(d,h)=>{if(!s)n.clearOptions(c);else if(a){const f=d[0];f!==void 0&&(a.dataset.value=f[n.settings.valueField])}r.call(n,d,h),s=!1}),n.hook("after","refreshOptions",()=>{const d=n.lastValue;var h;u(d)?(h=n.render("loading_more",{query:d}),h&&(h.setAttribute("data-selectable",""),a=h)):d in i&&!o.querySelector(".no-results")&&(h=n.render("no_more_results",{query:d})),h&&(tR(h,n.settings.optionClass),o.append(h))}),n.on("initialize",()=>{l=Object.keys(n.options),o=n.dropdown_content,n.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},n.settings.render),o.addEventListener("scroll",()=>{n.settings.shouldLoadMore.call(n)&&u(n.lastValue)&&(s||(s=!0,n.load.call(n,n.lastValue)))})})}cn.define("change_listener",ok);cn.define("checkbox_options",ck);cn.define("clear_button",fk);cn.define("drag_drop",_k);cn.define("dropdown_header",Dk);cn.define("caret_position",Mk);cn.define("dropdown_input",Vk);cn.define("input_autogrow",Uk);cn.define("no_backspace_delete",jk);cn.define("no_active_items",$k);cn.define("optgroup_columns",Xk);cn.define("remove_button",Jk);cn.define("restore_on_backspace",Zk);cn.define("virtual_scroll",iR);const oR=n=>({init(){const e=this.$refs[`select_picker_${n.dataField}_${n.tableName}`],t={items:n.initialValues,...n.framework,onChange:o=>{Ix(n,o)},onInitialize:()=>{n.appliedFilters&&n.dataField&&this.applyFilterForDataField(n.appliedFilters,n.dataField,e),window.addEventListener(`pg:clear_multi_select::${n.tableName}:${n.dataField}`,()=>{e&&e.tomselect.clear(!0)}),window.addEventListener(`pg:clear_all_multi_select::${n.tableName}`,()=>{e&&e.tomselect.clear(!0)})}},r={valueField:n.optionValue,labelField:n.optionLabel,searchField:n.optionLabel,load:async function(o,s){function a(l,u){var c;const{method:d,url:h}=l,f=new Request(h,{method:d,body:d.toLowerCase()==="post"?JSON.stringify({search:u,...i}):void 0});f.headers.set("Content-Type","application/json"),f.headers.set("Accept","application/json"),f.headers.set("X-Requested-With","XMLHttpRequest");const p=(c=document.head.querySelector('[name="csrf-token"]'))==null?void 0:c.getAttribute("content");return p&&f.headers.set("X-CSRF-TOKEN",p),f}fetch(a(n.asyncData,o)).then(l=>l.json()).then(l=>{s(l)}).catch(()=>{s()})},render:{option:function(o,s){return`<div class="py-2 mb-1"><span>${s(o[n.optionLabel])}</span></div>`},item:function(o,s){return`<div class="py-2 mb-1"><span>${s(o[n.optionLabel])}</span></div>`}}};let i=t;n.hasOwnProperty("asyncData")&&(i=Object.assign(t,r)),new cn(e,i)},applyFilterForDataField(e,t,r){const i=t.split(".");let o=e;for(const s of i)if(o&&typeof o=="object"&&o.hasOwnProperty(s))o=o[s];else return;Array.isArray(o)&&o.length>0&&r.tomselect.addItems(o)}}),sR=n=>({initialValues:n.initialValues,framework:n.framework,init(){const e=this.$refs["select_picker_"+n.dataField+"_"+n.tableName],t=this.deepCopy(this.framework);new window.SlimSelect({select:e,...t,events:{afterChange:r=>{let i=r.map(o=>o.value);Ix(n,i)}}}),n.appliedFilters&&n.dataField&&this.applyFilterForDataField(n.appliedFilters,n.dataField,e),window.addEventListener("pg:clear_multi_select::"+n.tableName+":"+n.dataField,()=>{e.slim.setSelected([],!1)}),window.addEventListener("pg:clear_all_multi_select::"+n.tableName,()=>{e.slim.setSelected([],!1)})},applyFilterForDataField(e,t,r){const i=t.split(".");let o=e;for(const s of i)if(o&&typeof o=="object"&&o.hasOwnProperty(s))o=o[s];else return;Array.isArray(o)&&o.length>0&&r.slim.setSelected(o,!1)},deepCopy(e){if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.map(this.deepCopy);const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=this.deepCopy(e[r]));return t}}),aR=()=>({init(){Livewire.on("pg:scrollTop",n=>{setTimeout(()=>{document.querySelector("body").scrollIntoView({behavior:"auto"})},0)}),new IntersectionObserver(n=>{n[0].isIntersecting&&this.$wire.call("loadMore")},{rootMargin:"300px"}).observe(this.$el)}}),lR=n=>({rowId:n?.rowId??null,parentId:n?.parentId??null,toHtml(){let e=null;const t=this.parentId??this.$wire.id;if(this.rowId){const i=window[`pgActions_${t}`];i&&i[this.rowId]!==void 0&&(e=i[this.rowId])}else e=window[`pgActionsHeader_${t}`];if(typeof e!="object"||e===null)return"";let r="";return e.forEach(i=>{let o=this.shouldHideAction(i),s=this.getReplaceHtml(i);if(!o)if(s)r+=s;else{let a=this.buildAttributesString(i);if(i.icon){let l=this.processIcon(i);if(!l)return;r+=this.buildActionHtmlWithIcon(i,a,l)}else r+=this.buildActionHtml(i,a)}}),r},shouldHideAction(e){if(e.can===!1)return!0;let t=!1;return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(r=>{r.action.includes(e.action)&&r.apply&&r.rule.hide&&(t=!0)}),t},getReplaceHtml(e){let t=null;return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(r=>{r.apply&&r.action.includes(e.action)&&r.replaceHtml&&(t=r.replaceHtml)}),t},buildAttributesString(e){let t=e.attributes??[];return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(r=>{r.apply&&r.action.includes(e.action)&&r.rule.setAttribute&&r.rule.setAttribute.length>0&&Object.values(r.rule.setAttribute).forEach(i=>{t[i.attribute]=i.value})}),Object.entries(t).map(([r,i])=>` ${r}="${i}"`).join("")},processIcon(e){const t=Object.entries(e.iconAttributes??[]).map(([i,o])=>` ${i}="${o}"`).join("");let r=window.pgResourceIcons[e.icon];return typeof r>"u"?(console.warn(`PowerGrid: Unable to load icons in javascript window in row: [${this.rowId}]`),null):this.replaceIconAttributes(r,t)},replaceIconAttributes(e,t){return e.replace(/<([^\s>]+)([^>]*)>/,(r,i,o)=>{let s=o.trim();const a=t.replace(/class="([^"]*)"/,(l,u)=>(s.includes("class=")?s=s.replace(/class="([^"]*)"/,(c,d)=>`class="${d} ${u.trim()}"`):s+=` ${l}`,""));return`<${i} ${s} ${a}>`})},buildActionHtmlWithIcon(e,t,r){return e.slot?`<${e.tag??"button"} ${t}>${r} ${e.slot}</${e.tag??"button"}>`:`<${e.tag??"button"} ${t}>${r}</${e.tag??"button"}>`},buildActionHtml(e,t){return`<${e.tag??"button"} ${t}>${e.slot}</${e.tag??"button"}>`}}),uR=n=>({templateContent:n?.templateContent??null,rendered:null,parentId:n?.parentId??null,init(){const e=Object.keys(this.templateContent)[0],t=window[`pgRowTemplates_${this.parentId??this.$wire.id}`][e],r=this.templateContent[e];if(r){let i=t;for(const[o,s]of Object.entries(r)){const a=`{{ ${o} }}`,l=String(s).replace(/'/g,"\\'");i=i.replaceAll(a,l)}this.rendered=i}}}),cR=n=>({rowId:n.rowId,rules:n.rules,defaultClasses:n.defaultClasses,attributes:[],theme:[],init(){this.rules&&Object.values(this.rules).forEach(e=>{(e.applyLoop||e.apply)&&e!=null&&e.attributes&&this.attributes.push(e.attributes)})},getAttributes(){let e={class:this.defaultClasses};return this.attributes.forEach(t=>{Object.keys(t).forEach(r=>{typeof t[r]=="object"?e[t[r].key]=t[r].value:e[r]?e[r]+=` ${t[r]}`:e[r]=t[r]})}),e}});window.pgToggleable=lA;window.pgFlatpickr=cA;window.pgEditable=dA;window.pgResponsive=yA;window.pgTomSelect=oR;window.pgSlimSelect=sR;window.pgLoadMore=aR;window.pgRenderActions=lR;window.pgRowAttributes=cR;window.pgRenderRowTemplate=uR;document.addEventListener("DOMContentLoaded",()=>{Livewire.hook("commit",({component:n,succeed:e,fail:t})=>{n.ephemeral.setUp&&n.ephemeral.setUp.hasOwnProperty("responsive")&&(e(()=>{queueMicrotask(()=>{window.dispatchEvent(new CustomEvent("pg-livewire-request-finished"))})}),t(()=>{window.dispatchEvent(new CustomEvent("pg-livewire-request-finished"))}))})});document.addEventListener("DOMContentLoaded",()=>{window.Alpine.directive("multisort-shift-click",(n,{expression:e})=>{n.addEventListener("click",t=>{window.Livewire.find(e).set("multiSort",t.shiftKey)})})});var Cd=["onChange","onClose","onDayCreate","onDestroy","onKeyDown","onMonthChange","onOpen","onParseConfig","onReady","onValueUpdate","onYearChange","onPreCalendarPosition"],os={_disable:[],allowInput:!1,allowInvalidPreload:!1,altFormat:"F j, Y",altInput:!1,altInputClass:"form-control input",animate:typeof window=="object"&&window.navigator.userAgent.indexOf("MSIE")===-1,ariaDateFormat:"F j, Y",autoFillDefaultTime:!0,clickOpens:!0,closeOnSelect:!0,conjunction:", ",dateFormat:"Y-m-d",defaultHour:12,defaultMinute:0,defaultSeconds:0,disable:[],disableMobile:!1,enableSeconds:!1,enableTime:!1,errorHandler:function(n){return typeof console<"u"&&console.warn(n)},getWeek:function(n){var e=new Date(n.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},hourIncrement:1,ignoredFocusElements:[],inline:!1,locale:"default",minuteIncrement:5,mode:"single",monthSelectorType:"dropdown",nextArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>",noCalendar:!1,now:new Date,onChange:[],onClose:[],onDayCreate:[],onDestroy:[],onKeyDown:[],onMonthChange:[],onOpen:[],onParseConfig:[],onReady:[],onValueUpdate:[],onYearChange:[],onPreCalendarPosition:[],plugins:[],position:"auto",positionElement:void 0,prevArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>",shorthandCurrentMonth:!1,showMonths:1,static:!1,time_24hr:!1,weekNumbers:!1,wrap:!1},wa={weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:function(n){var e=n%100;if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" to ",weekAbbreviation:"Wk",scrollTitle:"Scroll to increment",toggleTitle:"Click to toggle",amPM:["AM","PM"],yearAriaLabel:"Year",monthAriaLabel:"Month",hourAriaLabel:"Hour",minuteAriaLabel:"Minute",time_24hr:!1},gn=function(n,e){return e===void 0&&(e=2),("000"+n).slice(e*-1)},Gn=function(n){return n===!0?1:0};function Xm(n,e){var t;return function(){var r=this,i=arguments;clearTimeout(t),t=setTimeout(function(){return n.apply(r,i)},e)}}var Ed=function(n){return n instanceof Array?n:[n]};function sn(n,e,t){if(t===!0)return n.classList.add(e);n.classList.remove(e)}function Ve(n,e,t){var r=window.document.createElement(n);return e=e||"",t=t||"",r.className=e,t!==void 0&&(r.textContent=t),r}function yl(n){for(;n.firstChild;)n.removeChild(n.firstChild)}function Wx(n,e){if(e(n))return n;if(n.parentNode)return Wx(n.parentNode,e)}function bl(n,e){var t=Ve("div","numInputWrapper"),r=Ve("input","numInput "+n),i=Ve("span","arrowUp"),o=Ve("span","arrowDown");if(navigator.userAgent.indexOf("MSIE 9.0")===-1?r.type="number":(r.type="text",r.pattern="\\d*"),e!==void 0)for(var s in e)r.setAttribute(s,e[s]);return t.appendChild(r),t.appendChild(i),t.appendChild(o),t}function In(n){try{if(typeof n.composedPath=="function"){var e=n.composedPath();return e[0]}return n.target}catch{return n.target}}var Sd=function(){},Cu=function(n,e,t){return t.months[e?"shorthand":"longhand"][n]},dR={D:Sd,F:function(n,e,t){n.setMonth(t.months.longhand.indexOf(e))},G:function(n,e){n.setHours((n.getHours()>=12?12:0)+parseFloat(e))},H:function(n,e){n.setHours(parseFloat(e))},J:function(n,e){n.setDate(parseFloat(e))},K:function(n,e,t){n.setHours(n.getHours()%12+12*Gn(new RegExp(t.amPM[1],"i").test(e)))},M:function(n,e,t){n.setMonth(t.months.shorthand.indexOf(e))},S:function(n,e){n.setSeconds(parseFloat(e))},U:function(n,e){return new Date(parseFloat(e)*1e3)},W:function(n,e,t){var r=parseInt(e),i=new Date(n.getFullYear(),0,2+(r-1)*7,0,0,0,0);return i.setDate(i.getDate()-i.getDay()+t.firstDayOfWeek),i},Y:function(n,e){n.setFullYear(parseFloat(e))},Z:function(n,e){return new Date(e)},d:function(n,e){n.setDate(parseFloat(e))},h:function(n,e){n.setHours((n.getHours()>=12?12:0)+parseFloat(e))},i:function(n,e){n.setMinutes(parseFloat(e))},j:function(n,e){n.setDate(parseFloat(e))},l:Sd,m:function(n,e){n.setMonth(parseFloat(e)-1)},n:function(n,e){n.setMonth(parseFloat(e)-1)},s:function(n,e){n.setSeconds(parseFloat(e))},u:function(n,e){return new Date(parseFloat(e))},w:Sd,y:function(n,e){n.setFullYear(2e3+parseFloat(e))}},lo={D:"",F:"",G:"(\\d\\d|\\d)",H:"(\\d\\d|\\d)",J:"(\\d\\d|\\d)\\w+",K:"",M:"",S:"(\\d\\d|\\d)",U:"(.+)",W:"(\\d\\d|\\d)",Y:"(\\d{4})",Z:"(.+)",d:"(\\d\\d|\\d)",h:"(\\d\\d|\\d)",i:"(\\d\\d|\\d)",j:"(\\d\\d|\\d)",l:"",m:"(\\d\\d|\\d)",n:"(\\d\\d|\\d)",s:"(\\d\\d|\\d)",u:"(.+)",w:"(\\d\\d|\\d)",y:"(\\d{2})"},aa={Z:function(n){return n.toISOString()},D:function(n,e,t){return e.weekdays.shorthand[aa.w(n,e,t)]},F:function(n,e,t){return Cu(aa.n(n,e,t)-1,!1,e)},G:function(n,e,t){return gn(aa.h(n,e,t))},H:function(n){return gn(n.getHours())},J:function(n,e){return e.ordinal!==void 0?n.getDate()+e.ordinal(n.getDate()):n.getDate()},K:function(n,e){return e.amPM[Gn(n.getHours()>11)]},M:function(n,e){return Cu(n.getMonth(),!0,e)},S:function(n){return gn(n.getSeconds())},U:function(n){return n.getTime()/1e3},W:function(n,e,t){return t.getWeek(n)},Y:function(n){return gn(n.getFullYear(),4)},d:function(n){return gn(n.getDate())},h:function(n){return n.getHours()%12?n.getHours()%12:12},i:function(n){return gn(n.getMinutes())},j:function(n){return n.getDate()},l:function(n,e){return e.weekdays.longhand[n.getDay()]},m:function(n){return gn(n.getMonth()+1)},n:function(n){return n.getMonth()+1},s:function(n){return n.getSeconds()},u:function(n){return n.getTime()},w:function(n){return n.getDay()},y:function(n){return String(n.getFullYear()).substring(2)}},zx=function(n){var e=n.config,t=e===void 0?os:e,r=n.l10n,i=r===void 0?wa:r,o=n.isMobile,s=o===void 0?!1:o;return function(a,l,u){var c=u||i;return t.formatDate!==void 0&&!s?t.formatDate(a,l,c):l.split("").map(function(d,h,f){return aa[d]&&f[h-1]!=="\\"?aa[d](a,c,t):d!=="\\"?d:""}).join("")}},Yh=function(n){var e=n.config,t=e===void 0?os:e,r=n.l10n,i=r===void 0?wa:r;return function(o,s,a,l){if(!(o!==0&&!o)){var u=l||i,c,d=o;if(o instanceof Date)c=new Date(o.getTime());else if(typeof o!="string"&&o.toFixed!==void 0)c=new Date(o);else if(typeof o=="string"){var h=s||(t||os).dateFormat,f=String(o).trim();if(f==="today")c=new Date,a=!0;else if(t&&t.parseDate)c=t.parseDate(o,h);else if(/Z$/.test(f)||/GMT$/.test(f))c=new Date(o);else{for(var p=void 0,g=[],m=0,v=0,y="";m<h.length;m++){var b=h[m],x=b==="\\",w=h[m-1]==="\\"||x;if(lo[b]&&!w){y+=lo[b];var _=new RegExp(y).exec(o);_&&(p=!0)&&g[b!=="Y"?"push":"unshift"]({fn:dR[b],val:_[++v]})}else x||(y+=".")}c=!t||!t.noCalendar?new Date(new Date().getFullYear(),0,1,0,0,0,0):new Date(new Date().setHours(0,0,0,0)),g.forEach(function(C){var E=C.fn,S=C.val;return c=E(c,S,u)||c}),c=p?c:void 0}}if(!(c instanceof Date&&!isNaN(c.getTime()))){t.errorHandler(new Error("Invalid date provided: "+d));return}return a===!0&&c.setHours(0,0,0,0),c}}};function On(n,e,t){return t===void 0&&(t=!0),t!==!1?new Date(n.getTime()).setHours(0,0,0,0)-new Date(e.getTime()).setHours(0,0,0,0):n.getTime()-e.getTime()}var hR=function(n,e,t){return n>Math.min(e,t)&&n<Math.max(e,t)},Dd=function(n,e,t){return n*3600+e*60+t},fR=function(n){var e=Math.floor(n/3600),t=(n-e*3600)/60;return[e,t,n-e*3600-t*60]},pR={DAY:864e5};function Ad(n){var e=n.defaultHour,t=n.defaultMinute,r=n.defaultSeconds;if(n.minDate!==void 0){var i=n.minDate.getHours(),o=n.minDate.getMinutes(),s=n.minDate.getSeconds();e<i&&(e=i),e===i&&t<o&&(t=o),e===i&&t===o&&r<s&&(r=n.minDate.getSeconds())}if(n.maxDate!==void 0){var a=n.maxDate.getHours(),l=n.maxDate.getMinutes();e=Math.min(e,a),e===a&&(t=Math.min(l,t)),e===a&&t===l&&(r=n.maxDate.getSeconds())}return{hours:e,minutes:t,seconds:r}}typeof Object.assign!="function"&&(Object.assign=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];if(!n)throw TypeError("Cannot convert undefined or null to object");for(var r=function(a){a&&Object.keys(a).forEach(function(l){return n[l]=a[l]})},i=0,o=e;i<o.length;i++){var s=o[i];r(s)}return n});var $t=function(){return $t=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},$t.apply(this,arguments)},Km=function(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r},gR=300;function mR(n,e){var t={config:$t($t({},os),ht.defaultConfig),l10n:wa};t.parseDate=Yh({config:t.config,l10n:t.l10n}),t._handlers=[],t.pluginElements=[],t.loadedPlugins=[],t._bind=g,t._setHoursFromDate=h,t._positionCalendar=Ot,t.changeMonth=J,t.changeYear=Ae,t.clear=ee,t.close=re,t.onMouseOver=Be,t._createElement=Ve,t.createDay=_,t.destroy=fe,t.isEnabled=Ce,t.jumpToDate=y,t.updateValue=Wr,t.open=rt,t.redraw=Jn,t.set=Ls,t.setDate=Un,t.toggle=Hs;function r(){t.utils={getDaysInMonth:function(R,I){return R===void 0&&(R=t.currentMonth),I===void 0&&(I=t.currentYear),R===1&&(I%4===0&&I%100!==0||I%400===0)?29:t.l10n.daysInMonth[R]}}}function i(){t.element=t.input=n,t.isOpen=!1,Ze(),An(),ld(),ad(),r(),t.isMobile||w(),v(),(t.selectedDates.length||t.config.noCalendar)&&(t.config.enableTime&&h(t.config.noCalendar?t.latestSelectedDateObj:void 0),Wr(!1)),a();var R=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);!t.isMobile&&R&&Ot(),qe("onReady")}function o(){var R;return((R=t.calendarContainer)===null||R===void 0?void 0:R.getRootNode()).activeElement||document.activeElement}function s(R){return R.bind(t)}function a(){var R=t.config;R.weekNumbers===!1&&R.showMonths===1||R.noCalendar!==!0&&window.requestAnimationFrame(function(){if(t.calendarContainer!==void 0&&(t.calendarContainer.style.visibility="hidden",t.calendarContainer.style.display="block"),t.daysContainer!==void 0){var I=(t.days.offsetWidth+1)*R.showMonths;t.daysContainer.style.width=I+"px",t.calendarContainer.style.width=I+(t.weekWrapper!==void 0?t.weekWrapper.offsetWidth:0)+"px",t.calendarContainer.style.removeProperty("visibility"),t.calendarContainer.style.removeProperty("display")}})}function l(R){if(t.selectedDates.length===0){var I=t.config.minDate===void 0||On(new Date,t.config.minDate)>=0?new Date:new Date(t.config.minDate.getTime()),L=Ad(t.config);I.setHours(L.hours,L.minutes,L.seconds,I.getMilliseconds()),t.selectedDates=[I],t.latestSelectedDateObj=I}R!==void 0&&R.type!=="blur"&&wS(R);var Y=t._input.value;d(),Wr(),t._input.value!==Y&&t._debouncedChange()}function u(R,I){return R%12+12*Gn(I===t.l10n.amPM[1])}function c(R){switch(R%24){case 0:case 12:return 12;default:return R%12}}function d(){if(!(t.hourElement===void 0||t.minuteElement===void 0)){var R=(parseInt(t.hourElement.value.slice(-2),10)||0)%24,I=(parseInt(t.minuteElement.value,10)||0)%60,L=t.secondElement!==void 0?(parseInt(t.secondElement.value,10)||0)%60:0;t.amPM!==void 0&&(R=u(R,t.amPM.textContent));var Y=t.config.minTime!==void 0||t.config.minDate&&t.minDateHasTime&&t.latestSelectedDateObj&&On(t.latestSelectedDateObj,t.config.minDate,!0)===0,Z=t.config.maxTime!==void 0||t.config.maxDate&&t.maxDateHasTime&&t.latestSelectedDateObj&&On(t.latestSelectedDateObj,t.config.maxDate,!0)===0;if(t.config.maxTime!==void 0&&t.config.minTime!==void 0&&t.config.minTime>t.config.maxTime){var ne=Dd(t.config.minTime.getHours(),t.config.minTime.getMinutes(),t.config.minTime.getSeconds()),Se=Dd(t.config.maxTime.getHours(),t.config.maxTime.getMinutes(),t.config.maxTime.getSeconds()),ue=Dd(R,I,L);if(ue>Se&&ue<ne){var Te=fR(ne);R=Te[0],I=Te[1],L=Te[2]}}else{if(Z){var ae=t.config.maxTime!==void 0?t.config.maxTime:t.config.maxDate;R=Math.min(R,ae.getHours()),R===ae.getHours()&&(I=Math.min(I,ae.getMinutes())),I===ae.getMinutes()&&(L=Math.min(L,ae.getSeconds()))}if(Y){var ye=t.config.minTime!==void 0?t.config.minTime:t.config.minDate;R=Math.max(R,ye.getHours()),R===ye.getHours()&&I<ye.getMinutes()&&(I=ye.getMinutes()),I===ye.getMinutes()&&(L=Math.max(L,ye.getSeconds()))}}f(R,I,L)}}function h(R){var I=R||t.latestSelectedDateObj;I&&I instanceof Date&&f(I.getHours(),I.getMinutes(),I.getSeconds())}function f(R,I,L){t.latestSelectedDateObj!==void 0&&t.latestSelectedDateObj.setHours(R%24,I,L||0,0),!(!t.hourElement||!t.minuteElement||t.isMobile)&&(t.hourElement.value=gn(t.config.time_24hr?R:(12+R)%12+12*Gn(R%12===0)),t.minuteElement.value=gn(I),t.amPM!==void 0&&(t.amPM.textContent=t.l10n.amPM[Gn(R>=12)]),t.secondElement!==void 0&&(t.secondElement.value=gn(L)))}function p(R){var I=In(R),L=parseInt(I.value)+(R.delta||0);(L/1e3>1||R.key==="Enter"&&!/[^\d]/.test(L.toString()))&&Ae(L)}function g(R,I,L,Y){if(I instanceof Array)return I.forEach(function(Z){return g(R,Z,L,Y)});if(R instanceof Array)return R.forEach(function(Z){return g(Z,I,L,Y)});R.addEventListener(I,L,Y),t._handlers.push({remove:function(){return R.removeEventListener(I,L,Y)}})}function m(){qe("onChange")}function v(){if(t.config.wrap&&["open","close","toggle","clear"].forEach(function(L){Array.prototype.forEach.call(t.element.querySelectorAll("[data-"+L+"]"),function(Y){return g(Y,"click",t[L])})}),t.isMobile){Bs();return}var R=Xm(He,50);if(t._debouncedChange=Xm(m,gR),t.daysContainer&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&g(t.daysContainer,"mouseover",function(L){t.config.mode==="range"&&Be(In(L))}),g(t._input,"keydown",Re),t.calendarContainer!==void 0&&g(t.calendarContainer,"keydown",Re),!t.config.inline&&!t.config.static&&g(window,"resize",R),window.ontouchstart!==void 0?g(window.document,"touchstart",ve):g(window.document,"mousedown",ve),g(window.document,"focus",ve,{capture:!0}),t.config.clickOpens===!0&&(g(t._input,"focus",t.open),g(t._input,"click",t.open)),t.daysContainer!==void 0&&(g(t.monthNav,"click",xS),g(t.monthNav,["keyup","increment"],p),g(t.daysContainer,"click",Br)),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0){var I=function(L){return In(L).select()};g(t.timeContainer,["increment"],l),g(t.timeContainer,"blur",l,{capture:!0}),g(t.timeContainer,"click",b),g([t.hourElement,t.minuteElement],["focus","click"],I),t.secondElement!==void 0&&g(t.secondElement,"focus",function(){return t.secondElement&&t.secondElement.select()}),t.amPM!==void 0&&g(t.amPM,"click",function(L){l(L)})}t.config.allowInput&&g(t._input,"blur",dt)}function y(R,I){var L=R!==void 0?t.parseDate(R):t.latestSelectedDateObj||(t.config.minDate&&t.config.minDate>t.now?t.config.minDate:t.config.maxDate&&t.config.maxDate<t.now?t.config.maxDate:t.now),Y=t.currentYear,Z=t.currentMonth;try{L!==void 0&&(t.currentYear=L.getFullYear(),t.currentMonth=L.getMonth())}catch(ne){ne.message="Invalid date supplied: "+L,t.config.errorHandler(ne)}I&&t.currentYear!==Y&&(qe("onYearChange"),B()),I&&(t.currentYear!==Y||t.currentMonth!==Z)&&qe("onMonthChange"),t.redraw()}function b(R){var I=In(R);~I.className.indexOf("arrow")&&x(R,I.classList.contains("arrowUp")?1:-1)}function x(R,I,L){var Y=R&&In(R),Z=L||Y&&Y.parentNode&&Y.parentNode.firstChild,ne=ud("increment");ne.delta=I,Z&&Z.dispatchEvent(ne)}function w(){var R=window.document.createDocumentFragment();if(t.calendarContainer=Ve("div","flatpickr-calendar"),t.calendarContainer.tabIndex=-1,!t.config.noCalendar){if(R.appendChild(W()),t.innerContainer=Ve("div","flatpickr-innerContainer"),t.config.weekNumbers){var I=K(),L=I.weekWrapper,Y=I.weekNumbers;t.innerContainer.appendChild(L),t.weekNumbers=Y,t.weekWrapper=L}t.rContainer=Ve("div","flatpickr-rContainer"),t.rContainer.appendChild(U()),t.daysContainer||(t.daysContainer=Ve("div","flatpickr-days"),t.daysContainer.tabIndex=-1),M(),t.rContainer.appendChild(t.daysContainer),t.innerContainer.appendChild(t.rContainer),R.appendChild(t.innerContainer)}t.config.enableTime&&R.appendChild(j()),sn(t.calendarContainer,"rangeMode",t.config.mode==="range"),sn(t.calendarContainer,"animate",t.config.animate===!0),sn(t.calendarContainer,"multiMonth",t.config.showMonths>1),t.calendarContainer.appendChild(R);var Z=t.config.appendTo!==void 0&&t.config.appendTo.nodeType!==void 0;if((t.config.inline||t.config.static)&&(t.calendarContainer.classList.add(t.config.inline?"inline":"static"),t.config.inline&&(!Z&&t.element.parentNode?t.element.parentNode.insertBefore(t.calendarContainer,t._input.nextSibling):t.config.appendTo!==void 0&&t.config.appendTo.appendChild(t.calendarContainer)),t.config.static)){var ne=Ve("div","flatpickr-wrapper");t.element.parentNode&&t.element.parentNode.insertBefore(ne,t.element),ne.appendChild(t.element),t.altInput&&ne.appendChild(t.altInput),ne.appendChild(t.calendarContainer)}!t.config.static&&!t.config.inline&&(t.config.appendTo!==void 0?t.config.appendTo:window.document.body).appendChild(t.calendarContainer)}function _(R,I,L,Y){var Z=Ce(I,!0),ne=Ve("span",R,I.getDate().toString());return ne.dateObj=I,ne.$i=Y,ne.setAttribute("aria-label",t.formatDate(I,t.config.ariaDateFormat)),R.indexOf("hidden")===-1&&On(I,t.now)===0&&(t.todayDateElem=ne,ne.classList.add("today"),ne.setAttribute("aria-current","date")),Z?(ne.tabIndex=-1,cd(I)&&(ne.classList.add("selected"),t.selectedDateElem=ne,t.config.mode==="range"&&(sn(ne,"startRange",t.selectedDates[0]&&On(I,t.selectedDates[0],!0)===0),sn(ne,"endRange",t.selectedDates[1]&&On(I,t.selectedDates[1],!0)===0),R==="nextMonthDay"&&ne.classList.add("inRange")))):ne.classList.add("flatpickr-disabled"),t.config.mode==="range"&&bS(I)&&!cd(I)&&ne.classList.add("inRange"),t.weekNumbers&&t.config.showMonths===1&&R!=="prevMonthDay"&&Y%7===6&&t.weekNumbers.insertAdjacentHTML("beforeend","<span class='flatpickr-day'>"+t.config.getWeek(I)+"</span>"),qe("onDayCreate",ne),ne}function C(R){R.focus(),t.config.mode==="range"&&Be(R)}function E(R){for(var I=R>0?0:t.config.showMonths-1,L=R>0?t.config.showMonths:-1,Y=I;Y!=L;Y+=R)for(var Z=t.daysContainer.children[Y],ne=R>0?0:Z.children.length-1,Se=R>0?Z.children.length:-1,ue=ne;ue!=Se;ue+=R){var Te=Z.children[ue];if(Te.className.indexOf("hidden")===-1&&Ce(Te.dateObj))return Te}}function S(R,I){for(var L=R.className.indexOf("Month")===-1?R.dateObj.getMonth():t.currentMonth,Y=I>0?t.config.showMonths:-1,Z=I>0?1:-1,ne=L-t.currentMonth;ne!=Y;ne+=Z)for(var Se=t.daysContainer.children[ne],ue=L-t.currentMonth===ne?R.$i+I:I<0?Se.children.length-1:0,Te=Se.children.length,ae=ue;ae>=0&&ae<Te&&ae!=(I>0?Te:-1);ae+=Z){var ye=Se.children[ae];if(ye.className.indexOf("hidden")===-1&&Ce(ye.dateObj)&&Math.abs(R.$i-ae)>=Math.abs(I))return C(ye)}t.changeMonth(Z),D(E(Z),0)}function D(R,I){var L=o(),Y=ke(L||document.body),Z=R!==void 0?R:Y?L:t.selectedDateElem!==void 0&&ke(t.selectedDateElem)?t.selectedDateElem:t.todayDateElem!==void 0&&ke(t.todayDateElem)?t.todayDateElem:E(I>0?1:-1);Z===void 0?t._input.focus():Y?S(Z,I):C(Z)}function k(R,I){for(var L=(new Date(R,I,1).getDay()-t.l10n.firstDayOfWeek+7)%7,Y=t.utils.getDaysInMonth((I-1+12)%12,R),Z=t.utils.getDaysInMonth(I,R),ne=window.document.createDocumentFragment(),Se=t.config.showMonths>1,ue=Se?"prevMonthDay hidden":"prevMonthDay",Te=Se?"nextMonthDay hidden":"nextMonthDay",ae=Y+1-L,ye=0;ae<=Y;ae++,ye++)ne.appendChild(_("flatpickr-day "+ue,new Date(R,I-1,ae),ae,ye));for(ae=1;ae<=Z;ae++,ye++)ne.appendChild(_("flatpickr-day",new Date(R,I,ae),ae,ye));for(var Ye=Z+1;Ye<=42-L&&(t.config.showMonths===1||ye%7!==0);Ye++,ye++)ne.appendChild(_("flatpickr-day "+Te,new Date(R,I+1,Ye%Z),Ye,ye));var fr=Ve("div","dayContainer");return fr.appendChild(ne),fr}function M(){if(t.daysContainer!==void 0){yl(t.daysContainer),t.weekNumbers&&yl(t.weekNumbers);for(var R=document.createDocumentFragment(),I=0;I<t.config.showMonths;I++){var L=new Date(t.currentYear,t.currentMonth,1);L.setMonth(t.currentMonth+I),R.appendChild(k(L.getFullYear(),L.getMonth()))}t.daysContainer.appendChild(R),t.days=t.daysContainer.firstChild,t.config.mode==="range"&&t.selectedDates.length===1&&Be()}}function B(){if(!(t.config.showMonths>1||t.config.monthSelectorType!=="dropdown")){var R=function(Y){return t.config.minDate!==void 0&&t.currentYear===t.config.minDate.getFullYear()&&Y<t.config.minDate.getMonth()?!1:!(t.config.maxDate!==void 0&&t.currentYear===t.config.maxDate.getFullYear()&&Y>t.config.maxDate.getMonth())};t.monthsDropdownContainer.tabIndex=-1,t.monthsDropdownContainer.innerHTML="";for(var I=0;I<12;I++)if(R(I)){var L=Ve("option","flatpickr-monthDropdown-month");L.value=new Date(t.currentYear,I).getMonth().toString(),L.textContent=Cu(I,t.config.shorthandCurrentMonth,t.l10n),L.tabIndex=-1,t.currentMonth===I&&(L.selected=!0),t.monthsDropdownContainer.appendChild(L)}}}function H(){var R=Ve("div","flatpickr-month"),I=window.document.createDocumentFragment(),L;t.config.showMonths>1||t.config.monthSelectorType==="static"?L=Ve("span","cur-month"):(t.monthsDropdownContainer=Ve("select","flatpickr-monthDropdown-months"),t.monthsDropdownContainer.setAttribute("aria-label",t.l10n.monthAriaLabel),g(t.monthsDropdownContainer,"change",function(Se){var ue=In(Se),Te=parseInt(ue.value,10);t.changeMonth(Te-t.currentMonth),qe("onMonthChange")}),B(),L=t.monthsDropdownContainer);var Y=bl("cur-year",{tabindex:"-1"}),Z=Y.getElementsByTagName("input")[0];Z.setAttribute("aria-label",t.l10n.yearAriaLabel),t.config.minDate&&Z.setAttribute("min",t.config.minDate.getFullYear().toString()),t.config.maxDate&&(Z.setAttribute("max",t.config.maxDate.getFullYear().toString()),Z.disabled=!!t.config.minDate&&t.config.minDate.getFullYear()===t.config.maxDate.getFullYear());var ne=Ve("div","flatpickr-current-month");return ne.appendChild(L),ne.appendChild(Y),I.appendChild(ne),R.appendChild(I),{container:R,yearElement:Z,monthElement:L}}function F(){yl(t.monthNav),t.monthNav.appendChild(t.prevMonthNav),t.config.showMonths&&(t.yearElements=[],t.monthElements=[]);for(var R=t.config.showMonths;R--;){var I=H();t.yearElements.push(I.yearElement),t.monthElements.push(I.monthElement),t.monthNav.appendChild(I.container)}t.monthNav.appendChild(t.nextMonthNav)}function W(){return t.monthNav=Ve("div","flatpickr-months"),t.yearElements=[],t.monthElements=[],t.prevMonthNav=Ve("span","flatpickr-prev-month"),t.prevMonthNav.innerHTML=t.config.prevArrow,t.nextMonthNav=Ve("span","flatpickr-next-month"),t.nextMonthNav.innerHTML=t.config.nextArrow,F(),Object.defineProperty(t,"_hidePrevMonthArrow",{get:function(){return t.__hidePrevMonthArrow},set:function(R){t.__hidePrevMonthArrow!==R&&(sn(t.prevMonthNav,"flatpickr-disabled",R),t.__hidePrevMonthArrow=R)}}),Object.defineProperty(t,"_hideNextMonthArrow",{get:function(){return t.__hideNextMonthArrow},set:function(R){t.__hideNextMonthArrow!==R&&(sn(t.nextMonthNav,"flatpickr-disabled",R),t.__hideNextMonthArrow=R)}}),t.currentYearElement=t.yearElements[0],hl(),t.monthNav}function j(){t.calendarContainer.classList.add("hasTime"),t.config.noCalendar&&t.calendarContainer.classList.add("noCalendar");var R=Ad(t.config);t.timeContainer=Ve("div","flatpickr-time"),t.timeContainer.tabIndex=-1;var I=Ve("span","flatpickr-time-separator",":"),L=bl("flatpickr-hour",{"aria-label":t.l10n.hourAriaLabel});t.hourElement=L.getElementsByTagName("input")[0];var Y=bl("flatpickr-minute",{"aria-label":t.l10n.minuteAriaLabel});if(t.minuteElement=Y.getElementsByTagName("input")[0],t.hourElement.tabIndex=t.minuteElement.tabIndex=-1,t.hourElement.value=gn(t.latestSelectedDateObj?t.latestSelectedDateObj.getHours():t.config.time_24hr?R.hours:c(R.hours)),t.minuteElement.value=gn(t.latestSelectedDateObj?t.latestSelectedDateObj.getMinutes():R.minutes),t.hourElement.setAttribute("step",t.config.hourIncrement.toString()),t.minuteElement.setAttribute("step",t.config.minuteIncrement.toString()),t.hourElement.setAttribute("min",t.config.time_24hr?"0":"1"),t.hourElement.setAttribute("max",t.config.time_24hr?"23":"12"),t.hourElement.setAttribute("maxlength","2"),t.minuteElement.setAttribute("min","0"),t.minuteElement.setAttribute("max","59"),t.minuteElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(L),t.timeContainer.appendChild(I),t.timeContainer.appendChild(Y),t.config.time_24hr&&t.timeContainer.classList.add("time24hr"),t.config.enableSeconds){t.timeContainer.classList.add("hasSeconds");var Z=bl("flatpickr-second");t.secondElement=Z.getElementsByTagName("input")[0],t.secondElement.value=gn(t.latestSelectedDateObj?t.latestSelectedDateObj.getSeconds():R.seconds),t.secondElement.setAttribute("step",t.minuteElement.getAttribute("step")),t.secondElement.setAttribute("min","0"),t.secondElement.setAttribute("max","59"),t.secondElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(Ve("span","flatpickr-time-separator",":")),t.timeContainer.appendChild(Z)}return t.config.time_24hr||(t.amPM=Ve("span","flatpickr-am-pm",t.l10n.amPM[Gn((t.latestSelectedDateObj?t.hourElement.value:t.config.defaultHour)>11)]),t.amPM.title=t.l10n.toggleTitle,t.amPM.tabIndex=-1,t.timeContainer.appendChild(t.amPM)),t.timeContainer}function U(){t.weekdayContainer?yl(t.weekdayContainer):t.weekdayContainer=Ve("div","flatpickr-weekdays");for(var R=t.config.showMonths;R--;){var I=Ve("div","flatpickr-weekdaycontainer");t.weekdayContainer.appendChild(I)}return q(),t.weekdayContainer}function q(){if(t.weekdayContainer){var R=t.l10n.firstDayOfWeek,I=Km(t.l10n.weekdays.shorthand);R>0&&R<I.length&&(I=Km(I.splice(R,I.length),I.splice(0,R)));for(var L=t.config.showMonths;L--;)t.weekdayContainer.children[L].innerHTML=`
      <span class='flatpickr-weekday'>
        `+I.join("</span><span class='flatpickr-weekday'>")+`
      </span>
      `}}function K(){t.calendarContainer.classList.add("hasWeeks");var R=Ve("div","flatpickr-weekwrapper");R.appendChild(Ve("span","flatpickr-weekday",t.l10n.weekAbbreviation));var I=Ve("div","flatpickr-weeks");return R.appendChild(I),{weekWrapper:R,weekNumbers:I}}function J(R,I){I===void 0&&(I=!0);var L=I?R:R-t.currentMonth;L<0&&t._hidePrevMonthArrow===!0||L>0&&t._hideNextMonthArrow===!0||(t.currentMonth+=L,(t.currentMonth<0||t.currentMonth>11)&&(t.currentYear+=t.currentMonth>11?1:-1,t.currentMonth=(t.currentMonth+12)%12,qe("onYearChange"),B()),M(),qe("onMonthChange"),hl())}function ee(R,I){if(R===void 0&&(R=!0),I===void 0&&(I=!0),t.input.value="",t.altInput!==void 0&&(t.altInput.value=""),t.mobileInput!==void 0&&(t.mobileInput.value=""),t.selectedDates=[],t.latestSelectedDateObj=void 0,I===!0&&(t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth()),t.config.enableTime===!0){var L=Ad(t.config),Y=L.hours,Z=L.minutes,ne=L.seconds;f(Y,Z,ne)}t.redraw(),R&&qe("onChange")}function re(){t.isOpen=!1,t.isMobile||(t.calendarContainer!==void 0&&t.calendarContainer.classList.remove("open"),t._input!==void 0&&t._input.classList.remove("active")),qe("onClose")}function fe(){t.config!==void 0&&qe("onDestroy");for(var R=t._handlers.length;R--;)t._handlers[R].remove();if(t._handlers=[],t.mobileInput)t.mobileInput.parentNode&&t.mobileInput.parentNode.removeChild(t.mobileInput),t.mobileInput=void 0;else if(t.calendarContainer&&t.calendarContainer.parentNode)if(t.config.static&&t.calendarContainer.parentNode){var I=t.calendarContainer.parentNode;if(I.lastChild&&I.removeChild(I.lastChild),I.parentNode){for(;I.firstChild;)I.parentNode.insertBefore(I.firstChild,I);I.parentNode.removeChild(I)}}else t.calendarContainer.parentNode.removeChild(t.calendarContainer);t.altInput&&(t.input.type="text",t.altInput.parentNode&&t.altInput.parentNode.removeChild(t.altInput),delete t.altInput),t.input&&(t.input.type=t.input._type,t.input.classList.remove("flatpickr-input"),t.input.removeAttribute("readonly")),["_showTimeInput","latestSelectedDateObj","_hideNextMonthArrow","_hidePrevMonthArrow","__hideNextMonthArrow","__hidePrevMonthArrow","isMobile","isOpen","selectedDateElem","minDateHasTime","maxDateHasTime","days","daysContainer","_input","_positionElement","innerContainer","rContainer","monthNav","todayDateElem","calendarContainer","weekdayContainer","prevMonthNav","nextMonthNav","monthsDropdownContainer","currentMonthElement","currentYearElement","navigationCurrentMonth","selectedDateElem","config"].forEach(function(L){try{delete t[L]}catch{}})}function pe(R){return t.calendarContainer.contains(R)}function ve(R){if(t.isOpen&&!t.config.inline){var I=In(R),L=pe(I),Y=I===t.input||I===t.altInput||t.element.contains(I)||R.path&&R.path.indexOf&&(~R.path.indexOf(t.input)||~R.path.indexOf(t.altInput)),Z=!Y&&!L&&!pe(R.relatedTarget),ne=!t.config.ignoredFocusElements.some(function(Se){return Se.contains(I)});Z&&ne&&(t.config.allowInput&&t.setDate(t._input.value,!1,t.config.altInput?t.config.altFormat:t.config.dateFormat),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0&&t.input.value!==""&&t.input.value!==void 0&&l(),t.close(),t.config&&t.config.mode==="range"&&t.selectedDates.length===1&&t.clear(!1))}}function Ae(R){if(!(!R||t.config.minDate&&R<t.config.minDate.getFullYear()||t.config.maxDate&&R>t.config.maxDate.getFullYear())){var I=R,L=t.currentYear!==I;t.currentYear=I||t.currentYear,t.config.maxDate&&t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth=Math.min(t.config.maxDate.getMonth(),t.currentMonth):t.config.minDate&&t.currentYear===t.config.minDate.getFullYear()&&(t.currentMonth=Math.max(t.config.minDate.getMonth(),t.currentMonth)),L&&(t.redraw(),qe("onYearChange"),B())}}function Ce(R,I){var L;I===void 0&&(I=!0);var Y=t.parseDate(R,void 0,I);if(t.config.minDate&&Y&&On(Y,t.config.minDate,I!==void 0?I:!t.minDateHasTime)<0||t.config.maxDate&&Y&&On(Y,t.config.maxDate,I!==void 0?I:!t.maxDateHasTime)>0)return!1;if(!t.config.enable&&t.config.disable.length===0)return!0;if(Y===void 0)return!1;for(var Z=!!t.config.enable,ne=(L=t.config.enable)!==null&&L!==void 0?L:t.config.disable,Se=0,ue=void 0;Se<ne.length;Se++){if(ue=ne[Se],typeof ue=="function"&&ue(Y))return Z;if(ue instanceof Date&&Y!==void 0&&ue.getTime()===Y.getTime())return Z;if(typeof ue=="string"){var Te=t.parseDate(ue,void 0,!0);return Te&&Te.getTime()===Y.getTime()?Z:!Z}else if(typeof ue=="object"&&Y!==void 0&&ue.from&&ue.to&&Y.getTime()>=ue.from.getTime()&&Y.getTime()<=ue.to.getTime())return Z}return!Z}function ke(R){return t.daysContainer!==void 0?R.className.indexOf("hidden")===-1&&R.className.indexOf("flatpickr-disabled")===-1&&t.daysContainer.contains(R):!1}function dt(R){var I=R.target===t._input,L=t._input.value.trimEnd()!==dd();I&&L&&!(R.relatedTarget&&pe(R.relatedTarget))&&t.setDate(t._input.value,!0,R.target===t.altInput?t.config.altFormat:t.config.dateFormat)}function Re(R){var I=In(R),L=t.config.wrap?n.contains(I):I===t._input,Y=t.config.allowInput,Z=t.isOpen&&(!Y||!L),ne=t.config.inline&&L&&!Y;if(R.keyCode===13&&L){if(Y)return t.setDate(t._input.value,!0,I===t.altInput?t.config.altFormat:t.config.dateFormat),t.close(),I.blur();t.open()}else if(pe(I)||Z||ne){var Se=!!t.timeContainer&&t.timeContainer.contains(I);switch(R.keyCode){case 13:Se?(R.preventDefault(),l(),kn()):Br(R);break;case 27:R.preventDefault(),kn();break;case 8:case 46:L&&!t.config.allowInput&&(R.preventDefault(),t.clear());break;case 37:case 39:if(!Se&&!L){R.preventDefault();var ue=o();if(t.daysContainer!==void 0&&(Y===!1||ue&&ke(ue))){var Te=R.keyCode===39?1:-1;R.ctrlKey?(R.stopPropagation(),J(Te),D(E(1),0)):D(void 0,Te)}}else t.hourElement&&t.hourElement.focus();break;case 38:case 40:R.preventDefault();var ae=R.keyCode===40?1:-1;t.daysContainer&&I.$i!==void 0||I===t.input||I===t.altInput?R.ctrlKey?(R.stopPropagation(),Ae(t.currentYear-ae),D(E(1),0)):Se||D(void 0,ae*7):I===t.currentYearElement?Ae(t.currentYear-ae):t.config.enableTime&&(!Se&&t.hourElement&&t.hourElement.focus(),l(R),t._debouncedChange());break;case 9:if(Se){var ye=[t.hourElement,t.minuteElement,t.secondElement,t.amPM].concat(t.pluginElements).filter(function(Rn){return Rn}),Ye=ye.indexOf(I);if(Ye!==-1){var fr=ye[Ye+(R.shiftKey?-1:1)];R.preventDefault(),(fr||t._input).focus()}}else!t.config.noCalendar&&t.daysContainer&&t.daysContainer.contains(I)&&R.shiftKey&&(R.preventDefault(),t._input.focus());break}}if(t.amPM!==void 0&&I===t.amPM)switch(R.key){case t.l10n.amPM[0].charAt(0):case t.l10n.amPM[0].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[0],d(),Wr();break;case t.l10n.amPM[1].charAt(0):case t.l10n.amPM[1].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[1],d(),Wr();break}(L||pe(I))&&qe("onKeyDown",R)}function Be(R,I){if(I===void 0&&(I="flatpickr-day"),!(t.selectedDates.length!==1||R&&(!R.classList.contains(I)||R.classList.contains("flatpickr-disabled")))){for(var L=R?R.dateObj.getTime():t.days.firstElementChild.dateObj.getTime(),Y=t.parseDate(t.selectedDates[0],void 0,!0).getTime(),Z=Math.min(L,t.selectedDates[0].getTime()),ne=Math.max(L,t.selectedDates[0].getTime()),Se=!1,ue=0,Te=0,ae=Z;ae<ne;ae+=pR.DAY)Ce(new Date(ae),!0)||(Se=Se||ae>Z&&ae<ne,ae<Y&&(!ue||ae>ue)?ue=ae:ae>Y&&(!Te||ae<Te)&&(Te=ae));var ye=Array.from(t.rContainer.querySelectorAll("*:nth-child(-n+"+t.config.showMonths+") > ."+I));ye.forEach(function(Ye){var fr=Ye.dateObj,Rn=fr.getTime(),Ws=ue>0&&Rn<ue||Te>0&&Rn>Te;if(Ws){Ye.classList.add("notAllowed"),["inRange","startRange","endRange"].forEach(function(Wo){Ye.classList.remove(Wo)});return}else if(Se&&!Ws)return;["startRange","inRange","endRange","notAllowed"].forEach(function(Wo){Ye.classList.remove(Wo)}),R!==void 0&&(R.classList.add(L<=t.selectedDates[0].getTime()?"startRange":"endRange"),Y<L&&Rn===Y?Ye.classList.add("startRange"):Y>L&&Rn===Y&&Ye.classList.add("endRange"),Rn>=ue&&(Te===0||Rn<=Te)&&hR(Rn,Y,L)&&Ye.classList.add("inRange"))})}}function He(){t.isOpen&&!t.config.static&&!t.config.inline&&Ot()}function rt(R,I){if(I===void 0&&(I=t._positionElement),t.isMobile===!0){if(R){R.preventDefault();var L=In(R);L&&L.blur()}t.mobileInput!==void 0&&(t.mobileInput.focus(),t.mobileInput.click()),qe("onOpen");return}else if(t._input.disabled||t.config.inline)return;var Y=t.isOpen;t.isOpen=!0,Y||(t.calendarContainer.classList.add("open"),t._input.classList.add("active"),qe("onOpen"),Ot(I)),t.config.enableTime===!0&&t.config.noCalendar===!0&&t.config.allowInput===!1&&(R===void 0||!t.timeContainer.contains(R.relatedTarget))&&setTimeout(function(){return t.hourElement.select()},50)}function Ke(R){return function(I){var L=t.config["_"+R+"Date"]=t.parseDate(I,t.config.dateFormat),Y=t.config["_"+(R==="min"?"max":"min")+"Date"];L!==void 0&&(t[R==="min"?"minDateHasTime":"maxDateHasTime"]=L.getHours()>0||L.getMinutes()>0||L.getSeconds()>0),t.selectedDates&&(t.selectedDates=t.selectedDates.filter(function(Z){return Ce(Z)}),!t.selectedDates.length&&R==="min"&&h(L),Wr()),t.daysContainer&&(Jn(),L!==void 0?t.currentYearElement[R]=L.getFullYear().toString():t.currentYearElement.removeAttribute(R),t.currentYearElement.disabled=!!Y&&L!==void 0&&Y.getFullYear()===L.getFullYear())}}function Ze(){var R=["wrap","weekNumbers","allowInput","allowInvalidPreload","clickOpens","time_24hr","enableTime","noCalendar","altInput","shorthandCurrentMonth","inline","static","enableSeconds","disableMobile"],I=$t($t({},JSON.parse(JSON.stringify(n.dataset||{}))),e),L={};t.config.parseDate=I.parseDate,t.config.formatDate=I.formatDate,Object.defineProperty(t.config,"enable",{get:function(){return t.config._enable},set:function(ye){t.config._enable=Ho(ye)}}),Object.defineProperty(t.config,"disable",{get:function(){return t.config._disable},set:function(ye){t.config._disable=Ho(ye)}});var Y=I.mode==="time";if(!I.dateFormat&&(I.enableTime||Y)){var Z=ht.defaultConfig.dateFormat||os.dateFormat;L.dateFormat=I.noCalendar||Y?"H:i"+(I.enableSeconds?":S":""):Z+" H:i"+(I.enableSeconds?":S":"")}if(I.altInput&&(I.enableTime||Y)&&!I.altFormat){var ne=ht.defaultConfig.altFormat||os.altFormat;L.altFormat=I.noCalendar||Y?"h:i"+(I.enableSeconds?":S K":" K"):ne+(" h:i"+(I.enableSeconds?":S":"")+" K")}Object.defineProperty(t.config,"minDate",{get:function(){return t.config._minDate},set:Ke("min")}),Object.defineProperty(t.config,"maxDate",{get:function(){return t.config._maxDate},set:Ke("max")});var Se=function(ye){return function(Ye){t.config[ye==="min"?"_minTime":"_maxTime"]=t.parseDate(Ye,"H:i:S")}};Object.defineProperty(t.config,"minTime",{get:function(){return t.config._minTime},set:Se("min")}),Object.defineProperty(t.config,"maxTime",{get:function(){return t.config._maxTime},set:Se("max")}),I.mode==="time"&&(t.config.noCalendar=!0,t.config.enableTime=!0),Object.assign(t.config,L,I);for(var ue=0;ue<R.length;ue++)t.config[R[ue]]=t.config[R[ue]]===!0||t.config[R[ue]]==="true";Cd.filter(function(ye){return t.config[ye]!==void 0}).forEach(function(ye){t.config[ye]=Ed(t.config[ye]||[]).map(s)}),t.isMobile=!t.config.disableMobile&&!t.config.inline&&t.config.mode==="single"&&!t.config.disable.length&&!t.config.enable&&!t.config.weekNumbers&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(var ue=0;ue<t.config.plugins.length;ue++){var Te=t.config.plugins[ue](t)||{};for(var ae in Te)Cd.indexOf(ae)>-1?t.config[ae]=Ed(Te[ae]).map(s).concat(t.config[ae]):typeof I[ae]>"u"&&(t.config[ae]=Te[ae])}I.altInputClass||(t.config.altInputClass=Dn().className+" "+t.config.altInputClass),qe("onParseConfig")}function Dn(){return t.config.wrap?n.querySelector("[data-input]"):n}function An(){typeof t.config.locale!="object"&&typeof ht.l10ns[t.config.locale]>"u"&&t.config.errorHandler(new Error("flatpickr: invalid locale "+t.config.locale)),t.l10n=$t($t({},ht.l10ns.default),typeof t.config.locale=="object"?t.config.locale:t.config.locale!=="default"?ht.l10ns[t.config.locale]:void 0),lo.D="("+t.l10n.weekdays.shorthand.join("|")+")",lo.l="("+t.l10n.weekdays.longhand.join("|")+")",lo.M="("+t.l10n.months.shorthand.join("|")+")",lo.F="("+t.l10n.months.longhand.join("|")+")",lo.K="("+t.l10n.amPM[0]+"|"+t.l10n.amPM[1]+"|"+t.l10n.amPM[0].toLowerCase()+"|"+t.l10n.amPM[1].toLowerCase()+")";var R=$t($t({},e),JSON.parse(JSON.stringify(n.dataset||{})));R.time_24hr===void 0&&ht.defaultConfig.time_24hr===void 0&&(t.config.time_24hr=t.l10n.time_24hr),t.formatDate=zx(t),t.parseDate=Yh({config:t.config,l10n:t.l10n})}function Ot(R){if(typeof t.config.position=="function")return void t.config.position(t,R);if(t.calendarContainer!==void 0){qe("onPreCalendarPosition");var I=R||t._positionElement,L=Array.prototype.reduce.call(t.calendarContainer.children,(function(RS,TS){return RS+TS.offsetHeight}),0),Y=t.calendarContainer.offsetWidth,Z=t.config.position.split(" "),ne=Z[0],Se=Z.length>1?Z[1]:null,ue=I.getBoundingClientRect(),Te=window.innerHeight-ue.bottom,ae=ne==="above"||ne!=="below"&&Te<L&&ue.top>L,ye=window.pageYOffset+ue.top+(ae?-L-2:I.offsetHeight+2);if(sn(t.calendarContainer,"arrowTop",!ae),sn(t.calendarContainer,"arrowBottom",ae),!t.config.inline){var Ye=window.pageXOffset+ue.left,fr=!1,Rn=!1;Se==="center"?(Ye-=(Y-ue.width)/2,fr=!0):Se==="right"&&(Ye-=Y-ue.width,Rn=!0),sn(t.calendarContainer,"arrowLeft",!fr&&!Rn),sn(t.calendarContainer,"arrowCenter",fr),sn(t.calendarContainer,"arrowRight",Rn);var Ws=window.document.body.offsetWidth-(window.pageXOffset+ue.right),Wo=Ye+Y>window.document.body.offsetWidth,_S=Ws+Y>window.document.body.offsetWidth;if(sn(t.calendarContainer,"rightMost",Wo),!t.config.static)if(t.calendarContainer.style.top=ye+"px",!Wo)t.calendarContainer.style.left=Ye+"px",t.calendarContainer.style.right="auto";else if(!_S)t.calendarContainer.style.left="auto",t.calendarContainer.style.right=Ws+"px";else{var hd=ui();if(hd===void 0)return;var CS=window.document.body.offsetWidth,ES=Math.max(0,CS/2-Y/2),SS=".flatpickr-calendar.centerMost:before",DS=".flatpickr-calendar.centerMost:after",AS=hd.cssRules.length,kS="{left:"+ue.left+"px;right:auto;}";sn(t.calendarContainer,"rightMost",!1),sn(t.calendarContainer,"centerMost",!0),hd.insertRule(SS+","+DS+kS,AS),t.calendarContainer.style.left=ES+"px",t.calendarContainer.style.right="auto"}}}}function ui(){for(var R=null,I=0;I<document.styleSheets.length;I++){var L=document.styleSheets[I];if(L.cssRules){try{L.cssRules}catch{continue}R=L;break}}return R??Qn()}function Qn(){var R=document.createElement("style");return document.head.appendChild(R),R.sheet}function Jn(){t.config.noCalendar||t.isMobile||(B(),hl(),M())}function kn(){t._input.focus(),window.navigator.userAgent.indexOf("MSIE")!==-1||navigator.msMaxTouchPoints!==void 0?setTimeout(t.close,0):t.close()}function Br(R){R.preventDefault(),R.stopPropagation();var I=function(ye){return ye.classList&&ye.classList.contains("flatpickr-day")&&!ye.classList.contains("flatpickr-disabled")&&!ye.classList.contains("notAllowed")},L=Wx(In(R),I);if(L!==void 0){var Y=L,Z=t.latestSelectedDateObj=new Date(Y.dateObj.getTime()),ne=(Z.getMonth()<t.currentMonth||Z.getMonth()>t.currentMonth+t.config.showMonths-1)&&t.config.mode!=="range";if(t.selectedDateElem=Y,t.config.mode==="single")t.selectedDates=[Z];else if(t.config.mode==="multiple"){var Se=cd(Z);Se?t.selectedDates.splice(parseInt(Se),1):t.selectedDates.push(Z)}else t.config.mode==="range"&&(t.selectedDates.length===2&&t.clear(!1,!1),t.latestSelectedDateObj=Z,t.selectedDates.push(Z),On(Z,t.selectedDates[0],!0)!==0&&t.selectedDates.sort(function(ye,Ye){return ye.getTime()-Ye.getTime()}));if(d(),ne){var ue=t.currentYear!==Z.getFullYear();t.currentYear=Z.getFullYear(),t.currentMonth=Z.getMonth(),ue&&(qe("onYearChange"),B()),qe("onMonthChange")}if(hl(),M(),Wr(),!ne&&t.config.mode!=="range"&&t.config.showMonths===1?C(Y):t.selectedDateElem!==void 0&&t.hourElement===void 0&&t.selectedDateElem&&t.selectedDateElem.focus(),t.hourElement!==void 0&&t.hourElement!==void 0&&t.hourElement.focus(),t.config.closeOnSelect){var Te=t.config.mode==="single"&&!t.config.enableTime,ae=t.config.mode==="range"&&t.selectedDates.length===2&&!t.config.enableTime;(Te||ae)&&kn()}m()}}var hn={locale:[An,q],showMonths:[F,a,U],minDate:[y],maxDate:[y],positionElement:[dl],clickOpens:[function(){t.config.clickOpens===!0?(g(t._input,"focus",t.open),g(t._input,"click",t.open)):(t._input.removeEventListener("focus",t.open),t._input.removeEventListener("click",t.open))}]};function Ls(R,I){if(R!==null&&typeof R=="object"){Object.assign(t.config,R);for(var L in R)hn[L]!==void 0&&hn[L].forEach(function(Y){return Y()})}else t.config[R]=I,hn[R]!==void 0?hn[R].forEach(function(Y){return Y()}):Cd.indexOf(R)>-1&&(t.config[R]=Ed(I));t.redraw(),Wr(!0)}function Hr(R,I){var L=[];if(R instanceof Array)L=R.map(function(Y){return t.parseDate(Y,I)});else if(R instanceof Date||typeof R=="number")L=[t.parseDate(R,I)];else if(typeof R=="string")switch(t.config.mode){case"single":case"time":L=[t.parseDate(R,I)];break;case"multiple":L=R.split(t.config.conjunction).map(function(Y){return t.parseDate(Y,I)});break;case"range":L=R.split(t.l10n.rangeSeparator).map(function(Y){return t.parseDate(Y,I)});break}else t.config.errorHandler(new Error("Invalid date supplied: "+JSON.stringify(R)));t.selectedDates=t.config.allowInvalidPreload?L:L.filter(function(Y){return Y instanceof Date&&Ce(Y,!1)}),t.config.mode==="range"&&t.selectedDates.sort(function(Y,Z){return Y.getTime()-Z.getTime()})}function Un(R,I,L){if(I===void 0&&(I=!1),L===void 0&&(L=t.config.dateFormat),R!==0&&!R||R instanceof Array&&R.length===0)return t.clear(I);Hr(R,L),t.latestSelectedDateObj=t.selectedDates[t.selectedDates.length-1],t.redraw(),y(void 0,I),h(),t.selectedDates.length===0&&t.clear(!1),Wr(I),I&&qe("onChange")}function Ho(R){return R.slice().map(function(I){return typeof I=="string"||typeof I=="number"||I instanceof Date?t.parseDate(I,void 0,!0):I&&typeof I=="object"&&I.from&&I.to?{from:t.parseDate(I.from,void 0),to:t.parseDate(I.to,void 0)}:I}).filter(function(I){return I})}function ad(){t.selectedDates=[],t.now=t.parseDate(t.config.now)||new Date;var R=t.config.defaultDate||((t.input.nodeName==="INPUT"||t.input.nodeName==="TEXTAREA")&&t.input.placeholder&&t.input.value===t.input.placeholder?null:t.input.value);R&&Hr(R,t.config.dateFormat),t._initialDate=t.selectedDates.length>0?t.selectedDates[0]:t.config.minDate&&t.config.minDate.getTime()>t.now.getTime()?t.config.minDate:t.config.maxDate&&t.config.maxDate.getTime()<t.now.getTime()?t.config.maxDate:t.now,t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth(),t.selectedDates.length>0&&(t.latestSelectedDateObj=t.selectedDates[0]),t.config.minTime!==void 0&&(t.config.minTime=t.parseDate(t.config.minTime,"H:i")),t.config.maxTime!==void 0&&(t.config.maxTime=t.parseDate(t.config.maxTime,"H:i")),t.minDateHasTime=!!t.config.minDate&&(t.config.minDate.getHours()>0||t.config.minDate.getMinutes()>0||t.config.minDate.getSeconds()>0),t.maxDateHasTime=!!t.config.maxDate&&(t.config.maxDate.getHours()>0||t.config.maxDate.getMinutes()>0||t.config.maxDate.getSeconds()>0)}function ld(){if(t.input=Dn(),!t.input){t.config.errorHandler(new Error("Invalid input element specified"));return}t.input._type=t.input.type,t.input.type="text",t.input.classList.add("flatpickr-input"),t._input=t.input,t.config.altInput&&(t.altInput=Ve(t.input.nodeName,t.config.altInputClass),t._input=t.altInput,t.altInput.placeholder=t.input.placeholder,t.altInput.disabled=t.input.disabled,t.altInput.required=t.input.required,t.altInput.tabIndex=t.input.tabIndex,t.altInput.type="text",t.input.setAttribute("type","hidden"),!t.config.static&&t.input.parentNode&&t.input.parentNode.insertBefore(t.altInput,t.input.nextSibling)),t.config.allowInput||t._input.setAttribute("readonly","readonly"),dl()}function dl(){t._positionElement=t.config.positionElement||t._input}function Bs(){var R=t.config.enableTime?t.config.noCalendar?"time":"datetime-local":"date";t.mobileInput=Ve("input",t.input.className+" flatpickr-mobile"),t.mobileInput.tabIndex=1,t.mobileInput.type=R,t.mobileInput.disabled=t.input.disabled,t.mobileInput.required=t.input.required,t.mobileInput.placeholder=t.input.placeholder,t.mobileFormatStr=R==="datetime-local"?"Y-m-d\\TH:i:S":R==="date"?"Y-m-d":"H:i:S",t.selectedDates.length>0&&(t.mobileInput.defaultValue=t.mobileInput.value=t.formatDate(t.selectedDates[0],t.mobileFormatStr)),t.config.minDate&&(t.mobileInput.min=t.formatDate(t.config.minDate,"Y-m-d")),t.config.maxDate&&(t.mobileInput.max=t.formatDate(t.config.maxDate,"Y-m-d")),t.input.getAttribute("step")&&(t.mobileInput.step=String(t.input.getAttribute("step"))),t.input.type="hidden",t.altInput!==void 0&&(t.altInput.type="hidden");try{t.input.parentNode&&t.input.parentNode.insertBefore(t.mobileInput,t.input.nextSibling)}catch{}g(t.mobileInput,"change",function(I){t.setDate(In(I).value,!1,t.mobileFormatStr),qe("onChange"),qe("onClose")})}function Hs(R){if(t.isOpen===!0)return t.close();t.open(R)}function qe(R,I){if(t.config!==void 0){var L=t.config[R];if(L!==void 0&&L.length>0)for(var Y=0;L[Y]&&Y<L.length;Y++)L[Y](t.selectedDates,t.input.value,t,I);R==="onChange"&&(t.input.dispatchEvent(ud("change")),t.input.dispatchEvent(ud("input")))}}function ud(R){var I=document.createEvent("Event");return I.initEvent(R,!0,!0),I}function cd(R){for(var I=0;I<t.selectedDates.length;I++){var L=t.selectedDates[I];if(L instanceof Date&&On(L,R)===0)return""+I}return!1}function bS(R){return t.config.mode!=="range"||t.selectedDates.length<2?!1:On(R,t.selectedDates[0])>=0&&On(R,t.selectedDates[1])<=0}function hl(){t.config.noCalendar||t.isMobile||!t.monthNav||(t.yearElements.forEach(function(R,I){var L=new Date(t.currentYear,t.currentMonth,1);L.setMonth(t.currentMonth+I),t.config.showMonths>1||t.config.monthSelectorType==="static"?t.monthElements[I].textContent=Cu(L.getMonth(),t.config.shorthandCurrentMonth,t.l10n)+" ":t.monthsDropdownContainer.value=L.getMonth().toString(),R.value=L.getFullYear().toString()}),t._hidePrevMonthArrow=t.config.minDate!==void 0&&(t.currentYear===t.config.minDate.getFullYear()?t.currentMonth<=t.config.minDate.getMonth():t.currentYear<t.config.minDate.getFullYear()),t._hideNextMonthArrow=t.config.maxDate!==void 0&&(t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth+1>t.config.maxDate.getMonth():t.currentYear>t.config.maxDate.getFullYear()))}function dd(R){var I=R||(t.config.altInput?t.config.altFormat:t.config.dateFormat);return t.selectedDates.map(function(L){return t.formatDate(L,I)}).filter(function(L,Y,Z){return t.config.mode!=="range"||t.config.enableTime||Z.indexOf(L)===Y}).join(t.config.mode!=="range"?t.config.conjunction:t.l10n.rangeSeparator)}function Wr(R){R===void 0&&(R=!0),t.mobileInput!==void 0&&t.mobileFormatStr&&(t.mobileInput.value=t.latestSelectedDateObj!==void 0?t.formatDate(t.latestSelectedDateObj,t.mobileFormatStr):""),t.input.value=dd(t.config.dateFormat),t.altInput!==void 0&&(t.altInput.value=dd(t.config.altFormat)),R!==!1&&qe("onValueUpdate")}function xS(R){var I=In(R),L=t.prevMonthNav.contains(I),Y=t.nextMonthNav.contains(I);L||Y?J(L?-1:1):t.yearElements.indexOf(I)>=0?I.select():I.classList.contains("arrowUp")?t.changeYear(t.currentYear+1):I.classList.contains("arrowDown")&&t.changeYear(t.currentYear-1)}function wS(R){R.preventDefault();var I=R.type==="keydown",L=In(R),Y=L;t.amPM!==void 0&&L===t.amPM&&(t.amPM.textContent=t.l10n.amPM[Gn(t.amPM.textContent===t.l10n.amPM[0])]);var Z=parseFloat(Y.getAttribute("min")),ne=parseFloat(Y.getAttribute("max")),Se=parseFloat(Y.getAttribute("step")),ue=parseInt(Y.value,10),Te=R.delta||(I?R.which===38?1:-1:0),ae=ue+Se*Te;if(typeof Y.value<"u"&&Y.value.length===2){var ye=Y===t.hourElement,Ye=Y===t.minuteElement;ae<Z?(ae=ne+ae+Gn(!ye)+(Gn(ye)&&Gn(!t.amPM)),Ye&&x(void 0,-1,t.hourElement)):ae>ne&&(ae=Y===t.hourElement?ae-ne-Gn(!t.amPM):Z,Ye&&x(void 0,1,t.hourElement)),t.amPM&&ye&&(Se===1?ae+ue===23:Math.abs(ae-ue)>Se)&&(t.amPM.textContent=t.l10n.amPM[Gn(t.amPM.textContent===t.l10n.amPM[0])]),Y.value=gn(ae)}}return i(),t}function ss(n,e){for(var t=Array.prototype.slice.call(n).filter(function(s){return s instanceof HTMLElement}),r=[],i=0;i<t.length;i++){var o=t[i];try{if(o.getAttribute("data-fp-omit")!==null)continue;o._flatpickr!==void 0&&(o._flatpickr.destroy(),o._flatpickr=void 0),o._flatpickr=mR(o,e||{}),r.push(o._flatpickr)}catch(s){console.error(s)}}return r.length===1?r[0]:r}typeof HTMLElement<"u"&&typeof HTMLCollection<"u"&&typeof NodeList<"u"&&(HTMLCollection.prototype.flatpickr=NodeList.prototype.flatpickr=function(n){return ss(this,n)},HTMLElement.prototype.flatpickr=function(n){return ss([this],n)});var ht=function(n,e){return typeof n=="string"?ss(window.document.querySelectorAll(n),e):n instanceof Node?ss([n],e):ss(n,e)};ht.defaultConfig={};ht.l10ns={en:$t({},wa),default:$t({},wa)};ht.localize=function(n){ht.l10ns.default=$t($t({},ht.l10ns.default),n)};ht.setDefaults=function(n){ht.defaultConfig=$t($t({},ht.defaultConfig),n)};ht.parseDate=Yh({});ht.formatDate=zx({});ht.compareDates=On;typeof jQuery<"u"&&typeof jQuery.fn<"u"&&(jQuery.fn.flatpickr=function(n){return ss(this,n)});Date.prototype.fp_incr=function(n){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+(typeof n=="string"?parseInt(n,10):n))};typeof window<"u"&&(window.flatpickr=ht);var na={exports:{}},vR=na.exports,Qm;function yR(){return Qm||(Qm=1,(function(n,e){(function(t,r){r(e)})(vR,(function(t){var r=typeof window<"u"&&window.flatpickr!==void 0?window.flatpickr:{l10ns:{}},i={weekdays:{shorthand:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],longhand:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"]},months:{shorthand:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],longhand:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]},ordinal:function(){return"º"},firstDayOfWeek:1,rangeSeparator:" a ",time_24hr:!0};r.l10ns.es=i;var o=r.l10ns;t.Spanish=i,t.default=o,Object.defineProperty(t,"__esModule",{value:!0})}))})(na,na.exports)),na.exports}var bR=yR();function kd(n,e){n.split(/\s+/).forEach(t=>{e(t)})}class xR{constructor(){this._events={}}on(e,t){kd(e,r=>{const i=this._events[r]||[];i.push(t),this._events[r]=i})}off(e,t){var r=arguments.length;if(r===0){this._events={};return}kd(e,i=>{if(r===1){delete this._events[i];return}const o=this._events[i];o!==void 0&&(o.splice(o.indexOf(t),1),this._events[i]=o)})}trigger(e,...t){var r=this;kd(e,i=>{const o=r._events[i];o!==void 0&&o.forEach(s=>{s.apply(r,t)})})}}function wR(n){return n.plugins={},class extends n{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){n.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,r;const i=this,o=[];if(Array.isArray(e))e.forEach(s=>{typeof s=="string"?o.push(s):(i.plugins.settings[s.name]=s.options,o.push(s.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(i.plugins.settings[t]=e[t],o.push(t));for(;r=o.shift();)i.require(r)}loadPlugin(e){var t=this,r=t.plugins,i=n.plugins[e];if(!n.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');r.requested[e]=!0,r.loaded[e]=i.fn.apply(t,[t.plugins.settings[e]||{}]),r.names.push(e)}require(e){var t=this,r=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(r.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return r.loaded[e]}}}const Ec=n=>(n=n.filter(Boolean),n.length<2?n[0]||"":CR(n)==1?"["+n.join("")+"]":"(?:"+n.join("|")+")"),Vx=n=>{if(!_R(n))return n.join("");let e="",t=0;const r=()=>{t>1&&(e+="{"+t+"}")};return n.forEach((i,o)=>{if(i===n[o-1]){t++;return}r(),e+=i,t=1}),r(),e},Ux=n=>{let e=Array.from(n);return Ec(e)},_R=n=>new Set(n).size!==n.length,_a=n=>(n+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),CR=n=>n.reduce((e,t)=>Math.max(e,ER(t)),0),ER=n=>Array.from(n).length,jx=n=>{if(n.length===1)return[[n]];let e=[];const t=n.substring(1);return jx(t).forEach(function(i){let o=i.slice(0);o[0]=n.charAt(0)+o[0],e.push(o),o=i.slice(0),o.unshift(n.charAt(0)),e.push(o)}),e},SR=[[0,65535]],DR="[̀-ͯ·ʾʼ]";let Eu,$x;const AR=3,up={},Jm={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let n in Jm){let e=Jm[n]||"";for(let t=0;t<e.length;t++){let r=e.substring(t,t+1);up[r]=n}}const kR=new RegExp(Object.keys(up).join("|")+"|"+DR,"gu"),RR=n=>{Eu===void 0&&(Eu=OR(SR))},Zm=(n,e="NFKD")=>n.normalize(e),Su=n=>Array.from(n).reduce((e,t)=>e+TR(t),""),TR=n=>(n=Zm(n).toLowerCase().replace(kR,e=>up[e]||""),Zm(n,"NFC"));function*IR(n){for(const[e,t]of n)for(let r=e;r<=t;r++){let i=String.fromCharCode(r),o=Su(i);o!=i.toLowerCase()&&(o.length>AR||o.length!=0&&(yield{folded:o,composed:i,code_point:r}))}}const MR=n=>{const e={},t=(r,i)=>{const o=e[r]||new Set,s=new RegExp("^"+Ux(o)+"$","iu");i.match(s)||(o.add(_a(i)),e[r]=o)};for(let r of IR(n))t(r.folded,r.folded),t(r.folded,r.composed);return e},OR=n=>{const e=MR(n),t={};let r=[];for(let o in e){let s=e[o];s&&(t[o]=Ux(s)),o.length>1&&r.push(_a(o))}r.sort((o,s)=>s.length-o.length);const i=Ec(r);return $x=new RegExp("^"+i,"u"),t},PR=(n,e=1)=>{let t=0;return n=n.map(r=>(Eu[r]&&(t+=r.length),Eu[r]||r)),t>=e?Vx(n):""},NR=(n,e=1)=>(e=Math.max(e,n.length-1),Ec(jx(n).map(t=>PR(t,e)))),ev=(n,e=!0)=>{let t=n.length>1?1:0;return Ec(n.map(r=>{let i=[];const o=e?r.length():r.length()-1;for(let s=0;s<o;s++)i.push(NR(r.substrs[s]||"",t));return Vx(i)}))},FR=(n,e)=>{for(const t of e){if(t.start!=n.start||t.end!=n.end||t.substrs.join("")!==n.substrs.join(""))continue;let r=n.parts;const i=s=>{for(const a of r){if(a.start===s.start&&a.substr===s.substr)return!1;if(!(s.length==1||a.length==1)&&(s.start<a.start&&s.end>a.start||a.start<s.start&&a.end>s.start))return!0}return!1};if(!(t.parts.filter(i).length>0))return!0}return!1};class Du{parts;substrs;start;end;constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let r=new Du,i=JSON.parse(JSON.stringify(this.parts)),o=i.pop();for(const l of i)r.add(l);let s=t.substr.substring(0,e-o.start),a=s.length;return r.add({start:o.start,end:o.start+a,length:a,substr:s}),r}}const LR=n=>{RR(),n=Su(n);let e="",t=[new Du];for(let r=0;r<n.length;r++){let o=n.substring(r).match($x);const s=n.substring(r,r+1),a=o?o[0]:null;let l=[],u=new Set;for(const c of t){const d=c.last();if(!d||d.length==1||d.end<=r)if(a){const h=a.length;c.add({start:r,end:r+h,length:h,substr:a}),u.add("1")}else c.add({start:r,end:r+1,length:1,substr:s}),u.add("2");else if(a){let h=c.clone(r,d);const f=a.length;h.add({start:r,end:r+f,length:f,substr:a}),l.push(h)}else u.add("3")}if(l.length>0){l=l.sort((c,d)=>c.length()-d.length());for(let c of l)FR(c,t)||t.push(c);continue}if(r>0&&u.size==1&&!u.has("3")){e+=ev(t,!1);let c=new Du;const d=t[0];d&&c.add(d.last()),t=[c]}}return e+=ev(t,!0),e},BR=(n,e)=>{if(n)return n[e]},HR=(n,e)=>{if(n){for(var t,r=e.split(".");(t=r.shift())&&(n=n[t]););return n}},Rd=(n,e,t)=>{var r,i;return!n||(n=n+"",e.regex==null)||(i=n.search(e.regex),i===-1)?0:(r=e.string.length/n.length,i===0&&(r+=.5),r*t)},Td=(n,e)=>{var t=n[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(n[e]=[t])},xl=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},WR=(n,e)=>typeof n=="number"&&typeof e=="number"?n>e?1:n<e?-1:0:(n=Su(n+"").toLowerCase(),e=Su(e+"").toLowerCase(),n>e?1:e>n?-1:0);class zR{items;settings;constructor(e,t){this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,r){if(!e||!e.length)return[];const i=[],o=e.split(/\s+/);var s;return r&&(s=new RegExp("^("+Object.keys(r).map(_a).join("|")+"):(.*)$")),o.forEach(a=>{let l,u=null,c=null;s&&(l=a.match(s))&&(u=l[1],a=l[2]),a.length>0&&(this.settings.diacritics?c=LR(a)||null:c=_a(a),c&&t&&(c="\\b"+c)),i.push({string:a,regex:c?new RegExp(c,"iu"):null,field:u})}),i}getScoreFunction(e,t){var r=this.prepareSearch(e,t);return this._getScoreFunction(r)}_getScoreFunction(e){const t=e.tokens,r=t.length;if(!r)return function(){return 0};const i=e.options.fields,o=e.weights,s=i.length,a=e.getAttrFn;if(!s)return function(){return 1};const l=(function(){return s===1?function(u,c){const d=i[0].field;return Rd(a(c,d),u,o[d]||1)}:function(u,c){var d=0;if(u.field){const h=a(c,u.field);!u.regex&&h?d+=1/s:d+=Rd(h,u,1)}else xl(o,(h,f)=>{d+=Rd(a(c,f),u,h)});return d/s}})();return r===1?function(u){return l(t[0],u)}:e.options.conjunction==="and"?function(u){var c,d=0;for(let h of t){if(c=l(h,u),c<=0)return 0;d+=c}return d/r}:function(u){var c=0;return xl(t,d=>{c+=l(d,u)}),c/r}}getSortFunction(e,t){var r=this.prepareSearch(e,t);return this._getSortFunction(r)}_getSortFunction(e){var t,r=[];const i=this,o=e.options,s=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof s=="function")return s.bind(this);const a=function(u,c){return u==="$score"?c.score:e.getAttrFn(i.items[c.id],u)};if(s)for(let u of s)(e.query||u.field!=="$score")&&r.push(u);if(e.query){t=!0;for(let u of r)if(u.field==="$score"){t=!1;break}t&&r.unshift({field:"$score",direction:"desc"})}else r=r.filter(u=>u.field!=="$score");return r.length?function(u,c){var d,h;for(let f of r)if(h=f.field,d=(f.direction==="desc"?-1:1)*WR(a(h,u),a(h,c)),d)return d;return 0}:null}prepareSearch(e,t){const r={};var i=Object.assign({},t);if(Td(i,"sort"),Td(i,"sort_empty"),i.fields){Td(i,"fields");const o=[];i.fields.forEach(s=>{typeof s=="string"&&(s={field:s,weight:1}),o.push(s),r[s.field]="weight"in s?s.weight:1}),i.fields=o}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,r),total:0,items:[],weights:r,getAttrFn:i.nesting?HR:BR}}search(e,t){var r=this,i,o;o=this.prepareSearch(e,t),t=o.options,e=o.query;const s=t.score||r._getScoreFunction(o);e.length?xl(r.items,(l,u)=>{i=s(l),(t.filter===!1||i>0)&&o.items.push({score:i,id:u})}):xl(r.items,(l,u)=>{o.items.push({score:1,id:u})});const a=r._getSortFunction(o);return a&&o.items.sort(a),o.total=o.items.length,typeof t.limit=="number"&&(o.items=o.items.slice(0,t.limit)),o}}const tr=n=>typeof n>"u"||n===null?null:cu(n),cu=n=>typeof n=="boolean"?n?"1":"0":n+"",Id=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),VR=(n,e)=>e>0?window.setTimeout(n,e):(n.call(null),null),UR=(n,e)=>{var t;return function(r,i){var o=this;t&&(o.loading=Math.max(o.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,o.loadedSearches[r]=!0,n.call(o,r,i)},e)}},tv=(n,e,t)=>{var r,i=n.trigger,o={};n.trigger=function(){var s=arguments[0];if(e.indexOf(s)!==-1)o[s]=arguments;else return i.apply(n,arguments)},t.apply(n,[]),n.trigger=i;for(r of e)r in o&&i.apply(n,o[r])},jR=n=>({start:n.selectionStart||0,length:(n.selectionEnd||0)-(n.selectionStart||0)}),mt=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},an=(n,e,t,r)=>{n.addEventListener(e,t,r)},qi=(n,e)=>{if(!e||!e[n])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},Md=(n,e)=>{const t=n.getAttribute("id");return t||(n.setAttribute("id",e),e)},nv=n=>n.replace(/[\\"']/g,"\\$&"),Yi=(n,e)=>{e&&n.append(e)},Wt=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},mr=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Gx(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Gx=n=>typeof n=="string"&&n.indexOf("<")>-1,$R=n=>n.replace(/['"\\]/g,"\\$&"),Od=(n,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),n.dispatchEvent(t)},wl=(n,e)=>{Object.assign(n.style,e)},Mn=(n,...e)=>{var t=qx(e);n=Yx(n),n.map(r=>{t.map(i=>{r.classList.add(i)})})},di=(n,...e)=>{var t=qx(e);n=Yx(n),n.map(r=>{t.map(i=>{r.classList.remove(i)})})},qx=n=>{var e=[];return Wt(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Yx=n=>(Array.isArray(n)||(n=[n]),n),Pd=(n,e,t)=>{if(!(t&&!t.contains(n)))for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},rv=(n,e=0)=>e>0?n[n.length-1]:n[0],GR=n=>Object.keys(n).length===0,iv=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t},ot=(n,e)=>{Wt(e,(t,r)=>{t==null?n.removeAttribute(r):n.setAttribute(r,""+t)})},Xh=(n,e)=>{n.parentNode&&n.parentNode.replaceChild(e,n)},qR=(n,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=o=>{var s=o.data.match(e);if(s&&o.data.length>0){var a=document.createElement("span");a.className="highlight";var l=o.splitText(s.index);l.splitText(s[0].length);var u=l.cloneNode(!0);return a.appendChild(u),Xh(l,a),1}return 0},r=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(s=>{i(s)})},i=o=>o.nodeType===3?t(o):(r(o),0);i(n)},YR=n=>{var e=n.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var r=t.parentNode;r.replaceChild(t.firstChild,t),r.normalize()})},XR=65,KR=13,QR=27,JR=37,ZR=38,e2=39,t2=40,ov=8,n2=46,sv=9,r2=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),_l=r2?"metaKey":"ctrlKey",av={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(n){return n.length>0},render:{}};function lv(n,e){var t=Object.assign({},av,e),r=t.dataAttr,i=t.labelField,o=t.valueField,s=t.disabledField,a=t.optgroupField,l=t.optgroupLabelField,u=t.optgroupValueField,c=n.tagName.toLowerCase(),d=n.getAttribute("placeholder")||n.getAttribute("data-placeholder");if(!d&&!t.allowEmptyOption){let g=n.querySelector('option[value=""]');g&&(d=g.textContent)}var h={placeholder:d,options:[],optgroups:[],items:[],maxItems:null},f=()=>{var g,m=h.options,v={},y=1;let b=0;var x=C=>{var E=Object.assign({},C.dataset),S=r&&E[r];return typeof S=="string"&&S.length&&(E=Object.assign(E,JSON.parse(S))),E},w=(C,E)=>{var S=tr(C.value);if(S!=null&&!(!S&&!t.allowEmptyOption)){if(v.hasOwnProperty(S)){if(E){var D=v[S][a];D?Array.isArray(D)?D.push(E):v[S][a]=[D,E]:v[S][a]=E}}else{var k=x(C);k[i]=k[i]||C.textContent,k[o]=k[o]||S,k[s]=k[s]||C.disabled,k[a]=k[a]||E,k.$option=C,k.$order=k.$order||++b,v[S]=k,m.push(k)}C.selected&&h.items.push(S)}},_=C=>{var E,S;S=x(C),S[l]=S[l]||C.getAttribute("label")||"",S[u]=S[u]||y++,S[s]=S[s]||C.disabled,S.$order=S.$order||++b,h.optgroups.push(S),E=S[u],Wt(C.children,D=>{w(D,E)})};h.maxItems=n.hasAttribute("multiple")?null:1,Wt(n.children,C=>{g=C.tagName.toLowerCase(),g==="optgroup"?_(C):g==="option"&&w(C)})},p=()=>{const g=n.getAttribute(r);if(g)h.options=JSON.parse(g),Wt(h.options,v=>{h.items.push(v[o])});else{var m=n.value.trim()||"";if(!t.allowEmptyOption&&!m.length)return;const v=m.split(t.delimiter);Wt(v,y=>{const b={};b[i]=y,b[o]=y,h.options.push(b)}),h.items=v}};return c==="select"?f():p(),Object.assign({},av,h,e)}var uv=0;class dn extends wR(xR){constructor(e,t){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,uv++;var r,i=mr(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(i,null);r=o.getPropertyValue("direction");const s=lv(i,t);this.settings=s,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(r),this.inputId=Md(i,"tomselect-"+uv),this.isRequired=i.required,this.sifter=new zR(this.options,{diacritics:s.diacritics}),s.mode=s.mode||(s.maxItems===1?"single":"multi"),typeof s.hideSelected!="boolean"&&(s.hideSelected=s.mode==="multi"),typeof s.hidePlaceholder!="boolean"&&(s.hidePlaceholder=s.mode!=="multi");var a=s.createFilter;typeof a!="function"&&(typeof a=="string"&&(a=new RegExp(a)),a instanceof RegExp?s.createFilter=m=>a.test(m):s.createFilter=m=>this.settings.duplicates||!this.options[m]),this.initializePlugins(s.plugins),this.setupCallbacks(),this.setupTemplates();const l=mr("<div>"),u=mr("<div>"),c=this._render("dropdown"),d=mr('<div role="listbox" tabindex="-1">'),h=this.input.getAttribute("class")||"",f=s.mode;var p;if(Mn(l,s.wrapperClass,h,f),Mn(u,s.controlClass),Yi(l,u),Mn(c,s.dropdownClass,f),s.copyClassesToDropdown&&Mn(c,h),Mn(d,s.dropdownContentClass),Yi(c,d),mr(s.dropdownParent||l).appendChild(c),Gx(s.controlInput)){p=mr(s.controlInput);var g=["autocorrect","autocapitalize","autocomplete","spellcheck"];Wt(g,m=>{i.getAttribute(m)&&ot(p,{[m]:i.getAttribute(m)})}),p.tabIndex=-1,u.appendChild(p),this.focus_node=p}else s.controlInput?(p=mr(s.controlInput),this.focus_node=p):(p=mr("<input/>"),this.focus_node=u);this.wrapper=l,this.dropdown=c,this.dropdown_content=d,this.control=u,this.control_input=p,this.setup()}setup(){const e=this,t=e.settings,r=e.control_input,i=e.dropdown,o=e.dropdown_content,s=e.wrapper,a=e.control,l=e.input,u=e.focus_node,c={passive:!0},d=e.inputId+"-ts-dropdown";ot(o,{id:d}),ot(u,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":d});const h=Md(u,e.inputId+"-ts-control"),f="label[for='"+$R(e.inputId)+"']",p=document.querySelector(f),g=e.focus.bind(e);if(p){an(p,"click",g),ot(p,{for:h});const y=Md(p,e.inputId+"-ts-label");ot(u,{"aria-labelledby":y}),ot(o,{"aria-labelledby":y})}if(s.style.width=l.style.width,e.plugins.names.length){const y="plugin-"+e.plugins.names.join(" plugin-");Mn([s,i],y)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&ot(l,{multiple:"multiple"}),t.placeholder&&ot(r,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+_a(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=UR(t.load,t.loadThrottle)),an(i,"mousemove",()=>{e.ignoreHover=!1}),an(i,"mouseenter",y=>{var b=Pd(y.target,"[data-selectable]",i);b&&e.onOptionHover(y,b)},{capture:!0}),an(i,"click",y=>{const b=Pd(y.target,"[data-selectable]");b&&(e.onOptionSelect(y,b),mt(y,!0))}),an(a,"click",y=>{var b=Pd(y.target,"[data-ts-item]",a);if(b&&e.onItemSelect(y,b)){mt(y,!0);return}r.value==""&&(e.onClick(),mt(y,!0))}),an(u,"keydown",y=>e.onKeyDown(y)),an(r,"keypress",y=>e.onKeyPress(y)),an(r,"input",y=>e.onInput(y)),an(u,"blur",y=>e.onBlur(y)),an(u,"focus",y=>e.onFocus(y)),an(r,"paste",y=>e.onPaste(y));const m=y=>{const b=y.composedPath()[0];if(!s.contains(b)&&!i.contains(b)){e.isFocused&&e.blur(),e.inputState();return}b==r&&e.isOpen?y.stopPropagation():mt(y,!0)},v=()=>{e.isOpen&&e.positionDropdown()};an(document,"mousedown",m),an(window,"scroll",v,c),an(window,"resize",v,c),this._destroy=()=>{document.removeEventListener("mousedown",m),window.removeEventListener("scroll",v),window.removeEventListener("resize",v),p&&p.removeEventListener("click",g)},this.revertSettings={innerHTML:l.innerHTML,tabIndex:l.tabIndex},l.tabIndex=-1,l.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,an(l,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,l.disabled?e.disable():l.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),Mn(l,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),Wt(t,r=>{this.registerOptionGroup(r)})}setupTemplates(){var e=this,t=e.settings.labelField,r=e.settings.optgroupLabelField,i={optgroup:o=>{let s=document.createElement("div");return s.className="optgroup",s.appendChild(o.options),s},optgroup_header:(o,s)=>'<div class="optgroup-header">'+s(o[r])+"</div>",option:(o,s)=>"<div>"+s(o[t])+"</div>",item:(o,s)=>"<div>"+s(o[t])+"</div>",option_create:(o,s)=>'<div class="create">Add <strong>'+s(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,t,r={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in r)t=this.settings[r[e]],t&&this.on(e,t)}sync(e=!0){const t=this,r=e?lv(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(r.options,r.optgroups),t.setValue(r.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Od(this.input,"input"),Od(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){mt(e);return}t.settings.splitOn&&setTimeout(()=>{var r=t.inputValue();if(r.match(t.settings.splitOn)){var i=r.trim().split(t.settings.splitOn);Wt(i,o=>{tr(o)&&(this.options[o]?t.addItem(o):t.createItem(o))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){mt(e);return}var r=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&r===t.settings.delimiter){t.createItem(),mt(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==sv&&mt(e);return}switch(e.keyCode){case XR:if(qi(_l,e)&&t.control_input.value==""){mt(e),t.selectAll();return}break;case QR:t.isOpen&&(mt(e,!0),t.close()),t.clearActiveItems();return;case t2:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let r=t.getAdjacent(t.activeOption,1);r&&t.setActiveOption(r)}mt(e);return;case ZR:if(t.activeOption){let r=t.getAdjacent(t.activeOption,-1);r&&t.setActiveOption(r)}mt(e);return;case KR:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),mt(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&mt(e);return;case JR:t.advanceSelection(-1,e);return;case e2:t.advanceSelection(1,e);return;case sv:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),mt(e)),t.settings.create&&t.createItem()&&mt(e));return;case ov:case n2:t.deleteSelection(e);return}t.isInputHidden&&!qi(_l,e)&&mt(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=VR(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,r=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),mt(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),r||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var r=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,r):r()}}}onOptionSelect(e,t){var r,i=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(r=t.dataset.value,typeof r<"u"&&(i.lastQuery=null,i.addItem(r),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var r=this;return!r.isLocked&&r.settings.mode==="multi"?(mt(e),r.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;Mn(t.wrapper,t.settings.loadingClass),t.loading++;const r=t.loadCallback.bind(t);t.settings.load.call(t,e,r)}loadCallback(e,t){const r=this;r.loading=Math.max(r.loading-1,0),r.lastQuery=null,r.clearActiveOption(),r.setupOptions(e,t),r.refreshOptions(r.isFocused&&!r.isInputHidden),r.loading||di(r.wrapper,r.settings.loadingClass),r.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,r=t.value!==e;r&&(t.value=e,Od(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var r=t?[]:["change"];tv(this,r,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var r=this,i,o,s,a,l,u;if(r.settings.mode!=="single"){if(!e){r.clearActiveItems(),r.isFocused&&r.inputState();return}if(i=t&&t.type.toLowerCase(),i==="click"&&qi("shiftKey",t)&&r.activeItems.length){for(u=r.getLastActive(),s=Array.prototype.indexOf.call(r.control.children,u),a=Array.prototype.indexOf.call(r.control.children,e),s>a&&(l=s,s=a,a=l),o=s;o<=a;o++)e=r.control.children[o],r.activeItems.indexOf(e)===-1&&r.setActiveItemClass(e);mt(t)}else i==="click"&&qi(_l,t)||i==="keydown"&&qi("shiftKey",t)?e.classList.contains("active")?r.removeActiveItem(e):r.setActiveItemClass(e):(r.clearActiveItems(),r.setActiveItemClass(e));r.inputState(),r.isFocused||r.focus()}}setActiveItemClass(e){const t=this,r=t.control.querySelector(".last-active");r&&di(r,"last-active"),Mn(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),di(e,"active")}clearActiveItems(){di(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,ot(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),ot(e,{"aria-selected":"true"}),Mn(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const r=this.dropdown_content,i=r.clientHeight,o=r.scrollTop||0,s=e.offsetHeight,a=e.getBoundingClientRect().top-r.getBoundingClientRect().top+o;a+s>i+o?this.scroll(a-i+s,t):a<o&&this.scroll(a,t)}scroll(e,t){const r=this.dropdown_content;t&&(r.style.scrollBehavior=t),r.scrollTop=e,r.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(di(this.activeOption,"active"),ot(this.activeOption,{"aria-selected":null})),this.activeOption=null,ot(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,Wt(t,r=>{e.setActiveItemClass(r)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(ot(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&ot(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,r,i=this,o=this.getSearchOptions();if(i.settings.score&&(r=i.settings.score.call(i,e),typeof r!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,t=i.sifter.search(e,Object.assign(o,{score:r})),i.currentResults=t):t=Object.assign({},i.currentResults),i.settings.hideSelected&&(t.items=t.items.filter(s=>{let a=tr(s.id);return!(a&&i.items.indexOf(a)!==-1)})),t}refreshOptions(e=!0){var t,r,i,o,s,a,l,u,c,d;const h={},f=[];var p=this,g=p.inputValue();const m=g===p.lastQuery||g==""&&p.lastQuery==null;var v=p.search(g),y=null,b=p.settings.shouldOpen||!1,x=p.dropdown_content;m&&(y=p.activeOption,y&&(c=y.closest("[data-group]"))),o=v.items.length,typeof p.settings.maxOptions=="number"&&(o=Math.min(o,p.settings.maxOptions)),o>0&&(b=!0);const w=(C,E)=>{let S=h[C];if(S!==void 0){let k=f[S];if(k!==void 0)return[S,k.fragment]}let D=document.createDocumentFragment();return S=f.length,f.push({fragment:D,order:E,optgroup:C}),[S,D]};for(t=0;t<o;t++){let C=v.items[t];if(!C)continue;let E=C.id,S=p.options[E];if(S===void 0)continue;let D=cu(E),k=p.getOption(D,!0);for(p.settings.hideSelected||k.classList.toggle("selected",p.items.includes(D)),s=S[p.settings.optgroupField]||"",a=Array.isArray(s)?s:[s],r=0,i=a&&a.length;r<i;r++){s=a[r];let M=S.$order,B=p.optgroups[s];B===void 0?s="":M=B.$order;const[H,F]=w(s,M);r>0&&(k=k.cloneNode(!0),ot(k,{id:S.$id+"-clone-"+r,"aria-selected":null}),k.classList.add("ts-cloned"),di(k,"active"),p.activeOption&&p.activeOption.dataset.value==E&&c&&c.dataset.group===s.toString()&&(y=k)),F.appendChild(k),s!=""&&(h[s]=H)}}p.settings.lockOptgroupOrder&&f.sort((C,E)=>C.order-E.order),l=document.createDocumentFragment(),Wt(f,C=>{let E=C.fragment,S=C.optgroup;if(!E||!E.children.length)return;let D=p.optgroups[S];if(D!==void 0){let k=document.createDocumentFragment(),M=p.render("optgroup_header",D);Yi(k,M),Yi(k,E);let B=p.render("optgroup",{group:D,options:k});Yi(l,B)}else Yi(l,E)}),x.innerHTML="",Yi(x,l),p.settings.highlight&&(YR(x),v.query.length&&v.tokens.length&&Wt(v.tokens,C=>{qR(x,C.regex)}));var _=C=>{let E=p.render(C,{input:g});return E&&(b=!0,x.insertBefore(E,x.firstChild)),E};if(p.loading?_("loading"):p.settings.shouldLoad.call(p,g)?v.items.length===0&&_("no_results"):_("not_loading"),u=p.canCreate(g),u&&(d=_("option_create")),p.hasOptions=v.items.length>0||u,b){if(v.items.length>0){if(!y&&p.settings.mode==="single"&&p.items[0]!=null&&(y=p.getOption(p.items[0])),!x.contains(y)){let C=0;d&&!p.settings.addPrecedence&&(C=1),y=p.selectable()[C]}}else d&&(y=d);e&&!p.isOpen&&(p.open(),p.scrollToOption(y,"auto")),p.setActiveOption(y)}else p.clearActiveOption(),e&&p.isOpen&&p.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const r=this;if(Array.isArray(e))return r.addOptions(e,t),!1;const i=tr(e[r.settings.valueField]);return i===null||r.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++r.order,e.$id=r.inputId+"-opt-"+e.$order,r.options[i]=e,r.lastQuery=null,t&&(r.userOptions[i]=t,r.trigger("option_add",i,e)),i)}addOptions(e,t=!1){Wt(e,r=>{this.addOption(r,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=tr(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var r;t[this.settings.optgroupValueField]=e,(r=this.registerOptionGroup(t))&&this.trigger("optgroup_add",r,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const r=this;var i,o;const s=tr(e),a=tr(t[r.settings.valueField]);if(s===null)return;const l=r.options[s];if(l==null)return;if(typeof a!="string")throw new Error("Value must be set in option data");const u=r.getOption(s),c=r.getItem(s);if(t.$order=t.$order||l.$order,delete r.options[s],r.uncacheValue(a),r.options[a]=t,u){if(r.dropdown_content.contains(u)){const d=r._render("option",t);Xh(u,d),r.activeOption===u&&r.setActiveOption(d)}u.remove()}c&&(o=r.items.indexOf(s),o!==-1&&r.items.splice(o,1,a),i=r._render("item",t),c.classList.contains("active")&&Mn(i,"active"),Xh(c,i)),r.lastQuery=null}removeOption(e,t){const r=this;e=cu(e),r.uncacheValue(e),delete r.userOptions[e],delete r.options[e],r.lastQuery=null,r.trigger("option_remove",e),r.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const r={};Wt(this.options,(i,o)=>{t(i,o)&&(r[o]=i)}),this.options=this.sifter.items=r,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const r=tr(e);if(r===null)return null;const i=this.options[r];if(i!=null){if(i.$div)return i.$div;if(t)return this._render("option",i)}return null}getAdjacent(e,t,r="option"){var i=this,o;if(!e)return null;r=="item"?o=i.controlChildren():o=i.dropdown_content.querySelectorAll("[data-selectable]");for(let s=0;s<o.length;s++)if(o[s]==e)return t>0?o[s+1]:o[s-1];return null}getItem(e){if(typeof e=="object")return e;var t=tr(e);return t!==null?this.control.querySelector(`[data-value="${nv(t)}"]`):null}addItems(e,t){var r=this,i=Array.isArray(e)?e:[e];i=i.filter(s=>r.items.indexOf(s)===-1);const o=i[i.length-1];i.forEach(s=>{r.isPending=s!==o,r.addItem(s,t)})}addItem(e,t){var r=t?[]:["change","dropdown_close"];tv(this,r,()=>{var i,o;const s=this,a=s.settings.mode,l=tr(e);if(!(l&&s.items.indexOf(l)!==-1&&(a==="single"&&s.close(),a==="single"||!s.settings.duplicates))&&!(l===null||!s.options.hasOwnProperty(l))&&(a==="single"&&s.clear(t),!(a==="multi"&&s.isFull()))){if(i=s._render("item",s.options[l]),s.control.contains(i)&&(i=i.cloneNode(!0)),o=s.isFull(),s.items.splice(s.caretPos,0,l),s.insertAtCaret(i),s.isSetup){if(!s.isPending&&s.settings.hideSelected){let u=s.getOption(l),c=s.getAdjacent(u,1);c&&s.setActiveOption(c)}!s.isPending&&!s.settings.closeAfterSelect&&s.refreshOptions(s.isFocused&&a!=="single"),s.settings.closeAfterSelect!=!1&&s.isFull()?s.close():s.isPending||s.positionDropdown(),s.trigger("item_add",l,i),s.isPending||s.updateOriginalInput({silent:t})}(!s.isPending||!o&&s.isFull())&&(s.inputState(),s.refreshState())}})}removeItem(e=null,t){const r=this;if(e=r.getItem(e),!e)return;var i,o;const s=e.dataset.value;i=iv(e),e.remove(),e.classList.contains("active")&&(o=r.activeItems.indexOf(e),r.activeItems.splice(o,1),di(e,"active")),r.items.splice(i,1),r.lastQuery=null,!r.settings.persist&&r.userOptions.hasOwnProperty(s)&&r.removeOption(s,t),i<r.caretPos&&r.setCaret(r.caretPos-1),r.updateOriginalInput({silent:t}),r.refreshState(),r.positionDropdown(),r.trigger("item_remove",s,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var r=this,i=r.caretPos,o;if(e=e||r.inputValue(),!r.canCreate(e))return t(),!1;r.lock();var s=!1,a=l=>{if(r.unlock(),!l||typeof l!="object")return t();var u=tr(l[r.settings.valueField]);if(typeof u!="string")return t();r.setTextboxValue(),r.addOption(l,!0),r.setCaret(i),r.addItem(u),t(l),s=!0};return typeof r.settings.create=="function"?o=r.settings.create.call(this,e,a):o={[r.settings.labelField]:e,[r.settings.valueField]:e},s||a(o),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),r=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",r),i.toggle("full",t),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",GR(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var r,i;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){let u=function(c,d,h){return c||(c=mr('<option value="'+Id(d)+'">'+Id(h)+"</option>")),c!=o&&t.input.append(c),a.push(c),(c!=o||l>0)&&(c.selected=!0),c};var s=u;const a=[],l=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(c=>{c.selected=!1}),t.items.length==0&&t.settings.mode=="single"?u(o,"",""):t.items.forEach(c=>{if(r=t.options[c],i=r[t.settings.labelField]||"",a.includes(r.$option)){const d=t.input.querySelector(`option[value="${nv(c)}"]:not(:checked)`);u(d,c,i)}else r.$option=u(r.$option,c,i)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,ot(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),wl(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),wl(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,r=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,ot(t.focus_node,{"aria-expanded":"false"}),wl(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),r&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),r=e.offsetHeight+t.top+window.scrollY,i=t.left+window.scrollX;wl(this.dropdown,{width:t.width+"px",top:r+"px",left:i+"px"})}}clear(e){var t=this;if(t.items.length){var r=t.controlChildren();Wt(r,i=>{t.removeItem(i,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,r=t.caretPos,i=t.control;i.insertBefore(e,i.children[r]||null),t.setCaret(r+1)}deleteSelection(e){var t,r,i,o,s=this;t=e&&e.keyCode===ov?-1:1,r=jR(s.control_input);const a=[];if(s.activeItems.length)o=rv(s.activeItems,t),i=iv(o),t>0&&i++,Wt(s.activeItems,l=>a.push(l));else if((s.isFocused||s.settings.mode==="single")&&s.items.length){const l=s.controlChildren();let u;t<0&&r.start===0&&r.length===0?u=l[s.caretPos-1]:t>0&&r.start===s.inputValue().length&&(u=l[s.caretPos]),u!==void 0&&a.push(u)}if(!s.shouldDelete(a,e))return!1;for(mt(e,!0),typeof i<"u"&&s.setCaret(i);a.length;)s.removeItem(a.pop());return s.inputState(),s.positionDropdown(),s.refreshOptions(!1),!0}shouldDelete(e,t){const r=e.map(i=>i.dataset.value);return!(!r.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(r,t)===!1)}advanceSelection(e,t){var r,i,o=this;o.rtl&&(e*=-1),!o.inputValue().length&&(qi(_l,t)||qi("shiftKey",t)?(r=o.getLastActive(e),r?r.classList.contains("active")?i=o.getAdjacent(r,e,"item"):i=r:e>0?i=o.control_input.nextElementSibling:i=o.control_input.previousElementSibling,i&&(i.classList.contains("active")&&o.removeActiveItem(r),o.setActiveItemClass(i))):o.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var r=this.control.querySelectorAll(".active");if(r)return rv(r,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,di(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var r,i;const o=this;if(typeof this.settings.render[e]!="function"||(i=o.settings.render[e].call(this,t,Id),!i))return null;if(i=mr(i),e==="option"||e==="option_create"?t[o.settings.disabledField]?ot(i,{"aria-disabled":"true"}):ot(i,{"data-selectable":""}):e==="optgroup"&&(r=t.group[o.settings.optgroupValueField],ot(i,{"data-group":r}),t.group[o.settings.disabledField]&&ot(i,{"data-disabled":""})),e==="option"||e==="item"){const s=cu(t[o.settings.valueField]);ot(i,{"data-value":s}),e==="item"?(Mn(i,o.settings.itemClass),ot(i,{"data-ts-item":""})):(Mn(i,o.settings.optionClass),ot(i,{role:"option",id:t.$id}),t.$div=i,o.options[s]=t)}return i}_render(e,t){const r=this.render(e,t);if(r==null)throw"HTMLElement expected";return r}clearCache(){Wt(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,r){var i=this,o=i[t];i[t]=function(){var s,a;return e==="after"&&(s=o.apply(i,arguments)),a=r.apply(i,arguments),e==="instead"?a:(e==="before"&&(s=o.apply(i,arguments)),s)}}}const i2=(n,e,t,r)=>{n.addEventListener(e,t,r)};function o2(){i2(this.input,"change",()=>{this.sync()})}const s2=n=>typeof n>"u"||n===null?null:a2(n),a2=n=>typeof n=="boolean"?n?"1":"0":n+"",cv=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},l2=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(u2(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},u2=n=>typeof n=="string"&&n.indexOf("<")>-1;function c2(n){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const r=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},n);var i=function(a,l){l?(a.checked=!0,r.uncheckedClassNames&&a.classList.remove(...r.uncheckedClassNames),r.checkedClassNames&&a.classList.add(...r.checkedClassNames)):(a.checked=!1,r.checkedClassNames&&a.classList.remove(...r.checkedClassNames),r.uncheckedClassNames&&a.classList.add(...r.uncheckedClassNames))},o=function(a){setTimeout(()=>{var l=a.querySelector("input."+r.className);l instanceof HTMLInputElement&&i(l,a.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var s=e.settings.render.option;e.settings.render.option=(a,l)=>{var u=l2(s.call(e,a,l)),c=document.createElement("input");r.className&&c.classList.add(r.className),c.addEventListener("click",function(h){cv(h)}),c.type="checkbox";const d=s2(a[e.settings.valueField]);return i(c,!!(d&&e.items.indexOf(d)>-1)),u.prepend(c),u}}),e.on("item_remove",s=>{var a=e.getOption(s);a&&(a.classList.remove("selected"),o(a))}),e.on("item_add",s=>{var a=e.getOption(s);a&&o(a)}),e.hook("instead","onOptionSelect",(s,a)=>{if(a.classList.contains("selected")){a.classList.remove("selected"),e.removeItem(a.dataset.value),e.refreshOptions(),cv(s,!0);return}t.call(e,s,a),o(a)})}const d2=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(h2(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},h2=n=>typeof n=="string"&&n.indexOf("<")>-1;function f2(n){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:r=>`<div class="${r.className}" title="${r.title}">&#10799;</div>`},n);e.on("initialize",()=>{var r=d2(t.html(t));r.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(r)})}const p2=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Vo=(n,e,t,r)=>{n.addEventListener(e,t,r)},g2=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},m2=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(v2(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},v2=n=>typeof n=="string"&&n.indexOf("<")>-1,y2=(n,e)=>{g2(e,(t,r)=>{t==null?n.removeAttribute(r):n.setAttribute(r,""+t)})},b2=(n,e)=>{var t;(t=n.parentNode)==null||t.insertBefore(e,n.nextSibling)},x2=(n,e)=>{var t;(t=n.parentNode)==null||t.insertBefore(e,n)},w2=(n,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,n==e)return!0}while(e&&e.previousElementSibling);return!1};function _2(){var n=this;if(n.settings.mode!=="multi")return;var e=n.lock,t=n.unlock;let r=!0,i;n.hook("after","setupTemplates",()=>{var o=n.settings.render.item;n.settings.render.item=(s,a)=>{const l=m2(o.call(n,s,a));y2(l,{draggable:"true"});const u=g=>{r||p2(g),g.stopPropagation()},c=g=>{i=l,setTimeout(()=>{l.classList.add("ts-dragging")},0)},d=g=>{g.preventDefault(),l.classList.add("ts-drag-over"),f(l,i)},h=()=>{l.classList.remove("ts-drag-over")},f=(g,m)=>{m!==void 0&&(w2(m,l)?b2(g,m):x2(g,m))},p=()=>{var g;document.querySelectorAll(".ts-drag-over").forEach(v=>v.classList.remove("ts-drag-over")),(g=i)==null||g.classList.remove("ts-dragging"),i=void 0;var m=[];n.control.querySelectorAll("[data-value]").forEach(v=>{if(v.dataset.value){let y=v.dataset.value;y&&m.push(y)}}),n.setValue(m)};return Vo(l,"mousedown",u),Vo(l,"dragstart",c),Vo(l,"dragenter",d),Vo(l,"dragover",d),Vo(l,"dragleave",h),Vo(l,"dragend",p),l}}),n.hook("instead","lock",()=>(r=!1,e.call(n))),n.hook("instead","unlock",()=>(r=!0,t.call(n)))}const C2=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},E2=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(S2(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},S2=n=>typeof n=="string"&&n.indexOf("<")>-1;function D2(n){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:r=>'<div class="'+r.headerClass+'"><div class="'+r.titleRowClass+'"><span class="'+r.labelClass+'">'+r.title+'</span><a class="'+r.closeClass+'">&times;</a></div></div>'},n);e.on("initialize",()=>{var r=E2(t.html(t)),i=r.querySelector("."+t.closeClass);i&&i.addEventListener("click",o=>{C2(o,!0),e.close()}),e.dropdown.insertBefore(r,e.dropdown.firstChild)})}const A2=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},k2=(n,...e)=>{var t=R2(e);n=T2(n),n.map(r=>{t.map(i=>{r.classList.remove(i)})})},R2=n=>{var e=[];return A2(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},T2=n=>(Array.isArray(n)||(n=[n]),n),I2=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t};function M2(){var n=this;n.hook("instead","setCaret",e=>{n.settings.mode==="single"||!n.control.contains(n.control_input)?e=n.items.length:(e=Math.max(0,Math.min(n.items.length,e)),e!=n.caretPos&&!n.isPending&&n.controlChildren().forEach((t,r)=>{r<e?n.control_input.insertAdjacentElement("beforebegin",t):n.control.appendChild(t)})),n.caretPos=e}),n.hook("instead","moveCaret",e=>{if(!n.isFocused)return;const t=n.getLastActive(e);if(t){const r=I2(t);n.setCaret(e>0?r+1:r),n.setActiveItem(),k2(t,"last-active")}else n.setCaret(n.caretPos+e)})}const O2=27,P2=9,N2=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},F2=(n,e,t,r)=>{n.addEventListener(e,t,r)},L2=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},dv=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(B2(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},B2=n=>typeof n=="string"&&n.indexOf("<")>-1,H2=(n,...e)=>{var t=W2(e);n=z2(n),n.map(r=>{t.map(i=>{r.classList.add(i)})})},W2=n=>{var e=[];return L2(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},z2=n=>(Array.isArray(n)||(n=[n]),n);function V2(){const n=this;n.settings.shouldOpen=!0,n.hook("before","setup",()=>{n.focus_node=n.control,H2(n.control_input,"dropdown-input");const e=dv('<div class="dropdown-input-wrap">');e.append(n.control_input),n.dropdown.insertBefore(e,n.dropdown.firstChild);const t=dv('<input class="items-placeholder" tabindex="-1" />');t.placeholder=n.settings.placeholder||"",n.control.append(t)}),n.on("initialize",()=>{n.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case O2:n.isOpen&&(N2(t,!0),n.close()),n.clearActiveItems();return;case P2:n.focus_node.tabIndex=-1;break}return n.onKeyDown.call(n,t)}),n.on("blur",()=>{n.focus_node.tabIndex=n.isDisabled?-1:n.tabIndex}),n.on("dropdown_open",()=>{n.control_input.focus()});const e=n.onBlur;n.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==n.control_input))return e.call(n)}),F2(n.control_input,"blur",()=>n.onBlur()),n.hook("before","close",()=>{n.isOpen&&n.focus_node.focus({preventScroll:!0})})})}const Cl=(n,e,t,r)=>{n.addEventListener(e,t,r)};function U2(){var n=this;n.on("initialize",()=>{var e=document.createElement("span"),t=n.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",n.wrapper.appendChild(e);var r=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of r)e.style[o]=t.style[o];var i=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};i(),n.on("update item_add item_remove",i),Cl(t,"input",i),Cl(t,"keyup",i),Cl(t,"blur",i),Cl(t,"update",i)})}function j2(){var n=this,e=n.deleteSelection;this.hook("instead","deleteSelection",t=>n.activeItems.length?e.call(n,t):!1)}function $2(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const hv=37,G2=39,q2=(n,e,t)=>{for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},Y2=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t};function X2(){var n=this,e=n.onKeyDown;n.hook("instead","onKeyDown",t=>{var r,i,o,s;if(!n.isOpen||!(t.keyCode===hv||t.keyCode===G2))return e.call(n,t);n.ignoreHover=!0,s=q2(n.activeOption,"[data-group]"),r=Y2(n.activeOption,"[data-selectable]"),s&&(t.keyCode===hv?s=s.previousSibling:s=s.nextSibling,s&&(o=s.querySelectorAll("[data-selectable]"),i=o[Math.min(o.length-1,r)],i&&n.setActiveOption(i)))})}const K2=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),fv=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},pv=(n,e,t,r)=>{n.addEventListener(e,t,r)},gv=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Q2(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Q2=n=>typeof n=="string"&&n.indexOf("<")>-1;function J2(n){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},n);var t=this;if(e.append){var r='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+K2(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var i=t.settings.render.item;t.settings.render.item=(o,s)=>{var a=gv(i.call(t,o,s)),l=gv(r);return a.appendChild(l),pv(l,"mousedown",u=>{fv(u,!0)}),pv(l,"click",u=>{t.isLocked||(fv(u,!0),!t.isLocked&&t.shouldDelete([a],u)&&(t.removeItem(a),t.refreshOptions(!1),t.inputState()))}),a}})}}function Z2(n){const e=this,t=Object.assign({text:r=>r[e.settings.labelField]},n);e.on("item_remove",function(r){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[r];i&&e.setTextboxValue(t.text.call(e,i))}})}const eT=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},tT=(n,...e)=>{var t=nT(e);n=rT(n),n.map(r=>{t.map(i=>{r.classList.add(i)})})},nT=n=>{var e=[];return eT(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},rT=n=>(Array.isArray(n)||(n=[n]),n);function iT(){const n=this,e=n.canLoad,t=n.clearActiveOption,r=n.loadCallback;var i={},o,s=!1,a,l=[];if(n.settings.shouldLoadMore||(n.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(n.activeOption){var h=n.selectable(),f=Array.from(h).indexOf(n.activeOption);if(f>=h.length-2)return!0}return!1}),!n.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";n.settings.sortField=[{field:"$order"},{field:"$score"}];const u=d=>typeof n.settings.maxOptions=="number"&&o.children.length>=n.settings.maxOptions?!1:!!(d in i&&i[d]),c=(d,h)=>n.items.indexOf(h)>=0||l.indexOf(h)>=0;n.setNextUrl=(d,h)=>{i[d]=h},n.getUrl=d=>{if(d in i){const h=i[d];return i[d]=!1,h}return n.clearPagination(),n.settings.firstUrl.call(n,d)},n.clearPagination=()=>{i={}},n.hook("instead","clearActiveOption",()=>{if(!s)return t.call(n)}),n.hook("instead","canLoad",d=>d in i?u(d):e.call(n,d)),n.hook("instead","loadCallback",(d,h)=>{if(!s)n.clearOptions(c);else if(a){const f=d[0];f!==void 0&&(a.dataset.value=f[n.settings.valueField])}r.call(n,d,h),s=!1}),n.hook("after","refreshOptions",()=>{const d=n.lastValue;var h;u(d)?(h=n.render("loading_more",{query:d}),h&&(h.setAttribute("data-selectable",""),a=h)):d in i&&!o.querySelector(".no-results")&&(h=n.render("no_more_results",{query:d})),h&&(tT(h,n.settings.optionClass),o.append(h))}),n.on("initialize",()=>{l=Object.keys(n.options),o=n.dropdown_content,n.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},n.settings.render),o.addEventListener("scroll",()=>{n.settings.shouldLoadMore.call(n)&&u(n.lastValue)&&(s||(s=!0,n.load.call(n,n.lastValue)))})})}dn.define("change_listener",o2);dn.define("checkbox_options",c2);dn.define("clear_button",f2);dn.define("drag_drop",_2);dn.define("dropdown_header",D2);dn.define("caret_position",M2);dn.define("dropdown_input",V2);dn.define("input_autogrow",U2);dn.define("no_backspace_delete",j2);dn.define("no_active_items",$2);dn.define("optgroup_columns",X2);dn.define("remove_button",J2);dn.define("restore_on_backspace",Z2);dn.define("virtual_scroll",iT);var Sc,me,Xx,Kx,ws,uo,mv,Qx,Jx,Au={},Zx=[],oT=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function gi(n,e){for(var t in e)n[t]=e[t];return n}function ew(n){var e=n.parentNode;e&&e.removeChild(n)}function O(n,e,t){var r,i,o,s={};for(o in e)o=="key"?r=e[o]:o=="ref"?i=e[o]:s[o]=e[o];if(arguments.length>2&&(s.children=arguments.length>3?Sc.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(o in n.defaultProps)s[o]===void 0&&(s[o]=n.defaultProps[o]);return du(n,s,r,i,null)}function du(n,e,t,r,i){var o={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++Xx};return i==null&&me.vnode!=null&&me.vnode(o),o}function un(){return{current:null}}function Ge(n){return n.children}function sT(n,e,t,r,i){var o;for(o in t)o==="children"||o==="key"||o in e||ku(n,o,null,t[o],r);for(o in e)i&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||t[o]===e[o]||ku(n,o,e[o],t[o],r)}function vv(n,e,t){e[0]==="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||oT.test(e)?t:t+"px"}function ku(n,e,t,r,i){var o;e:if(e==="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||vv(n.style,e,"");if(t)for(e in t)r&&t[e]===r[e]||vv(n.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in n?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+o]=t,t?r||n.addEventListener(e,o?bv:yv,o):n.removeEventListener(e,o?bv:yv,o);else if(e!=="dangerouslySetInnerHTML"){if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e.indexOf("-")==-1?n.removeAttribute(e):n.setAttribute(e,t))}}function yv(n){ws=!0;try{return this.l[n.type+!1](me.event?me.event(n):n)}finally{ws=!1}}function bv(n){ws=!0;try{return this.l[n.type+!0](me.event?me.event(n):n)}finally{ws=!1}}function Wn(n,e){this.props=n,this.context=e}function Ca(n,e){if(e==null)return n.__?Ca(n.__,n.__.__k.indexOf(n)+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?Ca(n):null}function tw(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return tw(n)}}function aT(n){ws?setTimeout(n):Qx(n)}function Kh(n){(!n.__d&&(n.__d=!0)&&uo.push(n)&&!Ru.__r++||mv!==me.debounceRendering)&&((mv=me.debounceRendering)||aT)(Ru)}function Ru(){var n,e,t,r,i,o,s,a;for(uo.sort(function(l,u){return l.__v.__b-u.__v.__b});n=uo.shift();)n.__d&&(e=uo.length,r=void 0,i=void 0,s=(o=(t=n).__v).__e,(a=t.__P)&&(r=[],(i=gi({},o)).__v=o.__v+1,cp(a,o,i,t.__n,a.ownerSVGElement!==void 0,o.__h!=null?[s]:null,r,s??Ca(o),o.__h),sw(r,o),o.__e!=s&&tw(o)),uo.length>e&&uo.sort(function(l,u){return l.__v.__b-u.__v.__b}));Ru.__r=0}function nw(n,e,t,r,i,o,s,a,l,u){var c,d,h,f,p,g,m,v=r&&r.__k||Zx,y=v.length;for(t.__k=[],c=0;c<e.length;c++)if((f=t.__k[c]=(f=e[c])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?du(null,f,null,null,f):Array.isArray(f)?du(Ge,{children:f},null,null,null):f.__b>0?du(f.type,f.props,f.key,f.ref?f.ref:null,f.__v):f)!=null){if(f.__=t,f.__b=t.__b+1,(h=v[c])===null||h&&f.key==h.key&&f.type===h.type)v[c]=void 0;else for(d=0;d<y;d++){if((h=v[d])&&f.key==h.key&&f.type===h.type){v[d]=void 0;break}h=null}cp(n,f,h=h||Au,i,o,s,a,l,u),p=f.__e,(d=f.ref)&&h.ref!=d&&(m||(m=[]),h.ref&&m.push(h.ref,null,f),m.push(d,f.__c||p,f)),p!=null?(g==null&&(g=p),typeof f.type=="function"&&f.__k===h.__k?f.__d=l=rw(f,l,n):l=iw(n,f,h,v,p,l),typeof t.type=="function"&&(t.__d=l)):l&&h.__e==l&&l.parentNode!=n&&(l=Ca(h))}for(t.__e=g,c=y;c--;)v[c]!=null&&(typeof t.type=="function"&&v[c].__e!=null&&v[c].__e==t.__d&&(t.__d=ow(r).nextSibling),lw(v[c],v[c]));if(m)for(c=0;c<m.length;c++)aw(m[c],m[++c],m[++c])}function rw(n,e,t){for(var r,i=n.__k,o=0;i&&o<i.length;o++)(r=i[o])&&(r.__=n,e=typeof r.type=="function"?rw(r,e,t):iw(t,r,r,i,r.__e,e));return e}function Tu(n,e){return e=e||[],n==null||typeof n=="boolean"||(Array.isArray(n)?n.some(function(t){Tu(t,e)}):e.push(n)),e}function iw(n,e,t,r,i,o){var s,a,l;if(e.__d!==void 0)s=e.__d,e.__d=void 0;else if(t==null||i!=o||i.parentNode==null)e:if(o==null||o.parentNode!==n)n.appendChild(i),s=null;else{for(a=o,l=0;(a=a.nextSibling)&&l<r.length;l+=1)if(a==i)break e;n.insertBefore(i,o),s=o}return s!==void 0?s:i.nextSibling}function ow(n){var e,t,r;if(n.type==null||typeof n.type=="string")return n.__e;if(n.__k){for(e=n.__k.length-1;e>=0;e--)if((t=n.__k[e])&&(r=ow(t)))return r}return null}function cp(n,e,t,r,i,o,s,a,l){var u,c,d,h,f,p,g,m,v,y,b,x,w,_,C,E=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(l=t.__h,a=e.__e=t.__e,e.__h=null,o=[a]),(u=me.__b)&&u(e);try{e:if(typeof E=="function"){if(m=e.props,v=(u=E.contextType)&&r[u.__c],y=u?v?v.props.value:u.__:r,t.__c?g=(c=e.__c=t.__c).__=c.__E:("prototype"in E&&E.prototype.render?e.__c=c=new E(m,y):(e.__c=c=new Wn(m,y),c.constructor=E,c.render=uT),v&&v.sub(c),c.props=m,c.state||(c.state={}),c.context=y,c.__n=r,d=c.__d=!0,c.__h=[],c._sb=[]),c.__s==null&&(c.__s=c.state),E.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=gi({},c.__s)),gi(c.__s,E.getDerivedStateFromProps(m,c.__s))),h=c.props,f=c.state,c.__v=e,d)E.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(E.getDerivedStateFromProps==null&&m!==h&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(m,y),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(m,c.__s,y)===!1||e.__v===t.__v){for(e.__v!==t.__v&&(c.props=m,c.state=c.__s,c.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(S){S&&(S.__=e)}),b=0;b<c._sb.length;b++)c.__h.push(c._sb[b]);c._sb=[],c.__h.length&&s.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(m,c.__s,y),c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(h,f,p)})}if(c.context=y,c.props=m,c.__P=n,x=me.__r,w=0,"prototype"in E&&E.prototype.render){for(c.state=c.__s,c.__d=!1,x&&x(e),u=c.render(c.props,c.state,c.context),_=0;_<c._sb.length;_++)c.__h.push(c._sb[_]);c._sb=[]}else do c.__d=!1,x&&x(e),u=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++w<25);c.state=c.__s,c.getChildContext!=null&&(r=gi(gi({},r),c.getChildContext())),d||c.getSnapshotBeforeUpdate==null||(p=c.getSnapshotBeforeUpdate(h,f)),C=u!=null&&u.type===Ge&&u.key==null?u.props.children:u,nw(n,Array.isArray(C)?C:[C],e,t,r,i,o,s,a,l),c.base=e.__e,e.__h=null,c.__h.length&&s.push(c),g&&(c.__E=c.__=null),c.__e=!1}else o==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=lT(t.__e,e,t,r,i,o,s,l);(u=me.diffed)&&u(e)}catch(S){e.__v=null,(l||o!=null)&&(e.__e=a,e.__h=!!l,o[o.indexOf(a)]=null),me.__e(S,e,t)}}function sw(n,e){me.__c&&me.__c(e,n),n.some(function(t){try{n=t.__h,t.__h=[],n.some(function(r){r.call(t)})}catch(r){me.__e(r,t.__v)}})}function lT(n,e,t,r,i,o,s,a){var l,u,c,d=t.props,h=e.props,f=e.type,p=0;if(f==="svg"&&(i=!0),o!=null){for(;p<o.length;p++)if((l=o[p])&&"setAttribute"in l==!!f&&(f?l.localName===f:l.nodeType===3)){n=l,o[p]=null;break}}if(n==null){if(f===null)return document.createTextNode(h);n=i?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,h.is&&h),o=null,a=!1}if(f===null)d===h||a&&n.data===h||(n.data=h);else{if(o=o&&Sc.call(n.childNodes),u=(d=t.props||Au).dangerouslySetInnerHTML,c=h.dangerouslySetInnerHTML,!a){if(o!=null)for(d={},p=0;p<n.attributes.length;p++)d[n.attributes[p].name]=n.attributes[p].value;(c||u)&&(c&&(u&&c.__html==u.__html||c.__html===n.innerHTML)||(n.innerHTML=c&&c.__html||""))}if(sT(n,h,d,i,a),c)e.__k=[];else if(p=e.props.children,nw(n,Array.isArray(p)?p:[p],e,t,r,i&&f!=="foreignObject",o,s,o?o[0]:t.__k&&Ca(t,0),a),o!=null)for(p=o.length;p--;)o[p]!=null&&ew(o[p]);a||("value"in h&&(p=h.value)!==void 0&&(p!==n.value||f==="progress"&&!p||f==="option"&&p!==d.value)&&ku(n,"value",p,d.value,!1),"checked"in h&&(p=h.checked)!==void 0&&p!==n.checked&&ku(n,"checked",p,d.checked,!1))}return n}function aw(n,e,t){try{typeof n=="function"?n(e):n.current=e}catch(r){me.__e(r,t)}}function lw(n,e,t){var r,i;if(me.unmount&&me.unmount(n),(r=n.ref)&&(r.current&&r.current!==n.__e||aw(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){me.__e(o,e)}r.base=r.__P=null,n.__c=void 0}if(r=n.__k)for(i=0;i<r.length;i++)r[i]&&lw(r[i],e,t||typeof n.type!="function");t||n.__e==null||ew(n.__e),n.__=n.__e=n.__d=void 0}function uT(n,e,t){return this.constructor(n,t)}function Ea(n,e,t){var r,i,o;me.__&&me.__(n,e),i=(r=!1)?null:e.__k,o=[],cp(e,n=e.__k=O(Ge,null,[n]),i||Au,Au,e.ownerSVGElement!==void 0,i?null:e.firstChild?Sc.call(e.childNodes):null,o,i?i.__e:e.firstChild,r),sw(o,n)}function cT(n,e){var t={__c:e="__cC"+Jx++,__:n,Consumer:function(r,i){return r.children(i)},Provider:function(r){var i,o;return this.getChildContext||(i=[],(o={})[e]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(s){this.props.value!==s.value&&i.some(function(a){a.__e=!0,Kh(a)})},this.sub=function(s){i.push(s);var a=s.componentWillUnmount;s.componentWillUnmount=function(){i.splice(i.indexOf(s),1),a&&a.call(s)}}),r.children}};return t.Provider.__=t.Consumer.contextType=t}Sc=Zx.slice,me={__e:function(n,e,t,r){for(var i,o,s;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(n)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,r||{}),s=i.__d),s)return i.__E=i}catch(a){n=a}throw n}},Xx=0,Kx=function(n){return n!=null&&n.constructor===void 0},ws=!1,Wn.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=gi({},this.state),typeof n=="function"&&(n=n(gi({},t),this.props)),n&&gi(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),Kh(this))},Wn.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Kh(this))},Wn.prototype.render=Ge,uo=[],Qx=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ru.__r=0,Jx=0;var wr,Nd,xv,uw=[],Fd=[],wv=me.__b,_v=me.__r,Cv=me.diffed,Ev=me.__c,Sv=me.unmount;function dT(){for(var n;n=uw.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(hu),n.__H.__h.forEach(Qh),n.__H.__h=[]}catch(e){n.__H.__h=[],me.__e(e,n.__v)}}me.__b=function(n){wr=null,wv&&wv(n)},me.__r=function(n){_v&&_v(n);var e=(wr=n.__c).__H;e&&(Nd===wr?(e.__h=[],wr.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.__V=Fd,t.__N=t.i=void 0})):(e.__h.forEach(hu),e.__h.forEach(Qh),e.__h=[])),Nd=wr},me.diffed=function(n){Cv&&Cv(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(uw.push(e)!==1&&xv===me.requestAnimationFrame||((xv=me.requestAnimationFrame)||hT)(dT)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.__V!==Fd&&(t.__=t.__V),t.i=void 0,t.__V=Fd})),Nd=wr=null},me.__c=function(n,e){e.some(function(t){try{t.__h.forEach(hu),t.__h=t.__h.filter(function(r){return!r.__||Qh(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],me.__e(r,t.__v)}}),Ev&&Ev(n,e)},me.unmount=function(n){Sv&&Sv(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(r){try{hu(r)}catch(i){e=i}}),t.__H=void 0,e&&me.__e(e,t.__v))};var Dv=typeof requestAnimationFrame=="function";function hT(n){var e,t=function(){clearTimeout(r),Dv&&cancelAnimationFrame(e),setTimeout(n)},r=setTimeout(t,100);Dv&&(e=requestAnimationFrame(t))}function hu(n){var e=wr,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),wr=e}function Qh(n){var e=wr;n.__c=n.__(),wr=e}function fT(n,e){for(var t in e)n[t]=e[t];return n}function Av(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var r in e)if(r!=="__source"&&n[r]!==e[r])return!0;return!1}function kv(n){this.props=n}(kv.prototype=new Wn).isPureReactComponent=!0,kv.prototype.shouldComponentUpdate=function(n,e){return Av(this.props,n)||Av(this.state,e)};var Rv=me.__b;me.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),Rv&&Rv(n)};var pT=me.__e;me.__e=function(n,e,t,r){if(n.then){for(var i,o=e;o=o.__;)if((i=o.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(n,e)}pT(n,e,t,r)};var Tv=me.unmount;function cw(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),n.__c.__H=null),(n=fT({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c=null),n.__k=n.__k&&n.__k.map(function(r){return cw(r,e,t)})),n}function dw(n,e,t){return n&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(r){return dw(r,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.insertBefore(n.__e,n.__d),n.__c.__e=!0,n.__c.__P=t)),n}function Ld(){this.__u=0,this.t=null,this.__b=null}function hw(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function El(){this.u=null,this.o=null}me.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&n.__h===!0&&(n.type=null),Tv&&Tv(n)},(Ld.prototype=new Wn).__c=function(n,e){var t=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(t);var i=hw(r.__v),o=!1,s=function(){o||(o=!0,t.__R=null,i?i(a):a())};t.__R=s;var a=function(){if(!--r.__u){if(r.state.__a){var u=r.state.__a;r.__v.__k[0]=dw(u,u.__c.__P,u.__c.__O)}var c;for(r.setState({__a:r.__b=null});c=r.t.pop();)c.forceUpdate()}},l=e.__h===!0;r.__u++||l||r.setState({__a:r.__b=r.__v.__k[0]}),n.then(s,s)},Ld.prototype.componentWillUnmount=function(){this.t=[]},Ld.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=cw(this.__b,t,r.__O=r.__P)}this.__b=null}var i=e.__a&&O(Ge,null,n.fallback);return i&&(i.__h=null),[O(Ge,null,e.__a?null:n.children),i]};var Iv=function(n,e,t){if(++t[1]===t[0]&&n.o.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.o.size))for(t=n.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.u=t=t[2]}};function gT(n){return this.getChildContext=function(){return n.context},n.children}function mT(n){var e=this,t=n.i;e.componentWillUnmount=function(){Ea(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),n.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,i){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),Ea(O(gT,{context:e.context},n.__v),e.l)):e.l&&e.componentWillUnmount()}function vT(n,e){var t=O(mT,{__v:n,i:e});return t.containerInfo=e,t}(El.prototype=new Wn).__a=function(n){var e=this,t=hw(e.__v),r=e.o.get(n);return r[0]++,function(i){var o=function(){e.props.revealOrder?(r.push(i),Iv(e,n,r)):i()};t?t(o):o()}},El.prototype.render=function(n){this.u=null,this.o=new Map;var e=Tu(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return n.children},El.prototype.componentDidUpdate=El.prototype.componentDidMount=function(){var n=this;this.o.forEach(function(e,t){Iv(n,t,e)})};var yT=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,bT=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,xT=typeof document<"u",wT=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(n)};Wn.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Wn.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var Mv=me.event;function _T(){}function CT(){return this.cancelBubble}function ET(){return this.defaultPrevented}me.event=function(n){return Mv&&(n=Mv(n)),n.persist=_T,n.isPropagationStopped=CT,n.isDefaultPrevented=ET,n.nativeEvent=n};var Ov={configurable:!0,get:function(){return this.class}},Pv=me.vnode;me.vnode=function(n){var e=n.type,t=n.props,r=t;if(typeof e=="string"){var i=e.indexOf("-")===-1;for(var o in r={},t){var s=t[o];xT&&o==="children"&&e==="noscript"||o==="value"&&"defaultValue"in t&&s==null||(o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&s===!0?s="":/ondoubleclick/i.test(o)?o="ondblclick":/^onchange(textarea|input)/i.test(o+e)&&!wT(t.type)?o="oninput":/^onfocus$/i.test(o)?o="onfocusin":/^onblur$/i.test(o)?o="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(o)?o=o.toLowerCase():i&&bT.test(o)?o=o.replace(/[A-Z0-9]/g,"-$&").toLowerCase():s===null&&(s=void 0),/^oninput$/i.test(o)&&(o=o.toLowerCase(),r[o]&&(o="oninputCapture")),r[o]=s)}e=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=Tu(t.children).forEach(function(a){a.props.selected=r.value.indexOf(a.props.value)!=-1})),e=="select"&&r.defaultValue!=null&&(r.value=Tu(t.children).forEach(function(a){a.props.selected=r.multiple?r.defaultValue.indexOf(a.props.value)!=-1:r.defaultValue==a.props.value})),n.props=r,t.class!=t.className&&(Ov.enumerable="className"in t,t.className!=null&&(r.class=t.className),Object.defineProperty(r,"className",Ov))}n.$$typeof=yT,Pv&&Pv(n)};var Nv=me.__r;me.__r=function(n){Nv&&Nv(n),n.__c};const fw=[],Jh=new Map;function Dc(n){fw.push(n),Jh.forEach(e=>{gw(e,n)})}function ST(n){n.isConnected&&n.getRootNode&&pw(n.getRootNode())}function pw(n){let e=Jh.get(n);if(!e||!e.isConnected){if(e=n.querySelector("style[data-fullcalendar]"),!e){e=document.createElement("style"),e.setAttribute("data-fullcalendar","");const t=AT();t&&(e.nonce=t);const r=n===document?document.head:n,i=n===document?r.querySelector("script,link[rel=stylesheet],link[as=style],style"):r.firstChild;r.insertBefore(e,i)}Jh.set(n,e),DT(e)}}function DT(n){for(const e of fw)gw(n,e)}function gw(n,e){const{sheet:t}=n,r=t.cssRules.length;e.split("}").forEach((i,o)=>{i=i.trim(),i&&t.insertRule(i+"}",r+o)})}let Bd;function AT(){return Bd===void 0&&(Bd=kT()),Bd}function kT(){const n=document.querySelector('meta[name="csp-nonce"]');if(n&&n.hasAttribute("content"))return n.getAttribute("content");const e=document.querySelector("script[nonce]");return e&&e.nonce||""}typeof document<"u"&&pw(document);var RT=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';Dc(RT);class dp{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),e==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:r}=this;e in r&&(t?delete r[e]:(r[e]-=1,r[e]<=0&&delete r[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}}function hp(n){n.parentNode&&n.parentNode.removeChild(n)}function Kt(n,e){if(n.closest)return n.closest(e);if(!document.documentElement.contains(n))return null;do{if(TT(n,e))return n;n=n.parentElement||n.parentNode}while(n!==null&&n.nodeType===1);return null}function TT(n,e){return(n.matches||n.matchesSelector||n.msMatchesSelector).call(n,e)}function IT(n,e){let t=n instanceof HTMLElement?[n]:n,r=[];for(let i=0;i<t.length;i+=1){let o=t[i].querySelectorAll(e);for(let s=0;s<o.length;s+=1)r.push(o[s])}return r}const MT=/(top|left|right|bottom|width|height)$/i;function la(n,e){for(let t in e)mw(n,t,e[t])}function mw(n,e,t){t==null?n.style[e]="":typeof t=="number"&&MT.test(e)?n.style[e]=`${t}px`:n.style[e]=t}function vw(n){var e,t;return(t=(e=n.composedPath)===null||e===void 0?void 0:e.call(n)[0])!==null&&t!==void 0?t:n.target}let Fv=0;function Di(){return Fv+=1,"fc-dom-"+Fv}function Ac(n){n.preventDefault()}function OT(n,e){return t=>{let r=Kt(t.target,n);r&&e.call(r,t,r)}}function yw(n,e,t,r){let i=OT(t,r);return n.addEventListener(e,i),()=>{n.removeEventListener(e,i)}}function PT(n,e,t,r){let i;return yw(n,"mouseover",e,(o,s)=>{if(s!==i){i=s,t(o,s);let a=l=>{i=null,r(l,s),s.removeEventListener("mouseleave",a)};s.addEventListener("mouseleave",a)}})}const Lv=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function NT(n,e){let t=r=>{e(r),Lv.forEach(i=>{n.removeEventListener(i,t)})};Lv.forEach(r=>{n.addEventListener(r,t)})}function bw(n){return Object.assign({onClick:n},xw(n))}function xw(n){return{tabIndex:0,onKeyDown(e){(e.key==="Enter"||e.key===" ")&&(n(e),e.preventDefault())}}}let Bv=0;function To(){return Bv+=1,String(Bv)}function fp(){document.body.classList.add("fc-not-allowed")}function pp(){document.body.classList.remove("fc-not-allowed")}function FT(n){n.style.userSelect="none",n.style.webkitUserSelect="none",n.addEventListener("selectstart",Ac)}function LT(n){n.style.userSelect="",n.style.webkitUserSelect="",n.removeEventListener("selectstart",Ac)}function BT(n){n.addEventListener("contextmenu",Ac)}function HT(n){n.removeEventListener("contextmenu",Ac)}function WT(n){let e=[],t=[],r,i;for(typeof n=="string"?t=n.split(/\s*,\s*/):typeof n=="function"?t=[n]:Array.isArray(n)&&(t=n),r=0;r<t.length;r+=1)i=t[r],typeof i=="string"?e.push(i.charAt(0)==="-"?{field:i.substring(1),order:-1}:{field:i,order:1}):typeof i=="function"&&e.push({func:i});return e}function zT(n,e,t){let r,i;for(r=0;r<t.length;r+=1)if(i=VT(n,e,t[r]),i)return i;return 0}function VT(n,e,t){return t.func?t.func(n,e):UT(n[t.field],e[t.field])*(t.order||1)}function UT(n,e){return!n&&!e?0:e==null?-1:n==null?1:typeof n=="string"||typeof e=="string"?String(n).localeCompare(String(e)):n-e}function as(n,e){let t=String(n);return"000".substr(0,e-t.length)+t}function ua(n,e,t){return typeof n=="function"?n(...e):typeof n=="string"?e.reduce((r,i,o)=>r.replace("$"+o,i||""),n):t}function jT(n,e){return n-e}function fu(n){return n%1===0}function $T(n){let e=n.querySelector(".fc-scrollgrid-shrink-frame"),t=n.querySelector(".fc-scrollgrid-shrink-cushion");if(!e)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!t)throw new Error("needs fc-scrollgrid-shrink-cushion className");return n.getBoundingClientRect().width-e.getBoundingClientRect().width+t.getBoundingClientRect().width}const Hv=["years","months","days","milliseconds"],GT=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function Fe(n,e){return typeof n=="string"?qT(n):typeof n=="object"&&n?Wv(n):typeof n=="number"?Wv({[e||"milliseconds"]:n}):null}function qT(n){let e=GT.exec(n);if(e){let t=e[1]?-1:1;return{years:0,months:0,days:t*(e[2]?parseInt(e[2],10):0),milliseconds:t*((e[3]?parseInt(e[3],10):0)*60*60*1e3+(e[4]?parseInt(e[4],10):0)*60*1e3+(e[5]?parseInt(e[5],10):0)*1e3+(e[6]?parseInt(e[6],10):0))}}return null}function Wv(n){let e={years:n.years||n.year||0,months:n.months||n.month||0,days:n.days||n.day||0,milliseconds:(n.hours||n.hour||0)*60*60*1e3+(n.minutes||n.minute||0)*60*1e3+(n.seconds||n.second||0)*1e3+(n.milliseconds||n.millisecond||n.ms||0)},t=n.weeks||n.week;return t&&(e.days+=t*7,e.specifiedWeeks=!0),e}function YT(n,e){return n.years===e.years&&n.months===e.months&&n.days===e.days&&n.milliseconds===e.milliseconds}function Zh(n,e){return{years:n.years+e.years,months:n.months+e.months,days:n.days+e.days,milliseconds:n.milliseconds+e.milliseconds}}function XT(n,e){return{years:n.years-e.years,months:n.months-e.months,days:n.days-e.days,milliseconds:n.milliseconds-e.milliseconds}}function KT(n,e){return{years:n.years*e,months:n.months*e,days:n.days*e,milliseconds:n.milliseconds*e}}function QT(n){return ls(n)/365}function JT(n){return ls(n)/30}function ls(n){return rr(n)/864e5}function rr(n){return n.years*(365*864e5)+n.months*(30*864e5)+n.days*864e5+n.milliseconds}function gp(n,e){let t=null;for(let r=0;r<Hv.length;r+=1){let i=Hv[r];if(e[i]){let o=n[i]/e[i];if(!fu(o)||t!==null&&t!==o)return null;t=o}else if(n[i])return null}return t}function ef(n){let e=n.milliseconds;if(e){if(e%1e3!==0)return{unit:"millisecond",value:e};if(e%(1e3*60)!==0)return{unit:"second",value:e/1e3};if(e%(1e3*60*60)!==0)return{unit:"minute",value:e/(1e3*60)};if(e)return{unit:"hour",value:e/(1e3*60*60)}}return n.days?n.specifiedWeeks&&n.days%7===0?{unit:"week",value:n.days/7}:{unit:"day",value:n.days}:n.months?{unit:"month",value:n.months}:n.years?{unit:"year",value:n.years}:{unit:"millisecond",value:0}}function Ii(n,e,t){if(n===e)return!0;let r=n.length,i;if(r!==e.length)return!1;for(i=0;i<r;i+=1)if(!(t?t(n[i],e[i]):n[i]===e[i]))return!1;return!0}const ZT=["sun","mon","tue","wed","thu","fri","sat"];function zv(n,e){let t=mi(n);return t[2]+=e*7,xn(t)}function St(n,e){let t=mi(n);return t[2]+=e,xn(t)}function Mi(n,e){let t=mi(n);return t[6]+=e,xn(t)}function eI(n,e){return Bi(n,e)/7}function Bi(n,e){return(e.valueOf()-n.valueOf())/(1e3*60*60*24)}function tI(n,e){return(e.valueOf()-n.valueOf())/(1e3*60*60)}function nI(n,e){return(e.valueOf()-n.valueOf())/(1e3*60)}function rI(n,e){return(e.valueOf()-n.valueOf())/1e3}function iI(n,e){let t=Xe(n),r=Xe(e);return{years:0,months:0,days:Math.round(Bi(t,r)),milliseconds:e.valueOf()-r.valueOf()-(n.valueOf()-t.valueOf())}}function oI(n,e){let t=Iu(n,e);return t!==null&&t%7===0?t/7:null}function Iu(n,e){return vi(n)===vi(e)?Math.round(Bi(n,e)):null}function Xe(n){return xn([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()])}function sI(n){return xn([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours()])}function aI(n){return xn([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes()])}function lI(n){return xn([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds()])}function uI(n,e,t){let r=n.getUTCFullYear(),i=Hd(n,r,e,t);if(i<1)return Hd(n,r-1,e,t);let o=Hd(n,r+1,e,t);return o>=1?Math.min(i,o):i}function Hd(n,e,t,r){let i=xn([e,0,1+cI(e,t,r)]),o=Xe(n),s=Math.round(Bi(i,o));return Math.floor(s/7)+1}function cI(n,e,t){let r=7+e-t;return-((7+xn([n,0,r]).getUTCDay()-e)%7)+r-1}function Vv(n){return[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()]}function Uv(n){return new Date(n[0],n[1]||0,n[2]==null?1:n[2],n[3]||0,n[4]||0,n[5]||0)}function mi(n){return[n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()]}function xn(n){return n.length===1&&(n=n.concat([0])),new Date(Date.UTC(...n))}function ww(n){return!isNaN(n.valueOf())}function vi(n){return n.getUTCHours()*1e3*60*60+n.getUTCMinutes()*1e3*60+n.getUTCSeconds()*1e3+n.getUTCMilliseconds()}function _w(n,e,t=!1){let r=n.toISOString();return r=r.replace(".000",""),t&&(r=r.replace("T00:00:00Z","")),r.length>10&&(e==null?r=r.replace("Z",""):e!==0&&(r=r.replace("Z",mp(e,!0)))),r}function Xa(n){return n.toISOString().replace(/T.*$/,"")}function dI(n){return n.toISOString().match(/^\d{4}-\d{2}/)[0]}function hI(n){return as(n.getUTCHours(),2)+":"+as(n.getUTCMinutes(),2)+":"+as(n.getUTCSeconds(),2)}function mp(n,e=!1){let t=n<0?"-":"+",r=Math.abs(n),i=Math.floor(r/60),o=Math.round(r%60);return e?`${t+as(i,2)}:${as(o,2)}`:`GMT${t}${i}${o?`:${as(o,2)}`:""}`}function ge(n,e,t){let r,i;return function(...o){if(!r)i=n.apply(this,o);else if(!Ii(r,o)){let s=n.apply(this,o);(!e||!e(s,i))&&(i=s)}return r=o,i}}function pu(n,e,t){let r,i;return o=>(r?ar(r,o)||(i=n.call(this,o)):i=n.call(this,o),r=o,i)}const Wd={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},Mu={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},Sl=/\s*([ap])\.?m\.?/i,fI=/,/g,pI=/\s+/g,gI=/\u200e/g,mI=/UTC|GMT/;class vI{constructor(e){let t={},r={},i=9;for(let o in e)o in Wd?(r[o]=e[o],Wd[o]<9&&(i=Math.min(Wd[o],i))):(t[o]=e[o],o in Mu&&(i=Math.min(Mu[o],i)));this.standardDateProps=t,this.extendedSettings=r,this.smallestUnitNum=i,this.buildFormattingFunc=ge(jv)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,r,i){let{standardDateProps:o,extendedSettings:s}=this,a=CI(e.marker,t.marker,r.calendarSystem);if(!a)return this.format(e,r);let l=a;l>1&&(o.year==="numeric"||o.year==="2-digit")&&(o.month==="numeric"||o.month==="2-digit")&&(o.day==="numeric"||o.day==="2-digit")&&(l=1);let u=this.format(e,r),c=this.format(t,r);if(u===c)return u;let d=EI(o,l),h=jv(d,s,r),f=h(e),p=h(t),g=SI(u,f,c,p),m=s.separator||i||r.defaultSeparator||"";return g?g.before+f+m+p+g.after:u+m+c}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}}function jv(n,e,t){let r=Object.keys(n).length;return r===1&&n.timeZoneName==="short"?i=>mp(i.timeZoneOffset):r===0&&e.week?i=>_I(t.computeWeekNumber(i.marker),t.weekText,t.weekTextLong,t.locale,e.week):yI(n,e,t)}function yI(n,e,t){n=Object.assign({},n),e=Object.assign({},e),bI(n,e),n.timeZone="UTC";let r=new Intl.DateTimeFormat(t.locale.codes,n),i;if(e.omitZeroMinute){let o=Object.assign({},n);delete o.minute,i=new Intl.DateTimeFormat(t.locale.codes,o)}return o=>{let{marker:s}=o,a;i&&!s.getUTCMinutes()?a=i:a=r;let l=a.format(s);return xI(l,o,n,e,t)}}function bI(n,e){n.timeZoneName&&(n.hour||(n.hour="2-digit"),n.minute||(n.minute="2-digit")),n.timeZoneName==="long"&&(n.timeZoneName="short"),e.omitZeroMinute&&(n.second||n.millisecond)&&delete e.omitZeroMinute}function xI(n,e,t,r,i){return n=n.replace(gI,""),t.timeZoneName==="short"&&(n=wI(n,i.timeZone==="UTC"||e.timeZoneOffset==null?"UTC":mp(e.timeZoneOffset))),r.omitCommas&&(n=n.replace(fI,"").trim()),r.omitZeroMinute&&(n=n.replace(":00","")),r.meridiem===!1?n=n.replace(Sl,"").trim():r.meridiem==="narrow"?n=n.replace(Sl,(o,s)=>s.toLocaleLowerCase()):r.meridiem==="short"?n=n.replace(Sl,(o,s)=>`${s.toLocaleLowerCase()}m`):r.meridiem==="lowercase"&&(n=n.replace(Sl,o=>o.toLocaleLowerCase())),n=n.replace(pI," "),n=n.trim(),n}function wI(n,e){let t=!1;return n=n.replace(mI,()=>(t=!0,e)),t||(n+=` ${e}`),n}function _I(n,e,t,r,i){let o=[];return i==="long"?o.push(t):(i==="short"||i==="narrow")&&o.push(e),(i==="long"||i==="short")&&o.push(" "),o.push(r.simpleNumberFormat.format(n)),r.options.direction==="rtl"&&o.reverse(),o.join("")}function CI(n,e,t){return t.getMarkerYear(n)!==t.getMarkerYear(e)?5:t.getMarkerMonth(n)!==t.getMarkerMonth(e)?4:t.getMarkerDay(n)!==t.getMarkerDay(e)?2:vi(n)!==vi(e)?1:0}function EI(n,e){let t={};for(let r in n)(!(r in Mu)||Mu[r]<=e)&&(t[r]=n[r]);return t}function SI(n,e,t,r){let i=0;for(;i<n.length;){let o=n.indexOf(e,i);if(o===-1)break;let s=n.substr(0,o);i=o+e.length;let a=n.substr(i),l=0;for(;l<t.length;){let u=t.indexOf(r,l);if(u===-1)break;let c=t.substr(0,u);l=u+r.length;let d=t.substr(l);if(s===c&&a===d)return{before:s,after:a}}}return null}function $v(n,e){let t=e.markerToArray(n.marker);return{marker:n.marker,timeZoneOffset:n.timeZoneOffset,array:t,year:t[0],month:t[1],day:t[2],hour:t[3],minute:t[4],second:t[5],millisecond:t[6]}}function Ou(n,e,t,r){let i=$v(n,t.calendarSystem),o=e?$v(e,t.calendarSystem):null;return{date:i,start:i,end:o,timeZone:t.timeZone,localeCodes:t.locale.codes,defaultSeparator:r||t.defaultSeparator}}class DI{constructor(e){this.cmdStr=e}format(e,t,r){return t.cmdFormatter(this.cmdStr,Ou(e,null,t,r))}formatRange(e,t,r,i){return r.cmdFormatter(this.cmdStr,Ou(e,t,r,i))}}class AI{constructor(e){this.func=e}format(e,t,r){return this.func(Ou(e,null,t,r))}formatRange(e,t,r,i){return this.func(Ou(e,t,r,i))}}function tt(n){return typeof n=="object"&&n?new vI(n):typeof n=="string"?new DI(n):typeof n=="function"?new AI(n):null}const Gv={navLinkDayClick:V,navLinkWeekClick:V,duration:Fe,bootstrapFontAwesome:V,buttonIcons:V,customButtons:V,defaultAllDayEventDuration:Fe,defaultTimedEventDuration:Fe,nextDayThreshold:Fe,scrollTime:Fe,scrollTimeReset:Boolean,slotMinTime:Fe,slotMaxTime:Fe,dayPopoverFormat:tt,slotDuration:Fe,snapDuration:Fe,headerToolbar:V,footerToolbar:V,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:tt,dayHeaderClassNames:V,dayHeaderContent:V,dayHeaderDidMount:V,dayHeaderWillUnmount:V,dayCellClassNames:V,dayCellContent:V,dayCellDidMount:V,dayCellWillUnmount:V,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:V,weekNumbers:Boolean,weekNumberClassNames:V,weekNumberContent:V,weekNumberDidMount:V,weekNumberWillUnmount:V,editable:Boolean,viewClassNames:V,viewDidMount:V,viewWillUnmount:V,nowIndicator:Boolean,nowIndicatorSnap:V,nowIndicatorClassNames:V,nowIndicatorContent:V,nowIndicatorDidMount:V,nowIndicatorWillUnmount:V,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:V,locale:V,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:V,eventOrder:WT,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:V,contentHeight:V,direction:String,weekNumberFormat:tt,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:V,initialDate:V,now:V,eventDataTransform:V,stickyHeaderDates:V,stickyFooterScrollbar:V,viewHeight:V,defaultAllDay:Boolean,eventSourceFailure:V,eventSourceSuccess:V,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:V,eventConstraint:V,eventAllow:V,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:V,eventContent:V,eventDidMount:V,eventWillUnmount:V,selectConstraint:V,selectOverlap:V,selectAllow:V,droppable:Boolean,unselectCancel:String,slotLabelFormat:V,slotLaneClassNames:V,slotLaneContent:V,slotLaneDidMount:V,slotLaneWillUnmount:V,slotLabelClassNames:V,slotLabelContent:V,slotLabelDidMount:V,slotLabelWillUnmount:V,dayMaxEvents:V,dayMaxEventRows:V,dayMinWidth:Number,slotLabelInterval:Fe,allDayText:String,allDayClassNames:V,allDayContent:V,allDayDidMount:V,allDayWillUnmount:V,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:tt,rerenderDelay:Number,moreLinkText:V,moreLinkHint:V,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:V,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:Fe,hiddenDays:V,fixedWeekCount:Boolean,validRange:V,visibleRange:V,titleFormat:V,eventInteractive:Boolean,noEventsText:String,viewHint:V,navLinkHint:V,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:V,moreLinkClassNames:V,moreLinkContent:V,moreLinkDidMount:V,moreLinkWillUnmount:V,monthStartFormat:tt,handleCustomRendering:V,customRenderingMetaMap:V,customRenderingReplaces:Boolean},ca={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" – ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},qv={datesSet:V,eventsSet:V,eventAdd:V,eventChange:V,eventRemove:V,windowResize:V,eventClick:V,eventMouseEnter:V,eventMouseLeave:V,select:V,unselect:V,loading:V,_unmount:V,_beforeprint:V,_afterprint:V,_noEventDrop:V,_noEventResize:V,_resize:V,_scrollRequest:V},Yv={buttonText:V,buttonHints:V,views:V,plugins:V,initialEvents:V,events:V,eventSources:V},no={headerToolbar:ro,footerToolbar:ro,buttonText:ro,buttonHints:ro,buttonIcons:ro,dateIncrement:ro,plugins:Dl,events:Dl,eventSources:Dl,resources:Dl};function ro(n,e){return typeof n=="object"&&typeof e=="object"&&n&&e?ar(n,e):n===e}function Dl(n,e){return Array.isArray(n)&&Array.isArray(e)?Ii(n,e):n===e}const kI={type:String,component:V,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:V,usesMinMaxTime:Boolean,classNames:V,content:V,didMount:V,willUnmount:V};function zd(n){return yp(n,no)}function vp(n,e){let t={},r={};for(let i in e)i in n&&(t[i]=e[i](n[i]));for(let i in n)i in e||(r[i]=n[i]);return{refined:t,extra:r}}function V(n){return n}const{hasOwnProperty:Pu}=Object.prototype;function yp(n,e){let t={};if(e){for(let r in e)if(e[r]===ro){let i=[];for(let o=n.length-1;o>=0;o-=1){let s=n[o][r];if(typeof s=="object"&&s)i.unshift(s);else if(s!==void 0){t[r]=s;break}}i.length&&(t[r]=yp(i))}}for(let r=n.length-1;r>=0;r-=1){let i=n[r];for(let o in i)o in t||(t[o]=i[o])}return t}function Co(n,e){let t={};for(let r in n)e(n[r],r)&&(t[r]=n[r]);return t}function ei(n,e){let t={};for(let r in n)t[r]=e(n[r],r);return t}function Cw(n){let e={};for(let t of n)e[t]=!0;return e}function bp(n){let e=[];for(let t in n)e.push(n[t]);return e}function ar(n,e){if(n===e)return!0;for(let t in n)if(Pu.call(n,t)&&!(t in e))return!1;for(let t in e)if(Pu.call(e,t)&&n[t]!==e[t])return!1;return!0}const RI=/^on[A-Z]/;function TI(n,e){const t=II(n,e);for(let r of t)if(!RI.test(r))return!1;return!0}function II(n,e){let t=[];for(let r in n)Pu.call(n,r)&&(r in e||t.push(r));for(let r in e)Pu.call(e,r)&&n[r]!==e[r]&&t.push(r);return t}function Vd(n,e,t={}){if(n===e)return!0;for(let r in e)if(!(r in n&&MI(n[r],e[r],t[r])))return!1;for(let r in n)if(!(r in e))return!1;return!0}function MI(n,e,t){return n===e||t===!0?!0:t?t(n,e):!1}function OI(n,e=0,t,r=1){let i=[];t==null&&(t=Object.keys(n).length);for(let o=e;o<t;o+=r){let s=n[o];s!==void 0&&i.push(s)}return i}let Ew={};function PI(n,e){Ew[n]=e}function NI(n){return new Ew[n]}class FI{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return xn(e)}markerToArray(e){return mi(e)}}PI("gregory",FI);const LI=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function BI(n){let e=LI.exec(n);if(e){let t=new Date(Date.UTC(Number(e[1]),e[3]?Number(e[3])-1:0,Number(e[5]||1),Number(e[7]||0),Number(e[8]||0),Number(e[10]||0),e[12]?+`0.${e[12]}`*1e3:0));if(ww(t)){let r=null;return e[13]&&(r=(e[15]==="-"?-1:1)*(Number(e[16]||0)*60+Number(e[18]||0))),{marker:t,isTimeUnspecified:!e[6],timeZoneOffset:r}}}return null}class HI{constructor(e){let t=this.timeZone=e.timeZone,r=t!=="local"&&t!=="UTC";e.namedTimeZoneImpl&&r&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=!!(!r||this.namedTimeZoneImpl),this.calendarSystem=NI(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,e.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof e.firstDay=="number"&&(this.weekDow=e.firstDay),typeof e.weekNumberCalculation=="function"&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=e.weekText!=null?e.weekText:e.locale.options.weekText,this.weekTextLong=(e.weekTextLong!=null?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return t===null?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):xn(Vv(new Date))}createMarkerMeta(e){if(typeof e=="string")return this.parse(e);let t=null;return typeof e=="number"?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=xn(e)),t===null||!ww(t)?null:{marker:t,isTimeUnspecified:!1,forcedTzo:null}}parse(e){let t=BI(e);if(t===null)return null;let{marker:r}=t,i=null;return t.timeZoneOffset!==null&&(this.canComputeOffset?r=this.timestampToMarker(r.valueOf()-t.timeZoneOffset*60*1e3):i=t.timeZoneOffset),{marker:r,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:i}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]+=t.years,r[1]+=t.months,r[2]+=t.days,r[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(r)}subtract(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]-=t.years,r[1]-=t.months,r[2]-=t.days,r[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(r)}addYears(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]+=t,this.calendarSystem.arrayToMarker(r)}addMonths(e,t){let r=this.calendarSystem.markerToArray(e);return r[1]+=t,this.calendarSystem.arrayToMarker(r)}diffWholeYears(e,t){let{calendarSystem:r}=this;return vi(e)===vi(t)&&r.getMarkerDay(e)===r.getMarkerDay(t)&&r.getMarkerMonth(e)===r.getMarkerMonth(t)?r.getMarkerYear(t)-r.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:r}=this;return vi(e)===vi(t)&&r.getMarkerDay(e)===r.getMarkerDay(t)?r.getMarkerMonth(t)-r.getMarkerMonth(e)+(r.getMarkerYear(t)-r.getMarkerYear(e))*12:null}greatestWholeUnit(e,t){let r=this.diffWholeYears(e,t);return r!==null?{unit:"year",value:r}:(r=this.diffWholeMonths(e,t),r!==null?{unit:"month",value:r}:(r=oI(e,t),r!==null?{unit:"week",value:r}:(r=Iu(e,t),r!==null?{unit:"day",value:r}:(r=tI(e,t),fu(r)?{unit:"hour",value:r}:(r=nI(e,t),fu(r)?{unit:"minute",value:r}:(r=rI(e,t),fu(r)?{unit:"second",value:r}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,r){let i;return r.years&&(i=this.diffWholeYears(e,t),i!==null)?i/QT(r):r.months&&(i=this.diffWholeMonths(e,t),i!==null)?i/JT(r):r.days&&(i=Iu(e,t),i!==null)?i/ls(r):(t.valueOf()-e.valueOf())/rr(r)}startOf(e,t){return t==="year"?this.startOfYear(e):t==="month"?this.startOfMonth(e):t==="week"?this.startOfWeek(e):t==="day"?Xe(e):t==="hour"?sI(e):t==="minute"?aI(e):t==="second"?lI(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):uI(e,this.weekDow,this.weekDoy)}format(e,t,r={}){return t.format({marker:e,timeZoneOffset:r.forcedTzo!=null?r.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,r,i={}){return i.isEndExclusive&&(t=Mi(t,-1)),r.formatRange({marker:e,timeZoneOffset:i.forcedStartTzo!=null?i.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:i.forcedEndTzo!=null?i.forcedEndTzo:this.offsetForMarker(t)},this,i.defaultSeparator)}formatIso(e,t={}){let r=null;return t.omitTimeZoneOffset||(t.forcedTzo!=null?r=t.forcedTzo:r=this.offsetForMarker(e)),_w(e,r,t.omitTime)}timestampToMarker(e){return this.timeZone==="local"?xn(Vv(new Date(e))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(e):xn(this.namedTimeZoneImpl.timestampToArray(e))}offsetForMarker(e){return this.timeZone==="local"?-Uv(mi(e)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(mi(e)):null}toDate(e,t){return this.timeZone==="local"?Uv(mi(e)):this.timeZone==="UTC"?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-this.namedTimeZoneImpl.offsetForArray(mi(e))*1e3*60):new Date(e.valueOf()-(t||0))}}class Ka{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,r;if(typeof e=="object"&&e){t=Object.assign({},this.iconClasses);for(r in e)t[r]=this.applyIconOverridePrefix(e[r]);this.iconClasses=t}else e===!1&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&e.indexOf(t)!==0&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let r;return t&&this.rtlIconClasses?r=this.rtlIconClasses[e]||this.iconClasses[e]:r=this.iconClasses[e],r?`${this.baseIconClass} ${r}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}}Ka.prototype.classes={};Ka.prototype.iconClasses={};Ka.prototype.baseIconClass="";Ka.prototype.iconOverridePrefix="";function Nu(n){n();let e=me.debounceRendering,t=[];function r(i){t.push(i)}for(me.debounceRendering=r,Ea(O(WI,{}),document.createElement("div"));t.length;)t.shift()();me.debounceRendering=e}class WI extends Wn{render(){return O("div",{})}componentDidMount(){this.setState({})}}function Sw(n){let e=cT(n),t=e.Provider;return e.Provider=function(){let r=!this.getChildContext,i=t.apply(this,arguments);if(r){let o=[];this.shouldComponentUpdate=s=>{this.props.value!==s.value&&o.forEach(a=>{a.context=s.value,a.forceUpdate()})},this.sub=s=>{o.push(s);let a=s.componentWillUnmount;s.componentWillUnmount=()=>{o.splice(o.indexOf(s),1),a&&a.call(s)}}}return i},e}class zI{constructor(e,t,r,i){this.execFunc=e,this.emitter=t,this.scrollTime=r,this.scrollTimeReset=i,this.handleScrollRequest=o=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},o),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}}const ti=Sw({});function VI(n,e,t,r,i,o,s,a,l,u,c,d,h,f){return{dateEnv:i,nowManager:o,options:t,pluginHooks:a,emitter:c,dispatch:l,getCurrentData:u,calendarApi:d,viewSpec:n,viewApi:e,dateProfileGenerator:r,theme:s,isRtl:t.direction==="rtl",addResizeHandler(p){c.on("_resize",p)},removeResizeHandler(p){c.off("_resize",p)},createScrollResponder(p){return new zI(p,c,Fe(t.scrollTime),t.scrollTimeReset)},registerInteractiveComponent:h,unregisterInteractiveComponent:f}}class Io extends Wn{shouldComponentUpdate(e,t){return!Vd(this.props,e,this.propEquality)||!Vd(this.state,t,this.stateEquality)}safeSetState(e){Vd(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}}Io.addPropsEquality=UI;Io.addStateEquality=jI;Io.contextType=ti;Io.prototype.propEquality={};Io.prototype.stateEquality={};class ze extends Io{}ze.contextType=ti;function UI(n){let e=Object.create(this.prototype.propEquality);Object.assign(e,n),this.prototype.propEquality=e}function jI(n){let e=Object.create(this.prototype.stateEquality);Object.assign(e,n),this.prototype.stateEquality=e}function Ir(n,e){typeof n=="function"?n(e):n&&(n.current=e)}class xp extends ze{constructor(){super(...arguments),this.id=To(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{const{options:t}=this.context,{generatorName:r}=this.props;(!t.customRenderingReplaces||!tf(r,t))&&this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&Ir(this.props.elRef,e)}}render(){const{props:e,context:t}=this,{options:r}=t,{customGenerator:i,defaultGenerator:o,renderProps:s}=e,a=Dw(e,[],this.handleEl);let l=!1,u,c=[],d;if(i!=null){const h=typeof i=="function"?i(s,O):i;if(h===!0)l=!0;else{const f=h&&typeof h=="object";f&&"html"in h?a.dangerouslySetInnerHTML={__html:h.html}:f&&"domNodes"in h?c=Array.prototype.slice.call(h.domNodes):(f?Kx(h):typeof h!="function")?u=h:d=h}}else l=!tf(e.generatorName,r);return l&&o&&(u=o(s)),this.queuedDomNodes=c,this.currentGeneratorMeta=d,O(e.elTag,a,u)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;const{props:r,context:i}=this,{handleCustomRendering:o,customRenderingMetaMap:s}=i.options;if(o){const a=(t=this.currentGeneratorMeta)!==null&&t!==void 0?t:s?.[r.generatorName];a&&o(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:a},r),{elClasses:(r.elClasses||[]).filter($I)}))}}applyQueueudDomNodes(){const{queuedDomNodes:e,currentDomNodes:t}=this,r=this.base;if(!Ii(e,t)){t.forEach(hp);for(let i of e)r.appendChild(i);this.currentDomNodes=e}}}xp.addPropsEquality({elClasses:Ii,elStyle:ar,elAttrs:TI,renderProps:ar});function tf(n,e){var t;return!!(e.handleCustomRendering&&n&&(!((t=e.customRenderingMetaMap)===null||t===void 0)&&t[n]))}function Dw(n,e,t){const r=Object.assign(Object.assign({},n.elAttrs),{ref:t});return(n.elClasses||e)&&(r.className=(n.elClasses||[]).concat(e||[]).concat(r.className||[]).filter(Boolean).join(" ")),n.elStyle&&(r.style=n.elStyle),r}function $I(n){return!!n}const Aw=Sw(0);class rn extends Wn{constructor(){super(...arguments),this.InnerContent=GI.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(Ir(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){const{props:e}=this,t=qI(e.classNameGenerator,e.renderProps);if(e.children){const r=Dw(e,t,this.handleEl),i=e.children(this.InnerContent,e.renderProps,r);return e.elTag?O(e.elTag,r,i):i}else return O(xp,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?(t=(e=this.props).didMount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;(t=(e=this.props).willUnmount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}}rn.contextType=Aw;function GI(n,e){const t=n.props;return O(xp,Object.assign({renderProps:t.renderProps,generatorName:t.generatorName,customGenerator:t.customGenerator,defaultGenerator:t.defaultGenerator,renderId:n.context},e))}function qI(n,e){const t=typeof n=="function"?n(e):n||[];return typeof t=="string"?[t]:t}class Sa extends ze{render(){let{props:e,context:t}=this,{options:r}=t,i={view:t.viewApi};return O(rn,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...kw(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:i,classNameGenerator:r.viewClassNames,generatorName:void 0,didMount:r.viewDidMount,willUnmount:r.viewWillUnmount},()=>e.children)}}function kw(n){return[`fc-${n.type}-view`,"fc-view"]}function YI(n,e){let t=null,r=null;return n.start&&(t=e.createMarker(n.start)),n.end&&(r=e.createMarker(n.end)),!t&&!r||t&&r&&r<t?null:{start:t,end:r}}function Xv(n,e){let t=[],{start:r}=e,i,o;for(n.sort(XI),i=0;i<n.length;i+=1)o=n[i],o.start>r&&t.push({start:r,end:o.start}),o.end>r&&(r=o.end);return r<e.end&&t.push({start:r,end:e.end}),t}function XI(n,e){return n.start.valueOf()-e.start.valueOf()}function Oi(n,e){let{start:t,end:r}=n,i=null;return e.start!==null&&(t===null?t=e.start:t=new Date(Math.max(t.valueOf(),e.start.valueOf()))),e.end!=null&&(r===null?r=e.end:r=new Date(Math.min(r.valueOf(),e.end.valueOf()))),(t===null||r===null||t<r)&&(i={start:t,end:r}),i}function KI(n,e){return(n.start===null?null:n.start.valueOf())===(e.start===null?null:e.start.valueOf())&&(n.end===null?null:n.end.valueOf())===(e.end===null?null:e.end.valueOf())}function wp(n,e){return(n.end===null||e.start===null||n.end>e.start)&&(n.start===null||e.end===null||n.start<e.end)}function kc(n,e){return(n.start===null||e.start!==null&&e.start>=n.start)&&(n.end===null||e.end!==null&&e.end<=n.end)}function Jr(n,e){return(n.start===null||e>=n.start)&&(n.end===null||e<n.end)}function QI(n,e){return e.start!=null&&n<e.start?e.start:e.end!=null&&n>=e.end?new Date(e.end.valueOf()-1):n}function Rw(n){let e=Math.floor(Bi(n.start,n.end))||1,t=Xe(n.start),r=St(t,e);return{start:t,end:r}}function _p(n,e=Fe(0)){let t=null,r=null;if(n.end){r=Xe(n.end);let i=n.end.valueOf()-r.valueOf();i&&i>=rr(e)&&(r=St(r,1))}return n.start&&(t=Xe(n.start),r&&r<=t&&(r=St(t,1))),{start:t,end:r}}function JI(n){let e=_p(n);return Bi(e.start,e.end)>1}function ns(n,e,t,r){return r==="year"?Fe(t.diffWholeYears(n,e),"year"):r==="month"?Fe(t.diffWholeMonths(n,e),"month"):iI(n,e)}class Tw{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,r){let{dateEnv:i}=this.props,o=i.subtract(i.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(o,-1,r)}buildNext(e,t,r){let{dateEnv:i}=this.props,o=i.add(i.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(o,1,r)}build(e,t,r=!0){let{props:i}=this,o,s,a,l,u,c;return o=this.buildValidRange(),o=this.trimHiddenDays(o),r&&(e=QI(e,o)),s=this.buildCurrentRangeInfo(e,t),a=/^(year|month|week|day)$/.test(s.unit),l=this.buildRenderRange(this.trimHiddenDays(s.range),s.unit,a),l=this.trimHiddenDays(l),u=l,i.showNonCurrentDates||(u=Oi(u,s.range)),u=this.adjustActiveRange(u),u=Oi(u,o),c=wp(s.range,o),Jr(l,e)||(e=l.start),{currentDate:e,validRange:o,currentRange:s.range,currentRangeUnit:s.unit,isRangeAllDay:a,activeRange:u,renderRange:l,slotMinTime:i.slotMinTime,slotMaxTime:i.slotMaxTime,isValid:c,dateIncrement:this.buildDateIncrement(s.duration)}}buildValidRange(){let e=this.props.validRangeInput,t=typeof e=="function"?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let{props:r}=this,i=null,o=null,s=null,a;return r.duration?(i=r.duration,o=r.durationUnit,s=this.buildRangeFromDuration(e,t,i,o)):(a=this.props.dayCount)?(o="day",s=this.buildRangeFromDayCount(e,t,a)):(s=this.buildCustomVisibleRange(e))?o=r.dateEnv.greatestWholeUnit(s.start,s.end).unit:(i=this.getFallbackDuration(),o=ef(i).unit,s=this.buildRangeFromDuration(e,t,i,o)),{duration:i,unit:o,range:s}}getFallbackDuration(){return Fe({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:r,slotMinTime:i,slotMaxTime:o}=this.props,{start:s,end:a}=e;return r&&(ls(i)<0&&(s=Xe(s),s=t.add(s,i)),ls(o)>1&&(a=Xe(a),a=St(a,-1),a=t.add(a,o))),{start:s,end:a}}buildRangeFromDuration(e,t,r,i){let{dateEnv:o,dateAlignment:s}=this.props,a,l,u;if(!s){let{dateIncrement:d}=this.props;d&&rr(d)<rr(r)?s=ef(d).unit:s=i}ls(r)<=1&&this.isHiddenDay(a)&&(a=this.skipHiddenDays(a,t),a=Xe(a));function c(){a=o.startOf(e,s),l=o.add(a,r),u={start:a,end:l}}return c(),this.trimHiddenDays(u)||(e=this.skipHiddenDays(e,t),c()),u}buildRangeFromDayCount(e,t,r){let{dateEnv:i,dateAlignment:o}=this.props,s=0,a=e,l;o&&(a=i.startOf(a,o)),a=Xe(a),a=this.skipHiddenDays(a,t),l=a;do l=St(l,1),this.isHiddenDay(l)||(s+=1);while(s<r);return{start:a,end:l}}buildCustomVisibleRange(e){let{props:t}=this,r=t.visibleRangeInput,i=typeof r=="function"?r.call(t.calendarApi,t.dateEnv.toDate(e)):r,o=this.refineRange(i);return o&&(o.start==null||o.end==null)?null:o}buildRenderRange(e,t,r){return e}buildDateIncrement(e){let{dateIncrement:t}=this.props,r;return t||((r=this.props.dateAlignment)?Fe(1,r):e||Fe({days:1}))}refineRange(e){if(e){let t=YI(e,this.props.dateEnv);return t&&(t=_p(t)),t}return null}initHiddenDays(){let e=this.props.hiddenDays||[],t=[],r=0,i;for(this.props.weekends===!1&&e.push(0,6),i=0;i<7;i+=1)(t[i]=e.indexOf(i)!==-1)||(r+=1);if(!r)throw new Error("invalid hiddenDays");this.isHiddenDayHash=t}trimHiddenDays(e){let{start:t,end:r}=e;return t&&(t=this.skipHiddenDays(t)),r&&(r=this.skipHiddenDays(r,-1,!0)),t==null||r==null||t<r?{start:t,end:r}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,r=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(r?t:0)+7)%7];)e=St(e,t);return e}}function Cp(n,e,t,r){return{instanceId:To(),defId:n,range:e,forcedStartTzo:t??null,forcedEndTzo:r??null}}function ZI(n,e,t,r){for(let i=0;i<r.length;i+=1){let o=r[i].parse(n,t);if(o){let{allDay:s}=n;return s==null&&(s=e,s==null&&(s=o.allDayGuess,s==null&&(s=!1))),{allDay:s,duration:o.duration,typeData:o.typeData,typeId:i}}}return null}function Eo(n,e,t){let{dateEnv:r,pluginHooks:i,options:o}=t,{defs:s,instances:a}=n;a=Co(a,l=>!s[l.defId].recurringDef);for(let l in s){let u=s[l];if(u.recurringDef){let{duration:c}=u.recurringDef;c||(c=u.allDay?o.defaultAllDayEventDuration:o.defaultTimedEventDuration);let d=eM(u,c,e,r,i.recurringTypes);for(let h of d){let f=Cp(l,{start:h,end:r.add(h,c)});a[f.instanceId]=f}}}return{defs:s,instances:a}}function eM(n,e,t,r,i){let s=i[n.recurringDef.typeId].expand(n.recurringDef.typeData,{start:r.subtract(t.start,e),end:t.end},r);return n.allDay&&(s=s.map(Xe)),s}const gu={id:String,groupId:String,title:String,url:String,interactive:Boolean},Iw={start:V,end:V,date:V,allDay:Boolean},tM=Object.assign(Object.assign(Object.assign({},gu),Iw),{extendedProps:V});function Mw(n,e,t,r,i=Ep(t),o,s){let{refined:a,extra:l}=Ow(n,t,i),u=rM(e,t),c=ZI(a,u,t.dateEnv,t.pluginHooks.recurringTypes);if(c){let h=nf(a,l,e?e.sourceId:"",c.allDay,!!c.duration,t,o);return h.recurringDef={typeId:c.typeId,typeData:c.typeData,duration:c.duration},{def:h,instance:null}}let d=nM(a,u,t,r);if(d){let h=nf(a,l,e?e.sourceId:"",d.allDay,d.hasEnd,t,o),f=Cp(h.defId,d.range,d.forcedStartTzo,d.forcedEndTzo);return s&&h.publicId&&s[h.publicId]&&(f.instanceId=s[h.publicId]),{def:h,instance:f}}return null}function Ow(n,e,t=Ep(e)){return vp(n,t)}function Ep(n){return Object.assign(Object.assign(Object.assign({},Fu),tM),n.pluginHooks.eventRefiners)}function nf(n,e,t,r,i,o,s){let a={title:n.title||"",groupId:n.groupId||"",publicId:n.id||"",url:n.url||"",recurringDef:null,defId:(s&&n.id?s[n.id]:"")||To(),sourceId:t,allDay:r,hasEnd:i,interactive:n.interactive,ui:Lu(n,o),extendedProps:Object.assign(Object.assign({},n.extendedProps||{}),e)};for(let l of o.pluginHooks.eventDefMemberAdders)Object.assign(a,l(n));return Object.freeze(a.ui.classNames),Object.freeze(a.extendedProps),a}function nM(n,e,t,r){let{allDay:i}=n,o,s=null,a=!1,l,u=null,c=n.start!=null?n.start:n.date;if(o=t.dateEnv.createMarkerMeta(c),o)s=o.marker;else if(!r)return null;return n.end!=null&&(l=t.dateEnv.createMarkerMeta(n.end)),i==null&&(e!=null?i=e:i=(!o||o.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),i&&s&&(s=Xe(s)),l&&(u=l.marker,i&&(u=Xe(u)),s&&u<=s&&(u=null)),u?a=!0:r||(a=t.options.forceEventDuration||!1,u=t.dateEnv.add(s,i?t.options.defaultAllDayEventDuration:t.options.defaultTimedEventDuration)),{allDay:i,hasEnd:a,range:{start:s,end:u},forcedStartTzo:o?o.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function rM(n,e){let t=null;return n&&(t=n.defaultAllDay),t==null&&(t=e.options.defaultAllDay),t}function Da(n,e,t,r,i,o){let s=zn(),a=Ep(t);for(let l of n){let u=Mw(l,e,t,r,a,i,o);u&&rf(u,s)}return s}function rf(n,e=zn()){return e.defs[n.def.defId]=n.def,n.instance&&(e.instances[n.instance.instanceId]=n.instance),e}function Sp(n,e){let t=n.instances[e];if(t){let r=n.defs[t.defId],i=Rc(n,o=>iM(r,o));return i.defs[r.defId]=r,i.instances[t.instanceId]=t,i}return zn()}function iM(n,e){return!!(n.groupId&&n.groupId===e.groupId)}function zn(){return{defs:{},instances:{}}}function Dp(n,e){return{defs:Object.assign(Object.assign({},n.defs),e.defs),instances:Object.assign(Object.assign({},n.instances),e.instances)}}function Rc(n,e){let t=Co(n.defs,e),r=Co(n.instances,i=>t[i.defId]);return{defs:t,instances:r}}function oM(n,e){let{defs:t,instances:r}=n,i={},o={};for(let s in t)e.defs[s]||(i[s]=t[s]);for(let s in r)!e.instances[s]&&i[r[s].defId]&&(o[s]=r[s]);return{defs:i,instances:o}}function sM(n,e){return Array.isArray(n)?Da(n,null,e,!0):typeof n=="object"&&n?Da([n],null,e,!0):n!=null?String(n):null}function Kv(n){return Array.isArray(n)?n:typeof n=="string"?n.split(/\s+/):[]}const Fu={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:V,overlap:V,allow:V,className:Kv,classNames:Kv,color:String,backgroundColor:String,borderColor:String,textColor:String},aM={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function Lu(n,e){let t=sM(n.constraint,e);return{display:n.display||null,startEditable:n.startEditable!=null?n.startEditable:n.editable,durationEditable:n.durationEditable!=null?n.durationEditable:n.editable,constraints:t!=null?[t]:[],overlap:n.overlap!=null?n.overlap:null,allows:n.allow!=null?[n.allow]:[],backgroundColor:n.backgroundColor||n.color||"",borderColor:n.borderColor||n.color||"",textColor:n.textColor||"",classNames:(n.className||[]).concat(n.classNames||[])}}function Pw(n){return n.reduce(lM,aM)}function lM(n,e){return{display:e.display!=null?e.display:n.display,startEditable:e.startEditable!=null?e.startEditable:n.startEditable,durationEditable:e.durationEditable!=null?e.durationEditable:n.durationEditable,constraints:n.constraints.concat(e.constraints),overlap:typeof e.overlap=="boolean"?e.overlap:n.overlap,allows:n.allows.concat(e.allows),backgroundColor:e.backgroundColor||n.backgroundColor,borderColor:e.borderColor||n.borderColor,textColor:e.textColor||n.textColor,classNames:n.classNames.concat(e.classNames)}}const uM={id:String,defaultAllDay:Boolean,url:String,format:String,events:V,eventDataTransform:V,success:V,failure:V};function Nw(n,e,t=Fw(e)){let r;if(typeof n=="string"?r={url:n}:typeof n=="function"||Array.isArray(n)?r={events:n}:typeof n=="object"&&n&&(r=n),r){let{refined:i,extra:o}=vp(r,t),s=cM(i,e);if(s)return{_raw:n,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:i.defaultAllDay,eventDataTransform:i.eventDataTransform,success:i.success,failure:i.failure,publicId:i.id||"",sourceId:To(),sourceDefId:s.sourceDefId,meta:s.meta,ui:Lu(i,e),extendedProps:o}}return null}function Fw(n){return Object.assign(Object.assign(Object.assign({},Fu),uM),n.pluginHooks.eventSourceRefiners)}function cM(n,e){let t=e.pluginHooks.eventSourceDefs;for(let r=t.length-1;r>=0;r-=1){let o=t[r].parseMeta(n);if(o)return{sourceDefId:r,meta:o}}return null}function dM(n,e,t,r,i){switch(e.type){case"RECEIVE_EVENTS":return hM(n,t[e.sourceId],e.fetchId,e.fetchRange,e.rawEvents,i);case"RESET_RAW_EVENTS":return fM(n,t[e.sourceId],e.rawEvents,r.activeRange,i);case"ADD_EVENTS":return pM(n,e.eventStore,r?r.activeRange:null,i);case"RESET_EVENTS":return e.eventStore;case"MERGE_EVENTS":return Dp(n,e.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return r?Eo(n,r.activeRange,i):n;case"REMOVE_EVENTS":return oM(n,e.eventStore);case"REMOVE_EVENT_SOURCE":return Bw(n,e.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return Rc(n,o=>!o.sourceId);case"REMOVE_ALL_EVENTS":return zn();default:return n}}function hM(n,e,t,r,i,o){if(e&&t===e.latestFetchId){let s=Da(Lw(i,e,o),e,o);return r&&(s=Eo(s,r,o)),Dp(Bw(n,e.sourceId),s)}return n}function fM(n,e,t,r,i){const{defIdMap:o,instanceIdMap:s}=mM(n);let a=Da(Lw(t,e,i),e,i,!1,o,s);return Eo(a,r,i)}function Lw(n,e,t){let r=t.options.eventDataTransform,i=e?e.eventDataTransform:null;return i&&(n=Qv(n,i)),r&&(n=Qv(n,r)),n}function Qv(n,e){let t;if(!e)t=n;else{t=[];for(let r of n){let i=e(r);i?t.push(i):i==null&&t.push(r)}}return t}function pM(n,e,t,r){return t&&(e=Eo(e,t,r)),Dp(n,e)}function Jv(n,e,t){let{defs:r}=n,i=ei(n.instances,o=>r[o.defId].allDay?o:Object.assign(Object.assign({},o),{range:{start:t.createMarker(e.toDate(o.range.start,o.forcedStartTzo)),end:t.createMarker(e.toDate(o.range.end,o.forcedEndTzo))},forcedStartTzo:t.canComputeOffset?null:o.forcedStartTzo,forcedEndTzo:t.canComputeOffset?null:o.forcedEndTzo}));return{defs:r,instances:i}}function Bw(n,e){return Rc(n,t=>t.sourceId!==e)}function gM(n,e){return{defs:n.defs,instances:Co(n.instances,t=>!e[t.instanceId])}}function mM(n){const{defs:e,instances:t}=n,r={},i={};for(let o in e){const s=e[o],{publicId:a}=s;a&&(r[a]=o)}for(let o in t){const s=t[o],a=e[s.defId],{publicId:l}=a;l&&(i[l]=o)}return{defIdMap:r,instanceIdMap:i}}class Tc{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){vM(this.handlers,e,t)}off(e,t){yM(this.handlers,e,t)}trigger(e,...t){let r=this.handlers[e]||[],i=this.options&&this.options[e],o=[].concat(i||[],r);for(let s of o)s.apply(this.thisContext,t)}hasHandlers(e){return!!(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}}function vM(n,e,t){(n[e]||(n[e]=[])).push(t)}function yM(n,e,t){t?n[e]&&(n[e]=n[e].filter(r=>r!==t)):delete n[e]}const bM={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function xM(n,e){return Da(wM(n),null,e)}function wM(n){let e;return n===!0?e=[{}]:Array.isArray(n)?e=n.filter(t=>t.daysOfWeek):typeof n=="object"&&n?e=[n]:e=[],e=e.map(t=>Object.assign(Object.assign({},bM),t)),e}function Hw(n,e,t){t.emitter.trigger("select",Object.assign(Object.assign({},Ap(n,t)),{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view}))}function _M(n,e){e.emitter.trigger("unselect",{jsEvent:n?n.origEvent:null,view:e.viewApi||e.calendarApi.view})}function Ap(n,e){let t={};for(let r of e.pluginHooks.dateSpanTransforms)Object.assign(t,r(n,e));return Object.assign(t,FM(n,e.dateEnv)),t}function Zv(n,e,t){let{dateEnv:r,options:i}=t,o=e;return n?(o=Xe(o),o=r.add(o,i.defaultAllDayEventDuration)):o=r.add(o,i.defaultTimedEventDuration),o}function kp(n,e,t,r){let i=Bu(n.defs,e),o=zn();for(let s in n.defs){let a=n.defs[s];o.defs[s]=CM(a,i[s],t,r)}for(let s in n.instances){let a=n.instances[s],l=o.defs[a.defId];o.instances[s]=EM(a,l,i[a.defId],t,r)}return o}function CM(n,e,t,r){let i=t.standardProps||{};i.hasEnd==null&&e.durationEditable&&(t.startDelta||t.endDelta)&&(i.hasEnd=!0);let o=Object.assign(Object.assign(Object.assign({},n),i),{ui:Object.assign(Object.assign({},n.ui),i.ui)});t.extendedProps&&(o.extendedProps=Object.assign(Object.assign({},o.extendedProps),t.extendedProps));for(let s of r.pluginHooks.eventDefMutationAppliers)s(o,t,r);return!o.hasEnd&&r.options.forceEventDuration&&(o.hasEnd=!0),o}function EM(n,e,t,r,i){let{dateEnv:o}=i,s=r.standardProps&&r.standardProps.allDay===!0,a=r.standardProps&&r.standardProps.hasEnd===!1,l=Object.assign({},n);return s&&(l.range=Rw(l.range)),r.datesDelta&&t.startEditable&&(l.range={start:o.add(l.range.start,r.datesDelta),end:o.add(l.range.end,r.datesDelta)}),r.startDelta&&t.durationEditable&&(l.range={start:o.add(l.range.start,r.startDelta),end:l.range.end}),r.endDelta&&t.durationEditable&&(l.range={start:l.range.start,end:o.add(l.range.end,r.endDelta)}),a&&(l.range={start:l.range.start,end:Zv(e.allDay,l.range.start,i)}),e.allDay&&(l.range={start:Xe(l.range.start),end:Xe(l.range.end)}),l.range.end<l.range.start&&(l.range.end=Zv(e.allDay,l.range.start,i)),l}class Ko{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}}class ut{constructor(e,t,r){this._context=e,this._def=t,this._instance=r||null}setProp(e,t){if(e in Iw)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e==="id")t=gu[e](t),this.mutate({standardProps:{publicId:t}});else if(e in gu)t=gu[e](t),this.mutate({standardProps:{[e]:t}});else if(e in Fu){let r=Fu[e](t);e==="color"?r={backgroundColor:t,borderColor:t}:e==="editable"?r={startEditable:t,durationEditable:t}:r={[e]:t},this.mutate({standardProps:{ui:r}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:r}=this._context,i=r.createMarker(e);if(i&&this._instance){let o=this._instance.range,s=ns(o.start,i,r,t.granularity);t.maintainDuration?this.mutate({datesDelta:s}):this.mutate({startDelta:s})}}setEnd(e,t={}){let{dateEnv:r}=this._context,i;if(!(e!=null&&(i=r.createMarker(e),!i))&&this._instance)if(i){let o=ns(this._instance.range.end,i,r,t.granularity);this.mutate({endDelta:o})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,r={}){let{dateEnv:i}=this._context,o={allDay:r.allDay},s=i.createMarker(e),a;if(s&&!(t!=null&&(a=i.createMarker(t),!a))&&this._instance){let l=this._instance.range;r.allDay===!0&&(l=Rw(l));let u=ns(l.start,s,i,r.granularity);if(a){let c=ns(l.end,a,i,r.granularity);YT(u,c)?this.mutate({datesDelta:u,standardProps:o}):this.mutate({startDelta:u,endDelta:c,standardProps:o})}else o.hasEnd=!1,this.mutate({datesDelta:u,standardProps:o})}}moveStart(e){let t=Fe(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=Fe(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=Fe(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let r={allDay:e},{maintainDuration:i}=t;i==null&&(i=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(r.hasEnd=i),this.mutate({standardProps:r})}formatRange(e){let{dateEnv:t}=this._context,r=this._instance,i=tt(e);return this._def.hasEnd?t.formatRange(r.range.start,r.range.end,i,{forcedStartTzo:r.forcedStartTzo,forcedEndTzo:r.forcedEndTzo}):t.format(r.range.start,i,{forcedTzo:r.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let r=this._def,i=this._context,{eventStore:o}=i.getCurrentData(),s=Sp(o,t.instanceId);s=kp(s,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},e,i);let l=new ut(i,r,t);this._def=s.defs[r.defId],this._instance=s.instances[t.instanceId],i.dispatch({type:"MERGE_EVENTS",eventStore:s}),i.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:mo(s,i,t),revert(){i.dispatch({type:"RESET_EVENTS",eventStore:o})}})}}remove(){let e=this._context,t=Ww(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new Ko(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:r}=t,{startStr:i,endStr:o}=this,s={allDay:t.allDay};return t.title&&(s.title=t.title),i&&(s.start=i),o&&(s.end=o),t.publicId&&(s.id=t.publicId),t.groupId&&(s.groupId=t.groupId),t.url&&(s.url=t.url),r.display&&r.display!=="auto"&&(s.display=r.display),e.collapseColor&&r.backgroundColor&&r.backgroundColor===r.borderColor?s.color=r.backgroundColor:(r.backgroundColor&&(s.backgroundColor=r.backgroundColor),r.borderColor&&(s.borderColor=r.borderColor)),r.textColor&&(s.textColor=r.textColor),r.classNames.length&&(s.classNames=r.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(s,t.extendedProps):s.extendedProps=t.extendedProps),s}toJSON(){return this.toPlainObject()}}function Ww(n){let e=n._def,t=n._instance;return{defs:{[e.defId]:e},instances:t?{[t.instanceId]:t}:{}}}function mo(n,e,t){let{defs:r,instances:i}=n,o=[],s=t?t.instanceId:"";for(let a in i){let l=i[a],u=r[l.defId];l.instanceId!==s&&o.push(new ut(e,u,l))}return o}function of(n,e,t,r){let i={},o={},s={},a=[],l=[],u=Bu(n.defs,e);for(let c in n.defs){let d=n.defs[c];u[d.defId].display==="inverse-background"&&(d.groupId?(i[d.groupId]=[],s[d.groupId]||(s[d.groupId]=d)):o[c]=[])}for(let c in n.instances){let d=n.instances[c],h=n.defs[d.defId],f=u[h.defId],p=d.range,g=!h.allDay&&r?_p(p,r):p,m=Oi(g,t);m&&(f.display==="inverse-background"?h.groupId?i[h.groupId].push(m):o[d.defId].push(m):f.display!=="none"&&(f.display==="background"?a:l).push({def:h,ui:f,instance:d,range:m,isStart:g.start&&g.start.valueOf()===m.start.valueOf(),isEnd:g.end&&g.end.valueOf()===m.end.valueOf()}))}for(let c in i){let d=i[c],h=Xv(d,t);for(let f of h){let p=s[c],g=u[p.defId];a.push({def:p,ui:g,instance:null,range:f,isStart:!1,isEnd:!1})}}for(let c in o){let d=o[c],h=Xv(d,t);for(let f of h)a.push({def:n.defs[c],ui:u[c],instance:null,range:f,isStart:!1,isEnd:!1})}return{bg:a,fg:l}}function SM(n){return n.ui.display==="background"||n.ui.display==="inverse-background"}function ey(n,e){n.fcSeg=e}function _s(n){return n.fcSeg||n.parentNode.fcSeg||null}function Bu(n,e){return ei(n,t=>zw(t,e))}function zw(n,e){let t=[];return e[""]&&t.push(e[""]),e[n.defId]&&t.push(e[n.defId]),t.push(n.ui),Pw(t)}function Rp(n,e){let t=n.map(DM);return t.sort((r,i)=>zT(r,i,e)),t.map(r=>r._seg)}function DM(n){let{eventRange:e}=n,t=e.def,r=e.instance?e.instance.range:e.range,i=r.start?r.start.valueOf():0,o=r.end?r.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},t.extendedProps),t),{id:t.publicId,start:i,end:o,duration:o-i,allDay:Number(t.allDay),_seg:n})}function AM(n,e){let{pluginHooks:t}=e,r=t.isDraggableTransformers,{def:i,ui:o}=n.eventRange,s=o.startEditable;for(let a of r)s=a(s,i,o,e);return s}function kM(n,e){return n.isStart&&n.eventRange.ui.durationEditable&&e.options.eventResizableFromStart}function RM(n,e){return n.isEnd&&n.eventRange.ui.durationEditable}function da(n,e,t,r,i,o,s){let{dateEnv:a,options:l}=t,{displayEventTime:u,displayEventEnd:c}=l,d=n.eventRange.def,h=n.eventRange.instance;u==null&&(u=r!==!1),c==null&&(c=i!==!1);let f=h.range.start,p=h.range.end,g=o||n.start||n.eventRange.range.start,m=s||n.end||n.eventRange.range.end,v=Xe(f).valueOf()===Xe(g).valueOf(),y=Xe(Mi(p,-1)).valueOf()===Xe(Mi(m,-1)).valueOf();return u&&!d.allDay&&(v||y)?(g=v?f:g,m=y?p:m,c&&d.hasEnd?a.formatRange(g,m,e,{forcedStartTzo:o?null:h.forcedStartTzo,forcedEndTzo:s?null:h.forcedEndTzo}):a.format(g,e,{forcedTzo:o?null:h.forcedStartTzo})):""}function Zr(n,e,t){let r=n.eventRange.range;return{isPast:r.end<=(t||e.start),isFuture:r.start>=(t||e.end),isToday:e&&Jr(e,r.start)}}function TM(n){let e=["fc-event"];return n.isMirror&&e.push("fc-event-mirror"),n.isDraggable&&e.push("fc-event-draggable"),(n.isStartResizable||n.isEndResizable)&&e.push("fc-event-resizable"),n.isDragging&&e.push("fc-event-dragging"),n.isResizing&&e.push("fc-event-resizing"),n.isSelected&&e.push("fc-event-selected"),n.isStart&&e.push("fc-event-start"),n.isEnd&&e.push("fc-event-end"),n.isPast&&e.push("fc-event-past"),n.isToday&&e.push("fc-event-today"),n.isFuture&&e.push("fc-event-future"),e}function Vw(n){return n.instance?n.instance.instanceId:`${n.def.defId}:${n.range.start.toISOString()}`}function Tp(n,e){let{def:t,instance:r}=n.eventRange,{url:i}=t;if(i)return{href:i};let{emitter:o,options:s}=e,{eventInteractive:a}=s;return a==null&&(a=t.interactive,a==null&&(a=!!o.hasHandlers("eventClick"))),a?xw(l=>{o.trigger("eventClick",{el:l.target,event:new ut(e,t,r),jsEvent:l,view:e.viewApi})}):{}}const IM={start:V,end:V,allDay:Boolean};function MM(n,e,t){let r=OM(n,e),{range:i}=r;if(!i.start)return null;if(!i.end){if(t==null)return null;i.end=e.add(i.start,t)}return r}function OM(n,e){let{refined:t,extra:r}=vp(n,IM),i=t.start?e.createMarkerMeta(t.start):null,o=t.end?e.createMarkerMeta(t.end):null,{allDay:s}=t;return s==null&&(s=i&&i.isTimeUnspecified&&(!o||o.isTimeUnspecified)),Object.assign({range:{start:i?i.marker:null,end:o?o.marker:null},allDay:s},r)}function PM(n,e){return KI(n.range,e.range)&&n.allDay===e.allDay&&NM(n,e)}function NM(n,e){for(let t in e)if(t!=="range"&&t!=="allDay"&&n[t]!==e[t])return!1;for(let t in n)if(!(t in e))return!1;return!0}function FM(n,e){return Object.assign(Object.assign({},jw(n.range,e,n.allDay)),{allDay:n.allDay})}function Uw(n,e,t){return Object.assign(Object.assign({},jw(n,e,t)),{timeZone:e.timeZone})}function jw(n,e,t){return{start:e.toDate(n.start),end:e.toDate(n.end),startStr:e.formatIso(n.start,{omitTime:t}),endStr:e.formatIso(n.end,{omitTime:t})}}function LM(n,e,t){let r=Ow({editable:!1},t),i=nf(r.refined,r.extra,"",n.allDay,!0,t);return{def:i,ui:zw(i,e),instance:Cp(i.defId,n.range),range:n.range,isStart:!0,isEnd:!0}}function BM(n,e,t){let r=!1,i=function(a){r||(r=!0,e(a))},o=function(a){r||(r=!0,t(a))},s=n(i,o);s&&typeof s.then=="function"&&s.then(i,o)}class ty extends Error{constructor(e,t){super(e),this.response=t}}function HM(n,e,t){n=n.toUpperCase();const r={method:n};return n==="GET"?e+=(e.indexOf("?")===-1?"?":"&")+new URLSearchParams(t):(r.body=new URLSearchParams(t),r.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(e,r).then(i=>{if(i.ok)return i.json().then(o=>[o,i],()=>{throw new ty("Failure parsing JSON",i)});throw new ty("Request failed",i)})}let Ud;function $w(){return Ud==null&&(Ud=WM()),Ud}function WM(){if(typeof document>"u")return!0;let n=document.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.innerHTML="<table><tr><td><div></div></td></tr></table>",n.querySelector("table").style.height="100px",n.querySelector("div").style.height="100%",document.body.appendChild(n);let t=n.querySelector("div").offsetHeight>0;return document.body.removeChild(n),t}class zM extends ze{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{Nu(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{Nu(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:r}=this.state,i=r||t.height==="auto"||t.contentHeight==="auto",o=!i&&t.height!=null?t.height:"",s=["fc",r?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return $w()||s.push("fc-liquid-hack"),e.children(s,o,i,r)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}}let Ps=class{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}};function VM(n,e){return{component:n,el:e.el,useEventCenter:e.useEventCenter!=null?e.useEventCenter:!0,isHitComboAllowed:e.isHitComboAllowed||null}}function Ip(n){return{[n.component.uid]:n}}const sf={};class Mo extends Wn{constructor(e,t){super(e,t),this.handleRefresh=()=>{let r=this.computeTiming();r.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(r.state),this.clearTimeout(),this.setTimeout(r.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:t}=this,r=t.nowManager.getDateMarker(),{nowIndicatorSnap:i}=t.options;i==="auto"&&(i=/year|month|week|day/.test(e.unit)||(e.unitValue||1)===1);let o,s;return i?(o=t.dateEnv.startOf(r,e.unit),s=t.dateEnv.add(o,Fe(1,e.unit)).valueOf()-r.valueOf()):(o=r,s=1e3*60),s=Math.min(1e3*60*60*24,s),{state:{nowDate:o,todayRange:UM(o)},waitMs:s}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{const t=this.computeTiming();this.setState(t.state,()=>{this.setTimeout(t.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}}Mo.contextType=ti;function UM(n){let e=Xe(n),t=St(e,1);return{start:e,end:t}}class jM{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:r}=this;r.currentCalendarOptionsRefiners[e]?r.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:r}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:r.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let r=this.getCurrentData(),i;t=t||"day",i=r.viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),i?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:i.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let{viewSpecs:t,toolbarConfig:r}=this.getCurrentData(),i=[].concat(r.header?r.header.viewsWithButtons:[],r.footer?r.footer.viewsWithButtons:[]),o,s;for(let a in t)i.push(a);for(o=0;o<i.length;o+=1)if(s=t[i[o]],s&&s.singleUnit===e)return s;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),r=Fe(e);r&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,r)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:r}=this.getCurrentData();return r.format(r.createMarker(e),tt(t))}formatRange(e,t,r){let{dateEnv:i}=this.getCurrentData();return i.formatRange(i.createMarker(e),i.createMarker(t),tt(r),r)}formatIso(e,t){let{dateEnv:r}=this.getCurrentData();return r.formatIso(r.createMarker(e),{omitTime:t})}select(e,t){let r;t==null?e.start!=null?r=e:r={start:e,end:null}:r={start:e,end:t};let i=this.getCurrentData(),o=MM(r,i.dateEnv,Fe({days:1}));o&&(this.dispatch({type:"SELECT_DATES",selection:o}),Hw(o,null,i))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),_M(e,t))}addEvent(e,t){if(e instanceof ut){let s=e._def,a=e._instance;return this.getCurrentData().eventStore.defs[s.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:rf({def:s,instance:a})}),this.triggerEventAdd(e)),e}let r=this.getCurrentData(),i;if(t instanceof Ko)i=t.internalEventSource;else if(typeof t=="boolean")t&&([i]=bp(r.eventSources));else if(t!=null){let s=this.getEventSourceById(t);if(!s)return console.warn(`Could not find an event source with ID "${t}"`),null;i=s.internalEventSource}let o=Mw(e,i,r,!1);if(o){let s=new ut(r,o.def,o.def.recurringDef?null:o.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:rf(o)}),this.triggerEventAdd(s),s}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:Ww(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:r,instances:i}=t.eventStore;e=String(e);for(let o in r){let s=r[o];if(s.publicId===e){if(s.recurringDef)return new ut(t,s,null);for(let a in i){let l=i[a];if(l.defId===s.defId)return new ut(t,s,l)}}}return null}getEvents(){let e=this.getCurrentData();return mo(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,r=[];for(let i in t)r.push(new Ko(e,t[i]));return r}getEventSourceById(e){let t=this.getCurrentData(),r=t.eventSources;e=String(e);for(let i in r)if(r[i].publicId===e)return new Ko(t,r[i]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof Ko)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let r=Nw(e,t);return r?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[r]}),new Ko(t,r)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=Fe(e);t&&this.trigger("_scrollRequest",{time:t})}}function $M(n,e){return n.left>=e.left&&n.left<e.right&&n.top>=e.top&&n.top<e.bottom}function Gw(n,e){let t={left:Math.max(n.left,e.left),right:Math.min(n.right,e.right),top:Math.max(n.top,e.top),bottom:Math.min(n.bottom,e.bottom)};return t.left<t.right&&t.top<t.bottom?t:!1}function GM(n,e){return{left:Math.min(Math.max(n.left,e.left),e.right),top:Math.min(Math.max(n.top,e.top),e.bottom)}}function qM(n){return{left:(n.left+n.right)/2,top:(n.top+n.bottom)/2}}function YM(n,e){return{left:n.left-e.left,top:n.top-e.top}}const jd=zn();class XM{constructor(){this.getKeysForEventDefs=ge(this._getKeysForEventDefs),this.splitDateSelection=ge(this._splitDateSpan),this.splitEventStore=ge(this._splitEventStore),this.splitIndividualUi=ge(this._splitIndividualUi),this.splitEventDrag=ge(this._splitInteraction),this.splitEventResize=ge(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),r=this.getKeysForEventDefs(e.eventStore),i=this.splitDateSelection(e.dateSelection),o=this.splitIndividualUi(e.eventUiBases,r),s=this.splitEventStore(e.eventStore,r),a=this.splitEventDrag(e.eventDrag),l=this.splitEventResize(e.eventResize),u={};this.eventUiBuilders=ei(t,(c,d)=>this.eventUiBuilders[d]||ge(KM));for(let c in t){let d=t[c],h=s[c]||jd,f=this.eventUiBuilders[c];u[c]={businessHours:d.businessHours||e.businessHours,dateSelection:i[c]||null,eventStore:h,eventUiBases:f(e.eventUiBases[""],d.ui,o[c]),eventSelection:h.instances[e.eventSelection]?e.eventSelection:"",eventDrag:a[c]||null,eventResize:l[c]||null}}return u}_splitDateSpan(e){let t={};if(e){let r=this.getKeysForDateSpan(e);for(let i of r)t[i]=e}return t}_getKeysForEventDefs(e){return ei(e.defs,t=>this.getKeysForEventDef(t))}_splitEventStore(e,t){let{defs:r,instances:i}=e,o={};for(let s in r)for(let a of t[s])o[a]||(o[a]=zn()),o[a].defs[s]=r[s];for(let s in i){let a=i[s];for(let l of t[a.defId])o[l]&&(o[l].instances[s]=a)}return o}_splitIndividualUi(e,t){let r={};for(let i in e)if(i)for(let o of t[i])r[o]||(r[o]={}),r[o][i]=e[i];return r}_splitInteraction(e){let t={};if(e){let r=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),i=this._getKeysForEventDefs(e.mutatedEvents),o=this._splitEventStore(e.mutatedEvents,i),s=a=>{t[a]||(t[a]={affectedEvents:r[a]||jd,mutatedEvents:o[a]||jd,isEvent:e.isEvent})};for(let a in r)s(a);for(let a in o)s(a)}return t}}function KM(n,e,t){let r=[];n&&r.push(n),e&&r.push(e);let i={"":Pw(r)};return t&&Object.assign(i,t),i}function Mp(n,e,t,r){return{dow:n.getUTCDay(),isDisabled:!!(r&&(!r.activeRange||!Jr(r.activeRange,n))),isOther:!!(r&&!Jr(r.currentRange,n)),isToday:!!(e&&Jr(e,n)),isPast:!!(t?n<t:e&&n<e.start),isFuture:!!(t?n>t:e&&n>=e.end)}}function Ic(n,e){let t=["fc-day",`fc-day-${ZT[n.dow]}`];return n.isDisabled?t.push("fc-day-disabled"):(n.isToday&&(t.push("fc-day-today"),t.push(e.getClass("today"))),n.isPast&&t.push("fc-day-past"),n.isFuture&&t.push("fc-day-future"),n.isOther&&t.push("fc-day-other")),t}const QM=tt({year:"numeric",month:"long",day:"numeric"}),JM=tt({week:"long"});function Cs(n,e,t="day",r=!0){const{dateEnv:i,options:o,calendarApi:s}=n;let a=i.format(e,t==="week"?JM:QM);if(o.navLinks){let l=i.toDate(e);const u=c=>{let d=t==="day"?o.navLinkDayClick:t==="week"?o.navLinkWeekClick:null;typeof d=="function"?d.call(s,i.toDate(e),c):(typeof d=="string"&&(t=d),s.zoomTo(e,t))};return Object.assign({title:ua(o.navLinkHint,[a,l],a),"data-navlink":""},r?bw(u):{onClick:u})}return{"aria-label":a}}let $d=null;function ZM(){return $d===null&&($d=eO()),$d}function eO(){let n=document.createElement("div");la(n,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),n.innerHTML="<div></div>",document.body.appendChild(n);let t=n.firstChild.getBoundingClientRect().left>n.getBoundingClientRect().left;return hp(n),t}let Gd;function tO(){return Gd||(Gd=nO()),Gd}function nO(){let n=document.createElement("div");n.style.overflow="scroll",n.style.position="absolute",n.style.top="-9999px",n.style.left="-9999px",document.body.appendChild(n);let e=qw(n);return document.body.removeChild(n),e}function qw(n){return{x:n.offsetHeight-n.clientHeight,y:n.offsetWidth-n.clientWidth}}function rO(n,e=!1){let t=window.getComputedStyle(n),r=parseInt(t.borderLeftWidth,10)||0,i=parseInt(t.borderRightWidth,10)||0,o=parseInt(t.borderTopWidth,10)||0,s=parseInt(t.borderBottomWidth,10)||0,a=qw(n),l=a.y-r-i,u=a.x-o-s,c={borderLeft:r,borderRight:i,borderTop:o,borderBottom:s,scrollbarBottom:u,scrollbarLeft:0,scrollbarRight:0};return ZM()&&t.direction==="rtl"?c.scrollbarLeft=l:c.scrollbarRight=l,e&&(c.paddingLeft=parseInt(t.paddingLeft,10)||0,c.paddingRight=parseInt(t.paddingRight,10)||0,c.paddingTop=parseInt(t.paddingTop,10)||0,c.paddingBottom=parseInt(t.paddingBottom,10)||0),c}function iO(n,e=!1,t){let r=Op(n),i=rO(n,e),o={left:r.left+i.borderLeft+i.scrollbarLeft,right:r.right-i.borderRight-i.scrollbarRight,top:r.top+i.borderTop,bottom:r.bottom-i.borderBottom-i.scrollbarBottom};return e&&(o.left+=i.paddingLeft,o.right-=i.paddingRight,o.top+=i.paddingTop,o.bottom-=i.paddingBottom),o}function Op(n){let e=n.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY}}function oO(n){let e=Yw(n),t=n.getBoundingClientRect();for(let r of e){let i=Gw(t,r.getBoundingClientRect());if(i)t=i;else return null}return t}function Yw(n){let e=[];for(;n instanceof HTMLElement;){let t=window.getComputedStyle(n);if(t.position==="fixed")break;/(auto|scroll)/.test(t.overflow+t.overflowY+t.overflowX)&&e.push(n),n=n.parentNode}return e}class Es{constructor(e,t,r,i){this.els=t;let o=this.originClientRect=e.getBoundingClientRect();r&&this.buildElHorizontals(o.left),i&&this.buildElVerticals(o.top)}buildElHorizontals(e){let t=[],r=[];for(let i of this.els){let o=i.getBoundingClientRect();t.push(o.left-e),r.push(o.right-e)}this.lefts=t,this.rights=r}buildElVerticals(e){let t=[],r=[];for(let i of this.els){let o=i.getBoundingClientRect();t.push(o.top-e),r.push(o.bottom-e)}this.tops=t,this.bottoms=r}leftToIndex(e){let{lefts:t,rights:r}=this,i=t.length,o;for(o=0;o<i;o+=1)if(e>=t[o]&&e<r[o])return o}topToIndex(e){let{tops:t,bottoms:r}=this,i=t.length,o;for(o=0;o<i;o+=1)if(e>=t[o]&&e<r[o])return o}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return Al(this.tops||[],e.tops||[])&&Al(this.bottoms||[],e.bottoms||[])&&Al(this.lefts||[],e.lefts||[])&&Al(this.rights||[],e.rights||[])}}function Al(n,e){const t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(Math.round(n[r])!==Math.round(e[r]))return!1;return!0}class Pp{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}}class sO extends Pp{constructor(e){super(),this.el=e}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(e){this.el.scrollTop=e}setScrollLeft(e){this.el.scrollLeft=e}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}}class aO extends Pp{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(e){window.scroll(window.scrollX,e)}setScrollLeft(e){window.scroll(e,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}}class ur extends ze{constructor(){super(...arguments),this.uid=To()}prepareHits(){}queryHit(e,t,r,i){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!Kt(e,".fc-event-mirror")}isValidDateDownEl(e){return!Kt(e,".fc-event:not(.fc-bg-event)")&&!Kt(e,".fc-more-link")&&!Kt(e,"a[data-navlink]")&&!Kt(e,".fc-popover")}}class Xw{constructor(e=t=>t.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let r of e)this.insertEntry(r,t);return t}insertEntry(e,t){let r=this.findInsertion(e);this.isInsertionValid(r,e)?this.insertEntryAt(e,r):this.handleInvalidInsertion(r,e,t)}isInsertionValid(e,t){return(this.maxCoord===-1||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(this.maxStackCnt===-1||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,r){if(this.allowReslicing&&e.touchingEntry){const i=Object.assign(Object.assign({},t),{span:Np(t.span,e.touchingEntry.span)});r.push(i),this.splitEntry(t,e.touchingEntry,r)}else r.push(t)}splitEntry(e,t,r){let i=e.span,o=t.span;i.start<o.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:i.start,end:o.start}},r),i.end>o.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:o.end,end:i.end}},r)}insertEntryAt(e,t){let{entriesByLevel:r,levelCoords:i}=this;t.lateral===-1?(qd(i,t.level,t.levelCoord),qd(r,t.level,[e])):qd(r[t.level],t.lateral,e),this.stackCnts[vo(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:r,strictOrder:i,stackCnts:o}=this,s=t.length,a=0,l=-1,u=-1,c=null,d=0;for(let p=0;p<s;p+=1){const g=t[p];if(!i&&g>=a+this.getEntryThickness(e))break;let m=r[p],v,y=lf(m,e.span.start,af),b=y[0]+y[1];for(;(v=m[b])&&v.span.start<e.span.end;){let x=g+this.getEntryThickness(v);x>a&&(a=x,c=v,l=p,u=b),x===a&&(d=Math.max(d,o[vo(v)]+1)),b+=1}}let h=0;if(c)for(h=l+1;h<s&&t[h]<a;)h+=1;let f=-1;return h<s&&t[h]===a&&(f=lf(r[h],e.span.end,af)[0]),{touchingLevel:l,touchingLateral:u,touchingEntry:c,stackCnt:d,levelCoord:a,level:h,lateral:f}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,r=e.length,i=[];for(let o=0;o<r;o+=1){let s=e[o],a=t[o];for(let l of s)i.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:a}))}return i}}function af(n){return n.span.end}function vo(n){return n.index+":"+n.span.start}function lO(n){let e=[];for(let t of n){let r=[],i={span:t.span,entries:[t]};for(let o of e)Np(o.span,i.span)?i={entries:o.entries.concat(i.entries),span:uO(o.span,i.span)}:r.push(o);r.push(i),e=r}return e}function uO(n,e){return{start:Math.min(n.start,e.start),end:Math.max(n.end,e.end)}}function Np(n,e){let t=Math.max(n.start,e.start),r=Math.min(n.end,e.end);return t<r?{start:t,end:r}:null}function qd(n,e,t){n.splice(e,0,t)}function lf(n,e,t){let r=0,i=n.length;if(!i||e<t(n[r]))return[0,0];if(e>t(n[i-1]))return[i,0];for(;r<i;){let o=Math.floor(r+(i-r)/2),s=t(n[o]);if(e<s)i=o;else if(e>s)r=o+1;else return[o,1]}return[r,0]}class cO{constructor(e,t){this.emitter=new Tc}destroy(){}setMirrorIsVisible(e){}setMirrorNeedsRevert(e){}setAutoScrollEnabled(e){}}const Fp={};function dO(n,e){return!n||e>10?tt({weekday:"short"}):e>1?tt({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):tt({weekday:"long"})}const Kw="fc-col-header-cell";function Qw(n){return n.text}class hO extends ze{render(){let{dateEnv:e,options:t,theme:r,viewApi:i}=this.context,{props:o}=this,{date:s,dateProfile:a}=o,l=Mp(s,o.todayRange,null,a),u=[Kw].concat(Ic(l,r)),c=e.format(s,o.dayHeaderFormat),d=!l.isDisabled&&o.colCnt>1?Cs(this.context,s):{},h=e.toDate(s);e.namedTimeZoneImpl&&(h=Mi(h,36e5));let f=Object.assign(Object.assign(Object.assign({date:h,view:i},o.extraRenderProps),{text:c}),l);return O(rn,{elTag:"th",elClasses:u,elAttrs:Object.assign({role:"columnheader",colSpan:o.colSpan,"data-date":l.isDisabled?void 0:Xa(s)},o.extraDataAttrs),renderProps:f,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:Qw,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},p=>O("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&O(p,{elTag:"a",elAttrs:d,elClasses:["fc-col-header-cell-cushion",o.isSticky&&"fc-sticky"]})))}}const fO=tt({weekday:"long"});class pO extends ze{render(){let{props:e}=this,{dateEnv:t,theme:r,viewApi:i,options:o}=this.context,s=St(new Date(2592e5),e.dow),a={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=t.format(s,e.dayHeaderFormat),u=Object.assign(Object.assign(Object.assign(Object.assign({date:s},a),{view:i}),e.extraRenderProps),{text:l});return O(rn,{elTag:"th",elClasses:[Kw,...Ic(a,r),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:u,generatorName:"dayHeaderContent",customGenerator:o.dayHeaderContent,defaultGenerator:Qw,classNameGenerator:o.dayHeaderClassNames,didMount:o.dayHeaderDidMount,willUnmount:o.dayHeaderWillUnmount},c=>O("div",{className:"fc-scrollgrid-sync-inner"},O(c,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(s,fO)}})))}}class Jw extends ze{constructor(){super(...arguments),this.createDayHeaderFormatter=ge(gO)}render(){let{context:e}=this,{dates:t,dateProfile:r,datesRepDistinctDays:i,renderIntro:o}=this.props,s=this.createDayHeaderFormatter(e.options.dayHeaderFormat,i,t.length);return O(Mo,{unit:"day"},(a,l)=>O("tr",{role:"row"},o&&o("day"),t.map(u=>i?O(hO,{key:u.toISOString(),date:u,dateProfile:r,todayRange:l,colCnt:t.length,dayHeaderFormat:s}):O(pO,{key:u.getUTCDay(),dow:u.getUTCDay(),dayHeaderFormat:s}))))}}function gO(n,e,t){return n||dO(e,t)}class Zw{constructor(e,t){let r=e.start,{end:i}=e,o=[],s=[],a=-1;for(;r<i;)t.isHiddenDay(r)?o.push(a+.5):(a+=1,o.push(a),s.push(r)),r=St(r,1);this.dates=s,this.indices=o,this.cnt=s.length}sliceRange(e){let t=this.getDateDayIndex(e.start),r=this.getDateDayIndex(St(e.end,-1)),i=Math.max(0,t),o=Math.min(this.cnt-1,r);return i=Math.ceil(i),o=Math.floor(o),i<=o?{firstIndex:i,lastIndex:o,isStart:t===i,isEnd:r===o}:null}getDateDayIndex(e){let{indices:t}=this,r=Math.floor(Bi(this.dates[0],e));return r<0?t[0]-1:r>=t.length?t[t.length-1]+1:t[r]}}class e1{constructor(e,t){let{dates:r}=e,i,o,s;if(t){for(o=r[0].getUTCDay(),i=1;i<r.length&&r[i].getUTCDay()!==o;i+=1);s=Math.ceil(r.length/i)}else s=1,i=r.length;this.rowCnt=s,this.colCnt=i,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let r=[];for(let i=0;i<this.colCnt;i+=1)r.push(this.buildCell(t,i));e.push(r)}return e}buildCell(e,t){let r=this.daySeries.dates[e*this.colCnt+t];return{key:r.toISOString(),date:r}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,r=this.daySeries.sliceRange(e),i=[];if(r){let{firstIndex:o,lastIndex:s}=r,a=o;for(;a<=s;){let l=Math.floor(a/t),u=Math.min((l+1)*t,s+1);i.push({row:l,firstCol:a%t,lastCol:(u-1)%t,isStart:r.isStart&&a===o,isEnd:r.isEnd&&u-1===s}),a=u}}return i}}class t1{constructor(){this.sliceBusinessHours=ge(this._sliceBusinessHours),this.sliceDateSelection=ge(this._sliceDateSpan),this.sliceEventStore=ge(this._sliceEventStore),this.sliceEventDrag=ge(this._sliceInteraction),this.sliceEventResize=ge(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,r,i,...o){let{eventUiBases:s}=e,a=this.sliceEventStore(e.eventStore,s,t,r,...o);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,r,s,i,...o),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,r,i,...o),fgEventSegs:a.fg,bgEventSegs:a.bg,eventDrag:this.sliceEventDrag(e.eventDrag,s,t,r,...o),eventResize:this.sliceEventResize(e.eventResize,s,t,r,...o),eventSelection:e.eventSelection}}sliceNowDate(e,t,r,i,...o){return this._sliceDateSpan({range:{start:e,end:Mi(e,1)},allDay:!1},t,r,{},i,...o)}_sliceBusinessHours(e,t,r,i,...o){return e?this._sliceEventStore(Eo(e,kl(t,!!r),i),{},t,r,...o).bg:[]}_sliceEventStore(e,t,r,i,...o){if(e){let s=of(e,t,kl(r,!!i),i);return{bg:this.sliceEventRanges(s.bg,o),fg:this.sliceEventRanges(s.fg,o)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,r,i,...o){if(!e)return null;let s=of(e.mutatedEvents,t,kl(r,!!i),i);return{segs:this.sliceEventRanges(s.fg,o),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,r,i,o,...s){if(!e)return[];let a=kl(t,!!r),l=Oi(e.range,a);if(l){e=Object.assign(Object.assign({},e),{range:l});let u=LM(e,i,o),c=this.sliceRange(e.range,...s);for(let d of c)d.eventRange=u;return c}return[]}sliceEventRanges(e,t){let r=[];for(let i of e)r.push(...this.sliceEventRange(i,t));return r}sliceEventRange(e,t){let r=e.range;this.forceDayIfListItem&&e.ui.display==="list-item"&&(r={start:r.start,end:St(r.start,1)});let i=this.sliceRange(r,...t);for(let o of i)o.eventRange=e,o.isStart=e.isStart&&o.isStart,o.isEnd=e.isEnd&&o.isEnd;return i}}function kl(n,e){let t=n.activeRange;return e?t:{start:Mi(t.start,n.slotMinTime.milliseconds),end:Mi(t.end,n.slotMaxTime.milliseconds-864e5)}}function n1(n,e,t){let{instances:r}=n.mutatedEvents;for(let i in r)if(!kc(e.validRange,r[i].range))return!1;return r1({eventDrag:n},t)}function mO(n,e,t){return kc(e.validRange,n.range)?r1({dateSelection:n},t):!1}function r1(n,e){let t=e.getCurrentData(),r=Object.assign({businessHours:t.businessHours,dateSelection:"",eventStore:t.eventStore,eventUiBases:t.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},n);return(e.pluginHooks.isPropsValid||vO)(r,e)}function vO(n,e,t={},r){return!(n.eventDrag&&!yO(n,e,t,r)||n.dateSelection&&!bO(n,e,t,r))}function yO(n,e,t,r){let i=e.getCurrentData(),o=n.eventDrag,s=o.mutatedEvents,a=s.defs,l=s.instances,u=Bu(a,o.isEvent?n.eventUiBases:{"":i.selectionConfig});r&&(u=ei(u,r));let c=gM(n.eventStore,o.affectedEvents.instances),d=c.defs,h=c.instances,f=Bu(d,n.eventUiBases);for(let p in l){let g=l[p],m=g.range,v=u[g.defId],y=a[g.defId];if(!i1(v.constraints,m,c,n.businessHours,e))return!1;let{eventOverlap:b}=e.options,x=typeof b=="function"?b:null;for(let _ in h){let C=h[_];if(wp(m,C.range)&&(f[C.defId].overlap===!1&&o.isEvent||v.overlap===!1||x&&!x(new ut(e,d[C.defId],C),new ut(e,y,g))))return!1}let w=i.eventStore;for(let _ of v.allows){let C=Object.assign(Object.assign({},t),{range:g.range,allDay:y.allDay}),E=w.defs[y.defId],S=w.instances[p],D;if(E?D=new ut(e,E,S):D=new ut(e,y),!_(Ap(C,e),D))return!1}}return!0}function bO(n,e,t,r){let i=n.eventStore,o=i.defs,s=i.instances,a=n.dateSelection,l=a.range,{selectionConfig:u}=e.getCurrentData();if(r&&(u=r(u)),!i1(u.constraints,l,i,n.businessHours,e))return!1;let{selectOverlap:c}=e.options,d=typeof c=="function"?c:null;for(let h in s){let f=s[h];if(wp(l,f.range)&&(u.overlap===!1||d&&!d(new ut(e,o[f.defId],f),null)))return!1}for(let h of u.allows){let f=Object.assign(Object.assign({},t),a);if(!h(Ap(f,e),null))return!1}return!0}function i1(n,e,t,r,i){for(let o of n)if(!wO(xO(o,e,t,r,i),e))return!1;return!0}function xO(n,e,t,r,i){return n==="businessHours"?Yd(Eo(r,e,i)):typeof n=="string"?Yd(Rc(t,o=>o.groupId===n)):typeof n=="object"&&n?Yd(Eo(n,e,i)):[]}function Yd(n){let{instances:e}=n,t=[];for(let r in e)t.push(e[r].range);return t}function wO(n,e){for(let t of n)if(kc(t,e))return!0;return!1}const Rl=/^(visible|hidden)$/;class o1 extends ze{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,Ir(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:r}=e,i=t&&r,o=["fc-scroller"];return t&&(r?o.push("fc-scroller-liquid-absolute"):o.push("fc-scroller-liquid")),O("div",{ref:this.handleEl,className:o.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:i&&-(e.overcomeLeft||0)||"",right:i&&-(e.overcomeRight||0)||"",bottom:i&&-(e.overcomeBottom||0)||"",marginLeft:!i&&-(e.overcomeLeft||0)||"",marginRight:!i&&-(e.overcomeRight||0)||"",marginBottom:!i&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(Rl.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:r}=e;for(let i=0;i<r.length;i+=1)if(r[i].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(Rl.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:r}=e;for(let i=0;i<r.length;i+=1)if(r[i].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return Rl.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return Rl.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}}class Yr{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(t,r)=>{let{depths:i,currentMap:o}=this,s=!1,a=!1;t!==null?(s=r in o,o[r]=t,i[r]=(i[r]||0)+1,a=!0):(i[r]-=1,i[r]||(delete o[r],delete this.callbackMap[r],s=!0)),this.masterCallback&&(s&&this.masterCallback(null,String(r)),a&&this.masterCallback(t,String(r)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=r=>{this.handleValue(r,String(e))}),t}collect(e,t,r){return OI(this.currentMap,e,t,r)}getAll(){return bp(this.currentMap)}}function _O(n){let e=IT(n,".fc-scrollgrid-shrink"),t=0;for(let r of e)t=Math.max(t,$T(r));return Math.ceil(t)}function s1(n,e){return n.liquid&&e.liquid}function CO(n,e){return e.maxHeight!=null||s1(n,e)}function EO(n,e,t,r){let{expandRows:i}=t;return typeof e.content=="function"?e.content(t):O("table",{role:"presentation",className:[e.tableClassName,n.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:i?t.clientHeight:""}},t.tableColGroupNode,O(r?"thead":"tbody",{role:"presentation"},typeof e.rowContent=="function"?e.rowContent(t):e.rowContent))}function SO(n,e){return Ii(n,e,ar)}function DO(n,e){let t=[];for(let r of n){let i=r.span||1;for(let o=0;o<i;o+=1)t.push(O("col",{style:{width:r.width==="shrink"?AO(e):r.width||"",minWidth:r.minWidth||""}}))}return O("colgroup",{},...t)}function AO(n){return n??4}function kO(n){for(let e of n)if(e.width==="shrink")return!0;return!1}function RO(n,e){let t=["fc-scrollgrid",e.theme.getClass("table")];return n&&t.push("fc-scrollgrid-liquid"),t}function TO(n,e){let t=["fc-scrollgrid-section",`fc-scrollgrid-section-${n.type}`,n.className];return e&&n.liquid&&n.maxHeight==null&&t.push("fc-scrollgrid-section-liquid"),n.isSticky&&t.push("fc-scrollgrid-section-sticky"),t}function uf(n){return O("div",{className:"fc-scrollgrid-sticky-shim",style:{width:n.clientWidth,minWidth:n.tableMinWidth}})}function Hu(n){let{stickyHeaderDates:e}=n;return(e==null||e==="auto")&&(e=n.height==="auto"||n.viewHeight==="auto"),e}function a1(n){let{stickyFooterScrollbar:e}=n;return(e==null||e==="auto")&&(e=n.height==="auto"||n.viewHeight==="auto"),e}class Lp extends ze{constructor(){super(...arguments),this.processCols=ge(e=>e,SO),this.renderMicroColGroup=ge(DO),this.scrollerRefs=new Yr,this.scrollerElRefs=new Yr(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:r}=this,i=e.sections||[],o=this.processCols(e.cols),s=this.renderMicroColGroup(o,t.shrinkWidth),a=RO(e.liquid,r);e.collapsibleWidth&&a.push("fc-scrollgrid-collapsible");let l=i.length,u=0,c,d=[],h=[],f=[];for(;u<l&&(c=i[u]).type==="header";)d.push(this.renderSection(c,s,!0)),u+=1;for(;u<l&&(c=i[u]).type==="body";)h.push(this.renderSection(c,s,!1)),u+=1;for(;u<l&&(c=i[u]).type==="footer";)f.push(this.renderSection(c,s,!0)),u+=1;let p=!$w();const g={role:"rowgroup"};return O("table",{role:"grid",className:a.join(" "),style:{height:e.height}},!!(!p&&d.length)&&O("thead",g,...d),!!(!p&&h.length)&&O("tbody",g,...h),!!(!p&&f.length)&&O("tfoot",g,...f),p&&O("tbody",g,...d,...h,...f))}renderSection(e,t,r){return"outerContent"in e?O(Ge,{key:e.key},e.outerContent):O("tr",{key:e.key,role:"presentation",className:TO(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,r))}renderChunkTd(e,t,r,i){if("outerContent"in r)return r.outerContent;let{props:o}=this,{forceYScrollbars:s,scrollerClientWidths:a,scrollerClientHeights:l}=this.state,u=CO(o,e),c=s1(o,e),d=o.liquid?s?"scroll":u?"auto":"hidden":"visible",h=e.key,f=EO(e,r,{tableColGroupNode:t,tableMinWidth:"",clientWidth:!o.collapsibleWidth&&a[h]!==void 0?a[h]:null,clientHeight:l[h]!==void 0?l[h]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},i);return O(i?"th":"td",{ref:r.elRef,role:"presentation"},O("div",{className:`fc-scroller-harness${c?" fc-scroller-harness-liquid":""}`},O(o1,{ref:this.scrollerRefs.createRef(h),elRef:this.scrollerElRefs.createRef(h),overflowY:d,overflowX:o.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:c,liquidIsAbsolute:!0},f)))}_handleScrollerEl(e,t){let r=IO(this.props.sections,t);r&&Ir(r.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return kO(this.props.cols)?_O(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=tO(),{scrollerRefs:t,scrollerElRefs:r}=this,i=!1,o={},s={};for(let a in t.currentMap){let l=t.currentMap[a];if(l&&l.needsYScrolling()){i=!0;break}}for(let a of this.props.sections){let l=a.key,u=r.currentMap[l];if(u){let c=u.parentNode;o[l]=Math.floor(c.getBoundingClientRect().width-(i?e.y:0)),s[l]=Math.floor(c.getBoundingClientRect().height)}}return{forceYScrollbars:i,scrollerClientWidths:o,scrollerClientHeights:s}}}Lp.addStateEquality({scrollerClientWidths:ar,scrollerClientHeights:ar});function IO(n,e){for(let t of n)if(t.key===e)return t;return null}class Mc extends ze{constructor(){super(...arguments),this.buildPublicEvent=ge((e,t,r)=>new ut(e,t,r)),this.handleEl=e=>{this.el=e,Ir(this.props.elRef,e),e&&ey(e,this.props.seg)}}render(){const{props:e,context:t}=this,{options:r}=t,{seg:i}=e,{eventRange:o}=i,{ui:s}=o,a={event:this.buildPublicEvent(t,o.def,o.instance),view:t.viewApi,timeText:e.timeText,textColor:s.textColor,backgroundColor:s.backgroundColor,borderColor:s.borderColor,isDraggable:!e.disableDragging&&AM(i,t),isStartResizable:!e.disableResizing&&kM(i,t),isEndResizable:!e.disableResizing&&RM(i),isMirror:!!(e.isDragging||e.isResizing||e.isDateSelecting),isStart:!!i.isStart,isEnd:!!i.isEnd,isPast:!!e.isPast,isFuture:!!e.isFuture,isToday:!!e.isToday,isSelected:!!e.isSelected,isDragging:!!e.isDragging,isResizing:!!e.isResizing};return O(rn,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...TM(a),...i.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:a,generatorName:"eventContent",customGenerator:r.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:r.eventClassNames,didMount:r.eventDidMount,willUnmount:r.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&ey(this.el,this.props.seg)}}class Bp extends ze{render(){let{props:e,context:t}=this,{options:r}=t,{seg:i}=e,{ui:o}=i.eventRange,s=r.eventTimeFormat||e.defaultTimeFormat,a=da(i,s,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return O(Mc,Object.assign({},e,{elTag:"a",elStyle:{borderColor:o.borderColor,backgroundColor:o.backgroundColor},elAttrs:Tp(i,t),defaultGenerator:MO,timeText:a}),(l,u)=>O(Ge,null,O(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:u.textColor}}),!!u.isStartResizable&&O("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!u.isEndResizable&&O("div",{className:"fc-event-resizer fc-event-resizer-end"})))}}Bp.addPropsEquality({seg:ar});function MO(n){return O("div",{className:"fc-event-main-frame"},n.timeText&&O("div",{className:"fc-event-time"},n.timeText),O("div",{className:"fc-event-title-container"},O("div",{className:"fc-event-title fc-sticky"},n.event.title||O(Ge,null," "))))}const Hp=n=>O(ti.Consumer,null,e=>{let{options:t}=e,r={isAxis:n.isAxis,date:e.dateEnv.toDate(n.date),view:e.viewApi};return O(rn,{elRef:n.elRef,elTag:n.elTag||"div",elAttrs:n.elAttrs,elClasses:n.elClasses,elStyle:n.elStyle,renderProps:r,generatorName:"nowIndicatorContent",customGenerator:t.nowIndicatorContent,classNameGenerator:t.nowIndicatorClassNames,didMount:t.nowIndicatorDidMount,willUnmount:t.nowIndicatorWillUnmount},n.children)}),OO=tt({day:"numeric"});class Wp extends ze{constructor(){super(...arguments),this.refineRenderProps=pu(PO)}render(){let{props:e,context:t}=this,{options:r}=t,i=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:r.monthStartFormat});return O(rn,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),i.isDisabled?{}:{"data-date":Xa(e.date)}),elClasses:[...Ic(i,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:i,generatorName:"dayCellContent",customGenerator:r.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:i.isDisabled?void 0:r.dayCellClassNames,didMount:r.dayCellDidMount,willUnmount:r.dayCellWillUnmount},e.children)}}function zp(n){return!!(n.dayCellContent||tf("dayCellContent",n))}function PO(n){let{date:e,dateEnv:t,dateProfile:r,isMonthStart:i}=n,o=Mp(e,n.todayRange,null,r),s=n.showDayNumber?t.format(e,i?n.monthStartFormat:OO):"";return Object.assign(Object.assign(Object.assign({date:t.toDate(e),view:n.viewApi},o),{isMonthStart:i,dayNumberText:s}),n.extraRenderProps)}class l1 extends ze{render(){let{props:e}=this,{seg:t}=e;return O(Mc,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:NO,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}}function NO(n){let{title:e}=n.event;return e&&O("div",{className:"fc-event-title"},n.event.title)}function u1(n){return O("div",{className:`fc-${n}`})}const c1=n=>O(ti.Consumer,null,e=>{let{dateEnv:t,options:r}=e,{date:i}=n,o=r.weekNumberFormat||n.defaultFormat,s=t.computeWeekNumber(i),a=t.format(i,o),l={num:s,text:a,date:i};return O(rn,{elRef:n.elRef,elTag:n.elTag,elAttrs:n.elAttrs,elClasses:n.elClasses,elStyle:n.elStyle,renderProps:l,generatorName:"weekNumberContent",customGenerator:r.weekNumberContent,defaultGenerator:FO,classNameGenerator:r.weekNumberClassNames,didMount:r.weekNumberDidMount,willUnmount:r.weekNumberWillUnmount},n.children)});function FO(n){return n.text}const Xd=10;class LO extends ze{constructor(){super(...arguments),this.state={titleId:Di()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&Ir(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{const t=vw(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{e.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:r,state:i}=this,o=["fc-popover",e.getClass("popover")].concat(r.extraClassNames||[]);return vT(O("div",Object.assign({},r.extraAttrs,{id:r.id,className:o.join(" "),"aria-labelledby":i.titleId,ref:this.handleRootEl}),O("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},O("span",{className:"fc-popover-title",id:i.titleId},r.title),O("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),O("div",{className:"fc-popover-body "+e.getClass("popoverContent")},r.children)),r.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:r}=this.props,{rootEl:i}=this,o=oO(t);if(o){let s=i.getBoundingClientRect(),a=r?Kt(t,".fc-scrollgrid").getBoundingClientRect().top:o.top,l=e?o.right-s.width:o.left;a=Math.max(a,Xd),l=Math.min(l,document.documentElement.clientWidth-Xd-s.width),l=Math.max(l,Xd);let u=i.offsetParent.getBoundingClientRect();la(i,{top:a-u.top,left:l-u.left})}}}class BO extends ur{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:r}=this,{startDate:i,todayRange:o,dateProfile:s}=r,a=t.format(i,e.dayPopoverFormat);return O(Wp,{elRef:this.handleRootEl,date:i,dateProfile:s,todayRange:o},(l,u,c)=>O(LO,{elRef:c.ref,id:r.id,title:a,extraClassNames:["fc-more-popover"].concat(c.className||[]),extraAttrs:c,parentEl:r.parentEl,alignmentEl:r.alignmentEl,alignGridTop:r.alignGridTop,onClose:r.onClose},zp(e)&&O(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),r.children))}queryHit(e,t,r,i){let{rootEl:o,props:s}=this;return e>=0&&e<r&&t>=0&&t<i?{dateProfile:s.dateProfile,dateSpan:Object.assign({allDay:!s.forceTimed,range:{start:s.startDate,end:s.endDate}},s.extraDateSpan),dayEl:o,rect:{left:0,top:0,right:r,bottom:i},layer:1}:null}}class d1 extends ze{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:Di()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&Ir(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:r}=this,{moreLinkClick:i}=r.options,o=ny(t).start;function s(a){let{def:l,instance:u,range:c}=a.eventRange;return{event:new ut(r,l,u),start:r.dateEnv.toDate(c.start),end:r.dateEnv.toDate(c.end),isStart:a.isStart,isEnd:a.isEnd}}typeof i=="function"&&(i=i({date:o,allDay:!!t.allDayDate,allSegs:t.allSegs.map(s),hiddenSegs:t.hiddenSegs.map(s),jsEvent:e,view:r.viewApi})),!i||i==="popover"?this.setState({isPopoverOpen:!0}):typeof i=="string"&&r.calendarApi.zoomTo(o,i)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return O(ti.Consumer,null,r=>{let{viewApi:i,options:o,calendarApi:s}=r,{moreLinkText:a}=o,{moreCnt:l}=e,u=ny(e),c=typeof a=="function"?a.call(s,l):`+${l} ${a}`,d=ua(o.moreLinkHint,[l],c),h={num:l,shortText:`+${l}`,text:c,view:i};return O(Ge,null,!!e.moreCnt&&O(rn,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),bw(this.handleClick)),{title:d,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:h,generatorName:"moreLinkContent",customGenerator:o.moreLinkContent,defaultGenerator:e.defaultGenerator||HO,classNameGenerator:o.moreLinkClassNames,didMount:o.moreLinkDidMount,willUnmount:o.moreLinkWillUnmount},e.children),t.isPopoverOpen&&O(BO,{id:t.popoverId,startDate:u.start,endDate:u.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=Kt(this.linkEl,".fc-view-harness"))}}function HO(n){return n.text}function ny(n){if(n.allDayDate)return{start:n.allDayDate,end:St(n.allDayDate,1)};let{hiddenSegs:e}=n;return{start:h1(e),end:zO(e)}}function h1(n){return n.reduce(WO).eventRange.range.start}function WO(n,e){return n.eventRange.range.start<e.eventRange.range.start?n:e}function zO(n){return n.reduce(VO).eventRange.range.end}function VO(n,e){return n.eventRange.range.end>e.eventRange.range.end?n:e}const UO=[],f1={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},p1=Object.assign(Object.assign({},f1),{buttonHints:{prev:"Previous $0",next:"Next $0",today(n,e){return e==="day"?"Today":`This ${n}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(n){return`Show ${n} more event${n===1?"":"s"}`}});function jO(n){let e=n.length>0?n[0].code:"en",t=UO.concat(n),r={en:p1};for(let i of t)r[i.code]=i;return{map:r,defaultCode:e}}function g1(n,e){return typeof n=="object"&&!Array.isArray(n)?m1(n.code,[n.code],n):$O(n,e)}function $O(n,e){let t=[].concat(n||[]),r=GO(t,e)||p1;return m1(n,t,r)}function GO(n,e){for(let t=0;t<n.length;t+=1){let r=n[t].toLocaleLowerCase().split("-");for(let i=r.length;i>0;i-=1){let o=r.slice(0,i).join("-");if(e[o])return e[o]}}return null}function m1(n,e,t){let r=yp([f1,t],["buttonText"]);delete r.code;let{week:i}=r;return delete r.week,{codeArg:n,codes:e,week:i,simpleNumberFormat:new Intl.NumberFormat(n),options:r}}function Pr(n){return{id:To(),name:n.name,premiumReleaseDate:n.premiumReleaseDate?new Date(n.premiumReleaseDate):void 0,deps:n.deps||[],reducers:n.reducers||[],isLoadingFuncs:n.isLoadingFuncs||[],contextInit:[].concat(n.contextInit||[]),eventRefiners:n.eventRefiners||{},eventDefMemberAdders:n.eventDefMemberAdders||[],eventSourceRefiners:n.eventSourceRefiners||{},isDraggableTransformers:n.isDraggableTransformers||[],eventDragMutationMassagers:n.eventDragMutationMassagers||[],eventDefMutationAppliers:n.eventDefMutationAppliers||[],dateSelectionTransformers:n.dateSelectionTransformers||[],datePointTransforms:n.datePointTransforms||[],dateSpanTransforms:n.dateSpanTransforms||[],views:n.views||{},viewPropsTransformers:n.viewPropsTransformers||[],isPropsValid:n.isPropsValid||null,externalDefTransforms:n.externalDefTransforms||[],viewContainerAppends:n.viewContainerAppends||[],eventDropTransformers:n.eventDropTransformers||[],componentInteractions:n.componentInteractions||[],calendarInteractions:n.calendarInteractions||[],themeClasses:n.themeClasses||{},eventSourceDefs:n.eventSourceDefs||[],cmdFormatter:n.cmdFormatter,recurringTypes:n.recurringTypes||[],namedTimeZonedImpl:n.namedTimeZonedImpl,initialView:n.initialView||"",elementDraggingImpl:n.elementDraggingImpl,optionChangeHandlers:n.optionChangeHandlers||{},scrollGridImpl:n.scrollGridImpl||null,listenerRefiners:n.listenerRefiners||{},optionRefiners:n.optionRefiners||{},propSetHandlers:n.propSetHandlers||{}}}function qO(n,e){let t={},r={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function i(o){for(let s of o){const a=s.name,l=t[a];l===void 0?(t[a]=s.id,i(s.deps),r=XO(r,s)):l!==s.id&&console.warn(`Duplicate plugin '${a}'`)}}return n&&i(n),i(e),r}function YO(){let n=[],e=[],t;return(r,i)=>((!t||!Ii(r,n)||!Ii(i,e))&&(t=qO(r,i)),n=r,e=i,t)}function XO(n,e){return{premiumReleaseDate:KO(n.premiumReleaseDate,e.premiumReleaseDate),reducers:n.reducers.concat(e.reducers),isLoadingFuncs:n.isLoadingFuncs.concat(e.isLoadingFuncs),contextInit:n.contextInit.concat(e.contextInit),eventRefiners:Object.assign(Object.assign({},n.eventRefiners),e.eventRefiners),eventDefMemberAdders:n.eventDefMemberAdders.concat(e.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},n.eventSourceRefiners),e.eventSourceRefiners),isDraggableTransformers:n.isDraggableTransformers.concat(e.isDraggableTransformers),eventDragMutationMassagers:n.eventDragMutationMassagers.concat(e.eventDragMutationMassagers),eventDefMutationAppliers:n.eventDefMutationAppliers.concat(e.eventDefMutationAppliers),dateSelectionTransformers:n.dateSelectionTransformers.concat(e.dateSelectionTransformers),datePointTransforms:n.datePointTransforms.concat(e.datePointTransforms),dateSpanTransforms:n.dateSpanTransforms.concat(e.dateSpanTransforms),views:Object.assign(Object.assign({},n.views),e.views),viewPropsTransformers:n.viewPropsTransformers.concat(e.viewPropsTransformers),isPropsValid:e.isPropsValid||n.isPropsValid,externalDefTransforms:n.externalDefTransforms.concat(e.externalDefTransforms),viewContainerAppends:n.viewContainerAppends.concat(e.viewContainerAppends),eventDropTransformers:n.eventDropTransformers.concat(e.eventDropTransformers),calendarInteractions:n.calendarInteractions.concat(e.calendarInteractions),componentInteractions:n.componentInteractions.concat(e.componentInteractions),themeClasses:Object.assign(Object.assign({},n.themeClasses),e.themeClasses),eventSourceDefs:n.eventSourceDefs.concat(e.eventSourceDefs),cmdFormatter:e.cmdFormatter||n.cmdFormatter,recurringTypes:n.recurringTypes.concat(e.recurringTypes),namedTimeZonedImpl:e.namedTimeZonedImpl||n.namedTimeZonedImpl,initialView:n.initialView||e.initialView,elementDraggingImpl:n.elementDraggingImpl||e.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},n.optionChangeHandlers),e.optionChangeHandlers),scrollGridImpl:e.scrollGridImpl||n.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},n.listenerRefiners),e.listenerRefiners),optionRefiners:Object.assign(Object.assign({},n.optionRefiners),e.optionRefiners),propSetHandlers:Object.assign(Object.assign({},n.propSetHandlers),e.propSetHandlers)}}function KO(n,e){return n===void 0?e:e===void 0?n:new Date(Math.max(n.valueOf(),e.valueOf()))}class Hi extends Ka{}Hi.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};Hi.prototype.baseIconClass="fc-icon";Hi.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};Hi.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};Hi.prototype.iconOverrideOption="buttonIcons";Hi.prototype.iconOverrideCustomButtonOption="icon";Hi.prototype.iconOverridePrefix="fc-icon-";function QO(n,e){let t={},r;for(r in n)cf(r,t,n,e);for(r in e)cf(r,t,n,e);return t}function cf(n,e,t,r){if(e[n])return e[n];let i=JO(n,e,t,r);return i&&(e[n]=i),i}function JO(n,e,t,r){let i=t[n],o=r[n],s=c=>i&&i[c]!==null?i[c]:o&&o[c]!==null?o[c]:null,a=s("component"),l=s("superType"),u=null;if(l){if(l===n)throw new Error("Can't have a custom view type that references itself");u=cf(l,e,t,r)}return!a&&u&&(a=u.component),a?{type:n,component:a,defaults:Object.assign(Object.assign({},u?u.defaults:{}),i?i.rawOptions:{}),overrides:Object.assign(Object.assign({},u?u.overrides:{}),o?o.rawOptions:{})}:null}function ry(n){return ei(n,ZO)}function ZO(n){let e=typeof n=="function"?{component:n}:n,{component:t}=e;return e.content?t=iy(e):t&&!(t.prototype instanceof ze)&&(t=iy(Object.assign(Object.assign({},e),{content:t}))),{superType:e.type,component:t,rawOptions:e}}function iy(n){return e=>O(ti.Consumer,null,t=>O(rn,{elTag:"div",elClasses:kw(t.viewSpec),renderProps:Object.assign(Object.assign({},e),{nextDayThreshold:t.options.nextDayThreshold}),generatorName:void 0,customGenerator:n.content,classNameGenerator:n.classNames,didMount:n.didMount,willUnmount:n.willUnmount}))}function eP(n,e,t,r){let i=ry(n),o=ry(e.views),s=QO(i,o);return ei(s,a=>tP(a,o,e,t,r))}function tP(n,e,t,r,i){let o=n.overrides.duration||n.defaults.duration||r.duration||t.duration,s=null,a="",l="",u={};if(o&&(s=nP(o),s)){let h=ef(s);a=h.unit,h.value===1&&(l=a,u=e[a]?e[a].rawOptions:{})}let c=h=>{let f=h.buttonText||{},p=n.defaults.buttonTextKey;return p!=null&&f[p]!=null?f[p]:f[n.type]!=null?f[n.type]:f[l]!=null?f[l]:null},d=h=>{let f=h.buttonHints||{},p=n.defaults.buttonTextKey;return p!=null&&f[p]!=null?f[p]:f[n.type]!=null?f[n.type]:f[l]!=null?f[l]:null};return{type:n.type,component:n.component,duration:s,durationUnit:a,singleUnit:l,optionDefaults:n.defaults,optionOverrides:Object.assign(Object.assign({},u),n.overrides),buttonTextOverride:c(r)||c(t)||n.overrides.buttonText,buttonTextDefault:c(i)||n.defaults.buttonText||c(ca)||n.type,buttonTitleOverride:d(r)||d(t)||n.overrides.buttonHint,buttonTitleDefault:d(i)||n.defaults.buttonHint||d(ca)}}let oy={};function nP(n){let e=JSON.stringify(n),t=oy[e];return t===void 0&&(t=Fe(n),oy[e]=t),t}function rP(n,e){switch(e.type){case"CHANGE_VIEW_TYPE":n=e.viewType}return n}function iP(n,e){switch(e.type){case"CHANGE_DATE":return e.dateMarker;default:return n}}function oP(n,e,t){let r=n.initialDate;return r!=null?e.createMarker(r):t.getDateMarker()}function sP(n,e){switch(e.type){case"SET_OPTION":return Object.assign(Object.assign({},n),{[e.optionName]:e.rawOptionValue});default:return n}}function aP(n,e,t,r){let i;switch(e.type){case"CHANGE_VIEW_TYPE":return r.build(e.dateMarker||t);case"CHANGE_DATE":return r.build(e.dateMarker);case"PREV":if(i=r.buildPrev(n,t),i.isValid)return i;break;case"NEXT":if(i=r.buildNext(n,t),i.isValid)return i;break}return n}function lP(n,e,t){let r=e?e.activeRange:null;return y1({},gP(n,t),r,t)}function uP(n,e,t,r){let i=t?t.activeRange:null;switch(e.type){case"ADD_EVENT_SOURCES":return y1(n,e.sources,i,r);case"REMOVE_EVENT_SOURCE":return dP(n,e.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return t?b1(n,i,r):n;case"FETCH_EVENT_SOURCES":return Vp(n,e.sourceIds?Cw(e.sourceIds):x1(n,r),i,e.isRefetch||!1,r);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return pP(n,e.sourceId,e.fetchId,e.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return n}}function cP(n,e,t){let r=e?e.activeRange:null;return Vp(n,x1(n,t),r,!0,t)}function v1(n){for(let e in n)if(n[e].isFetching)return!0;return!1}function y1(n,e,t,r){let i={};for(let o of e)i[o.sourceId]=o;return t&&(i=b1(i,t,r)),Object.assign(Object.assign({},n),i)}function dP(n,e){return Co(n,t=>t.sourceId!==e)}function b1(n,e,t){return Vp(n,Co(n,r=>hP(r,e,t)),e,!1,t)}function hP(n,e,t){return w1(n,t)?!t.options.lazyFetching||!n.fetchRange||n.isFetching||e.start<n.fetchRange.start||e.end>n.fetchRange.end:!n.latestFetchId}function Vp(n,e,t,r,i){let o={};for(let s in n){let a=n[s];e[s]?o[s]=fP(a,t,r,i):o[s]=a}return o}function fP(n,e,t,r){let{options:i,calendarApi:o}=r,s=r.pluginHooks.eventSourceDefs[n.sourceDefId],a=To();return s.fetch({eventSource:n,range:e,isRefetch:t,context:r},l=>{let{rawEvents:u}=l;i.eventSourceSuccess&&(u=i.eventSourceSuccess.call(o,u,l.response)||u),n.success&&(u=n.success.call(o,u,l.response)||u),r.dispatch({type:"RECEIVE_EVENTS",sourceId:n.sourceId,fetchId:a,fetchRange:e,rawEvents:u})},l=>{let u=!1;i.eventSourceFailure&&(i.eventSourceFailure.call(o,l),u=!0),n.failure&&(n.failure(l),u=!0),u||console.warn(l.message,l),r.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:n.sourceId,fetchId:a,fetchRange:e,error:l})}),Object.assign(Object.assign({},n),{isFetching:!0,latestFetchId:a})}function pP(n,e,t,r){let i=n[e];return i&&t===i.latestFetchId?Object.assign(Object.assign({},n),{[e]:Object.assign(Object.assign({},i),{isFetching:!1,fetchRange:r})}):n}function x1(n,e){return Co(n,t=>w1(t,e))}function gP(n,e){let t=Fw(e),r=[].concat(n.eventSources||[]),i=[];n.initialEvents&&r.unshift(n.initialEvents),n.events&&r.unshift(n.events);for(let o of r){let s=Nw(o,e,t);s&&i.push(s)}return i}function w1(n,e){return!e.pluginHooks.eventSourceDefs[n.sourceDefId].ignoreRange}function mP(n,e){switch(e.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return e.selection;default:return n}}function vP(n,e){switch(e.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return e.eventInstanceId;default:return n}}function yP(n,e){let t;switch(e.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return n}}function bP(n,e){let t;switch(e.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return n}}function xP(n,e,t,r,i){let o=n.headerToolbar?sy(n.headerToolbar,n,e,t,r,i):null,s=n.footerToolbar?sy(n.footerToolbar,n,e,t,r,i):null;return{header:o,footer:s}}function sy(n,e,t,r,i,o){let s={},a=[],l=!1;for(let u in n){let c=n[u],d=wP(c,e,t,r,i,o);s[u]=d.widgets,a.push(...d.viewsWithButtons),l=l||d.hasTitle}return{sectionWidgets:s,viewsWithButtons:a,hasTitle:l}}function wP(n,e,t,r,i,o){let s=e.direction==="rtl",a=e.customButtons||{},l=t.buttonText||{},u=e.buttonText||{},c=t.buttonHints||{},d=e.buttonHints||{},h=n?n.split(" "):[],f=[],p=!1;return{widgets:h.map(m=>m.split(",").map(v=>{if(v==="title")return p=!0,{buttonName:v};let y,b,x,w,_,C;if(y=a[v])x=E=>{y.click&&y.click.call(E.target,E,E.target)},(w=r.getCustomButtonIconClass(y))||(w=r.getIconClass(v,s))||(_=y.text),C=y.hint||y.text;else if(b=i[v]){f.push(v),x=()=>{o.changeView(v)},(_=b.buttonTextOverride)||(w=r.getIconClass(v,s))||(_=b.buttonTextDefault);let E=b.buttonTextOverride||b.buttonTextDefault;C=ua(b.buttonTitleOverride||b.buttonTitleDefault||e.viewHint,[E,v],E)}else if(o[v])if(x=()=>{o[v]()},(_=l[v])||(w=r.getIconClass(v,s))||(_=u[v]),v==="prevYear"||v==="nextYear"){let E=v==="prevYear"?"prev":"next";C=ua(c[E]||d[E],[u.year||"year","year"],u[v])}else C=E=>ua(c[v]||d[v],[u[E]||E,E],u[v]);return{buttonName:v,buttonClick:x,buttonIcon:w,buttonText:_,buttonHint:C}})),viewsWithButtons:f,hasTitle:p}}class _P{constructor(e,t,r){this.type=e,this.getCurrentData=t,this.dateEnv=r}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}}let CP={ignoreRange:!0,parseMeta(n){return Array.isArray(n.events)?n.events:null},fetch(n,e){e({rawEvents:n.eventSource.meta})}};const EP=Pr({name:"array-event-source",eventSourceDefs:[CP]});let SP={parseMeta(n){return typeof n.events=="function"?n.events:null},fetch(n,e,t){const{dateEnv:r}=n.context,i=n.eventSource.meta;BM(i.bind(null,Uw(n.range,r)),o=>e({rawEvents:o}),t)}};const DP=Pr({name:"func-event-source",eventSourceDefs:[SP]}),AP={method:String,extraParams:V,startParam:String,endParam:String,timeZoneParam:String};let kP={parseMeta(n){return n.url&&(n.format==="json"||!n.format)?{url:n.url,format:"json",method:(n.method||"GET").toUpperCase(),extraParams:n.extraParams,startParam:n.startParam,endParam:n.endParam,timeZoneParam:n.timeZoneParam}:null},fetch(n,e,t){const{meta:r}=n.eventSource,i=TP(r,n.range,n.context);HM(r.method,r.url,i).then(([o,s])=>{e({rawEvents:o,response:s})},t)}};const RP=Pr({name:"json-event-source",eventSourceRefiners:AP,eventSourceDefs:[kP]});function TP(n,e,t){let{dateEnv:r,options:i}=t,o,s,a,l,u={};return o=n.startParam,o==null&&(o=i.startParam),s=n.endParam,s==null&&(s=i.endParam),a=n.timeZoneParam,a==null&&(a=i.timeZoneParam),typeof n.extraParams=="function"?l=n.extraParams():l=n.extraParams||{},Object.assign(u,l),u[o]=r.formatIso(e.start),u[s]=r.formatIso(e.end),r.timeZone!=="local"&&(u[a]=r.timeZone),u}const IP={daysOfWeek:V,startTime:Fe,endTime:Fe,duration:Fe,startRecur:V,endRecur:V};let MP={parse(n,e){if(n.daysOfWeek||n.startTime||n.endTime||n.startRecur||n.endRecur){let t={daysOfWeek:n.daysOfWeek||null,startTime:n.startTime||null,endTime:n.endTime||null,startRecur:n.startRecur?e.createMarker(n.startRecur):null,endRecur:n.endRecur?e.createMarker(n.endRecur):null,dateEnv:e},r;return n.duration&&(r=n.duration),!r&&n.startTime&&n.endTime&&(r=XT(n.endTime,n.startTime)),{allDayGuess:!n.startTime&&!n.endTime,duration:r,typeData:t}}return null},expand(n,e,t){let r=Oi(e,{start:n.startRecur,end:n.endRecur});return r?PP(n.daysOfWeek,n.startTime,n.dateEnv,t,r):[]}};const OP=Pr({name:"simple-recurring-event",recurringTypes:[MP],eventRefiners:IP});function PP(n,e,t,r,i){let o=n?Cw(n):null,s=Xe(i.start),a=i.end,l=[];for(e&&(e.milliseconds<0?a=St(a,1):e.milliseconds>=1e3*60*60*24&&(s=St(s,-1)));s<a;){let u;(!o||o[s.getUTCDay()])&&(e?u=r.add(s,e):u=s,l.push(r.createMarker(t.toDate(u)))),s=St(s,1)}return l}const NP=Pr({name:"change-handler",optionChangeHandlers:{events(n,e){ay([n],e)},eventSources:ay}});function ay(n,e){let t=bp(e.getCurrentData().eventSources);if(t.length===1&&n.length===1&&Array.isArray(t[0]._raw)&&Array.isArray(n[0])){e.dispatch({type:"RESET_RAW_EVENTS",sourceId:t[0].sourceId,rawEvents:n[0]});return}let r=[];for(let i of n){let o=!1;for(let s=0;s<t.length;s+=1)if(t[s]._raw===i){t.splice(s,1),o=!0;break}o||r.push(i)}for(let i of t)e.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:i.sourceId});for(let i of r)e.calendarApi.addEventSource(i)}function FP(n,e){e.emitter.trigger("datesSet",Object.assign(Object.assign({},Uw(n.activeRange,e.dateEnv)),{view:e.viewApi}))}function LP(n,e){let{emitter:t}=e;t.hasHandlers("eventsSet")&&t.trigger("eventsSet",mo(n,e))}const BP=[EP,DP,RP,OP,NP,Pr({name:"misc",isLoadingFuncs:[n=>v1(n.eventSources)],propSetHandlers:{dateProfile:FP,eventStore:LP}})];class HP{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new dp(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t=[],r;for(;r=e.shift();)this.runTask(r),t.push(r);this.drained(t)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}}function WP(n,e,t){let r;return/^(year|month)$/.test(n.currentRangeUnit)?r=n.currentRange:r=n.activeRange,t.formatRange(r.start,r.end,tt(e.titleFormat||zP(n)),{isEndExclusive:n.isRangeAllDay,defaultSeparator:e.titleRangeSeparator})}function zP(n){let{currentRangeUnit:e}=n;if(e==="year")return{year:"numeric"};if(e==="month")return{year:"numeric",month:"long"};let t=Iu(n.currentRange.start,n.currentRange.end);return t!==null&&t>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}class ly{constructor(){this.resetListeners=new Set}handleInput(e,t){const r=this.dateEnv;if(e!==r&&(typeof t=="function"?this.nowFn=t:r||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,r))for(const i of this.resetListeners.values())i()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}}class VP{constructor(e){this.computeCurrentViewData=ge(this._computeCurrentViewData),this.organizeRawLocales=ge(jO),this.buildLocale=ge(g1),this.buildPluginHooks=YO(),this.buildDateEnv=ge(UP),this.buildTheme=ge(jP),this.parseToolbars=ge(xP),this.buildViewSpecs=ge(eP),this.buildDateProfileGenerator=pu($P),this.buildViewApi=ge(GP),this.buildViewUiProps=pu(XP),this.buildEventUiBySource=ge(qP,ar),this.buildEventUiBases=ge(YP),this.parseContextBusinessHours=pu(KP),this.buildTitle=ge(WP),this.nowManager=new ly,this.emitter=new Tc,this.actionRunner=new HP(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=h=>{this.actionRunner.request(h)},this.props=e,this.actionRunner.pause(),this.nowManager=new ly;let t={},r=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),i=r.calendarOptions.initialView||r.pluginHooks.initialView,o=this.computeCurrentViewData(i,r,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(o.options);let s={nowManager:this.nowManager,dateEnv:r.dateEnv,options:r.calendarOptions,pluginHooks:r.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},a=oP(r.calendarOptions,r.dateEnv,this.nowManager),l=o.dateProfileGenerator.build(a);Jr(l.activeRange,a)||(a=l.currentRange.start);for(let h of r.pluginHooks.contextInit)h(s);let u=lP(r.calendarOptions,l,s),c={dynamicOptionOverrides:t,currentViewType:i,currentDate:a,dateProfile:l,businessHours:this.parseContextBusinessHours(s),eventSources:u,eventUiBases:{},eventStore:zn(),renderableEventStore:zn(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(s).selectionConfig},d=Object.assign(Object.assign({},s),c);for(let h of r.pluginHooks.reducers)Object.assign(c,h(null,null,d));Kd(c,s)&&this.emitter.trigger("loading",!0),this.state=c,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:r}=this;t===void 0?r.optionOverrides=e:(r.optionOverrides=Object.assign(Object.assign({},r.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(t===void 0||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:r,emitter:i}=this,o=sP(r.dynamicOptionOverrides,e),s=this.computeOptionsData(t.optionOverrides,o,t.calendarApi),a=rP(r.currentViewType,e),l=this.computeCurrentViewData(a,s,t.optionOverrides,o);t.calendarApi.currentDataManager=this,i.setThisContext(t.calendarApi),i.setOptions(l.options);let u={nowManager:this.nowManager,dateEnv:s.dateEnv,options:s.calendarOptions,pluginHooks:s.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:i,getCurrentData:this.getCurrentData},{currentDate:c,dateProfile:d}=r;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(d=l.dateProfileGenerator.build(c)),c=iP(c,e),d=aP(d,e,c,l.dateProfileGenerator),(e.type==="PREV"||e.type==="NEXT"||!Jr(d.currentRange,c))&&(c=d.currentRange.start);let h=uP(r.eventSources,e,d,u),f=dM(r.eventStore,e,h,d,u),g=v1(h)&&!l.options.progressiveEventRendering&&r.renderableEventStore||f,{eventUiSingleBase:m,selectionConfig:v}=this.buildViewUiProps(u),y=this.buildEventUiBySource(h),b=this.buildEventUiBases(g.defs,m,y),x={dynamicOptionOverrides:o,currentViewType:a,currentDate:c,dateProfile:d,eventSources:h,eventStore:f,renderableEventStore:g,selectionConfig:v,eventUiBases:b,businessHours:this.parseContextBusinessHours(u),dateSelection:mP(r.dateSelection,e),eventSelection:vP(r.eventSelection,e),eventDrag:yP(r.eventDrag,e),eventResize:bP(r.eventResize,e)},w=Object.assign(Object.assign({},u),x);for(let E of s.pluginHooks.reducers)Object.assign(x,E(r,e,w));let _=Kd(r,u),C=Kd(x,u);!_&&C?i.trigger("loading",!0):_&&!C&&i.trigger("loading",!1),this.state=x,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,r=this.data,i=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),o=this.computeCurrentViewData(t.currentViewType,i,e.optionOverrides,t.dynamicOptionOverrides),s=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,o.options,i.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},i),o),t),a=i.pluginHooks.optionChangeHandlers,l=r&&r.calendarOptions,u=i.calendarOptions;if(l&&l!==u){l.timeZone!==u.timeZone&&(t.eventSources=s.eventSources=cP(s.eventSources,t.dateProfile,s),t.eventStore=s.eventStore=Jv(s.eventStore,r.dateEnv,s.dateEnv),t.renderableEventStore=s.renderableEventStore=Jv(s.renderableEventStore,r.dateEnv,s.dateEnv));for(let c in a)(this.optionsForHandling.indexOf(c)!==-1||l[c]!==u[c])&&a[c](u[c],s)}this.optionsForHandling=[],e.onData&&e.onData(s)}computeOptionsData(e,t,r){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:i,pluginHooks:o,localeDefaults:s,availableLocaleData:a,extra:l}=this.processRawCalendarOptions(e,t);uy(l);let u=this.buildDateEnv(i.timeZone,i.locale,i.weekNumberCalculation,i.firstDay,i.weekText,o,a,i.defaultRangeSeparator),c=this.buildViewSpecs(o.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,s),d=this.buildTheme(i,o),h=this.parseToolbars(i,this.stableOptionOverrides,d,c,r);return this.stableCalendarOptionsData={calendarOptions:i,pluginHooks:o,dateEnv:u,viewSpecs:c,theme:d,toolbarConfig:h,localeDefaults:s,availableRawLocales:a.map}}processRawCalendarOptions(e,t){let{locales:r,locale:i}=zd([ca,e,t]),o=this.organizeRawLocales(r),s=o.map,a=this.buildLocale(i||o.defaultCode,s).options,l=this.buildPluginHooks(e.plugins||[],BP),u=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Gv),qv),Yv),l.listenerRefiners),l.optionRefiners),c={},d=zd([ca,a,e,t]),h={},f=this.currentCalendarOptionsInput,p=this.currentCalendarOptionsRefined,g=!1;for(let m in d)this.optionsForRefining.indexOf(m)===-1&&(d[m]===f[m]||no[m]&&m in f&&no[m](f[m],d[m]))?h[m]=p[m]:u[m]?(h[m]=u[m](d[m]),g=!0):c[m]=f[m];return g&&(this.currentCalendarOptionsInput=d,this.currentCalendarOptionsRefined=h,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:o,localeDefaults:a,extra:c}}_computeCurrentViewData(e,t,r,i){let o=t.viewSpecs[e];if(!o)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:s,extra:a}=this.processRawViewOptions(o,t.pluginHooks,t.localeDefaults,r,i);uy(a),this.nowManager.handleInput(t.dateEnv,s.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:o.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:o.duration,durationUnit:o.durationUnit,usesMinMaxTime:o.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,showNonCurrentDates:s.showNonCurrentDates,dayCount:s.dayCount,dateAlignment:s.dateAlignment,dateIncrement:s.dateIncrement,hiddenDays:s.hiddenDays,weekends:s.weekends,validRangeInput:s.validRange,visibleRangeInput:s.visibleRange,fixedWeekCount:s.fixedWeekCount}),u=this.buildViewApi(e,this.getCurrentData,t.dateEnv);return{viewSpec:o,options:s,dateProfileGenerator:l,viewApi:u}}processRawViewOptions(e,t,r,i,o){let s=zd([ca,e.optionDefaults,r,i,e.optionOverrides,o]),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Gv),qv),Yv),kI),t.listenerRefiners),t.optionRefiners),l={},u=this.currentViewOptionsInput,c=this.currentViewOptionsRefined,d=!1,h={};for(let f in s)s[f]===u[f]||no[f]&&no[f](s[f],u[f])?l[f]=c[f]:(s[f]===this.currentCalendarOptionsInput[f]||no[f]&&no[f](s[f],this.currentCalendarOptionsInput[f])?f in this.currentCalendarOptionsRefined&&(l[f]=this.currentCalendarOptionsRefined[f]):a[f]?l[f]=a[f](s[f]):h[f]=s[f],d=!0);return d&&(this.currentViewOptionsInput=s,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:h}}}function UP(n,e,t,r,i,o,s,a){let l=g1(e||s.defaultCode,s.map);return new HI({calendarSystem:"gregory",timeZone:n,namedTimeZoneImpl:o.namedTimeZonedImpl,locale:l,weekNumberCalculation:t,firstDay:r,weekText:i,cmdFormatter:o.cmdFormatter,defaultSeparator:a})}function jP(n,e){let t=e.themeClasses[n.themeSystem]||Hi;return new t(n)}function $P(n){let e=n.dateProfileGeneratorClass||Tw;return new e(n)}function GP(n,e,t){return new _P(n,e,t)}function qP(n){return ei(n,e=>e.ui)}function YP(n,e,t){let r={"":e};for(let i in n){let o=n[i];o.sourceId&&t[o.sourceId]&&(r[i]=t[o.sourceId])}return r}function XP(n){let{options:e}=n;return{eventUiSingleBase:Lu({display:e.eventDisplay,editable:e.editable,startEditable:e.eventStartEditable,durationEditable:e.eventDurationEditable,constraint:e.eventConstraint,overlap:typeof e.eventOverlap=="boolean"?e.eventOverlap:void 0,allow:e.eventAllow,backgroundColor:e.eventBackgroundColor,borderColor:e.eventBorderColor,textColor:e.eventTextColor,color:e.eventColor},n),selectionConfig:Lu({constraint:e.selectConstraint,overlap:typeof e.selectOverlap=="boolean"?e.selectOverlap:void 0,allow:e.selectAllow},n)}}function Kd(n,e){for(let t of e.pluginHooks.isLoadingFuncs)if(t(n))return!0;return!1}function KP(n){return xM(n.options.businessHours,n)}function uy(n,e){for(let t in n)console.warn(`Unknown option '${t}'`)}class QP extends ze{render(){let e=this.props.widgetGroups.map(t=>this.renderWidgetGroup(t));return O("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:r}=this.context,i=[],o=!0;for(let s of e){let{buttonName:a,buttonClick:l,buttonText:u,buttonIcon:c,buttonHint:d}=s;if(a==="title")o=!1,i.push(O("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let h=a===t.activeButton,f=!t.isTodayEnabled&&a==="today"||!t.isPrevEnabled&&a==="prev"||!t.isNextEnabled&&a==="next",p=[`fc-${a}-button`,r.getClass("button")];h&&p.push(r.getClass("buttonActive")),i.push(O("button",{type:"button",title:typeof d=="function"?d(t.navUnit):d,disabled:f,"aria-pressed":h,className:p.join(" "),onClick:l},u||(c?O("span",{className:c,role:"img"}):"")))}}if(i.length>1){let s=o&&r.getClass("buttonGroup")||"";return O("div",{className:s},...i)}return i[0]}}class cy extends ze{render(){let{model:e,extraClassName:t}=this.props,r=!1,i,o,s=e.sectionWidgets,a=s.center;return s.left?(r=!0,i=s.left):i=s.start,s.right?(r=!0,o=s.right):o=s.end,O("div",{className:[t||"","fc-toolbar",r?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",i||[]),this.renderSection("center",a||[]),this.renderSection("end",o||[]))}renderSection(e,t){let{props:r}=this;return O(QP,{key:e,widgetGroups:t,title:r.title,navUnit:r.navUnit,activeButton:r.activeButton,isTodayEnabled:r.isTodayEnabled,isPrevEnabled:r.isPrevEnabled,isNextEnabled:r.isNextEnabled,titleId:r.titleId})}}class JP extends ze{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,Ir(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:r}=e,i=["fc-view-harness",r||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],o="",s="";return r?t.availableWidth!==null?o=t.availableWidth/r:s=`${1/r*100}%`:o=e.height||"",O("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:i.join(" "),style:{height:o,paddingBottom:s}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}}class ZP extends Ps{constructor(e){super(e),this.handleSegClick=(t,r)=>{let{component:i}=this,{context:o}=i,s=_s(r);if(s&&i.isValidSegDownEl(t.target)){let a=Kt(t.target,".fc-event-forced-url"),l=a?a.querySelector("a[href]").href:"";o.emitter.trigger("eventClick",{el:r,event:new ut(i.context,s.eventRange.def,s.eventRange.instance),jsEvent:t,view:o.viewApi}),l&&!t.defaultPrevented&&(window.location.href=l)}},this.destroy=yw(e.el,"click",".fc-event",this.handleSegClick)}}class eN extends Ps{constructor(e){super(e),this.handleEventElRemove=t=>{t===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(t,r)=>{_s(r)&&(this.currentSegEl=r,this.triggerEvent("eventMouseEnter",t,r))},this.handleSegLeave=(t,r)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",t,r))},this.removeHoverListeners=PT(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,r){let{component:i}=this,{context:o}=i,s=_s(r);(!t||i.isValidSegDownEl(t.target))&&o.emitter.trigger(e,{el:r,event:new ut(o,s.eventRange.def,s.eventRange.instance),jsEvent:t,view:o.viewApi})}}class tN extends Io{constructor(){super(...arguments),this.buildViewContext=ge(VI),this.buildViewPropTransformers=ge(rN),this.buildToolbarProps=ge(nN),this.headerRef=un(),this.footerRef=un(),this.interactionsStore={},this.state={viewLabelId:Di()},this.registerInteractiveComponent=(e,t)=>{let r=VM(e,t),s=[ZP,eN].concat(this.props.pluginHooks.componentInteractions).map(a=>new a(r));this.interactionsStore[e.uid]=s,sf[e.uid]=r},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let r of t)r.destroy();delete this.interactionsStore[e.uid]}delete sf[e.uid]},this.resizeRunner=new dp(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let{props:e}=this,{toolbarConfig:t,options:r}=e,i=!1,o="",s;e.isHeightAuto||e.forPrint?o="":r.height!=null?i=!0:r.contentHeight!=null?o=r.contentHeight:s=Math.max(r.aspectRatio,.5);let a=this.buildViewContext(e.viewSpec,e.viewApi,e.options,e.dateProfileGenerator,e.dateEnv,e.nowManager,e.theme,e.pluginHooks,e.dispatch,e.getCurrentData,e.emitter,e.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=t.header&&t.header.hasTitle?this.state.viewLabelId:void 0;return O(ti.Provider,{value:a},O(Mo,{unit:"day"},u=>{let c=this.buildToolbarProps(e.viewSpec,e.dateProfile,e.dateProfileGenerator,e.currentDate,u,e.viewTitle);return O(Ge,null,t.header&&O(cy,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:t.header,titleId:l},c)),O(JP,{liquid:i,height:o,aspectRatio:s,labeledById:l},this.renderView(e),this.buildAppendContent()),t.footer&&O(cy,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:t.footer,titleId:""},c)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(r=>new r(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let r in t)t[r](e[r],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:r}=t.pluginHooks;for(let i in r)t[i]!==e[i]&&r[i](t[i],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map(r=>r(e));return O(Ge,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:r}=e,i={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},o=this.buildViewPropTransformers(t.viewPropsTransformers);for(let a of o)Object.assign(i,a.transform(i,e));let s=r.component;return O(s,Object.assign({},i))}}function nN(n,e,t,r,i,o){let s=t.build(i,void 0,!1),a=t.buildPrev(e,r,!1),l=t.buildNext(e,r,!1);return{title:o,activeButton:n.type,navUnit:n.singleUnit,isTodayEnabled:s.isValid&&!Jr(e.currentRange,i),isPrevEnabled:a.isValid,isNextEnabled:l.isValid}}function rN(n){return n.map(e=>new e)}class iN extends jM{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=r=>{switch(r.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=r=>{this.currentData=r,this.renderRunner.request(r.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:r}=this;Nu(()=>{Ea(O(zM,{options:r.calendarOptions,theme:r.theme,emitter:r.emitter},(i,o,s,a)=>(this.setClassNames(i),this.setHeight(o),O(Aw.Provider,{value:this.customContentRenderId},O(tN,Object.assign({isHeightAuto:s,forPrint:a},r))))),this.el)})}else this.isRendered&&(this.isRendered=!1,Ea(null,this.el),this.setClassNames([]),this.setHeight(""))},ST(e),this.el=e,this.renderRunner=new dp(this.handleRenderRequest),new VP({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){Nu(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!Ii(e,this.currentClassNames)){let{classList:t}=this.el;for(let r of this.currentClassNames)t.remove(r);for(let r of e)t.add(r);this.currentClassNames=e}}setHeight(e){mw(this.el,"height",e)}}class oN extends ur{constructor(){super(...arguments),this.headerElRef=un()}renderSimpleLayout(e,t){let{props:r,context:i}=this,o=[],s=Hu(i.options);return e&&o.push({type:"header",key:"header",isSticky:s,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),o.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),O(Sa,{elClasses:["fc-daygrid"],viewSpec:i.viewSpec},O(Lp,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[],sections:o}))}renderHScrollLayout(e,t,r,i){let o=this.context.pluginHooks.scrollGridImpl;if(!o)throw new Error("No ScrollGrid implementation");let{props:s,context:a}=this,l=!s.forPrint&&Hu(a.options),u=!s.forPrint&&a1(a.options),c=[];return e&&c.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),c.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),u&&c.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:uf}]}),O(Sa,{elClasses:["fc-daygrid"],viewSpec:a.viewSpec},O(o,{liquid:!s.isHeightAuto&&!s.forPrint,forPrint:s.forPrint,collapsibleWidth:s.forPrint,colGroups:[{cols:[{span:r,minWidth:i}]}],sections:c}))}}function mu(n,e){let t=[];for(let r=0;r<e;r+=1)t[r]=[];for(let r of n)t[r.row].push(r);return t}function Tl(n,e){let t=[];for(let r=0;r<e;r+=1)t[r]=[];for(let r of n)t[r.firstCol].push(r);return t}function dy(n,e){let t=[];if(n){for(let r=0;r<e;r+=1)t[r]={affectedInstances:n.affectedInstances,isEvent:n.isEvent,segs:[]};for(let r of n.segs)t[r.row].segs.push(r)}else for(let r=0;r<e;r+=1)t[r]=null;return t}const _1=tt({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function C1(n){let{display:e}=n.eventRange.ui;return e==="list-item"||e==="auto"&&!n.eventRange.def.allDay&&n.firstCol===n.lastCol&&n.isStart&&n.isEnd}class E1 extends ze{render(){let{props:e}=this;return O(Bp,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:_1,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}}class S1 extends ze{render(){let{props:e,context:t}=this,{options:r}=t,{seg:i}=e,o=r.eventTimeFormat||_1,s=da(i,o,t,!0,e.defaultDisplayEventEnd);return O(Mc,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Tp(e.seg,t),defaultGenerator:sN,timeText:s,isResizing:!1,isDateSelecting:!1}))}}function sN(n){return O(Ge,null,O("div",{className:"fc-daygrid-event-dot",style:{borderColor:n.borderColor||n.backgroundColor}}),n.timeText&&O("div",{className:"fc-event-time"},n.timeText),O("div",{className:"fc-event-title"},n.event.title||O(Ge,null," ")))}class aN extends ze{constructor(){super(...arguments),this.compileSegs=ge(lN)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:r}=this.compileSegs(e.singlePlacements);return O(d1,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:r,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let i=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return O(Ge,null,t.map(o=>{let s=o.eventRange.instance.instanceId;return O("div",{className:"fc-daygrid-event-harness",key:s,style:{visibility:i[s]?"hidden":""}},C1(o)?O(S1,Object.assign({seg:o,isDragging:!1,isSelected:s===e.eventSelection,defaultDisplayEventEnd:!1},Zr(o,e.todayRange))):O(E1,Object.assign({seg:o,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:s===e.eventSelection,defaultDisplayEventEnd:!1},Zr(o,e.todayRange))))}))}})}}function lN(n){let e=[],t=[];for(let r of n)e.push(r.seg),r.isVisible||t.push(r.seg);return{allSegs:e,invisibleSegs:t}}const uN=tt({week:"narrow"});class cN extends ur{constructor(){super(...arguments),this.rootElRef=un(),this.state={dayNumberId:Di()},this.handleRootEl=e=>{Ir(this.rootElRef,e),Ir(this.props.elRef,e)}}render(){let{context:e,props:t,state:r,rootElRef:i}=this,{options:o,dateEnv:s}=e,{date:a,dateProfile:l}=t;const u=t.showDayNumber&&hN(a,l.currentRange,s);return O(Wp,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":r.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:dN,date:a,dateProfile:l,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:u,extraRenderProps:t.extraRenderProps},(c,d)=>O("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&O(c1,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:Cs(e,a,"week"),date:a,defaultFormat:uN}),!d.isDisabled&&(t.showDayNumber||zp(o)||t.forceDayTop)?O("div",{className:"fc-daygrid-day-top"},O(c,{elTag:"a",elClasses:["fc-daygrid-day-number",u&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},Cs(e,a)),{id:r.dayNumberId})})):t.showDayNumber?O("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},O("a",{className:"fc-daygrid-day-number"}," ")):void 0,O("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,O("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},O(aN,{allDayDate:a,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:i,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),O("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}}function dN(n){return n.dayNumberText||O(Ge,null," ")}function hN(n,e,t){const{start:r,end:i}=e,o=Mi(i,-1),s=t.getYear(r),a=t.getMonth(r),l=t.getYear(o),u=t.getMonth(o);return!(s===l&&a===u)&&(n.valueOf()===r.valueOf()||t.getDay(n)===1&&n.valueOf()<i.valueOf())}function D1(n){return n.eventRange.instance.instanceId+":"+n.firstCol}function A1(n){return D1(n)+":"+n.lastCol}function fN(n,e,t,r,i,o,s){let a=new mN(v=>{let y=n[v.index].eventRange.instance.instanceId+":"+v.span.start+":"+(v.span.end-1);return i[y]||1});a.allowReslicing=!0,a.strictOrder=r,e===!0||t===!0?(a.maxCoord=o,a.hiddenConsumes=!0):typeof e=="number"?a.maxStackCnt=e:typeof t=="number"&&(a.maxStackCnt=t,a.hiddenConsumes=!0);let l=[],u=[];for(let v=0;v<n.length;v+=1){let y=n[v],b=A1(y);i[b]!=null?l.push({index:v,span:{start:y.firstCol,end:y.lastCol+1}}):u.push(y)}let c=a.addSegs(l),d=a.toRects(),{singleColPlacements:h,multiColPlacements:f,leftoverMargins:p}=pN(d,n,s),g=[],m=[];for(let v of u){f[v.firstCol].push({seg:v,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let y=v.firstCol;y<=v.lastCol;y+=1)h[y].push({seg:us(v,y,y+1,s),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let v=0;v<s.length;v+=1)g.push(0);for(let v of c){let y=n[v.index],b=v.span;f[b.start].push({seg:us(y,b.start,b.end,s),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let x=b.start;x<b.end;x+=1)g[x]+=1,h[x].push({seg:us(y,x,x+1,s),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let v=0;v<s.length;v+=1)m.push(p[v]);return{singleColPlacements:h,multiColPlacements:f,moreCnts:g,moreMarginTops:m}}function pN(n,e,t){let r=gN(n,t.length),i=[],o=[],s=[];for(let a=0;a<t.length;a+=1){let l=r[a],u=[],c=0,d=0;for(let f of l){let p=e[f.index];u.push({seg:us(p,a,a+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:f.levelCoord,marginTop:f.levelCoord-c}),c=f.levelCoord+f.thickness}let h=[];c=0,d=0;for(let f of l){let p=e[f.index],g=f.span.end-f.span.start>1,m=f.span.start===a;d+=f.levelCoord-c,c=f.levelCoord+f.thickness,g?(d+=f.thickness,m&&h.push({seg:us(p,f.span.start,f.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:f.levelCoord,marginTop:0})):m&&(h.push({seg:us(p,f.span.start,f.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:f.levelCoord,marginTop:d}),d=0)}i.push(u),o.push(h),s.push(d)}return{singleColPlacements:i,multiColPlacements:o,leftoverMargins:s}}function gN(n,e){let t=[];for(let r=0;r<e;r+=1)t.push([]);for(let r of n)for(let i=r.span.start;i<r.span.end;i+=1)t[i].push(r);return t}function us(n,e,t,r){if(n.firstCol===e&&n.lastCol===t-1)return n;let i=n.eventRange,o=i.range,s=Oi(o,{start:r[e].date,end:St(r[t-1].date,1)});return Object.assign(Object.assign({},n),{firstCol:e,lastCol:t-1,eventRange:{def:i.def,ui:Object.assign(Object.assign({},i.ui),{durationEditable:!1}),instance:i.instance,range:s},isStart:n.isStart&&s.start.valueOf()===o.start.valueOf(),isEnd:n.isEnd&&s.end.valueOf()===o.end.valueOf()})}class mN extends Xw{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){const t=super.addSegs(e),{entriesByLevel:r}=this,i=o=>!this.forceHidden[vo(o)];for(let o=0;o<r.length;o+=1)r[o]=r[o].filter(i);return t}handleInvalidInsertion(e,t,r){const{entriesByLevel:i,forceHidden:o}=this,{touchingEntry:s,touchingLevel:a,touchingLateral:l}=e;if(this.hiddenConsumes&&s){const u=vo(s);if(!o[u])if(this.allowReslicing){const c=Object.assign(Object.assign({},s),{span:Np(s.span,t.span)}),d=vo(c);o[d]=!0,i[a][l]=c,r.push(c),this.splitEntry(s,t,r)}else o[u]=!0,r.push(s)}super.handleInvalidInsertion(e,t,r)}}class k1 extends ur{constructor(){super(...arguments),this.cellElRefs=new Yr,this.frameElRefs=new Yr,this.fgElRefs=new Yr,this.segHarnessRefs=new Yr,this.rootElRef=un(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:r}=this,{options:i}=r,o=e.cells.length,s=Tl(e.businessHourSegs,o),a=Tl(e.bgEventSegs,o),l=Tl(this.getHighlightSegs(),o),u=Tl(this.getMirrorSegs(),o),{singleColPlacements:c,multiColPlacements:d,moreCnts:h,moreMarginTops:f}=fN(Rp(e.fgEventSegs,i.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,i.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),p=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return O("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((g,m)=>{let v=this.renderFgSegs(m,e.forPrint?c[m]:d[m],e.todayRange,p),y=this.renderFgSegs(m,vN(u[m],d),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return O(cN,{key:g.key,elRef:this.cellElRefs.createRef(g.key),innerElRef:this.frameElRefs.createRef(g.key),dateProfile:e.dateProfile,date:g.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&m===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:g.extraRenderProps,extraDataAttrs:g.extraDataAttrs,extraClassNames:g.extraClassNames,extraDateSpan:g.extraDateSpan,moreCnt:h[m],moreMarginTop:f[m],singlePlacements:c[m],fgContentElRef:this.fgElRefs.createRef(g.key),fgContent:O(Ge,null,O(Ge,null,v),O(Ge,null,y)),bgContent:O(Ge,null,this.renderFillSegs(l[m],"highlight"),this.renderFillSegs(s[m],"non-business"),this.renderFillSegs(a[m],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let r=this.props;this.updateSizing(!ar(e,r))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,r,i,o,s,a){let{context:l}=this,{eventSelection:u}=this.props,{framePositions:c}=this.state,d=this.props.cells.length===1,h=o||s||a,f=[];if(c)for(let p of t){let{seg:g}=p,{instanceId:m}=g.eventRange.instance,v=p.isVisible&&!i[m],y=p.isAbsolute,b="",x="";y&&(l.isRtl?(x=0,b=c.lefts[g.lastCol]-c.lefts[g.firstCol]):(b=0,x=c.rights[g.firstCol]-c.rights[g.lastCol])),f.push(O("div",{className:"fc-daygrid-event-harness"+(y?" fc-daygrid-event-harness-abs":""),key:D1(g),ref:h?null:this.segHarnessRefs.createRef(A1(g)),style:{visibility:v?"":"hidden",marginTop:y?"":p.marginTop,top:y?p.absoluteTop:"",left:b,right:x}},C1(g)?O(S1,Object.assign({seg:g,isDragging:o,isSelected:m===u,defaultDisplayEventEnd:d},Zr(g,r))):O(E1,Object.assign({seg:g,isDragging:o,isResizing:s,isDateSelecting:a,isSelected:m===u,defaultDisplayEventEnd:d},Zr(g,r)))))}return f}renderFillSegs(e,t){let{isRtl:r}=this.context,{todayRange:i}=this.props,{framePositions:o}=this.state,s=[];if(o)for(let a of e){let l=r?{right:0,left:o.lefts[a.lastCol]-o.lefts[a.firstCol]}:{left:0,right:o.rights[a.firstCol]-o.rights[a.lastCol]};s.push(O("div",{key:Vw(a.eventRange),className:"fc-daygrid-bg-harness",style:l},t==="bg-event"?O(l1,Object.assign({seg:a},Zr(a,i))):u1(t)))}return O(Ge,{},...s)}updateSizing(e){let{props:t,state:r,frameElRefs:i}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let l=t.cells.map(u=>i.currentMap[u.key]);if(l.length){let u=this.rootElRef.current,c=new Es(u,l,!0,!1);(!r.framePositions||!r.framePositions.similarTo(c))&&this.setState({framePositions:new Es(u,l,!0,!1)})}}const o=this.state.segHeights,s=this.querySegHeights(),a=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},o),s),maxContentHeight:a?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let r in e){let i=Math.round(e[r].getBoundingClientRect().height);t[r]=Math.max(t[r]||0,i)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],r=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-r.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}}k1.addStateEquality({segHeights:ar});function vN(n,e){if(!n.length)return[];let t=yN(e);return n.map(r=>({seg:r,isVisible:!0,isAbsolute:!0,absoluteTop:t[r.eventRange.instance.instanceId],marginTop:0}))}function yN(n){let e={};for(let t of n)for(let r of t)e[r.seg.eventRange.instance.instanceId]=r.absoluteTop;return e}class bN extends ur{constructor(){super(...arguments),this.splitBusinessHourSegs=ge(mu),this.splitBgEventSegs=ge(xN),this.splitFgEventSegs=ge(mu),this.splitDateSelectionSegs=ge(mu),this.splitEventDrag=ge(dy),this.splitEventResize=ge(dy),this.rowRefs=new Yr}render(){let{props:e,context:t}=this,r=e.cells.length,i=this.splitBusinessHourSegs(e.businessHourSegs,r),o=this.splitBgEventSegs(e.bgEventSegs,r),s=this.splitFgEventSegs(e.fgEventSegs,r),a=this.splitDateSelectionSegs(e.dateSelectionSegs,r),l=this.splitEventDrag(e.eventDrag,r),u=this.splitEventResize(e.eventResize,r),c=r>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return O(Mo,{unit:"day"},(d,h)=>O(Ge,null,e.cells.map((f,p)=>O(k1,{ref:this.rowRefs.createRef(p),key:f.length?f[0].date.toISOString():p,showDayNumbers:r>1,showWeekNumbers:e.showWeekNumbers,todayRange:h,dateProfile:e.dateProfile,cells:f,renderIntro:e.renderRowIntro,businessHourSegs:i[p],eventSelection:e.eventSelection,bgEventSegs:o[p],fgEventSegs:s[p],dateSelectionSegs:a[p],eventDrag:l[p],eventResize:u[p],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:c,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){const e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new Es(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new Es(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:r,rowPositions:i}=this,o=r.leftToIndex(e),s=i.topToIndex(t);if(s!=null&&o!=null){let a=this.props.cells[s][o];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(s,o),allDay:!0},a.extraDateSpan),dayEl:this.getCellEl(s,o),rect:{left:r.lefts[o],right:r.rights[o],top:i.tops[s],bottom:i.bottoms[s]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let r=this.props.cells[e][t].date,i=St(r,1);return{start:r,end:i}}}function xN(n,e){return mu(n.filter(wN),e)}function wN(n){return n.eventRange.def.allDay}class _N extends ur{constructor(){super(...arguments),this.elRef=un(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:r,expandRows:i}=e,o=r===!0||t===!0;o&&!i&&(o=!1,t=null,r=null);let s=["fc-daygrid-body",o?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",i?"":"fc-daygrid-body-natural"];return O("div",{ref:this.elRef,className:s.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},O("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:i?e.clientHeight:""}},e.colGroupNode,O("tbody",{role:"presentation"},O(bN,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:r,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){const e=CN(this.elRef.current,this.props.dateProfile);if(e){const t=e.closest(".fc-daygrid-body"),r=t.closest(".fc-scroller"),i=e.getBoundingClientRect().top-t.getBoundingClientRect().top;r.scrollTop=i?i+1:0}this.needsScrollReset=!1}}}function CN(n,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=n.querySelector(`[data-date="${dI(e.currentDate)}-01"]`)),t||(t=n.querySelector(`[data-date="${Xa(e.currentDate)}"]`)),t}class EN extends t1{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}}class R1 extends ur{constructor(){super(...arguments),this.slicer=new EN,this.tableRef=un()}render(){let{props:e,context:t}=this;return O(_N,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}}class SN extends oN{constructor(){super(...arguments),this.buildDayTableModel=ge(DN),this.headerRef=un(),this.tableRef=un()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:r}=this,i=this.buildDayTableModel(r.dateProfile,t),o=e.dayHeaders&&O(Jw,{ref:this.headerRef,dateProfile:r.dateProfile,dates:i.headerDates,datesRepDistinctDays:i.rowCnt===1}),s=a=>O(R1,{ref:this.tableRef,dateProfile:r.dateProfile,dayTableModel:i,businessHours:r.businessHours,dateSelection:r.dateSelection,eventStore:r.eventStore,eventUiBases:r.eventUiBases,eventSelection:r.eventSelection,eventDrag:r.eventDrag,eventResize:r.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:a.tableColGroupNode,tableMinWidth:a.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!r.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:a.clientWidth,clientHeight:a.clientHeight,forPrint:r.forPrint});return e.dayMinWidth?this.renderHScrollLayout(o,s,i.colCnt,e.dayMinWidth):this.renderSimpleLayout(o,s)}}function DN(n,e){let t=new Zw(n.renderRange,e);return new e1(t,/year|month|week/.test(n.currentRangeUnit))}class AN extends Tw{buildRenderRange(e,t,r){let i=super.buildRenderRange(e,t,r),{props:o}=this;return kN({currentRange:i,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:o.fixedWeekCount,dateEnv:o.dateEnv})}}function kN(n){let{dateEnv:e,currentRange:t}=n,{start:r,end:i}=t,o;if(n.snapToWeek&&(r=e.startOfWeek(r),o=e.startOfWeek(i),o.valueOf()!==i.valueOf()&&(i=zv(o,1))),n.fixedWeekCount){let s=e.startOfWeek(e.startOfMonth(St(t.end,-1))),a=Math.ceil(eI(s,i));i=zv(i,6-a)}return{start:r,end:i}}var RN=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';Dc(RN);var TN=Pr({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:SN,dateProfileGeneratorClass:AN},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});class IN extends XM{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?SM(e)?["timed","allDay"]:["allDay"]:["timed"]}}const MN=tt({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function T1(n){let e=["fc-timegrid-slot","fc-timegrid-slot-label",n.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return O(ti.Consumer,null,t=>{if(!n.isLabeled)return O("td",{className:e.join(" "),"data-time":n.isoTimeStr});let{dateEnv:r,options:i,viewApi:o}=t,s=i.slotLabelFormat==null?MN:Array.isArray(i.slotLabelFormat)?tt(i.slotLabelFormat[0]):tt(i.slotLabelFormat),a={level:0,time:n.time,date:r.toDate(n.date),view:o,text:r.format(n.date,s)};return O(rn,{elTag:"td",elClasses:e,elAttrs:{"data-time":n.isoTimeStr},renderProps:a,generatorName:"slotLabelContent",customGenerator:i.slotLabelContent,defaultGenerator:ON,classNameGenerator:i.slotLabelClassNames,didMount:i.slotLabelDidMount,willUnmount:i.slotLabelWillUnmount},l=>O("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},O(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function ON(n){return n.text}class PN extends ze{render(){return this.props.slatMetas.map(e=>O("tr",{key:e.key},O(T1,Object.assign({},e))))}}const NN=tt({week:"short"}),FN=5;class LN extends ur{constructor(){super(...arguments),this.allDaySplitter=new IN,this.headerElRef=un(),this.rootElRef=un(),this.scrollerElRef=un(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:r}=this.context,{dateProfile:i}=this.props,o=i.renderRange,a=Bi(o.start,o.end)===1?Cs(this.context,o.start,"week"):{};return r.weekNumbers&&e==="day"?O(c1,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:o.start,defaultFormat:NN},l=>O("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},O(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:a}))):O("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},O("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:r}=this.context,i={text:t.allDayText,view:r};return O(rn,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:i,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:BN,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},o=>O("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},O(o,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,r){let{context:i,props:o}=this,s=[],a=Hu(i.options);return e&&s.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(s.push({type:"body",key:"all-day",chunk:{content:t}}),s.push({type:"body",key:"all-day-divider",outerContent:O("tr",{role:"presentation",className:"fc-scrollgrid-section"},O("td",{className:"fc-timegrid-divider "+i.theme.getClass("tableCellShaded")}))})),s.push({type:"body",key:"body",liquid:!0,expandRows:!!i.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:r}}),O(Sa,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:i.viewSpec},O(Lp,{liquid:!o.isHeightAuto&&!o.forPrint,collapsibleWidth:o.forPrint,cols:[{width:"shrink"}],sections:s}))}renderHScrollLayout(e,t,r,i,o,s,a){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:u,props:c}=this,d=!c.forPrint&&Hu(u.options),h=!c.forPrint&&a1(u.options),f=[];e&&f.push({type:"header",key:"header",isSticky:d,syncRowHeights:!0,chunks:[{key:"axis",rowContent:g=>O("tr",{role:"presentation"},this.renderHeadAxis("day",g.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(f.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:g=>O("tr",{role:"presentation"},this.renderTableRowAxis(g.rowSyncHeights[0]))},{key:"cols",content:t}]}),f.push({key:"all-day-divider",type:"body",outerContent:O("tr",{role:"presentation",className:"fc-scrollgrid-section"},O("td",{colSpan:2,className:"fc-timegrid-divider "+u.theme.getClass("tableCellShaded")}))}));let p=u.options.nowIndicator;return f.push({type:"body",key:"body",liquid:!0,expandRows:!!u.options.expandRows,chunks:[{key:"axis",content:g=>O("div",{className:"fc-timegrid-axis-chunk"},O("table",{"aria-hidden":!0,style:{height:g.expandRows?g.clientHeight:""}},g.tableColGroupNode,O("tbody",null,O(PN,{slatMetas:s}))),O("div",{className:"fc-timegrid-now-indicator-container"},O(Mo,{unit:p?"minute":"day"},m=>{let v=p&&a&&a.safeComputeTop(m);return typeof v=="number"?O(Hp,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:v},isAxis:!0,date:m}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:r}]}),h&&f.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:uf},{key:"cols",content:uf}]}),O(Sa,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:u.viewSpec},O(l,{liquid:!c.isHeightAuto&&!c.forPrint,forPrint:c.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:i,minWidth:o}]}],sections:f}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=FN),{dayMaxEvents:e,dayMaxEventRows:t}}}function BN(n){return n.text}class HN{constructor(e,t,r){this.positions=e,this.dateProfile=t,this.slotDuration=r}safeComputeTop(e){let{dateProfile:t}=this;if(Jr(t.currentRange,e)){let r=Xe(e),i=e.valueOf()-r.valueOf();if(i>=rr(t.slotMinTime)&&i<rr(t.slotMaxTime))return this.computeTimeTop(Fe(i))}return null}computeDateTop(e,t){return t||(t=Xe(e)),this.computeTimeTop(Fe(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:r}=this,i=t.els.length,o=(e.milliseconds-rr(r.slotMinTime))/rr(this.slotDuration),s,a;return o=Math.max(0,o),o=Math.min(i,o),s=Math.floor(o),s=Math.min(s,i-1),a=o-s,t.tops[s]+t.getHeight(s)*a}}class WN extends ze{render(){let{props:e,context:t}=this,{options:r}=t,{slatElRefs:i}=e;return O("tbody",null,e.slatMetas.map((o,s)=>{let a={time:o.time,date:t.dateEnv.toDate(o.date),view:t.viewApi};return O("tr",{key:o.key,ref:i.createRef(o.key)},e.axis&&O(T1,Object.assign({},o)),O(rn,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!o.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":o.isoTimeStr},renderProps:a,generatorName:"slotLaneContent",customGenerator:r.slotLaneContent,classNameGenerator:r.slotLaneClassNames,didMount:r.slotLaneDidMount,willUnmount:r.slotLaneWillUnmount}))}))}}class zN extends ze{constructor(){super(...arguments),this.rootElRef=un(),this.slatElRefs=new Yr}render(){let{props:e,context:t}=this;return O("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},O("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,O(WN,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new HN(new Es(this.rootElRef.current,VN(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}}function VN(n,e){return e.map(t=>n[t.key])}function Vs(n,e){let t=[],r;for(r=0;r<e;r+=1)t.push([]);if(n)for(r=0;r<n.length;r+=1)t[n[r].col].push(n[r]);return t}function hy(n,e){let t=[];if(n){for(let r=0;r<e;r+=1)t[r]={affectedInstances:n.affectedInstances,isEvent:n.isEvent,segs:[]};for(let r of n.segs)t[r.col].segs.push(r)}else for(let r=0;r<e;r+=1)t[r]=null;return t}class UN extends ze{render(){let{props:e}=this;return O(d1,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>M1(e.hiddenSegs,e),defaultGenerator:jN,forceTimed:!0},t=>O(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}}function jN(n){return n.shortText}function $N(n,e,t){let r=new Xw;e!=null&&(r.strictOrder=e),t!=null&&(r.maxStackCnt=t);let i=r.addSegs(n),o=lO(i),s=GN(r);return s=KN(s,1),{segRects:QN(s),hiddenGroups:o}}function GN(n){const{entriesByLevel:e}=n,t=Up((r,i)=>r+":"+i,(r,i)=>{let o=XN(n,r,i),s=fy(o,t),a=e[r][i];return[Object.assign(Object.assign({},a),{nextLevelNodes:s[0]}),a.thickness+s[1]]});return fy(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function fy(n,e){if(!n)return[[],0];let{level:t,lateralStart:r,lateralEnd:i}=n,o=r,s=[];for(;o<i;)s.push(e(t,o)),o+=1;return s.sort(qN),[s.map(YN),s[0][1]]}function qN(n,e){return e[1]-n[1]}function YN(n){return n[0]}function XN(n,e,t){let{levelCoords:r,entriesByLevel:i}=n,o=i[e][t],s=r[e]+o.thickness,a=r.length,l=e;for(;l<a&&r[l]<s;l+=1);for(;l<a;l+=1){let u=i[l],c,d=lf(u,o.span.start,af),h=d[0]+d[1],f=h;for(;(c=u[f])&&c.span.start<o.span.end;)f+=1;if(h<f)return{level:l,lateralStart:h,lateralEnd:f}}return null}function KN(n,e){const t=Up((r,i,o)=>vo(r),(r,i,o)=>{let{nextLevelNodes:s,thickness:a}=r,l=a+o,u=a/l,c,d=[];if(!s.length)c=e;else for(let f of s)if(c===void 0){let p=t(f,i,l);c=p[0],d.push(p[1])}else{let p=t(f,c,0);d.push(p[1])}let h=(c-i)*u;return[c-h,Object.assign(Object.assign({},r),{thickness:h,nextLevelNodes:d})]});return n.map(r=>t(r,0,0)[1])}function QN(n){let e=[];const t=Up((i,o,s)=>vo(i),(i,o,s)=>{let a=Object.assign(Object.assign({},i),{levelCoord:o,stackDepth:s,stackForward:0});return e.push(a),a.stackForward=r(i.nextLevelNodes,o+i.thickness,s+1)+1});function r(i,o,s){let a=0;for(let l of i)a=Math.max(t(l,o,s),a);return a}return r(n,0,0),e}function Up(n,e){const t={};return(...r)=>{let i=n(...r);return i in t?t[i]:t[i]=e(...r)}}function py(n,e,t=null,r=0){let i=[];if(t)for(let o=0;o<n.length;o+=1){let s=n[o],a=t.computeDateTop(s.start,e),l=Math.max(a+(r||0),t.computeDateTop(s.end,e));i.push({start:Math.round(a),end:Math.round(l)})}return i}function JN(n,e,t,r){let i=[],o=[];for(let u=0;u<n.length;u+=1){let c=e[u];c?i.push({index:u,thickness:1,span:c}):o.push(n[u])}let{segRects:s,hiddenGroups:a}=$N(i,t,r),l=[];for(let u of s)l.push({seg:n[u.index],rect:u});for(let u of o)l.push({seg:u,rect:null});return{segPlacements:l,hiddenGroups:a}}const ZN=tt({hour:"numeric",minute:"2-digit",meridiem:!1});class I1 extends ze{render(){return O(Bp,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:ZN}))}}class eF extends ze{constructor(){super(...arguments),this.sortEventSegs=ge(Rp)}render(){let{props:e,context:t}=this,{options:r}=t,i=r.selectMirror,o=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||i&&e.dateSelectionSegs||[],s=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},a=this.sortEventSegs(e.fgEventSegs,r.eventOrder);return O(Wp,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},l=>O("div",{className:"fc-timegrid-col-frame"},O("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),O("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(a,s,!1,!1,!1)),O("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(o,{},!!e.eventDrag,!!e.eventResize,!!i,"mirror")),O("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),zp(r)&&O(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,r,i,o,s){let{props:a}=this;return a.forPrint?M1(e,a):this.renderPositionedFgSegs(e,t,r,i,o,s)}renderPositionedFgSegs(e,t,r,i,o,s){let{eventMaxStack:a,eventShortHeight:l,eventOrderStrict:u,eventMinHeight:c}=this.context.options,{date:d,slatCoords:h,eventSelection:f,todayRange:p,nowDate:g}=this.props,m=r||i||o,v=py(e,d,h,c),{segPlacements:y,hiddenGroups:b}=JN(e,v,u,a);return O(Ge,null,this.renderHiddenGroups(b,e),y.map(x=>{let{seg:w,rect:_}=x,C=w.eventRange.instance.instanceId,E=m||!!(!t[C]&&_),S=Qd(_&&_.span),D=!m&&_?this.computeSegHStyle(_):{left:0,right:0},k=!!_&&_.stackForward>0,M=!!_&&_.span.end-_.span.start<l;return O("div",{className:"fc-timegrid-event-harness"+(k?" fc-timegrid-event-harness-inset":""),key:s||C,style:Object.assign(Object.assign({visibility:E?"":"hidden"},S),D)},O(I1,Object.assign({seg:w,isDragging:r,isResizing:i,isDateSelecting:o,isSelected:C===f,isShort:M},Zr(w,p,g))))}))}renderHiddenGroups(e,t){let{extraDateSpan:r,dateProfile:i,todayRange:o,nowDate:s,eventSelection:a,eventDrag:l,eventResize:u}=this.props;return O(Ge,null,e.map(c=>{let d=Qd(c.span),h=tF(c.entries,t);return O(UN,{key:_w(h1(h)),hiddenSegs:h,top:d.top,bottom:d.bottom,extraDateSpan:r,dateProfile:i,todayRange:o,nowDate:s,eventSelection:a,eventDrag:l,eventResize:u})}))}renderFillSegs(e,t){let{props:r,context:i}=this,s=py(e,r.date,r.slatCoords,i.options.eventMinHeight).map((a,l)=>{let u=e[l];return O("div",{key:Vw(u.eventRange),className:"fc-timegrid-bg-harness",style:Qd(a)},t==="bg-event"?O(l1,Object.assign({seg:u},Zr(u,r.todayRange,r.nowDate))):u1(t))});return O(Ge,null,s)}renderNowIndicator(e){let{slatCoords:t,date:r}=this.props;return t?e.map((i,o)=>O(Hp,{key:o,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(i.start,r)},isAxis:!1,date:r})):null}computeSegHStyle(e){let{isRtl:t,options:r}=this.context,i=r.slotEventOverlap,o=e.levelCoord,s=e.levelCoord+e.thickness,a,l;i&&(s=Math.min(1,o+(s-o)*2)),t?(a=1-s,l=o):(a=o,l=1-s);let u={zIndex:e.stackDepth+1,left:a*100+"%",right:l*100+"%"};return i&&!e.stackForward&&(u[t?"marginLeft":"marginRight"]=20),u}}function M1(n,{todayRange:e,nowDate:t,eventSelection:r,eventDrag:i,eventResize:o}){let s=(i?i.affectedInstances:null)||(o?o.affectedInstances:null)||{};return O(Ge,null,n.map(a=>{let l=a.eventRange.instance.instanceId;return O("div",{key:l,style:{visibility:s[l]?"hidden":""}},O(I1,Object.assign({seg:a,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===r,isShort:!1},Zr(a,e,t))))}))}function Qd(n){return n?{top:n.start,bottom:-n.end}:{top:"",bottom:""}}function tF(n,e){return n.map(t=>e[t.index])}class nF extends ze{constructor(){super(...arguments),this.splitFgEventSegs=ge(Vs),this.splitBgEventSegs=ge(Vs),this.splitBusinessHourSegs=ge(Vs),this.splitNowIndicatorSegs=ge(Vs),this.splitDateSelectionSegs=ge(Vs),this.splitEventDrag=ge(hy),this.splitEventResize=ge(hy),this.rootElRef=un(),this.cellElRefs=new Yr}render(){let{props:e,context:t}=this,r=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),i=e.cells.length,o=this.splitFgEventSegs(e.fgEventSegs,i),s=this.splitBgEventSegs(e.bgEventSegs,i),a=this.splitBusinessHourSegs(e.businessHourSegs,i),l=this.splitNowIndicatorSegs(e.nowIndicatorSegs,i),u=this.splitDateSelectionSegs(e.dateSelectionSegs,i),c=this.splitEventDrag(e.eventDrag,i),d=this.splitEventResize(e.eventResize,i);return O("div",{className:"fc-timegrid-cols",ref:this.rootElRef},O("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,O("tbody",{role:"presentation"},O("tr",{role:"row"},e.axis&&O("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},O("div",{className:"fc-timegrid-col-frame"},O("div",{className:"fc-timegrid-now-indicator-container"},typeof r=="number"&&O(Hp,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:r},isAxis:!0,date:e.nowDate})))),e.cells.map((h,f)=>O(eF,{key:h.key,elRef:this.cellElRefs.createRef(h.key),dateProfile:e.dateProfile,date:h.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:h.extraRenderProps,extraDataAttrs:h.extraDataAttrs,extraClassNames:h.extraClassNames,extraDateSpan:h.extraDateSpan,fgEventSegs:o[f],bgEventSegs:s[f],businessHourSegs:a[f],nowIndicatorSegs:l[f],dateSelectionSegs:u[f],eventDrag:c[f],eventResize:d[f],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new Es(this.rootElRef.current,rF(this.cellElRefs.currentMap,e.cells),!0,!1))}}function rF(n,e){return e.map(t=>n[t.key])}class iF extends ur{constructor(){super(...arguments),this.processSlotOptions=ge(oF),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:r}=this.state;if(t&&r){if(e.time){let i=r.computeTimeTop(e.time);i=Math.ceil(i),i&&(i+=1),t(i)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return O("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},O(zN,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),O(nF,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:r,options:i}=this.context,{colCoords:o}=this,{dateProfile:s}=this.props,{slatCoords:a}=this.state,{snapDuration:l,snapsPerSlot:u}=this.processSlotOptions(this.props.slotDuration,i.snapDuration),c=o.leftToIndex(e),d=a.positions.topToIndex(t);if(c!=null&&d!=null){let h=this.props.cells[c],f=a.positions.tops[d],p=a.positions.getHeight(d),g=(t-f)/p,m=Math.floor(g*u),v=d*u+m,y=this.props.cells[c].date,b=Zh(s.slotMinTime,KT(l,v)),x=r.add(y,b),w=r.add(x,l);return{dateProfile:s,dateSpan:Object.assign({range:{start:x,end:w},allDay:!1},h.extraDateSpan),dayEl:o.els[c],rect:{left:o.lefts[c],right:o.rights[c],top:f,bottom:f+p},layer:0}}return null}}function oF(n,e){let t=e||n,r=gp(n,t);return r===null&&(t=n,r=1),{snapDuration:t,snapsPerSlot:r}}class sF extends t1{sliceRange(e,t){let r=[];for(let i=0;i<t.length;i+=1){let o=Oi(e,t[i]);o&&r.push({start:o.start,end:o.end,isStart:o.start.valueOf()===e.start.valueOf(),isEnd:o.end.valueOf()===e.end.valueOf(),col:i})}return r}}class aF extends ur{constructor(){super(...arguments),this.buildDayRanges=ge(lF),this.slicer=new sF,this.timeColsRef=un()}render(){let{props:e,context:t}=this,{dateProfile:r,dayTableModel:i}=e,{nowIndicator:o,nextDayThreshold:s}=t.options,a=this.buildDayRanges(i,r,t.dateEnv);return O(Mo,{unit:o?"minute":"day"},(l,u)=>O(iF,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,r,null,t,a),{forPrint:e.forPrint,axis:e.axis,dateProfile:r,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:i.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:l,nowIndicatorSegs:o&&this.slicer.sliceNowDate(l,r,s,t,a),todayRange:u,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}}function lF(n,e,t){let r=[];for(let i of n.headerDates)r.push({start:t.add(i,e.slotMinTime),end:t.add(i,e.slotMaxTime)});return r}const gy=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function uF(n,e,t,r,i){let o=new Date(0),s=n,a=Fe(0),l=t||cF(r),u=[];for(;rr(s)<rr(e);){let c=i.add(o,s),d=gp(a,l)!==null;u.push({date:c,time:s,key:c.toISOString(),isoTimeStr:hI(c),isLabeled:d}),s=Zh(s,r),a=Zh(a,r)}return u}function cF(n){let e,t,r;for(e=gy.length-1;e>=0;e-=1)if(t=Fe(gy[e]),r=gp(t,n),r!==null&&r>1)return t;return n}class dF extends LN{constructor(){super(...arguments),this.buildTimeColsModel=ge(hF),this.buildSlatMetas=ge(uF)}render(){let{options:e,dateEnv:t,dateProfileGenerator:r}=this.context,{props:i}=this,{dateProfile:o}=i,s=this.buildTimeColsModel(o,r),a=this.allDaySplitter.splitProps(i),l=this.buildSlatMetas(o.slotMinTime,o.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:u}=e,c=!u,d=u,h=e.dayHeaders&&O(Jw,{dates:s.headerDates,dateProfile:o,datesRepDistinctDays:!0,renderIntro:c?this.renderHeadAxis:null}),f=e.allDaySlot!==!1&&(g=>O(R1,Object.assign({},a.allDay,{dateProfile:o,dayTableModel:s,nextDayThreshold:e.nextDayThreshold,tableMinWidth:g.tableMinWidth,colGroupNode:g.tableColGroupNode,renderRowIntro:c?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:g.clientWidth,clientHeight:g.clientHeight,forPrint:i.forPrint},this.getAllDayMaxEventProps()))),p=g=>O(aF,Object.assign({},a.timed,{dayTableModel:s,dateProfile:o,axis:c,slotDuration:e.slotDuration,slatMetas:l,forPrint:i.forPrint,tableColGroupNode:g.tableColGroupNode,tableMinWidth:g.tableMinWidth,clientWidth:g.clientWidth,clientHeight:g.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:g.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return d?this.renderHScrollLayout(h,f,p,s.colCnt,u,l,this.state.slatCoords):this.renderSimpleLayout(h,f,p)}}function hF(n,e){let t=new Zw(n.renderRange,e);return new e1(t,!1)}var fF='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';Dc(fF);const pF={allDaySlot:Boolean};var gF=Pr({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:pF,views:{timeGrid:{component:dF,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});class mF extends ze{constructor(){super(...arguments),this.state={textId:Di()}}render(){let{theme:e,dateEnv:t,options:r,viewApi:i}=this.context,{cellId:o,dayDate:s,todayRange:a}=this.props,{textId:l}=this.state,u=Mp(s,a),c=r.listDayFormat?t.format(s,r.listDayFormat):"",d=r.listDaySideFormat?t.format(s,r.listDaySideFormat):"",h=Object.assign({date:t.toDate(s),view:i,textId:l,text:c,sideText:d,navLinkAttrs:Cs(this.context,s),sideNavLinkAttrs:Cs(this.context,s,"day",!1)},u);return O(rn,{elTag:"tr",elClasses:["fc-list-day",...Ic(u,e)],elAttrs:{"data-date":Xa(s)},renderProps:h,generatorName:"dayHeaderContent",customGenerator:r.dayHeaderContent,defaultGenerator:vF,classNameGenerator:r.dayHeaderClassNames,didMount:r.dayHeaderDidMount,willUnmount:r.dayHeaderWillUnmount},f=>O("th",{scope:"colgroup",colSpan:3,id:o,"aria-labelledby":l},O(f,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}}function vF(n){return O(Ge,null,n.text&&O("a",Object.assign({id:n.textId,className:"fc-list-day-text"},n.navLinkAttrs),n.text),n.sideText&&O("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},n.sideNavLinkAttrs),n.sideText))}const yF=tt({hour:"numeric",minute:"2-digit",meridiem:"short"});class bF extends ze{render(){let{props:e,context:t}=this,{options:r}=t,{seg:i,timeHeaderId:o,eventHeaderId:s,dateHeaderId:a}=e,l=r.eventTimeFormat||yF;return O(Mc,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",i.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>xF(i,t),seg:i,timeText:"",disableDragging:!0,disableResizing:!0}),(u,c)=>O(Ge,null,wF(i,l,t,o,a),O("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},O("span",{className:"fc-list-event-dot",style:{borderColor:c.borderColor||c.backgroundColor}})),O(u,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${s} ${a}`}})))}}function xF(n,e){let t=Tp(n,e);return O("a",Object.assign({},t),n.eventRange.def.title)}function wF(n,e,t,r,i){let{options:o}=t;if(o.displayEventTime!==!1){let s=n.eventRange.def,a=n.eventRange.instance,l=!1,u;if(s.allDay?l=!0:JI(n.eventRange.range)?n.isStart?u=da(n,e,t,null,null,a.range.start,n.end):n.isEnd?u=da(n,e,t,null,null,n.start,a.range.end):l=!0:u=da(n,e,t),l){let c={text:t.options.allDayText,view:t.viewApi};return O(rn,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${r} ${i}`},renderProps:c,generatorName:"allDayContent",customGenerator:o.allDayContent,defaultGenerator:_F,classNameGenerator:o.allDayClassNames,didMount:o.allDayDidMount,willUnmount:o.allDayWillUnmount})}return O("td",{className:"fc-list-event-time"},u)}return null}function _F(n){return n.text}class CF extends ur{constructor(){super(...arguments),this.computeDateVars=ge(SF),this.eventStoreToSegs=ge(this._eventStoreToSegs),this.state={timeHeaderId:Di(),eventHeaderId:Di(),dateHeaderIdRoot:Di()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:t}=this,{dayDates:r,dayRanges:i}=this.computeDateVars(e.dateProfile),o=this.eventStoreToSegs(e.eventStore,e.eventUiBases,i);return O(Sa,{elRef:this.setRootEl,elClasses:["fc-list",t.theme.getClass("table"),t.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:t.viewSpec},O(o1,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},o.length>0?this.renderSegList(o,r):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:t}=this.context,r={text:e.noEventsText,view:t};return O(rn,{elTag:"div",elClasses:["fc-list-empty"],renderProps:r,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:EF,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},i=>O(i,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,t){let{theme:r,options:i}=this.context,{timeHeaderId:o,eventHeaderId:s,dateHeaderIdRoot:a}=this.state,l=DF(e);return O(Mo,{unit:"day"},(u,c)=>{let d=[];for(let h=0;h<l.length;h+=1){let f=l[h];if(f){let p=Xa(t[h]),g=a+"-"+p;d.push(O(mF,{key:p,cellId:g,dayDate:t[h],todayRange:c})),f=Rp(f,i.eventOrder);for(let m of f)d.push(O(bF,Object.assign({key:p+":"+m.eventRange.instance.instanceId,seg:m,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:o,eventHeaderId:s,dateHeaderId:g},Zr(m,c,u))))}}return O("table",{className:"fc-list-table "+r.getClass("table")},O("thead",null,O("tr",null,O("th",{scope:"col",id:o},i.timeHint),O("th",{scope:"col","aria-hidden":!0}),O("th",{scope:"col",id:s},i.eventHint))),O("tbody",null,d))})}_eventStoreToSegs(e,t,r){return this.eventRangesToSegs(of(e,t,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,r)}eventRangesToSegs(e,t){let r=[];for(let i of e)r.push(...this.eventRangeToSegs(i,t));return r}eventRangeToSegs(e,t){let{dateEnv:r}=this.context,{nextDayThreshold:i}=this.context.options,o=e.range,s=e.def.allDay,a,l,u,c=[];for(a=0;a<t.length;a+=1)if(l=Oi(o,t[a]),l&&(u={component:this,eventRange:e,start:l.start,end:l.end,isStart:e.isStart&&l.start.valueOf()===o.start.valueOf(),isEnd:e.isEnd&&l.end.valueOf()===o.end.valueOf(),dayIndex:a},c.push(u),!u.isEnd&&!s&&a+1<t.length&&o.end<r.add(t[a+1].start,i))){u.end=o.end,u.isEnd=!0;break}return c}}function EF(n){return n.text}function SF(n){let e=Xe(n.renderRange.start),t=n.renderRange.end,r=[],i=[];for(;e<t;)r.push(e),i.push({start:e,end:St(e,1)}),e=St(e,1);return{dayDates:r,dayRanges:i}}function DF(n){let e=[],t,r;for(t=0;t<n.length;t+=1)r=n[t],(e[r.dayIndex]||(e[r.dayIndex]=[])).push(r);return e}var AF=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';Dc(AF);const kF={listDayFormat:my,listDaySideFormat:my,noEventsClassNames:V,noEventsContent:V,noEventsDidMount:V,noEventsWillUnmount:V};function my(n){return n===!1?null:tt(n)}var RF=Pr({name:"@fullcalendar/list",optionRefiners:kF,views:{list:{component:CF,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});Fp.touchMouseIgnoreWait=500;let df=0,Wu=0,hf=!1;class O1{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&TF(t)&&this.tryStart(t)){let r=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let r=this.createEventFromMouse(t);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let r=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r);let i=t.target;this.shouldIgnoreMove||i.addEventListener("touchmove",this.handleTouchMove),i.addEventListener("touchend",this.handleTouchEnd),i.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let r=this.createEventFromTouch(t);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleTouchEnd=t=>{if(this.isDragging){let r=t.target;r.removeEventListener("touchmove",this.handleTouchMove),r.removeEventListener("touchend",this.handleTouchEnd),r.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,IF()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let r=window.scrollX-this.prevScrollX+this.prevPageX,i=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:r,pageY:i,deltaX:r-this.origPageX,deltaY:i-this.origPageY})}},this.containerEl=e,this.emitter=new Tc,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),MF()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),OF()}tryStart(e){let t=this.querySubjectEl(e),r=e.target;return t&&(!this.handleSelector||Kt(r,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){hf=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?Kt(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return df||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(hf=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let r=0,i=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(r=e.pageX-this.origPageX,i=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:r,deltaY:i}}createEventFromTouch(e,t){let r=e.touches,i,o,s=0,a=0;return r&&r.length?(i=r[0].pageX,o=r[0].pageY):(i=e.pageX,o=e.pageY),t?(this.origPageX=i,this.origPageY=o):(s=i-this.origPageX,a=o-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:i,pageY:o,deltaX:s,deltaY:a}}}function TF(n){return n.button===0&&!n.ctrlKey}function IF(){df+=1,setTimeout(()=>{df-=1},Fp.touchMouseIgnoreWait)}function MF(){Wu+=1,Wu===1&&window.addEventListener("touchmove",P1,{passive:!1})}function OF(){Wu-=1,Wu||window.removeEventListener("touchmove",P1,{passive:!1})}function P1(n){hf&&n.preventDefault()}class PF{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,r){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=r-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let r=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(r,this.revertDuration):setTimeout(r,0)}doRevertAnimation(e,t){let r=this.mirrorEl,i=this.sourceEl.getBoundingClientRect();r.style.transition="top "+t+"ms,left "+t+"ms",la(r,{left:i.left,top:i.top}),NT(r,()=>{r.style.transition="",e()})}cleanup(){this.mirrorEl&&(hp(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&la(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),la(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}}class N1 extends Pp{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}}class F1 extends N1{constructor(e,t){super(new sO(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return iO(this.scrollController.el)}}class NF extends N1{constructor(e){super(new aO,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}}const vy=typeof performance=="function"?performance.now:Date.now;class FF{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=vy();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,r){this.isEnabled&&(this.scrollCaches=this.buildCaches(r),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let r=e-window.scrollX,i=t-window.scrollY,o=this.pointerScreenY===null?0:i-this.pointerScreenY,s=this.pointerScreenX===null?0:r-this.pointerScreenX;o<0?this.everMovedUp=!0:o>0&&(this.everMovedDown=!0),s<0?this.everMovedLeft=!0:s>0&&(this.everMovedRight=!0),this.pointerScreenX=r,this.pointerScreenY=i,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(vy()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:r}=e,{edgeThreshold:i}=this,o=i-e.distance,s=o*o/(i*i)*this.maxVelocity*t,a=1;switch(e.name){case"left":a=-1;case"right":r.setScrollLeft(r.getScrollLeft()+s*a);break;case"top":a=-1;case"bottom":r.setScrollTop(r.getScrollTop()+s*a);break}}computeBestEdge(e,t){let{edgeThreshold:r}=this,i=null,o=this.scrollCaches||[];for(let s of o){let a=s.clientRect,l=e-a.left,u=a.right-e,c=t-a.top,d=a.bottom-t;l>=0&&u>=0&&c>=0&&d>=0&&(c<=r&&this.everMovedUp&&s.canScrollUp()&&(!i||i.distance>c)&&(i={scrollCache:s,name:"top",distance:c}),d<=r&&this.everMovedDown&&s.canScrollDown()&&(!i||i.distance>d)&&(i={scrollCache:s,name:"bottom",distance:d}),l<=r&&this.everMovedLeft&&s.canScrollLeft()&&(!i||i.distance>l)&&(i={scrollCache:s,name:"left",distance:l}),u<=r&&this.everMovedRight&&s.canScrollRight()&&(!i||i.distance>u)&&(i={scrollCache:s,name:"right",distance:u}))}return i}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new NF(!1):new F1(t,!1))}queryScrollEls(e){let t=[];for(let r of this.scrollQuery)typeof r=="object"?t.push(r):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(r)));return t}}class Qa extends cO{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=i=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,FT(document.body),BT(document.body),i.isTouch||i.origEvent.preventDefault(),this.emitter.trigger("pointerdown",i),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(i.subjectEl,i.pageX,i.pageY),this.startDelay(i),this.minDistance||this.handleDistanceSurpassed(i)))},this.onPointerMove=i=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",i),!this.isDistanceSurpassed){let o=this.minDistance,s,{deltaX:a,deltaY:l}=i;s=a*a+l*l,s>=o*o&&this.handleDistanceSurpassed(i)}this.isDragging&&(i.origEvent.type!=="scroll"&&(this.mirror.handleMove(i.pageX,i.pageY),this.autoScroller.handleMove(i.pageX,i.pageY)),this.emitter.trigger("dragmove",i))}},this.onPointerUp=i=>{this.isInteracting&&(this.isInteracting=!1,LT(document.body),HT(document.body),this.emitter.trigger("pointerup",i),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(i)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let r=this.pointer=new O1(e);r.emitter.on("pointerdown",this.onPointerDown),r.emitter.on("pointermove",this.onPointerMove),r.emitter.on("pointerup",this.onPointerUp),t&&(r.selector=t),this.mirror=new PF,this.autoScroller=new FF}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}}class LF{constructor(e){this.el=e,this.origRect=Op(e),this.scrollCaches=Yw(e).map(t=>new F1(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let r={left:e,top:t};for(let i of this.scrollCaches)if(!BF(i.getEventTarget())&&!$M(r,i.clientRect))return!1;return!0}}function BF(n){let e=n.tagName;return e==="HTML"||e==="BODY"}class Oc{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=r=>{let{dragging:i}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(r),this.initialHit||!this.requireInitial?(i.setIgnoreMove(!1),this.emitter.trigger("pointerdown",r)):i.setIgnoreMove(!0)},this.handleDragStart=r=>{this.emitter.trigger("dragstart",r),this.handleMove(r,!0)},this.handleDragMove=r=>{this.emitter.trigger("dragmove",r),this.handleMove(r)},this.handlePointerUp=r=>{this.releaseHits(),this.emitter.trigger("pointerup",r)},this.handleDragEnd=r=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,r),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",r)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new Tc}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},r=t,i=e.subjectEl,o;i instanceof HTMLElement&&(o=Op(i),r=GM(r,o));let s=this.initialHit=this.queryHitForOffset(r.left,r.top);if(s){if(this.useSubjectCenter&&o){let a=Gw(o,s.rect);a&&(r=qM(a))}this.coordAdjust=YM(r,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let r=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!Pc(this.movingHit,r))&&(this.movingHit=r,this.emitter.trigger("hitupdate",r,!1,e))}prepareHits(){this.offsetTrackers=ei(this.droppableStore,e=>(e.component.prepareHits(),new LF(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:r,offsetTrackers:i}=this,o=null;for(let s in r){let a=r[s].component,l=i[s];if(l&&l.isWithinClipping(e,t)){let u=l.computeLeft(),c=l.computeTop(),d=e-u,h=t-c,{origRect:f}=l,p=f.right-f.left,g=f.bottom-f.top;if(d>=0&&d<p&&h>=0&&h<g){let m=a.queryHit(d,h,p,g);m&&kc(m.dateProfile.activeRange,m.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(d+u-window.scrollX,h+c-window.scrollY)))&&(!o||m.layer>o.layer)&&(m.componentId=s,m.context=a.context,m.rect.left+=u,m.rect.right+=u,m.rect.top+=c,m.rect.bottom+=c,o=m)}}}return o}}function Pc(n,e){return!n&&!e?!0:!!n!=!!e?!1:PM(n.dateSpan,e.dateSpan)}function L1(n,e){let t={};for(let r of e.pluginHooks.datePointTransforms)Object.assign(t,r(n,e));return Object.assign(t,HF(n,e.dateEnv)),t}function HF(n,e){return{date:e.toDate(n.range.start),dateStr:e.formatIso(n.range.start,{omitTime:n.allDay}),allDay:n.allDay}}class WF extends Ps{constructor(e){super(e),this.handlePointerDown=r=>{let{dragging:i}=this,o=r.origEvent.target;i.setIgnoreMove(!this.component.isValidDateDownEl(o))},this.handleDragEnd=r=>{let{component:i}=this,{pointer:o}=this.dragging;if(!o.wasTouchScroll){let{initialHit:s,finalHit:a}=this.hitDragging;if(s&&a&&Pc(s,a)){let{context:l}=i,u=Object.assign(Object.assign({},L1(s.dateSpan,l)),{dayEl:s.dayEl,jsEvent:r.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",u)}}},this.dragging=new Qa(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Oc(this.dragging,Ip(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}}class zF extends Ps{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=s=>{let{component:a,dragging:l}=this,{options:u}=a.context,c=u.selectable&&a.isValidDateDownEl(s.origEvent.target);l.setIgnoreMove(!c),l.delay=s.isTouch?VF(a):null},this.handleDragStart=s=>{this.component.context.calendarApi.unselect(s)},this.handleHitUpdate=(s,a)=>{let{context:l}=this.component,u=null,c=!1;if(s){let d=this.hitDragging.initialHit;s.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,s)||(u=UF(d,s,l.pluginHooks.dateSelectionTransformers)),(!u||!mO(u,s.dateProfile,l))&&(c=!0,u=null)}u?l.dispatch({type:"SELECT_DATES",selection:u}):a||l.dispatch({type:"UNSELECT_DATES"}),c?fp():pp(),a||(this.dragSelection=u)},this.handlePointerUp=s=>{this.dragSelection&&(Hw(this.dragSelection,s,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:r}=t.context,i=this.dragging=new Qa(e.el);i.touchScrollAllowed=!1,i.minDistance=r.selectMinDistance||0,i.autoScroller.isEnabled=r.dragScroll;let o=this.hitDragging=new Oc(this.dragging,Ip(e));o.emitter.on("pointerdown",this.handlePointerDown),o.emitter.on("dragstart",this.handleDragStart),o.emitter.on("hitupdate",this.handleHitUpdate),o.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}}function VF(n){let{options:e}=n.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function UF(n,e,t){let r=n.dateSpan,i=e.dateSpan,o=[r.range.start,r.range.end,i.range.start,i.range.end];o.sort(jT);let s={};for(let a of t){let l=a(n,e);if(l===!1)return null;l&&Object.assign(s,l)}return s.range={start:o[0],end:o[3]},s.allDay=r.allDay,s}class Ja extends Ps{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=s=>{let a=s.origEvent.target,{component:l,dragging:u}=this,{mirror:c}=u,{options:d}=l.context,h=l.context;this.subjectEl=s.subjectEl;let f=this.subjectSeg=_s(s.subjectEl),g=(this.eventRange=f.eventRange).instance.instanceId;this.relevantEvents=Sp(h.getCurrentData().eventStore,g),u.minDistance=s.isTouch?0:d.eventDragMinDistance,u.delay=s.isTouch&&g!==l.props.eventSelection?$F(l):null,d.fixedMirrorParent?c.parentNode=d.fixedMirrorParent:c.parentNode=Kt(a,".fc"),c.revertDuration=d.dragRevertDuration;let m=l.isValidSegDownEl(a)&&!Kt(a,".fc-event-resizer");u.setIgnoreMove(!m),this.isDragging=m&&s.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=s=>{let a=this.component.context,l=this.eventRange,u=l.instance.instanceId;s.isTouch?u!==this.component.props.eventSelection&&a.dispatch({type:"SELECT_EVENT",eventInstanceId:u}):a.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(a.calendarApi.unselect(s),a.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new ut(a,l.def,l.instance),jsEvent:s.origEvent,view:a.viewApi}))},this.handleHitUpdate=(s,a)=>{if(!this.isDragging)return;let l=this.relevantEvents,u=this.hitDragging.initialHit,c=this.component.context,d=null,h=null,f=null,p=!1,g={affectedEvents:l,mutatedEvents:zn(),isEvent:!0};if(s){d=s.context;let m=d.options;c===d||m.editable&&m.droppable?(h=jF(u,s,this.eventRange.instance.range.start,d.getCurrentData().pluginHooks.eventDragMutationMassagers),h&&(f=kp(l,d.getCurrentData().eventUiBases,h,d),g.mutatedEvents=f,n1(g,s.dateProfile,d)||(p=!0,h=null,f=null,g.mutatedEvents=zn()))):d=null}this.displayDrag(d,g),p?fp():pp(),a||(c===d&&Pc(u,s)&&(h=null),this.dragging.setMirrorNeedsRevert(!h),this.dragging.setMirrorIsVisible(!s||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=d,this.validMutation=h,this.mutatedRelevantEvents=f)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=s=>{if(this.isDragging){let a=this.component.context,l=a.viewApi,{receivingContext:u,validMutation:c}=this,d=this.eventRange.def,h=this.eventRange.instance,f=new ut(a,d,h),p=this.relevantEvents,g=this.mutatedRelevantEvents,{finalHit:m}=this.hitDragging;if(this.clearDrag(),a.emitter.trigger("eventDragStop",{el:this.subjectEl,event:f,jsEvent:s.origEvent,view:l}),c){if(u===a){let v=new ut(a,g.defs[d.defId],h?g.instances[h.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:g});let y={oldEvent:f,event:v,relatedEvents:mo(g,a,h),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:p})}},b={};for(let x of a.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(b,x(c,a));a.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},y),b),{el:s.subjectEl,delta:c.datesDelta,jsEvent:s.origEvent,view:l})),a.emitter.trigger("eventChange",y)}else if(u){let v={event:f,relatedEvents:mo(p,a,h),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:p})}};a.emitter.trigger("eventLeave",Object.assign(Object.assign({},v),{draggedEl:s.subjectEl,view:l})),a.dispatch({type:"REMOVE_EVENTS",eventStore:p}),a.emitter.trigger("eventRemove",v);let y=g.defs[d.defId],b=g.instances[h.instanceId],x=new ut(u,y,b);u.dispatch({type:"MERGE_EVENTS",eventStore:g});let w={event:x,relatedEvents:mo(g,u,b),revert(){u.dispatch({type:"REMOVE_EVENTS",eventStore:g})}};u.emitter.trigger("eventAdd",w),s.isTouch&&u.dispatch({type:"SELECT_EVENT",eventInstanceId:h.instanceId}),u.emitter.trigger("drop",Object.assign(Object.assign({},L1(m.dateSpan,u)),{draggedEl:s.subjectEl,jsEvent:s.origEvent,view:m.context.viewApi})),u.emitter.trigger("eventReceive",Object.assign(Object.assign({},w),{draggedEl:s.subjectEl,view:m.context.viewApi}))}}else a.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:r}=t.context,i=this.dragging=new Qa(e.el);i.pointer.selector=Ja.SELECTOR,i.touchScrollAllowed=!1,i.autoScroller.isEnabled=r.dragScroll;let o=this.hitDragging=new Oc(this.dragging,sf);o.useSubjectCenter=e.useEventCenter,o.emitter.on("pointerdown",this.handlePointerDown),o.emitter.on("dragstart",this.handleDragStart),o.emitter.on("hitupdate",this.handleHitUpdate),o.emitter.on("pointerup",this.handlePointerUp),o.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let r=this.component.context,i=this.receivingContext;i&&i!==e&&(i===r?i.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:zn(),isEvent:!0}}):i.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}}Ja.SELECTOR=".fc-event-draggable, .fc-event-resizable";function jF(n,e,t,r){let i=n.dateSpan,o=e.dateSpan,s=i.range.start,a=o.range.start,l={};i.allDay!==o.allDay&&(l.allDay=o.allDay,l.hasEnd=e.context.options.allDayMaintainDuration,o.allDay?s=Xe(t):s=t);let u=ns(s,a,n.context.dateEnv,n.componentId===e.componentId?n.largeUnit:null);u.milliseconds&&(l.allDay=!1);let c={datesDelta:u,standardProps:l};for(let d of r)d(c,n,e);return c}function $F(n){let{options:e}=n.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}class GF extends Ps{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=o=>{let{component:s}=this,a=this.querySegEl(o),l=_s(a),u=this.eventRange=l.eventRange;this.dragging.minDistance=s.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(o.origEvent.target)||o.isTouch&&this.component.props.eventSelection!==u.instance.instanceId)},this.handleDragStart=o=>{let{context:s}=this.component,a=this.eventRange;this.relevantEvents=Sp(s.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(o);this.draggingSegEl=l,this.draggingSeg=_s(l),s.calendarApi.unselect(),s.emitter.trigger("eventResizeStart",{el:l,event:new ut(s,a.def,a.instance),jsEvent:o.origEvent,view:s.viewApi})},this.handleHitUpdate=(o,s,a)=>{let{context:l}=this.component,u=this.relevantEvents,c=this.hitDragging.initialHit,d=this.eventRange.instance,h=null,f=null,p=!1,g={affectedEvents:u,mutatedEvents:zn(),isEvent:!0};o&&(o.componentId===c.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(c,o)||(h=qF(c,o,a.subjectEl.classList.contains("fc-event-resizer-start"),d.range))),h&&(f=kp(u,l.getCurrentData().eventUiBases,h,l),g.mutatedEvents=f,n1(g,o.dateProfile,l)||(p=!0,h=null,f=null,g.mutatedEvents=null)),f?l.dispatch({type:"SET_EVENT_RESIZE",state:g}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),p?fp():pp(),s||(h&&Pc(c,o)&&(h=null),this.validMutation=h,this.mutatedRelevantEvents=f)},this.handleDragEnd=o=>{let{context:s}=this.component,a=this.eventRange.def,l=this.eventRange.instance,u=new ut(s,a,l),c=this.relevantEvents,d=this.mutatedRelevantEvents;if(s.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:u,jsEvent:o.origEvent,view:s.viewApi}),this.validMutation){let h=new ut(s,d.defs[a.defId],l?d.instances[l.instanceId]:null);s.dispatch({type:"MERGE_EVENTS",eventStore:d});let f={oldEvent:u,event:h,relatedEvents:mo(d,s,l),revert(){s.dispatch({type:"MERGE_EVENTS",eventStore:c})}};s.emitter.trigger("eventResize",Object.assign(Object.assign({},f),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||Fe(0),endDelta:this.validMutation.endDelta||Fe(0),jsEvent:o.origEvent,view:s.viewApi})),s.emitter.trigger("eventChange",f)}else s.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,r=this.dragging=new Qa(e.el);r.pointer.selector=".fc-event-resizer",r.touchScrollAllowed=!1,r.autoScroller.isEnabled=t.context.options.dragScroll;let i=this.hitDragging=new Oc(this.dragging,Ip(e));i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return Kt(e.subjectEl,".fc-event")}}function qF(n,e,t,r){let i=n.context.dateEnv,o=n.dateSpan.range.start,s=e.dateSpan.range.start,a=ns(o,s,i,n.largeUnit);if(t){if(i.add(r.start,a)<r.end)return{startDelta:a}}else if(i.add(r.end,a)>r.start)return{endDelta:a};return null}class YF{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=r=>{r.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=r=>{let i=this.context.options.unselectCancel,o=vw(r.origEvent);this.matchesCancel=!!Kt(o,i),this.matchesEvent=!!Kt(o,Ja.SELECTOR)},this.onDocumentPointerUp=r=>{let{context:i}=this,{documentPointer:o}=this,s=i.getCurrentData();if(!o.wasTouchScroll){if(s.dateSelection&&!this.isRecentPointerDateSelect){let a=i.options.unselectAuto;a&&(!a||!this.matchesCancel)&&i.calendarApi.unselect(r)}s.eventSelection&&!this.matchesEvent&&i.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new O1(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}}const XF={fixedMirrorParent:V},KF={dateClick:V,eventDragStart:V,eventDragStop:V,eventDrop:V,eventResizeStart:V,eventResizeStop:V,eventResize:V,drop:V,eventReceive:V,eventLeave:V};Fp.dataAttrPrefix="";var QF=Pr({name:"@fullcalendar/interaction",componentInteractions:[WF,zF,Ja,GF],calendarInteractions:[YF],elementDraggingImpl:Qa,optionRefiners:XF,listenerRefiners:KF}),JF={code:"es",week:{dow:1,doy:4},buttonText:{prev:"Ant",next:"Sig",today:"Hoy",year:"Año",month:"Mes",week:"Semana",day:"Día",list:"Agenda"},buttonHints:{prev:"$0 antes",next:"$0 siguiente",today(n){return n==="Día"?"Hoy":(n==="Semana"?"Esta":"Este")+" "+n.toLocaleLowerCase()}},viewHint(n){return"Vista "+(n==="Semana"?"de la":"del")+" "+n.toLocaleLowerCase()},weekText:"Sm",weekTextLong:"Semana",allDayText:"Todo el día",moreLinkText:"más",moreLinkHint(n){return`Mostrar ${n} eventos más`},noEventsText:"No hay eventos para mostrar",navLinkHint:"Ir al $0",closeHint:"Cerrar",timeHint:"La hora",eventHint:"Evento"},ZF={code:"fr",week:{dow:1,doy:4},buttonText:{prev:"Précédent",next:"Suivant",today:"Aujourd'hui",year:"Année",month:"Mois",week:"Semaine",day:"Jour",list:"Planning"},weekText:"Sem.",weekTextLong:"Semaine",allDayText:"Toute la journée",moreLinkText:"en plus",noEventsText:"Aucun évènement à afficher"};function yy(n,e={}){if(n=Math.round(n),!n||n===0)return"-";const t=e.min||"min",r=e.h||"h";if(n<60)return`${n}${t}`;if(n<1440){const l=Math.floor(n/60),u=Math.round(n%60);return u>0?`${l}${r} ${u}${t}`:`${l}${r}`}const i=Math.floor(n/1440),o=n%1440,s=Math.floor(o/60),a=i>1?e.days||"days":e.day||"day";return s>0?`${i} ${a} ${s}${r}`:`${i} ${a}`}function eL(n,e,t={}){const r=document.documentElement.lang||"en",i={es:JF,fr:ZF,en:"en"},o=new iN(n,{plugins:[TN,gF,RF,QF],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},locale:i[r]||"en",height:"auto",editable:!1,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,displayEventTime:!0,displayEventEnd:!0,eventDisplay:"block",events:function(s,a,l){e.call("getEvents",s.startStr,s.endStr).then(u=>{a(u)}).catch(u=>{console.error("Error loading events:",u),l(u)})},eventClick:function(s){const a=s.event,l=a.extendedProps;let u="";if(l.type==="work"){const c=l.duration?yy(l.duration,t):t.inProgress||"In progress";u=`
                    <div class="p-4">
                        <h3 class="text-lg font-bold mb-2">${a.title}</h3>
                        <p><strong>${t.start||"Start"}:</strong> ${new Date(a.start).toLocaleString(r)}</p>
                        ${a.end?`<p><strong>${t.end||"End"}:</strong> ${new Date(a.end).toLocaleString(r)}</p>`:`<p class="text-warning">${t.currentlyClocked||"Currently clocked in"}</p>`}
                        <p><strong>${t.duration||"Duration"}:</strong> ${c}</p>
                    </div>
                `}else if(l.type==="absence"){const c=new Date(a.start),d=new Date(a.end),h=Math.floor((d-c)/(1e3*60)),f=yy(h,t);u=`
                    <div class="p-4">
                        <h3 class="text-lg font-bold mb-2">${a.title}</h3>
                        <p><strong>${t.status||"Status"}:</strong> <span class="badge badge-${l.status==="approved"?"success":l.status==="pending"?"warning":"error"}">${l.statusLabel}</span></p>
                        <p><strong>${t.start||"Start"}:</strong> ${new Date(a.start).toLocaleString(r)}</p>
                        <p><strong>${t.end||"End"}:</strong> ${new Date(a.end).toLocaleString(r)}</p>
                        <p><strong>${t.duration||"Duration"}:</strong> ${f}</p>
                        ${l.isBreak?'<p class="text-info">🍽 Break</p>':""}
                        ${l.reason?`<p class="mt-2"><strong>${t.reason||"Reason"}:</strong> ${l.reason}</p>`:""}
                    </div>
                `}tL(u,t)},select:function(s){console.log("Selected dates:",s.startStr,"to",s.endStr)}});return o.render(),o}function tL(n,e={}){const t=document.createElement("dialog");t.className="modal",t.innerHTML=`
        <div class="modal-box">
            ${n}
            <div class="modal-action">
                <button class="btn" onclick="this.closest('dialog').close()">${e.close||"Close"}</button>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    `,document.body.appendChild(t),t.showModal(),t.addEventListener("close",()=>{t.remove()})}window.initializeCalendar=eL;/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function by(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function B1(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?by(Object(t),!0).forEach(function(r){oL(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):by(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function nL(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function H1(n){var e=nL(n,"string");return typeof e=="symbol"?e:e+""}function ff(n){"@babel/helpers - typeof";return ff=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ff(n)}function rL(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function xy(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,H1(r.key),r)}}function iL(n,e,t){return e&&xy(n.prototype,e),t&&xy(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function oL(n,e,t){return e=H1(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function W1(n){return sL(n)||aL(n)||lL(n)||uL()}function sL(n){if(Array.isArray(n))return pf(n)}function aL(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function lL(n,e){if(n){if(typeof n=="string")return pf(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return pf(n,e)}}function pf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function uL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Nc=typeof window<"u"&&typeof window.document<"u",Mr=Nc?window:{},jp=Nc&&Mr.document.documentElement?"ontouchstart"in Mr.document.documentElement:!1,$p=Nc?"PointerEvent"in Mr:!1,st="cropper",Gp="all",z1="crop",V1="move",U1="zoom",Xi="e",Ki="w",Uo="s",hi="n",Us="ne",js="nw",$s="se",Gs="sw",gf="".concat(st,"-crop"),wy="".concat(st,"-disabled"),mn="".concat(st,"-hidden"),_y="".concat(st,"-hide"),cL="".concat(st,"-invisible"),zu="".concat(st,"-modal"),mf="".concat(st,"-move"),Aa="".concat(st,"Action"),Il="".concat(st,"Preview"),qp="crop",j1="move",$1="none",vf="crop",yf="cropend",bf="cropmove",xf="cropstart",Cy="dblclick",dL=jp?"touchstart":"mousedown",hL=jp?"touchmove":"mousemove",fL=jp?"touchend touchcancel":"mouseup",Ey=$p?"pointerdown":dL,Sy=$p?"pointermove":hL,Dy=$p?"pointerup pointercancel":fL,Ay="ready",ky="resize",Ry="wheel",wf="zoom",Ty="image/jpeg",pL=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,gL=/^data:/,mL=/^data:image\/jpeg;base64,/,vL=/^img|canvas$/i,G1=200,q1=100,Iy={viewMode:0,dragMode:qp,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:G1,minContainerHeight:q1,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},yL='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',bL=Number.isNaN||Mr.isNaN;function Pe(n){return typeof n=="number"&&!bL(n)}var My=function(e){return e>0&&e<1/0};function Jd(n){return typeof n>"u"}function So(n){return ff(n)==="object"&&n!==null}var xL=Object.prototype.hasOwnProperty;function rs(n){if(!So(n))return!1;try{var e=n.constructor,t=e.prototype;return e&&t&&xL.call(t,"isPrototypeOf")}catch{return!1}}function pn(n){return typeof n=="function"}var wL=Array.prototype.slice;function Y1(n){return Array.from?Array.from(n):wL.call(n)}function Ct(n,e){return n&&pn(e)&&(Array.isArray(n)||Pe(n.length)?Y1(n).forEach(function(t,r){e.call(n,t,r,n)}):So(n)&&Object.keys(n).forEach(function(t){e.call(n,n[t],t,n)})),n}var at=Object.assign||function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return So(e)&&r.length>0&&r.forEach(function(o){So(o)&&Object.keys(o).forEach(function(s){e[s]=o[s]})}),e},_L=/\.\d*(?:0|9){12}\d*$/;function cs(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return _L.test(n)?Math.round(n*e)/e:n}var CL=/^width|height|left|top|marginLeft|marginTop$/;function yi(n,e){var t=n.style;Ct(e,function(r,i){CL.test(i)&&Pe(r)&&(r="".concat(r,"px")),t[i]=r})}function EL(n,e){return n.classList?n.classList.contains(e):n.className.indexOf(e)>-1}function Nt(n,e){if(e){if(Pe(n.length)){Ct(n,function(r){Nt(r,e)});return}if(n.classList){n.classList.add(e);return}var t=n.className.trim();t?t.indexOf(e)<0&&(n.className="".concat(t," ").concat(e)):n.className=e}}function Dr(n,e){if(e){if(Pe(n.length)){Ct(n,function(t){Dr(t,e)});return}if(n.classList){n.classList.remove(e);return}n.className.indexOf(e)>=0&&(n.className=n.className.replace(e,""))}}function is(n,e,t){if(e){if(Pe(n.length)){Ct(n,function(r){is(r,e,t)});return}t?Nt(n,e):Dr(n,e)}}var SL=/([a-z\d])([A-Z])/g;function Yp(n){return n.replace(SL,"$1-$2").toLowerCase()}function _f(n,e){return So(n[e])?n[e]:n.dataset?n.dataset[e]:n.getAttribute("data-".concat(Yp(e)))}function ka(n,e,t){So(t)?n[e]=t:n.dataset?n.dataset[e]=t:n.setAttribute("data-".concat(Yp(e)),t)}function DL(n,e){if(So(n[e]))try{delete n[e]}catch{n[e]=void 0}else if(n.dataset)try{delete n.dataset[e]}catch{n.dataset[e]=void 0}else n.removeAttribute("data-".concat(Yp(e)))}var X1=/\s\s*/,K1=(function(){var n=!1;if(Nc){var e=!1,t=function(){},r=Object.defineProperty({},"once",{get:function(){return n=!0,e},set:function(o){e=o}});Mr.addEventListener("test",t,r),Mr.removeEventListener("test",t,r)}return n})();function Zn(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},i=t;e.trim().split(X1).forEach(function(o){if(!K1){var s=n.listeners;s&&s[o]&&s[o][t]&&(i=s[o][t],delete s[o][t],Object.keys(s[o]).length===0&&delete s[o],Object.keys(s).length===0&&delete n.listeners)}n.removeEventListener(o,i,r)})}function $n(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},i=t;e.trim().split(X1).forEach(function(o){if(r.once&&!K1){var s=n.listeners,a=s===void 0?{}:s;i=function(){delete a[o][t],n.removeEventListener(o,i,r);for(var u=arguments.length,c=new Array(u),d=0;d<u;d++)c[d]=arguments[d];t.apply(n,c)},a[o]||(a[o]={}),a[o][t]&&n.removeEventListener(o,a[o][t],r),a[o][t]=i,n.listeners=a}n.addEventListener(o,i,r)})}function ds(n,e,t){var r;return pn(Event)&&pn(CustomEvent)?r=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0}):(r=document.createEvent("CustomEvent"),r.initCustomEvent(e,!0,!0,t)),n.dispatchEvent(r)}function Q1(n){var e=n.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var Zd=Mr.location,AL=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Oy(n){var e=n.match(AL);return e!==null&&(e[1]!==Zd.protocol||e[2]!==Zd.hostname||e[3]!==Zd.port)}function Py(n){var e="timestamp=".concat(new Date().getTime());return n+(n.indexOf("?")===-1?"?":"&")+e}function ha(n){var e=n.rotate,t=n.scaleX,r=n.scaleY,i=n.translateX,o=n.translateY,s=[];Pe(i)&&i!==0&&s.push("translateX(".concat(i,"px)")),Pe(o)&&o!==0&&s.push("translateY(".concat(o,"px)")),Pe(e)&&e!==0&&s.push("rotate(".concat(e,"deg)")),Pe(t)&&t!==1&&s.push("scaleX(".concat(t,")")),Pe(r)&&r!==1&&s.push("scaleY(".concat(r,")"));var a=s.length?s.join(" "):"none";return{WebkitTransform:a,msTransform:a,transform:a}}function kL(n){var e=B1({},n),t=0;return Ct(n,function(r,i){delete e[i],Ct(e,function(o){var s=Math.abs(r.startX-o.startX),a=Math.abs(r.startY-o.startY),l=Math.abs(r.endX-o.endX),u=Math.abs(r.endY-o.endY),c=Math.sqrt(s*s+a*a),d=Math.sqrt(l*l+u*u),h=(d-c)/c;Math.abs(h)>Math.abs(t)&&(t=h)})}),t}function Ml(n,e){var t=n.pageX,r=n.pageY,i={endX:t,endY:r};return e?i:B1({startX:t,startY:r},i)}function RL(n){var e=0,t=0,r=0;return Ct(n,function(i){var o=i.startX,s=i.startY;e+=o,t+=s,r+=1}),e/=r,t/=r,{pageX:e,pageY:t}}function bi(n){var e=n.aspectRatio,t=n.height,r=n.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",o=My(r),s=My(t);if(o&&s){var a=t*e;i==="contain"&&a>r||i==="cover"&&a<r?t=r/e:r=t*e}else o?t=r/e:s&&(r=t*e);return{width:r,height:t}}function TL(n){var e=n.width,t=n.height,r=n.degree;if(r=Math.abs(r)%180,r===90)return{width:t,height:e};var i=r%90*Math.PI/180,o=Math.sin(i),s=Math.cos(i),a=e*s+t*o,l=e*o+t*s;return r>90?{width:l,height:a}:{width:a,height:l}}function IL(n,e,t,r){var i=e.aspectRatio,o=e.naturalWidth,s=e.naturalHeight,a=e.rotate,l=a===void 0?0:a,u=e.scaleX,c=u===void 0?1:u,d=e.scaleY,h=d===void 0?1:d,f=t.aspectRatio,p=t.naturalWidth,g=t.naturalHeight,m=r.fillColor,v=m===void 0?"transparent":m,y=r.imageSmoothingEnabled,b=y===void 0?!0:y,x=r.imageSmoothingQuality,w=x===void 0?"low":x,_=r.maxWidth,C=_===void 0?1/0:_,E=r.maxHeight,S=E===void 0?1/0:E,D=r.minWidth,k=D===void 0?0:D,M=r.minHeight,B=M===void 0?0:M,H=document.createElement("canvas"),F=H.getContext("2d"),W=bi({aspectRatio:f,width:C,height:S}),j=bi({aspectRatio:f,width:k,height:B},"cover"),U=Math.min(W.width,Math.max(j.width,p)),q=Math.min(W.height,Math.max(j.height,g)),K=bi({aspectRatio:i,width:C,height:S}),J=bi({aspectRatio:i,width:k,height:B},"cover"),ee=Math.min(K.width,Math.max(J.width,o)),re=Math.min(K.height,Math.max(J.height,s)),fe=[-ee/2,-re/2,ee,re];return H.width=cs(U),H.height=cs(q),F.fillStyle=v,F.fillRect(0,0,U,q),F.save(),F.translate(U/2,q/2),F.rotate(l*Math.PI/180),F.scale(c,h),F.imageSmoothingEnabled=b,F.imageSmoothingQuality=w,F.drawImage.apply(F,[n].concat(W1(fe.map(function(pe){return Math.floor(cs(pe))})))),F.restore(),H}var J1=String.fromCharCode;function ML(n,e,t){var r="";t+=e;for(var i=e;i<t;i+=1)r+=J1(n.getUint8(i));return r}var OL=/^data:.*,/;function PL(n){var e=n.replace(OL,""),t=atob(e),r=new ArrayBuffer(t.length),i=new Uint8Array(r);return Ct(i,function(o,s){i[s]=t.charCodeAt(s)}),r}function NL(n,e){for(var t=[],r=8192,i=new Uint8Array(n);i.length>0;)t.push(J1.apply(null,Y1(i.subarray(0,r)))),i=i.subarray(r);return"data:".concat(e,";base64,").concat(btoa(t.join("")))}function FL(n){var e=new DataView(n),t;try{var r,i,o;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var s=e.byteLength,a=2;a+1<s;){if(e.getUint8(a)===255&&e.getUint8(a+1)===225){i=a;break}a+=1}if(i){var l=i+4,u=i+10;if(ML(e,l,4)==="Exif"){var c=e.getUint16(u);if(r=c===18761,(r||c===19789)&&e.getUint16(u+2,r)===42){var d=e.getUint32(u+4,r);d>=8&&(o=u+d)}}}if(o){var h=e.getUint16(o,r),f,p;for(p=0;p<h;p+=1)if(f=o+p*12+2,e.getUint16(f,r)===274){f+=8,t=e.getUint16(f,r),e.setUint16(f,1,r);break}}}catch{t=1}return t}function LL(n){var e=0,t=1,r=1;switch(n){case 2:t=-1;break;case 3:e=-180;break;case 4:r=-1;break;case 5:e=90,r=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:r}}var BL={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,t=this.options,r=this.container,i=this.cropper,o=Number(t.minContainerWidth),s=Number(t.minContainerHeight);Nt(i,mn),Dr(e,mn);var a={width:Math.max(r.offsetWidth,o>=0?o:G1),height:Math.max(r.offsetHeight,s>=0?s:q1)};this.containerData=a,yi(i,{width:a.width,height:a.height}),Nt(e,mn),Dr(i,mn)},initCanvas:function(){var e=this.containerData,t=this.imageData,r=this.options.viewMode,i=Math.abs(t.rotate)%180===90,o=i?t.naturalHeight:t.naturalWidth,s=i?t.naturalWidth:t.naturalHeight,a=o/s,l=e.width,u=e.height;e.height*a>e.width?r===3?l=e.height*a:u=e.width/a:r===3?u=e.width/a:l=e.height*a;var c={aspectRatio:a,naturalWidth:o,naturalHeight:s,width:l,height:u};this.canvasData=c,this.limited=r===1||r===2,this.limitCanvas(!0,!0),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),c.left=(e.width-c.width)/2,c.top=(e.height-c.height)/2,c.oldLeft=c.left,c.oldTop=c.top,this.initialCanvasData=at({},c)},limitCanvas:function(e,t){var r=this.options,i=this.containerData,o=this.canvasData,s=this.cropBoxData,a=r.viewMode,l=o.aspectRatio,u=this.cropped&&s;if(e){var c=Number(r.minCanvasWidth)||0,d=Number(r.minCanvasHeight)||0;a>1?(c=Math.max(c,i.width),d=Math.max(d,i.height),a===3&&(d*l>c?c=d*l:d=c/l)):a>0&&(c?c=Math.max(c,u?s.width:0):d?d=Math.max(d,u?s.height:0):u&&(c=s.width,d=s.height,d*l>c?c=d*l:d=c/l));var h=bi({aspectRatio:l,width:c,height:d});c=h.width,d=h.height,o.minWidth=c,o.minHeight=d,o.maxWidth=1/0,o.maxHeight=1/0}if(t)if(a>(u?0:1)){var f=i.width-o.width,p=i.height-o.height;o.minLeft=Math.min(0,f),o.minTop=Math.min(0,p),o.maxLeft=Math.max(0,f),o.maxTop=Math.max(0,p),u&&this.limited&&(o.minLeft=Math.min(s.left,s.left+(s.width-o.width)),o.minTop=Math.min(s.top,s.top+(s.height-o.height)),o.maxLeft=s.left,o.maxTop=s.top,a===2&&(o.width>=i.width&&(o.minLeft=Math.min(0,f),o.maxLeft=Math.max(0,f)),o.height>=i.height&&(o.minTop=Math.min(0,p),o.maxTop=Math.max(0,p))))}else o.minLeft=-o.width,o.minTop=-o.height,o.maxLeft=i.width,o.maxTop=i.height},renderCanvas:function(e,t){var r=this.canvasData,i=this.imageData;if(t){var o=TL({width:i.naturalWidth*Math.abs(i.scaleX||1),height:i.naturalHeight*Math.abs(i.scaleY||1),degree:i.rotate||0}),s=o.width,a=o.height,l=r.width*(s/r.naturalWidth),u=r.height*(a/r.naturalHeight);r.left-=(l-r.width)/2,r.top-=(u-r.height)/2,r.width=l,r.height=u,r.aspectRatio=s/a,r.naturalWidth=s,r.naturalHeight=a,this.limitCanvas(!0,!1)}(r.width>r.maxWidth||r.width<r.minWidth)&&(r.left=r.oldLeft),(r.height>r.maxHeight||r.height<r.minHeight)&&(r.top=r.oldTop),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),this.limitCanvas(!1,!0),r.left=Math.min(Math.max(r.left,r.minLeft),r.maxLeft),r.top=Math.min(Math.max(r.top,r.minTop),r.maxTop),r.oldLeft=r.left,r.oldTop=r.top,yi(this.canvas,at({width:r.width,height:r.height},ha({translateX:r.left,translateY:r.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var t=this.canvasData,r=this.imageData,i=r.naturalWidth*(t.width/t.naturalWidth),o=r.naturalHeight*(t.height/t.naturalHeight);at(r,{width:i,height:o,left:(t.width-i)/2,top:(t.height-o)/2}),yi(this.image,at({width:r.width,height:r.height},ha(at({translateX:r.left,translateY:r.top},r)))),e&&this.output()},initCropBox:function(){var e=this.options,t=this.canvasData,r=e.aspectRatio||e.initialAspectRatio,i=Number(e.autoCropArea)||.8,o={width:t.width,height:t.height};r&&(t.height*r>t.width?o.height=o.width/r:o.width=o.height*r),this.cropBoxData=o,this.limitCropBox(!0,!0),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),o.width=Math.max(o.minWidth,o.width*i),o.height=Math.max(o.minHeight,o.height*i),o.left=t.left+(t.width-o.width)/2,o.top=t.top+(t.height-o.height)/2,o.oldLeft=o.left,o.oldTop=o.top,this.initialCropBoxData=at({},o)},limitCropBox:function(e,t){var r=this.options,i=this.containerData,o=this.canvasData,s=this.cropBoxData,a=this.limited,l=r.aspectRatio;if(e){var u=Number(r.minCropBoxWidth)||0,c=Number(r.minCropBoxHeight)||0,d=a?Math.min(i.width,o.width,o.width+o.left,i.width-o.left):i.width,h=a?Math.min(i.height,o.height,o.height+o.top,i.height-o.top):i.height;u=Math.min(u,i.width),c=Math.min(c,i.height),l&&(u&&c?c*l>u?c=u/l:u=c*l:u?c=u/l:c&&(u=c*l),h*l>d?h=d/l:d=h*l),s.minWidth=Math.min(u,d),s.minHeight=Math.min(c,h),s.maxWidth=d,s.maxHeight=h}t&&(a?(s.minLeft=Math.max(0,o.left),s.minTop=Math.max(0,o.top),s.maxLeft=Math.min(i.width,o.left+o.width)-s.width,s.maxTop=Math.min(i.height,o.top+o.height)-s.height):(s.minLeft=0,s.minTop=0,s.maxLeft=i.width-s.width,s.maxTop=i.height-s.height))},renderCropBox:function(){var e=this.options,t=this.containerData,r=this.cropBoxData;(r.width>r.maxWidth||r.width<r.minWidth)&&(r.left=r.oldLeft),(r.height>r.maxHeight||r.height<r.minHeight)&&(r.top=r.oldTop),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),this.limitCropBox(!1,!0),r.left=Math.min(Math.max(r.left,r.minLeft),r.maxLeft),r.top=Math.min(Math.max(r.top,r.minTop),r.maxTop),r.oldLeft=r.left,r.oldTop=r.top,e.movable&&e.cropBoxMovable&&ka(this.face,Aa,r.width>=t.width&&r.height>=t.height?V1:Gp),yi(this.cropBox,at({width:r.width,height:r.height},ha({translateX:r.left,translateY:r.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),ds(this.element,vf,this.getData())}},HL={initPreview:function(){var e=this.element,t=this.crossOrigin,r=this.options.preview,i=t?this.crossOriginUrl:this.url,o=e.alt||"The image to preview",s=document.createElement("img");if(t&&(s.crossOrigin=t),s.src=i,s.alt=o,this.viewBox.appendChild(s),this.viewBoxImage=s,!!r){var a=r;typeof r=="string"?a=e.ownerDocument.querySelectorAll(r):r.querySelector&&(a=[r]),this.previews=a,Ct(a,function(l){var u=document.createElement("img");ka(l,Il,{width:l.offsetWidth,height:l.offsetHeight,html:l.innerHTML}),t&&(u.crossOrigin=t),u.src=i,u.alt=o,u.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',l.innerHTML="",l.appendChild(u)})}},resetPreview:function(){Ct(this.previews,function(e){var t=_f(e,Il);yi(e,{width:t.width,height:t.height}),e.innerHTML=t.html,DL(e,Il)})},preview:function(){var e=this.imageData,t=this.canvasData,r=this.cropBoxData,i=r.width,o=r.height,s=e.width,a=e.height,l=r.left-t.left-e.left,u=r.top-t.top-e.top;!this.cropped||this.disabled||(yi(this.viewBoxImage,at({width:s,height:a},ha(at({translateX:-l,translateY:-u},e)))),Ct(this.previews,function(c){var d=_f(c,Il),h=d.width,f=d.height,p=h,g=f,m=1;i&&(m=h/i,g=o*m),o&&g>f&&(m=f/o,p=i*m,g=f),yi(c,{width:p,height:g}),yi(c.getElementsByTagName("img")[0],at({width:s*m,height:a*m},ha(at({translateX:-l*m,translateY:-u*m},e))))}))}},WL={bind:function(){var e=this.element,t=this.options,r=this.cropper;pn(t.cropstart)&&$n(e,xf,t.cropstart),pn(t.cropmove)&&$n(e,bf,t.cropmove),pn(t.cropend)&&$n(e,yf,t.cropend),pn(t.crop)&&$n(e,vf,t.crop),pn(t.zoom)&&$n(e,wf,t.zoom),$n(r,Ey,this.onCropStart=this.cropStart.bind(this)),t.zoomable&&t.zoomOnWheel&&$n(r,Ry,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&$n(r,Cy,this.onDblclick=this.dblclick.bind(this)),$n(e.ownerDocument,Sy,this.onCropMove=this.cropMove.bind(this)),$n(e.ownerDocument,Dy,this.onCropEnd=this.cropEnd.bind(this)),t.responsive&&$n(window,ky,this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,t=this.options,r=this.cropper;pn(t.cropstart)&&Zn(e,xf,t.cropstart),pn(t.cropmove)&&Zn(e,bf,t.cropmove),pn(t.cropend)&&Zn(e,yf,t.cropend),pn(t.crop)&&Zn(e,vf,t.crop),pn(t.zoom)&&Zn(e,wf,t.zoom),Zn(r,Ey,this.onCropStart),t.zoomable&&t.zoomOnWheel&&Zn(r,Ry,this.onWheel,{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&Zn(r,Cy,this.onDblclick),Zn(e.ownerDocument,Sy,this.onCropMove),Zn(e.ownerDocument,Dy,this.onCropEnd),t.responsive&&Zn(window,ky,this.onResize)}},zL={resize:function(){if(!this.disabled){var e=this.options,t=this.container,r=this.containerData,i=t.offsetWidth/r.width,o=t.offsetHeight/r.height,s=Math.abs(i-1)>Math.abs(o-1)?i:o;if(s!==1){var a,l;e.restore&&(a=this.getCanvasData(),l=this.getCropBoxData()),this.render(),e.restore&&(this.setCanvasData(Ct(a,function(u,c){a[c]=u*s})),this.setCropBoxData(Ct(l,function(u,c){l[c]=u*s})))}}},dblclick:function(){this.disabled||this.options.dragMode===$1||this.setDragMode(EL(this.dragBox,gf)?j1:qp)},wheel:function(e){var t=this,r=Number(this.options.wheelZoomRatio)||.1,i=1;this.disabled||(e.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){t.wheeling=!1},50),e.deltaY?i=e.deltaY>0?1:-1:e.wheelDelta?i=-e.wheelDelta/120:e.detail&&(i=e.detail>0?1:-1),this.zoom(-i*r,e)))},cropStart:function(e){var t=e.buttons,r=e.button;if(!(this.disabled||(e.type==="mousedown"||e.type==="pointerdown"&&e.pointerType==="mouse")&&(Pe(t)&&t!==1||Pe(r)&&r!==0||e.ctrlKey))){var i=this.options,o=this.pointers,s;e.changedTouches?Ct(e.changedTouches,function(a){o[a.identifier]=Ml(a)}):o[e.pointerId||0]=Ml(e),Object.keys(o).length>1&&i.zoomable&&i.zoomOnTouch?s=U1:s=_f(e.target,Aa),pL.test(s)&&ds(this.element,xf,{originalEvent:e,action:s})!==!1&&(e.preventDefault(),this.action=s,this.cropping=!1,s===z1&&(this.cropping=!0,Nt(this.dragBox,zu)))}},cropMove:function(e){var t=this.action;if(!(this.disabled||!t)){var r=this.pointers;e.preventDefault(),ds(this.element,bf,{originalEvent:e,action:t})!==!1&&(e.changedTouches?Ct(e.changedTouches,function(i){at(r[i.identifier]||{},Ml(i,!0))}):at(r[e.pointerId||0]||{},Ml(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var t=this.action,r=this.pointers;e.changedTouches?Ct(e.changedTouches,function(i){delete r[i.identifier]}):delete r[e.pointerId||0],t&&(e.preventDefault(),Object.keys(r).length||(this.action=""),this.cropping&&(this.cropping=!1,is(this.dragBox,zu,this.cropped&&this.options.modal)),ds(this.element,yf,{originalEvent:e,action:t}))}}},VL={change:function(e){var t=this.options,r=this.canvasData,i=this.containerData,o=this.cropBoxData,s=this.pointers,a=this.action,l=t.aspectRatio,u=o.left,c=o.top,d=o.width,h=o.height,f=u+d,p=c+h,g=0,m=0,v=i.width,y=i.height,b=!0,x;!l&&e.shiftKey&&(l=d&&h?d/h:1),this.limited&&(g=o.minLeft,m=o.minTop,v=g+Math.min(i.width,r.width,r.left+r.width),y=m+Math.min(i.height,r.height,r.top+r.height));var w=s[Object.keys(s)[0]],_={x:w.endX-w.startX,y:w.endY-w.startY},C=function(S){switch(S){case Xi:f+_.x>v&&(_.x=v-f);break;case Ki:u+_.x<g&&(_.x=g-u);break;case hi:c+_.y<m&&(_.y=m-c);break;case Uo:p+_.y>y&&(_.y=y-p);break}};switch(a){case Gp:u+=_.x,c+=_.y;break;case Xi:if(_.x>=0&&(f>=v||l&&(c<=m||p>=y))){b=!1;break}C(Xi),d+=_.x,d<0&&(a=Ki,d=-d,u-=d),l&&(h=d/l,c+=(o.height-h)/2);break;case hi:if(_.y<=0&&(c<=m||l&&(u<=g||f>=v))){b=!1;break}C(hi),h-=_.y,c+=_.y,h<0&&(a=Uo,h=-h,c-=h),l&&(d=h*l,u+=(o.width-d)/2);break;case Ki:if(_.x<=0&&(u<=g||l&&(c<=m||p>=y))){b=!1;break}C(Ki),d-=_.x,u+=_.x,d<0&&(a=Xi,d=-d,u-=d),l&&(h=d/l,c+=(o.height-h)/2);break;case Uo:if(_.y>=0&&(p>=y||l&&(u<=g||f>=v))){b=!1;break}C(Uo),h+=_.y,h<0&&(a=hi,h=-h,c-=h),l&&(d=h*l,u+=(o.width-d)/2);break;case Us:if(l){if(_.y<=0&&(c<=m||f>=v)){b=!1;break}C(hi),h-=_.y,c+=_.y,d=h*l}else C(hi),C(Xi),_.x>=0?f<v?d+=_.x:_.y<=0&&c<=m&&(b=!1):d+=_.x,_.y<=0?c>m&&(h-=_.y,c+=_.y):(h-=_.y,c+=_.y);d<0&&h<0?(a=Gs,h=-h,d=-d,c-=h,u-=d):d<0?(a=js,d=-d,u-=d):h<0&&(a=$s,h=-h,c-=h);break;case js:if(l){if(_.y<=0&&(c<=m||u<=g)){b=!1;break}C(hi),h-=_.y,c+=_.y,d=h*l,u+=o.width-d}else C(hi),C(Ki),_.x<=0?u>g?(d-=_.x,u+=_.x):_.y<=0&&c<=m&&(b=!1):(d-=_.x,u+=_.x),_.y<=0?c>m&&(h-=_.y,c+=_.y):(h-=_.y,c+=_.y);d<0&&h<0?(a=$s,h=-h,d=-d,c-=h,u-=d):d<0?(a=Us,d=-d,u-=d):h<0&&(a=Gs,h=-h,c-=h);break;case Gs:if(l){if(_.x<=0&&(u<=g||p>=y)){b=!1;break}C(Ki),d-=_.x,u+=_.x,h=d/l}else C(Uo),C(Ki),_.x<=0?u>g?(d-=_.x,u+=_.x):_.y>=0&&p>=y&&(b=!1):(d-=_.x,u+=_.x),_.y>=0?p<y&&(h+=_.y):h+=_.y;d<0&&h<0?(a=Us,h=-h,d=-d,c-=h,u-=d):d<0?(a=$s,d=-d,u-=d):h<0&&(a=js,h=-h,c-=h);break;case $s:if(l){if(_.x>=0&&(f>=v||p>=y)){b=!1;break}C(Xi),d+=_.x,h=d/l}else C(Uo),C(Xi),_.x>=0?f<v?d+=_.x:_.y>=0&&p>=y&&(b=!1):d+=_.x,_.y>=0?p<y&&(h+=_.y):h+=_.y;d<0&&h<0?(a=js,h=-h,d=-d,c-=h,u-=d):d<0?(a=Gs,d=-d,u-=d):h<0&&(a=Us,h=-h,c-=h);break;case V1:this.move(_.x,_.y),b=!1;break;case U1:this.zoom(kL(s),e),b=!1;break;case z1:if(!_.x||!_.y){b=!1;break}x=Q1(this.cropper),u=w.startX-x.left,c=w.startY-x.top,d=o.minWidth,h=o.minHeight,_.x>0?a=_.y>0?$s:Us:_.x<0&&(u-=d,a=_.y>0?Gs:js),_.y<0&&(c-=h),this.cropped||(Dr(this.cropBox,mn),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}b&&(o.width=d,o.height=h,o.left=u,o.top=c,this.action=a,this.renderCropBox()),Ct(s,function(E){E.startX=E.endX,E.startY=E.endY})}},UL={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&Nt(this.dragBox,zu),Dr(this.cropBox,mn),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=at({},this.initialImageData),this.canvasData=at({},this.initialCanvasData),this.cropBoxData=at({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(at(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),Dr(this.dragBox,zu),Nt(this.cropBox,mn)),this},replace:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&e&&(this.isImg&&(this.element.src=e),t?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,Ct(this.previews,function(r){r.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,Dr(this.cropper,wy)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,Nt(this.cropper,wy)),this},destroy:function(){var e=this.element;return e[st]?(e[st]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=this.canvasData,i=r.left,o=r.top;return this.moveTo(Jd(e)?e:i+Number(e),Jd(t)?t:o+Number(t))},moveTo:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=this.canvasData,i=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.movable&&(Pe(e)&&(r.left=e,i=!0),Pe(t)&&(r.top=t,i=!0),i&&this.renderCanvas(!0)),this},zoom:function(e,t){var r=this.canvasData;return e=Number(e),e<0?e=1/(1-e):e=1+e,this.zoomTo(r.width*e/r.naturalWidth,null,t)},zoomTo:function(e,t,r){var i=this.options,o=this.canvasData,s=o.width,a=o.height,l=o.naturalWidth,u=o.naturalHeight;if(e=Number(e),e>=0&&this.ready&&!this.disabled&&i.zoomable){var c=l*e,d=u*e;if(ds(this.element,wf,{ratio:e,oldRatio:s/l,originalEvent:r})===!1)return this;if(r){var h=this.pointers,f=Q1(this.cropper),p=h&&Object.keys(h).length?RL(h):{pageX:r.pageX,pageY:r.pageY};o.left-=(c-s)*((p.pageX-f.left-o.left)/s),o.top-=(d-a)*((p.pageY-f.top-o.top)/a)}else rs(t)&&Pe(t.x)&&Pe(t.y)?(o.left-=(c-s)*((t.x-o.left)/s),o.top-=(d-a)*((t.y-o.top)/a)):(o.left-=(c-s)/2,o.top-=(d-a)/2);o.width=c,o.height=d,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return e=Number(e),Pe(e)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var t=this.imageData.scaleY;return this.scale(e,Pe(t)?t:1)},scaleY:function(e){var t=this.imageData.scaleX;return this.scale(Pe(t)?t:1,e)},scale:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=this.imageData,i=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.scalable&&(Pe(e)&&(r.scaleX=e,i=!0),Pe(t)&&(r.scaleY=t,i=!0),i&&this.renderCanvas(!0,!0)),this},getData:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=this.options,r=this.imageData,i=this.canvasData,o=this.cropBoxData,s;if(this.ready&&this.cropped){s={x:o.left-i.left,y:o.top-i.top,width:o.width,height:o.height};var a=r.width/r.naturalWidth;if(Ct(s,function(c,d){s[d]=c/a}),e){var l=Math.round(s.y+s.height),u=Math.round(s.x+s.width);s.x=Math.round(s.x),s.y=Math.round(s.y),s.width=u-s.x,s.height=l-s.y}}else s={x:0,y:0,width:0,height:0};return t.rotatable&&(s.rotate=r.rotate||0),t.scalable&&(s.scaleX=r.scaleX||1,s.scaleY=r.scaleY||1),s},setData:function(e){var t=this.options,r=this.imageData,i=this.canvasData,o={};if(this.ready&&!this.disabled&&rs(e)){var s=!1;t.rotatable&&Pe(e.rotate)&&e.rotate!==r.rotate&&(r.rotate=e.rotate,s=!0),t.scalable&&(Pe(e.scaleX)&&e.scaleX!==r.scaleX&&(r.scaleX=e.scaleX,s=!0),Pe(e.scaleY)&&e.scaleY!==r.scaleY&&(r.scaleY=e.scaleY,s=!0)),s&&this.renderCanvas(!0,!0);var a=r.width/r.naturalWidth;Pe(e.x)&&(o.left=e.x*a+i.left),Pe(e.y)&&(o.top=e.y*a+i.top),Pe(e.width)&&(o.width=e.width*a),Pe(e.height)&&(o.height=e.height*a),this.setCropBoxData(o)}return this},getContainerData:function(){return this.ready?at({},this.containerData):{}},getImageData:function(){return this.sized?at({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,t={};return this.ready&&Ct(["left","top","width","height","naturalWidth","naturalHeight"],function(r){t[r]=e[r]}),t},setCanvasData:function(e){var t=this.canvasData,r=t.aspectRatio;return this.ready&&!this.disabled&&rs(e)&&(Pe(e.left)&&(t.left=e.left),Pe(e.top)&&(t.top=e.top),Pe(e.width)?(t.width=e.width,t.height=e.width/r):Pe(e.height)&&(t.height=e.height,t.width=e.height*r),this.renderCanvas(!0)),this},getCropBoxData:function(){var e=this.cropBoxData,t;return this.ready&&this.cropped&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCropBoxData:function(e){var t=this.cropBoxData,r=this.options.aspectRatio,i,o;return this.ready&&this.cropped&&!this.disabled&&rs(e)&&(Pe(e.left)&&(t.left=e.left),Pe(e.top)&&(t.top=e.top),Pe(e.width)&&e.width!==t.width&&(i=!0,t.width=e.width),Pe(e.height)&&e.height!==t.height&&(o=!0,t.height=e.height),r&&(i?t.height=t.width/r:o&&(t.width=t.height*r)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var t=this.canvasData,r=IL(this.image,this.imageData,t,e);if(!this.cropped)return r;var i=this.getData(e.rounded),o=i.x,s=i.y,a=i.width,l=i.height,u=r.width/Math.floor(t.naturalWidth);u!==1&&(o*=u,s*=u,a*=u,l*=u);var c=a/l,d=bi({aspectRatio:c,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),h=bi({aspectRatio:c,width:e.minWidth||0,height:e.minHeight||0},"cover"),f=bi({aspectRatio:c,width:e.width||(u!==1?r.width:a),height:e.height||(u!==1?r.height:l)}),p=f.width,g=f.height;p=Math.min(d.width,Math.max(h.width,p)),g=Math.min(d.height,Math.max(h.height,g));var m=document.createElement("canvas"),v=m.getContext("2d");m.width=cs(p),m.height=cs(g),v.fillStyle=e.fillColor||"transparent",v.fillRect(0,0,p,g);var y=e.imageSmoothingEnabled,b=y===void 0?!0:y,x=e.imageSmoothingQuality;v.imageSmoothingEnabled=b,x&&(v.imageSmoothingQuality=x);var w=r.width,_=r.height,C=o,E=s,S,D,k,M,B,H;C<=-a||C>w?(C=0,S=0,k=0,B=0):C<=0?(k=-C,C=0,S=Math.min(w,a+C),B=S):C<=w&&(k=0,S=Math.min(a,w-C),B=S),S<=0||E<=-l||E>_?(E=0,D=0,M=0,H=0):E<=0?(M=-E,E=0,D=Math.min(_,l+E),H=D):E<=_&&(M=0,D=Math.min(l,_-E),H=D);var F=[C,E,S,D];if(B>0&&H>0){var W=p/a;F.push(k*W,M*W,B*W,H*W)}return v.drawImage.apply(v,[r].concat(W1(F.map(function(j){return Math.floor(cs(j))})))),m},setAspectRatio:function(e){var t=this.options;return!this.disabled&&!Jd(e)&&(t.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var t=this.options,r=this.dragBox,i=this.face;if(this.ready&&!this.disabled){var o=e===qp,s=t.movable&&e===j1;e=o||s?e:$1,t.dragMode=e,ka(r,Aa,e),is(r,gf,o),is(r,mf,s),t.cropBoxMovable||(ka(i,Aa,e),is(i,gf,o),is(i,mf,s))}return this}},jL=Mr.Cropper,Z1=(function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(rL(this,n),!e||!vL.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=at({},Iy,rs(t)&&t),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return iL(n,[{key:"init",value:function(){var t=this.element,r=t.tagName.toLowerCase(),i;if(!t[st]){if(t[st]=this,r==="img"){if(this.isImg=!0,i=t.getAttribute("src")||"",this.originalUrl=i,!i)return;i=t.src}else r==="canvas"&&window.HTMLCanvasElement&&(i=t.toDataURL());this.load(i)}}},{key:"load",value:function(t){var r=this;if(t){this.url=t,this.imageData={};var i=this.element,o=this.options;if(!o.rotatable&&!o.scalable&&(o.checkOrientation=!1),!o.checkOrientation||!window.ArrayBuffer){this.clone();return}if(gL.test(t)){mL.test(t)?this.read(PL(t)):this.clone();return}var s=new XMLHttpRequest,a=this.clone.bind(this);this.reloading=!0,this.xhr=s,s.onabort=a,s.onerror=a,s.ontimeout=a,s.onprogress=function(){s.getResponseHeader("content-type")!==Ty&&s.abort()},s.onload=function(){r.read(s.response)},s.onloadend=function(){r.reloading=!1,r.xhr=null},o.checkCrossOrigin&&Oy(t)&&i.crossOrigin&&(t=Py(t)),s.open("GET",t,!0),s.responseType="arraybuffer",s.withCredentials=i.crossOrigin==="use-credentials",s.send()}}},{key:"read",value:function(t){var r=this.options,i=this.imageData,o=FL(t),s=0,a=1,l=1;if(o>1){this.url=NL(t,Ty);var u=LL(o);s=u.rotate,a=u.scaleX,l=u.scaleY}r.rotatable&&(i.rotate=s),r.scalable&&(i.scaleX=a,i.scaleY=l),this.clone()}},{key:"clone",value:function(){var t=this.element,r=this.url,i=t.crossOrigin,o=r;this.options.checkCrossOrigin&&Oy(r)&&(i||(i="anonymous"),o=Py(r)),this.crossOrigin=i,this.crossOriginUrl=o;var s=document.createElement("img");i&&(s.crossOrigin=i),s.src=o||r,s.alt=t.alt||"The image to crop",this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),Nt(s,_y),t.parentNode.insertBefore(s,t.nextSibling)}},{key:"start",value:function(){var t=this,r=this.image;r.onload=null,r.onerror=null,this.sizing=!0;var i=Mr.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(Mr.navigator.userAgent),o=function(u,c){at(t.imageData,{naturalWidth:u,naturalHeight:c,aspectRatio:u/c}),t.initialImageData=at({},t.imageData),t.sizing=!1,t.sized=!0,t.build()};if(r.naturalWidth&&!i){o(r.naturalWidth,r.naturalHeight);return}var s=document.createElement("img"),a=document.body||document.documentElement;this.sizingImage=s,s.onload=function(){o(s.width,s.height),i||a.removeChild(s)},s.src=r.src,i||(s.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",a.appendChild(s))}},{key:"stop",value:function(){var t=this.image;t.onload=null,t.onerror=null,t.parentNode.removeChild(t),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var t=this.element,r=this.options,i=this.image,o=t.parentNode,s=document.createElement("div");s.innerHTML=yL;var a=s.querySelector(".".concat(st,"-container")),l=a.querySelector(".".concat(st,"-canvas")),u=a.querySelector(".".concat(st,"-drag-box")),c=a.querySelector(".".concat(st,"-crop-box")),d=c.querySelector(".".concat(st,"-face"));this.container=o,this.cropper=a,this.canvas=l,this.dragBox=u,this.cropBox=c,this.viewBox=a.querySelector(".".concat(st,"-view-box")),this.face=d,l.appendChild(i),Nt(t,mn),o.insertBefore(a,t.nextSibling),Dr(i,_y),this.initPreview(),this.bind(),r.initialAspectRatio=Math.max(0,r.initialAspectRatio)||NaN,r.aspectRatio=Math.max(0,r.aspectRatio)||NaN,r.viewMode=Math.max(0,Math.min(3,Math.round(r.viewMode)))||0,Nt(c,mn),r.guides||Nt(c.getElementsByClassName("".concat(st,"-dashed")),mn),r.center||Nt(c.getElementsByClassName("".concat(st,"-center")),mn),r.background&&Nt(a,"".concat(st,"-bg")),r.highlight||Nt(d,cL),r.cropBoxMovable&&(Nt(d,mf),ka(d,Aa,Gp)),r.cropBoxResizable||(Nt(c.getElementsByClassName("".concat(st,"-line")),mn),Nt(c.getElementsByClassName("".concat(st,"-point")),mn)),this.render(),this.ready=!0,this.setDragMode(r.dragMode),r.autoCrop&&this.crop(),this.setData(r.data),pn(r.ready)&&$n(t,Ay,r.ready,{once:!0}),ds(t,Ay)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var t=this.cropper.parentNode;t&&t.removeChild(this.cropper),Dr(this.element,mn)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=jL,n}},{key:"setDefaults",value:function(t){at(Iy,rs(t)&&t)}}])})();at(Z1.prototype,BL,HL,WL,zL,VL,UL);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Za(n){return n+.5|0}const xi=(n,e,t)=>Math.max(Math.min(n,t),e);function ra(n){return xi(Za(n*2.55),0,255)}function Ai(n){return xi(Za(n*255),0,255)}function Gr(n){return xi(Za(n/2.55)/100,0,1)}function Ny(n){return xi(Za(n*100),0,100)}const jn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Cf=[..."0123456789ABCDEF"],$L=n=>Cf[n&15],GL=n=>Cf[(n&240)>>4]+Cf[n&15],Ol=n=>(n&240)>>4===(n&15),qL=n=>Ol(n.r)&&Ol(n.g)&&Ol(n.b)&&Ol(n.a);function YL(n){var e=n.length,t;return n[0]==="#"&&(e===4||e===5?t={r:255&jn[n[1]]*17,g:255&jn[n[2]]*17,b:255&jn[n[3]]*17,a:e===5?jn[n[4]]*17:255}:(e===7||e===9)&&(t={r:jn[n[1]]<<4|jn[n[2]],g:jn[n[3]]<<4|jn[n[4]],b:jn[n[5]]<<4|jn[n[6]],a:e===9?jn[n[7]]<<4|jn[n[8]]:255})),t}const XL=(n,e)=>n<255?e(n):"";function KL(n){var e=qL(n)?$L:GL;return n?"#"+e(n.r)+e(n.g)+e(n.b)+XL(n.a,e):void 0}const QL=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function e_(n,e,t){const r=e*Math.min(t,1-t),i=(o,s=(o+n/30)%12)=>t-r*Math.max(Math.min(s-3,9-s,1),-1);return[i(0),i(8),i(4)]}function JL(n,e,t){const r=(i,o=(i+n/60)%6)=>t-t*e*Math.max(Math.min(o,4-o,1),0);return[r(5),r(3),r(1)]}function ZL(n,e,t){const r=e_(n,1,.5);let i;for(e+t>1&&(i=1/(e+t),e*=i,t*=i),i=0;i<3;i++)r[i]*=1-e-t,r[i]+=e;return r}function eB(n,e,t,r,i){return n===i?(e-t)/r+(e<t?6:0):e===i?(t-n)/r+2:(n-e)/r+4}function Xp(n){const t=n.r/255,r=n.g/255,i=n.b/255,o=Math.max(t,r,i),s=Math.min(t,r,i),a=(o+s)/2;let l,u,c;return o!==s&&(c=o-s,u=a>.5?c/(2-o-s):c/(o+s),l=eB(t,r,i,c,o),l=l*60+.5),[l|0,u||0,a]}function Kp(n,e,t,r){return(Array.isArray(e)?n(e[0],e[1],e[2]):n(e,t,r)).map(Ai)}function Qp(n,e,t){return Kp(e_,n,e,t)}function tB(n,e,t){return Kp(ZL,n,e,t)}function nB(n,e,t){return Kp(JL,n,e,t)}function t_(n){return(n%360+360)%360}function rB(n){const e=QL.exec(n);let t=255,r;if(!e)return;e[5]!==r&&(t=e[6]?ra(+e[5]):Ai(+e[5]));const i=t_(+e[2]),o=+e[3]/100,s=+e[4]/100;return e[1]==="hwb"?r=tB(i,o,s):e[1]==="hsv"?r=nB(i,o,s):r=Qp(i,o,s),{r:r[0],g:r[1],b:r[2],a:t}}function iB(n,e){var t=Xp(n);t[0]=t_(t[0]+e),t=Qp(t),n.r=t[0],n.g=t[1],n.b=t[2]}function oB(n){if(!n)return;const e=Xp(n),t=e[0],r=Ny(e[1]),i=Ny(e[2]);return n.a<255?`hsla(${t}, ${r}%, ${i}%, ${Gr(n.a)})`:`hsl(${t}, ${r}%, ${i}%)`}const Fy={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ly={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function sB(){const n={},e=Object.keys(Ly),t=Object.keys(Fy);let r,i,o,s,a;for(r=0;r<e.length;r++){for(s=a=e[r],i=0;i<t.length;i++)o=t[i],a=a.replace(o,Fy[o]);o=parseInt(Ly[s],16),n[a]=[o>>16&255,o>>8&255,o&255]}return n}let Pl;function aB(n){Pl||(Pl=sB(),Pl.transparent=[0,0,0,0]);const e=Pl[n.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const lB=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function uB(n){const e=lB.exec(n);let t=255,r,i,o;if(e){if(e[7]!==r){const s=+e[7];t=e[8]?ra(s):xi(s*255,0,255)}return r=+e[1],i=+e[3],o=+e[5],r=255&(e[2]?ra(r):xi(r,0,255)),i=255&(e[4]?ra(i):xi(i,0,255)),o=255&(e[6]?ra(o):xi(o,0,255)),{r,g:i,b:o,a:t}}}function cB(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${Gr(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const eh=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,jo=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function dB(n,e,t){const r=jo(Gr(n.r)),i=jo(Gr(n.g)),o=jo(Gr(n.b));return{r:Ai(eh(r+t*(jo(Gr(e.r))-r))),g:Ai(eh(i+t*(jo(Gr(e.g))-i))),b:Ai(eh(o+t*(jo(Gr(e.b))-o))),a:n.a+t*(e.a-n.a)}}function Nl(n,e,t){if(n){let r=Xp(n);r[e]=Math.max(0,Math.min(r[e]+r[e]*t,e===0?360:1)),r=Qp(r),n.r=r[0],n.g=r[1],n.b=r[2]}}function n_(n,e){return n&&Object.assign(e||{},n)}function By(n){var e={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(e={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(e.a=Ai(n[3]))):(e=n_(n,{r:0,g:0,b:0,a:1}),e.a=Ai(e.a)),e}function hB(n){return n.charAt(0)==="r"?uB(n):rB(n)}class Ra{constructor(e){if(e instanceof Ra)return e;const t=typeof e;let r;t==="object"?r=By(e):t==="string"&&(r=YL(e)||aB(e)||hB(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=n_(this._rgb);return e&&(e.a=Gr(e.a)),e}set rgb(e){this._rgb=By(e)}rgbString(){return this._valid?cB(this._rgb):void 0}hexString(){return this._valid?KL(this._rgb):void 0}hslString(){return this._valid?oB(this._rgb):void 0}mix(e,t){if(e){const r=this.rgb,i=e.rgb;let o;const s=t===o?.5:t,a=2*s-1,l=r.a-i.a,u=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;o=1-u,r.r=255&u*r.r+o*i.r+.5,r.g=255&u*r.g+o*i.g+.5,r.b=255&u*r.b+o*i.b+.5,r.a=s*r.a+(1-s)*i.a,this.rgb=r}return this}interpolate(e,t){return e&&(this._rgb=dB(this._rgb,e._rgb,t)),this}clone(){return new Ra(this.rgb)}alpha(e){return this._rgb.a=Ai(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=Za(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Nl(this._rgb,2,e),this}darken(e){return Nl(this._rgb,2,-e),this}saturate(e){return Nl(this._rgb,1,e),this}desaturate(e){return Nl(this._rgb,1,-e),this}rotate(e){return iB(this._rgb,e),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function zr(){}const fB=(()=>{let n=0;return()=>n++})();function Me(n){return n==null}function lt(n){if(Array.isArray&&Array.isArray(n))return!0;const e=Object.prototype.toString.call(n);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function Ne(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function yt(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function Pn(n,e){return yt(n)?n:e}function _e(n,e){return typeof n>"u"?e:n}const pB=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/e,r_=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*e:+n;function Qe(n,e,t){if(n&&typeof n.call=="function")return n.apply(t,e)}function $e(n,e,t,r){let i,o,s;if(lt(n))for(o=n.length,i=0;i<o;i++)e.call(t,n[i],i);else if(Ne(n))for(s=Object.keys(n),o=s.length,i=0;i<o;i++)e.call(t,n[s[i]],s[i])}function Vu(n,e){let t,r,i,o;if(!n||!e||n.length!==e.length)return!1;for(t=0,r=n.length;t<r;++t)if(i=n[t],o=e[t],i.datasetIndex!==o.datasetIndex||i.index!==o.index)return!1;return!0}function Uu(n){if(lt(n))return n.map(Uu);if(Ne(n)){const e=Object.create(null),t=Object.keys(n),r=t.length;let i=0;for(;i<r;++i)e[t[i]]=Uu(n[t[i]]);return e}return n}function i_(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function gB(n,e,t,r){if(!i_(n))return;const i=e[n],o=t[n];Ne(i)&&Ne(o)?Ta(i,o,r):e[n]=Uu(o)}function Ta(n,e,t){const r=lt(e)?e:[e],i=r.length;if(!Ne(n))return n;t=t||{};const o=t.merger||gB;let s;for(let a=0;a<i;++a){if(s=r[a],!Ne(s))continue;const l=Object.keys(s);for(let u=0,c=l.length;u<c;++u)o(l[u],n,s,t)}return n}function fa(n,e){return Ta(n,e,{merger:mB})}function mB(n,e,t){if(!i_(n))return;const r=e[n],i=t[n];Ne(r)&&Ne(i)?fa(r,i):Object.prototype.hasOwnProperty.call(e,n)||(e[n]=Uu(i))}const Hy={"":n=>n,x:n=>n.x,y:n=>n.y};function vB(n){const e=n.split("."),t=[];let r="";for(const i of e)r+=i,r.endsWith("\\")?r=r.slice(0,-1)+".":(t.push(r),r="");return t}function yB(n){const e=vB(n);return t=>{for(const r of e){if(r==="")break;t=t&&t[r]}return t}}function Pi(n,e){return(Hy[e]||(Hy[e]=yB(e)))(n)}function Jp(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Ia=n=>typeof n<"u",Ni=n=>typeof n=="function",Wy=(n,e)=>{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0};function bB(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const We=Math.PI,nt=2*We,xB=nt+We,ju=Number.POSITIVE_INFINITY,wB=We/180,xt=We/2,Qi=We/4,zy=We*2/3,wi=Math.log10,Ar=Math.sign;function pa(n,e,t){return Math.abs(n-e)<t}function Vy(n){const e=Math.round(n);n=pa(n,e,n/1e3)?e:n;const t=Math.pow(10,Math.floor(wi(n))),r=n/t;return(r<=1?1:r<=2?2:r<=5?5:10)*t}function _B(n){const e=[],t=Math.sqrt(n);let r;for(r=1;r<t;r++)n%r===0&&(e.push(r),e.push(n/r));return t===(t|0)&&e.push(t),e.sort((i,o)=>i-o).pop(),e}function CB(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function Ss(n){return!CB(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function EB(n,e){const t=Math.round(n);return t-e<=n&&t+e>=n}function o_(n,e,t){let r,i,o;for(r=0,i=n.length;r<i;r++)o=n[r][t],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function ir(n){return n*(We/180)}function Zp(n){return n*(180/We)}function Uy(n){if(!yt(n))return;let e=1,t=0;for(;Math.round(n*e)/e!==n;)e*=10,t++;return t}function s_(n,e){const t=e.x-n.x,r=e.y-n.y,i=Math.sqrt(t*t+r*r);let o=Math.atan2(r,t);return o<-.5*We&&(o+=nt),{angle:o,distance:i}}function Ef(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function SB(n,e){return(n-e+xB)%nt-We}function qt(n){return(n%nt+nt)%nt}function Ma(n,e,t,r){const i=qt(n),o=qt(e),s=qt(t),a=qt(o-i),l=qt(s-i),u=qt(i-o),c=qt(i-s);return i===o||i===s||r&&o===s||a>l&&u<c}function Ft(n,e,t){return Math.max(e,Math.min(t,n))}function DB(n){return Ft(n,-32768,32767)}function Xr(n,e,t,r=1e-6){return n>=Math.min(e,t)-r&&n<=Math.max(e,t)+r}function eg(n,e,t){t=t||(s=>n[s]<e);let r=n.length-1,i=0,o;for(;r-i>1;)o=i+r>>1,t(o)?i=o:r=o;return{lo:i,hi:r}}const Kr=(n,e,t,r)=>eg(n,t,r?i=>{const o=n[i][e];return o<t||o===t&&n[i+1][e]===t}:i=>n[i][e]<t),AB=(n,e,t)=>eg(n,t,r=>n[r][e]>=t);function kB(n,e,t){let r=0,i=n.length;for(;r<i&&n[r]<e;)r++;for(;i>r&&n[i-1]>t;)i--;return r>0||i<n.length?n.slice(r,i):n}const a_=["push","pop","shift","splice","unshift"];function RB(n,e){if(n._chartjs){n._chartjs.listeners.push(e);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),a_.forEach(t=>{const r="_onData"+Jp(t),i=n[t];Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value(...o){const s=i.apply(this,o);return n._chartjs.listeners.forEach(a=>{typeof a[r]=="function"&&a[r](...o)}),s}})})}function jy(n,e){const t=n._chartjs;if(!t)return;const r=t.listeners,i=r.indexOf(e);i!==-1&&r.splice(i,1),!(r.length>0)&&(a_.forEach(o=>{delete n[o]}),delete n._chartjs)}function l_(n){const e=new Set(n);return e.size===n.length?n:Array.from(e)}const u_=(function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame})();function c_(n,e){let t=[],r=!1;return function(...i){t=i,r||(r=!0,u_.call(window,()=>{r=!1,n.apply(e,t)}))}}function TB(n,e){let t;return function(...r){return e?(clearTimeout(t),t=setTimeout(n,e,r)):n.apply(this,r),e}}const tg=n=>n==="start"?"left":n==="end"?"right":"center",jt=(n,e,t)=>n==="start"?e:n==="end"?t:(e+t)/2,IB=(n,e,t,r)=>n===(r?"left":"right")?t:n==="center"?(e+t)/2:e;function d_(n,e,t){const r=e.length;let i=0,o=r;if(n._sorted){const{iScale:s,vScale:a,_parsed:l}=n,u=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,c=s.axis,{min:d,max:h,minDefined:f,maxDefined:p}=s.getUserBounds();if(f){if(i=Math.min(Kr(l,c,d).lo,t?r:Kr(e,c,s.getPixelForValue(d)).lo),u){const g=l.slice(0,i+1).reverse().findIndex(m=>!Me(m[a.axis]));i-=Math.max(0,g)}i=Ft(i,0,r-1)}if(p){let g=Math.max(Kr(l,s.axis,h,!0).hi+1,t?0:Kr(e,c,s.getPixelForValue(h),!0).hi+1);if(u){const m=l.slice(g-1).findIndex(v=>!Me(v[a.axis]));g+=Math.max(0,m)}o=Ft(g,i,r)-i}else o=r-i}return{start:i,count:o}}function h_(n){const{xScale:e,yScale:t,_scaleRanges:r}=n,i={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!r)return n._scaleRanges=i,!0;const o=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==t.min||r.ymax!==t.max;return Object.assign(r,i),o}const Fl=n=>n===0||n===1,$y=(n,e,t)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-e)*nt/t)),Gy=(n,e,t)=>Math.pow(2,-10*n)*Math.sin((n-e)*nt/t)+1,ga={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*xt)+1,easeOutSine:n=>Math.sin(n*xt),easeInOutSine:n=>-.5*(Math.cos(We*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Fl(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Fl(n)?n:$y(n,.075,.3),easeOutElastic:n=>Fl(n)?n:Gy(n,.075,.3),easeInOutElastic(n){return Fl(n)?n:n<.5?.5*$y(n*2,.1125,.45):.5+.5*Gy(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let e=1.70158;return(n/=.5)<1?.5*(n*n*(((e*=1.525)+1)*n-e)):.5*((n-=2)*n*(((e*=1.525)+1)*n+e)+2)},easeInBounce:n=>1-ga.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?ga.easeInBounce(n*2)*.5:ga.easeOutBounce(n*2-1)*.5+.5};function ng(n){if(n&&typeof n=="object"){const e=n.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function qy(n){return ng(n)?n:new Ra(n)}function th(n){return ng(n)?n:new Ra(n).saturate(.5).darken(.1).hexString()}const MB=["x","y","borderWidth","radius","tension"],OB=["color","borderColor","backgroundColor"];function PB(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),n.set("animations",{colors:{type:"color",properties:OB},numbers:{type:"number",properties:MB}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function NB(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Yy=new Map;function FB(n,e){e=e||{};const t=n+JSON.stringify(e);let r=Yy.get(t);return r||(r=new Intl.NumberFormat(n,e),Yy.set(t,r)),r}function el(n,e,t){return FB(e,t).format(n)}const f_={values(n){return lt(n)?n:""+n},numeric(n,e,t){if(n===0)return"0";const r=this.chart.options.locale;let i,o=n;if(t.length>1){const u=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(u<1e-4||u>1e15)&&(i="scientific"),o=LB(n,t)}const s=wi(Math.abs(o)),a=isNaN(s)?1:Math.max(Math.min(-1*Math.floor(s),20),0),l={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),el(n,r,l)},logarithmic(n,e,t){if(n===0)return"0";const r=t[e].significand||n/Math.pow(10,Math.floor(wi(n)));return[1,2,3,5,10,15].includes(r)||e>.8*t.length?f_.numeric.call(this,n,e,t):""}};function LB(n,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&n!==Math.floor(n)&&(t=n-Math.floor(n)),t}var Fc={formatters:f_};function BB(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Fc.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Do=Object.create(null),Sf=Object.create(null);function ma(n,e){if(!e)return n;const t=e.split(".");for(let r=0,i=t.length;r<i;++r){const o=t[r];n=n[o]||(n[o]=Object.create(null))}return n}function nh(n,e,t){return typeof e=="string"?Ta(ma(n,e),t):Ta(ma(n,""),e)}class HB{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,i)=>th(i.backgroundColor),this.hoverBorderColor=(r,i)=>th(i.borderColor),this.hoverColor=(r,i)=>th(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return nh(this,e,t)}get(e){return ma(this,e)}describe(e,t){return nh(Sf,e,t)}override(e,t){return nh(Do,e,t)}route(e,t,r,i){const o=ma(this,e),s=ma(this,r),a="_"+t;Object.defineProperties(o,{[a]:{value:o[t],writable:!0},[t]:{enumerable:!0,get(){const l=this[a],u=s[i];return Ne(l)?Object.assign({},u,l):_e(l,u)},set(l){this[a]=l}}})}apply(e){e.forEach(t=>t(this))}}var ct=new HB({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[PB,NB,BB]);function WB(n){return!n||Me(n.size)||Me(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function $u(n,e,t,r,i){let o=e[i];return o||(o=e[i]=n.measureText(i).width,t.push(i)),o>r&&(r=o),r}function zB(n,e,t,r){r=r||{};let i=r.data=r.data||{},o=r.garbageCollect=r.garbageCollect||[];r.font!==e&&(i=r.data={},o=r.garbageCollect=[],r.font=e),n.save(),n.font=e;let s=0;const a=t.length;let l,u,c,d,h;for(l=0;l<a;l++)if(d=t[l],d!=null&&!lt(d))s=$u(n,i,o,s,d);else if(lt(d))for(u=0,c=d.length;u<c;u++)h=d[u],h!=null&&!lt(h)&&(s=$u(n,i,o,s,h));n.restore();const f=o.length/2;if(f>t.length){for(l=0;l<f;l++)delete i[o[l]];o.splice(0,f)}return s}function Ji(n,e,t){const r=n.currentDevicePixelRatio,i=t!==0?Math.max(t/2,.5):0;return Math.round((e-i)*r)/r+i}function Xy(n,e){!e&&!n||(e=e||n.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,n.width,n.height),e.restore())}function Df(n,e,t,r){p_(n,e,t,r,null)}function p_(n,e,t,r,i){let o,s,a,l,u,c,d,h;const f=e.pointStyle,p=e.rotation,g=e.radius;let m=(p||0)*wB;if(f&&typeof f=="object"&&(o=f.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){n.save(),n.translate(t,r),n.rotate(m),n.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),n.restore();return}if(!(isNaN(g)||g<=0)){switch(n.beginPath(),f){default:i?n.ellipse(t,r,i/2,g,0,0,nt):n.arc(t,r,g,0,nt),n.closePath();break;case"triangle":c=i?i/2:g,n.moveTo(t+Math.sin(m)*c,r-Math.cos(m)*g),m+=zy,n.lineTo(t+Math.sin(m)*c,r-Math.cos(m)*g),m+=zy,n.lineTo(t+Math.sin(m)*c,r-Math.cos(m)*g),n.closePath();break;case"rectRounded":u=g*.516,l=g-u,s=Math.cos(m+Qi)*l,d=Math.cos(m+Qi)*(i?i/2-u:l),a=Math.sin(m+Qi)*l,h=Math.sin(m+Qi)*(i?i/2-u:l),n.arc(t-d,r-a,u,m-We,m-xt),n.arc(t+h,r-s,u,m-xt,m),n.arc(t+d,r+a,u,m,m+xt),n.arc(t-h,r+s,u,m+xt,m+We),n.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*g,c=i?i/2:l,n.rect(t-c,r-l,2*c,2*l);break}m+=Qi;case"rectRot":d=Math.cos(m)*(i?i/2:g),s=Math.cos(m)*g,a=Math.sin(m)*g,h=Math.sin(m)*(i?i/2:g),n.moveTo(t-d,r-a),n.lineTo(t+h,r-s),n.lineTo(t+d,r+a),n.lineTo(t-h,r+s),n.closePath();break;case"crossRot":m+=Qi;case"cross":d=Math.cos(m)*(i?i/2:g),s=Math.cos(m)*g,a=Math.sin(m)*g,h=Math.sin(m)*(i?i/2:g),n.moveTo(t-d,r-a),n.lineTo(t+d,r+a),n.moveTo(t+h,r-s),n.lineTo(t-h,r+s);break;case"star":d=Math.cos(m)*(i?i/2:g),s=Math.cos(m)*g,a=Math.sin(m)*g,h=Math.sin(m)*(i?i/2:g),n.moveTo(t-d,r-a),n.lineTo(t+d,r+a),n.moveTo(t+h,r-s),n.lineTo(t-h,r+s),m+=Qi,d=Math.cos(m)*(i?i/2:g),s=Math.cos(m)*g,a=Math.sin(m)*g,h=Math.sin(m)*(i?i/2:g),n.moveTo(t-d,r-a),n.lineTo(t+d,r+a),n.moveTo(t+h,r-s),n.lineTo(t-h,r+s);break;case"line":s=i?i/2:Math.cos(m)*g,a=Math.sin(m)*g,n.moveTo(t-s,r-a),n.lineTo(t+s,r+a);break;case"dash":n.moveTo(t,r),n.lineTo(t+Math.cos(m)*(i?i/2:g),r+Math.sin(m)*g);break;case!1:n.closePath();break}n.fill(),e.borderWidth>0&&n.stroke()}}function Qr(n,e,t){return t=t||.5,!e||n&&n.x>e.left-t&&n.x<e.right+t&&n.y>e.top-t&&n.y<e.bottom+t}function Lc(n,e){n.save(),n.beginPath(),n.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),n.clip()}function Bc(n){n.restore()}function VB(n,e,t,r,i){if(!e)return n.lineTo(t.x,t.y);if(i==="middle"){const o=(e.x+t.x)/2;n.lineTo(o,e.y),n.lineTo(o,t.y)}else i==="after"!=!!r?n.lineTo(e.x,t.y):n.lineTo(t.x,e.y);n.lineTo(t.x,t.y)}function UB(n,e,t,r){if(!e)return n.lineTo(t.x,t.y);n.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?t.cp2x:t.cp1x,r?t.cp2y:t.cp1y,t.x,t.y)}function jB(n,e){e.translation&&n.translate(e.translation[0],e.translation[1]),Me(e.rotation)||n.rotate(e.rotation),e.color&&(n.fillStyle=e.color),e.textAlign&&(n.textAlign=e.textAlign),e.textBaseline&&(n.textBaseline=e.textBaseline)}function $B(n,e,t,r,i){if(i.strikethrough||i.underline){const o=n.measureText(r),s=e-o.actualBoundingBoxLeft,a=e+o.actualBoundingBoxRight,l=t-o.actualBoundingBoxAscent,u=t+o.actualBoundingBoxDescent,c=i.strikethrough?(l+u)/2:u;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=i.decorationWidth||2,n.moveTo(s,c),n.lineTo(a,c),n.stroke()}}function GB(n,e){const t=n.fillStyle;n.fillStyle=e.color,n.fillRect(e.left,e.top,e.width,e.height),n.fillStyle=t}function Ao(n,e,t,r,i,o={}){const s=lt(e)?e:[e],a=o.strokeWidth>0&&o.strokeColor!=="";let l,u;for(n.save(),n.font=i.string,jB(n,o),l=0;l<s.length;++l)u=s[l],o.backdrop&&GB(n,o.backdrop),a&&(o.strokeColor&&(n.strokeStyle=o.strokeColor),Me(o.strokeWidth)||(n.lineWidth=o.strokeWidth),n.strokeText(u,t,r,o.maxWidth)),n.fillText(u,t,r,o.maxWidth),$B(n,t,r,u,o),r+=Number(i.lineHeight);n.restore()}function Oa(n,e){const{x:t,y:r,w:i,h:o,radius:s}=e;n.arc(t+s.topLeft,r+s.topLeft,s.topLeft,1.5*We,We,!0),n.lineTo(t,r+o-s.bottomLeft),n.arc(t+s.bottomLeft,r+o-s.bottomLeft,s.bottomLeft,We,xt,!0),n.lineTo(t+i-s.bottomRight,r+o),n.arc(t+i-s.bottomRight,r+o-s.bottomRight,s.bottomRight,xt,0,!0),n.lineTo(t+i,r+s.topRight),n.arc(t+i-s.topRight,r+s.topRight,s.topRight,0,-xt,!0),n.lineTo(t+s.topLeft,r)}const qB=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,YB=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function XB(n,e){const t=(""+n).match(qB);if(!t||t[1]==="normal")return e*1.2;switch(n=+t[2],t[3]){case"px":return n;case"%":n/=100;break}return e*n}const KB=n=>+n||0;function rg(n,e){const t={},r=Ne(e),i=r?Object.keys(e):e,o=Ne(n)?r?s=>_e(n[s],n[e[s]]):s=>n[s]:()=>n;for(const s of i)t[s]=KB(o(s));return t}function g_(n){return rg(n,{top:"y",right:"x",bottom:"y",left:"x"})}function yo(n){return rg(n,["topLeft","topRight","bottomLeft","bottomRight"])}function tn(n){const e=g_(n);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function At(n,e){n=n||{},e=e||ct.font;let t=_e(n.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let r=_e(n.style,e.style);r&&!(""+r).match(YB)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const i={family:_e(n.family,e.family),lineHeight:XB(_e(n.lineHeight,e.lineHeight),t),size:t,style:r,weight:_e(n.weight,e.weight),string:""};return i.string=WB(i),i}function ia(n,e,t,r){let i,o,s;for(i=0,o=n.length;i<o;++i)if(s=n[i],s!==void 0&&s!==void 0)return s}function QB(n,e,t){const{min:r,max:i}=n,o=r_(e,(i-r)/2),s=(a,l)=>t&&a===0?0:a+l;return{min:s(r,-Math.abs(o)),max:s(i,o)}}function Wi(n,e){return Object.assign(Object.create(n),e)}function ig(n,e=[""],t,r,i=()=>n[0]){const o=t||n;typeof r>"u"&&(r=b_("_fallback",n));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:o,_fallback:r,_getTarget:i,override:a=>ig([a,...n],e,o,r)};return new Proxy(s,{deleteProperty(a,l){return delete a[l],delete a._keys,delete n[0][l],!0},get(a,l){return v_(a,l,()=>o3(l,e,n,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,l){return Qy(a).includes(l)},ownKeys(a){return Qy(a)},set(a,l,u){const c=a._storage||(a._storage=i());return a[l]=c[l]=u,delete a._keys,!0}})}function Ds(n,e,t,r){const i={_cacheable:!1,_proxy:n,_context:e,_subProxy:t,_stack:new Set,_descriptors:m_(n,r),setContext:o=>Ds(n,o,t,r),override:o=>Ds(n.override(o),e,t,r)};return new Proxy(i,{deleteProperty(o,s){return delete o[s],delete n[s],!0},get(o,s,a){return v_(o,s,()=>ZB(o,s,a))},getOwnPropertyDescriptor(o,s){return o._descriptors.allKeys?Reflect.has(n,s)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,s)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(o,s){return Reflect.has(n,s)},ownKeys(){return Reflect.ownKeys(n)},set(o,s,a){return n[s]=a,delete o[s],!0}})}function m_(n,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:r=e.indexable,_allKeys:i=e.allKeys}=n;return{allKeys:i,scriptable:t,indexable:r,isScriptable:Ni(t)?t:()=>t,isIndexable:Ni(r)?r:()=>r}}const JB=(n,e)=>n?n+Jp(e):e,og=(n,e)=>Ne(e)&&n!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function v_(n,e,t){if(Object.prototype.hasOwnProperty.call(n,e)||e==="constructor")return n[e];const r=t();return n[e]=r,r}function ZB(n,e,t){const{_proxy:r,_context:i,_subProxy:o,_descriptors:s}=n;let a=r[e];return Ni(a)&&s.isScriptable(e)&&(a=e3(e,a,n,t)),lt(a)&&a.length&&(a=t3(e,a,n,s.isIndexable)),og(e,a)&&(a=Ds(a,i,o&&o[e],s)),a}function e3(n,e,t,r){const{_proxy:i,_context:o,_subProxy:s,_stack:a}=t;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let l=e(o,s||r);return a.delete(n),og(n,l)&&(l=sg(i._scopes,i,n,l)),l}function t3(n,e,t,r){const{_proxy:i,_context:o,_subProxy:s,_descriptors:a}=t;if(typeof o.index<"u"&&r(n))return e[o.index%e.length];if(Ne(e[0])){const l=e,u=i._scopes.filter(c=>c!==l);e=[];for(const c of l){const d=sg(u,i,n,c);e.push(Ds(d,o,s&&s[n],a))}}return e}function y_(n,e,t){return Ni(n)?n(e,t):n}const n3=(n,e)=>n===!0?e:typeof n=="string"?Pi(e,n):void 0;function r3(n,e,t,r,i){for(const o of e){const s=n3(t,o);if(s){n.add(s);const a=y_(s._fallback,t,i);if(typeof a<"u"&&a!==t&&a!==r)return a}else if(s===!1&&typeof r<"u"&&t!==r)return null}return!1}function sg(n,e,t,r){const i=e._rootScopes,o=y_(e._fallback,t,r),s=[...n,...i],a=new Set;a.add(r);let l=Ky(a,s,t,o||t,r);return l===null||typeof o<"u"&&o!==t&&(l=Ky(a,s,o,l,r),l===null)?!1:ig(Array.from(a),[""],i,o,()=>i3(e,t,r))}function Ky(n,e,t,r,i){for(;t;)t=r3(n,e,t,r,i);return t}function i3(n,e,t){const r=n._getTarget();e in r||(r[e]={});const i=r[e];return lt(i)&&Ne(t)?t:i||{}}function o3(n,e,t,r){let i;for(const o of e)if(i=b_(JB(o,n),t),typeof i<"u")return og(n,i)?sg(t,r,n,i):i}function b_(n,e){for(const t of e){if(!t)continue;const r=t[n];if(typeof r<"u")return r}}function Qy(n){let e=n._keys;return e||(e=n._keys=s3(n._scopes)),e}function s3(n){const e=new Set;for(const t of n)for(const r of Object.keys(t).filter(i=>!i.startsWith("_")))e.add(r);return Array.from(e)}function x_(n,e,t,r){const{iScale:i}=n,{key:o="r"}=this._parsing,s=new Array(r);let a,l,u,c;for(a=0,l=r;a<l;++a)u=a+t,c=e[u],s[a]={r:i.parse(Pi(c,o),u)};return s}const a3=Number.EPSILON||1e-14,As=(n,e)=>e<n.length&&!n[e].skip&&n[e],w_=n=>n==="x"?"y":"x";function l3(n,e,t,r){const i=n.skip?e:n,o=e,s=t.skip?e:t,a=Ef(o,i),l=Ef(s,o);let u=a/(a+l),c=l/(a+l);u=isNaN(u)?0:u,c=isNaN(c)?0:c;const d=r*u,h=r*c;return{previous:{x:o.x-d*(s.x-i.x),y:o.y-d*(s.y-i.y)},next:{x:o.x+h*(s.x-i.x),y:o.y+h*(s.y-i.y)}}}function u3(n,e,t){const r=n.length;let i,o,s,a,l,u=As(n,0);for(let c=0;c<r-1;++c)if(l=u,u=As(n,c+1),!(!l||!u)){if(pa(e[c],0,a3)){t[c]=t[c+1]=0;continue}i=t[c]/e[c],o=t[c+1]/e[c],a=Math.pow(i,2)+Math.pow(o,2),!(a<=9)&&(s=3/Math.sqrt(a),t[c]=i*s*e[c],t[c+1]=o*s*e[c])}}function c3(n,e,t="x"){const r=w_(t),i=n.length;let o,s,a,l=As(n,0);for(let u=0;u<i;++u){if(s=a,a=l,l=As(n,u+1),!a)continue;const c=a[t],d=a[r];s&&(o=(c-s[t])/3,a[`cp1${t}`]=c-o,a[`cp1${r}`]=d-o*e[u]),l&&(o=(l[t]-c)/3,a[`cp2${t}`]=c+o,a[`cp2${r}`]=d+o*e[u])}}function d3(n,e="x"){const t=w_(e),r=n.length,i=Array(r).fill(0),o=Array(r);let s,a,l,u=As(n,0);for(s=0;s<r;++s)if(a=l,l=u,u=As(n,s+1),!!l){if(u){const c=u[e]-l[e];i[s]=c!==0?(u[t]-l[t])/c:0}o[s]=a?u?Ar(i[s-1])!==Ar(i[s])?0:(i[s-1]+i[s])/2:i[s-1]:i[s]}u3(n,i,o),c3(n,o,e)}function Ll(n,e,t){return Math.max(Math.min(n,t),e)}function h3(n,e){let t,r,i,o,s,a=Qr(n[0],e);for(t=0,r=n.length;t<r;++t)s=o,o=a,a=t<r-1&&Qr(n[t+1],e),o&&(i=n[t],s&&(i.cp1x=Ll(i.cp1x,e.left,e.right),i.cp1y=Ll(i.cp1y,e.top,e.bottom)),a&&(i.cp2x=Ll(i.cp2x,e.left,e.right),i.cp2y=Ll(i.cp2y,e.top,e.bottom)))}function f3(n,e,t,r,i){let o,s,a,l;if(e.spanGaps&&(n=n.filter(u=>!u.skip)),e.cubicInterpolationMode==="monotone")d3(n,i);else{let u=r?n[n.length-1]:n[0];for(o=0,s=n.length;o<s;++o)a=n[o],l=l3(u,a,n[Math.min(o+1,s-(r?0:1))%s],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,u=a}e.capBezierPoints&&h3(n,t)}function ag(){return typeof window<"u"&&typeof document<"u"}function lg(n){let e=n.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function Gu(n,e,t){let r;return typeof n=="string"?(r=parseInt(n,10),n.indexOf("%")!==-1&&(r=r/100*e.parentNode[t])):r=n,r}const Hc=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function p3(n,e){return Hc(n).getPropertyValue(e)}const g3=["top","right","bottom","left"];function bo(n,e,t){const r={};t=t?"-"+t:"";for(let i=0;i<4;i++){const o=g3[i];r[o]=parseFloat(n[e+"-"+o+t])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const m3=(n,e,t)=>(n>0||e>0)&&(!t||!t.shadowRoot);function v3(n,e){const t=n.touches,r=t&&t.length?t[0]:n,{offsetX:i,offsetY:o}=r;let s=!1,a,l;if(m3(i,o,n.target))a=i,l=o;else{const u=e.getBoundingClientRect();a=r.clientX-u.left,l=r.clientY-u.top,s=!0}return{x:a,y:l,box:s}}function io(n,e){if("native"in n)return n;const{canvas:t,currentDevicePixelRatio:r}=e,i=Hc(t),o=i.boxSizing==="border-box",s=bo(i,"padding"),a=bo(i,"border","width"),{x:l,y:u,box:c}=v3(n,t),d=s.left+(c&&a.left),h=s.top+(c&&a.top);let{width:f,height:p}=e;return o&&(f-=s.width+a.width,p-=s.height+a.height),{x:Math.round((l-d)/f*t.width/r),y:Math.round((u-h)/p*t.height/r)}}function y3(n,e,t){let r,i;if(e===void 0||t===void 0){const o=n&&lg(n);if(!o)e=n.clientWidth,t=n.clientHeight;else{const s=o.getBoundingClientRect(),a=Hc(o),l=bo(a,"border","width"),u=bo(a,"padding");e=s.width-u.width-l.width,t=s.height-u.height-l.height,r=Gu(a.maxWidth,o,"clientWidth"),i=Gu(a.maxHeight,o,"clientHeight")}}return{width:e,height:t,maxWidth:r||ju,maxHeight:i||ju}}const _i=n=>Math.round(n*10)/10;function b3(n,e,t,r){const i=Hc(n),o=bo(i,"margin"),s=Gu(i.maxWidth,n,"clientWidth")||ju,a=Gu(i.maxHeight,n,"clientHeight")||ju,l=y3(n,e,t);let{width:u,height:c}=l;if(i.boxSizing==="content-box"){const h=bo(i,"border","width"),f=bo(i,"padding");u-=f.width+h.width,c-=f.height+h.height}return u=Math.max(0,u-o.width),c=Math.max(0,r?u/r:c-o.height),u=_i(Math.min(u,s,l.maxWidth)),c=_i(Math.min(c,a,l.maxHeight)),u&&!c&&(c=_i(u/2)),(e!==void 0||t!==void 0)&&r&&l.height&&c>l.height&&(c=l.height,u=_i(Math.floor(c*r))),{width:u,height:c}}function Jy(n,e,t){const r=e||1,i=_i(n.height*r),o=_i(n.width*r);n.height=_i(n.height),n.width=_i(n.width);const s=n.canvas;return s.style&&(t||!s.style.height&&!s.style.width)&&(s.style.height=`${n.height}px`,s.style.width=`${n.width}px`),n.currentDevicePixelRatio!==r||s.height!==i||s.width!==o?(n.currentDevicePixelRatio=r,s.height=i,s.width=o,n.ctx.setTransform(r,0,0,r,0,0),!0):!1}const x3=(function(){let n=!1;try{const e={get passive(){return n=!0,!1}};ag()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return n})();function Zy(n,e){const t=p3(n,e),r=t&&t.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function oo(n,e,t,r){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function w3(n,e,t,r){return{x:n.x+t*(e.x-n.x),y:r==="middle"?t<.5?n.y:e.y:r==="after"?t<1?n.y:e.y:t>0?e.y:n.y}}function _3(n,e,t,r){const i={x:n.cp2x,y:n.cp2y},o={x:e.cp1x,y:e.cp1y},s=oo(n,i,t),a=oo(i,o,t),l=oo(o,e,t),u=oo(s,a,t),c=oo(a,l,t);return oo(u,c,t)}const C3=function(n,e){return{x(t){return n+n+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,r){return t-r},leftForLtr(t,r){return t-r}}},E3=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,e){return n+e},leftForLtr(n,e){return n}}};function hs(n,e,t){return n?C3(e,t):E3()}function __(n,e){let t,r;(e==="ltr"||e==="rtl")&&(t=n.canvas.style,r=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),n.prevTextDirection=r)}function C_(n,e){e!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",e[0],e[1]))}function E_(n){return n==="angle"?{between:Ma,compare:SB,normalize:qt}:{between:Xr,compare:(e,t)=>e-t,normalize:e=>e}}function eb({start:n,end:e,count:t,loop:r,style:i}){return{start:n%t,end:e%t,loop:r&&(e-n+1)%t===0,style:i}}function S3(n,e,t){const{property:r,start:i,end:o}=t,{between:s,normalize:a}=E_(r),l=e.length;let{start:u,end:c,loop:d}=n,h,f;if(d){for(u+=l,c+=l,h=0,f=l;h<f&&s(a(e[u%l][r]),i,o);++h)u--,c--;u%=l,c%=l}return c<u&&(c+=l),{start:u,end:c,loop:d,style:n.style}}function S_(n,e,t){if(!t)return[n];const{property:r,start:i,end:o}=t,s=e.length,{compare:a,between:l,normalize:u}=E_(r),{start:c,end:d,loop:h,style:f}=S3(n,e,t),p=[];let g=!1,m=null,v,y,b;const x=()=>l(i,b,v)&&a(i,b)!==0,w=()=>a(o,v)===0||l(o,b,v),_=()=>g||x(),C=()=>!g||w();for(let E=c,S=c;E<=d;++E)y=e[E%s],!y.skip&&(v=u(y[r]),v!==b&&(g=l(v,i,o),m===null&&_()&&(m=a(v,i)===0?E:S),m!==null&&C()&&(p.push(eb({start:m,end:E,loop:h,count:s,style:f})),m=null),S=E,b=v));return m!==null&&p.push(eb({start:m,end:d,loop:h,count:s,style:f})),p}function D_(n,e){const t=[],r=n.segments;for(let i=0;i<r.length;i++){const o=S_(r[i],n.points,e);o.length&&t.push(...o)}return t}function D3(n,e,t,r){let i=0,o=e-1;if(t&&!r)for(;i<e&&!n[i].skip;)i++;for(;i<e&&n[i].skip;)i++;for(i%=e,t&&(o+=i);o>i&&n[o%e].skip;)o--;return o%=e,{start:i,end:o}}function A3(n,e,t,r){const i=n.length,o=[];let s=e,a=n[e],l;for(l=e+1;l<=t;++l){const u=n[l%i];u.skip||u.stop?a.skip||(r=!1,o.push({start:e%i,end:(l-1)%i,loop:r}),e=s=u.stop?l:null):(s=l,a.skip&&(e=l)),a=u}return s!==null&&o.push({start:e%i,end:s%i,loop:r}),o}function k3(n,e){const t=n.points,r=n.options.spanGaps,i=t.length;if(!i)return[];const o=!!n._loop,{start:s,end:a}=D3(t,i,o,r);if(r===!0)return tb(n,[{start:s,end:a,loop:o}],t,e);const l=a<s?a+i:a,u=!!n._fullLoop&&s===0&&a===i-1;return tb(n,A3(t,s,l,u),t,e)}function tb(n,e,t,r){return!r||!r.setContext||!t?e:R3(n,e,t,r)}function R3(n,e,t,r){const i=n._chart.getContext(),o=nb(n.options),{_datasetIndex:s,options:{spanGaps:a}}=n,l=t.length,u=[];let c=o,d=e[0].start,h=d;function f(p,g,m,v){const y=a?-1:1;if(p!==g){for(p+=l;t[p%l].skip;)p-=y;for(;t[g%l].skip;)g+=y;p%l!==g%l&&(u.push({start:p%l,end:g%l,loop:m,style:v}),c=v,d=g%l)}}for(const p of e){d=a?d:p.start;let g=t[d%l],m;for(h=d+1;h<=p.end;h++){const v=t[h%l];m=nb(r.setContext(Wi(i,{type:"segment",p0:g,p1:v,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:s}))),T3(m,c)&&f(d,h-1,p.loop,c),g=v,c=m}d<h-1&&f(d,h-1,p.loop,c)}return u}function nb(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function T3(n,e){if(!e)return!1;const t=[],r=function(i,o){return ng(o)?(t.includes(o)||t.push(o),t.indexOf(o)):o};return JSON.stringify(n,r)!==JSON.stringify(e,r)}function Bl(n,e,t){return n.options.clip?n[t]:e[t]}function I3(n,e){const{xScale:t,yScale:r}=n;return t&&r?{left:Bl(t,e,"left"),right:Bl(t,e,"right"),top:Bl(r,e,"top"),bottom:Bl(r,e,"bottom")}:e}function A_(n,e){const t=e._clip;if(t.disabled)return!1;const r=I3(e,n.chartArea);return{left:t.left===!1?0:r.left-(t.left===!0?0:t.left),right:t.right===!1?n.width:r.right+(t.right===!0?0:t.right),top:t.top===!1?0:r.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?n.height:r.bottom+(t.bottom===!0?0:t.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class M3{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,r,i){const o=t.listeners[i],s=t.duration;o.forEach(a=>a({chart:e,initial:t.initial,numSteps:s,currentStep:Math.min(r-t.start,s)}))}_refresh(){this._request||(this._running=!0,this._request=u_.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((r,i)=>{if(!r.running||!r.items.length)return;const o=r.items;let s=o.length-1,a=!1,l;for(;s>=0;--s)l=o[s],l._active?(l._total>r.duration&&(r.duration=l._total),l.tick(e),a=!0):(o[s]=o[o.length-1],o.pop());a&&(i.draw(),this._notify(i,r,e,"progress")),o.length||(r.running=!1,this._notify(i,r,e,"complete"),r.initial=!1),t+=o.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let r=t.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,r)),r}listen(e,t,r){this._getAnims(e).listeners[t].push(r)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((r,i)=>Math.max(r,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const r=t.items;let i=r.length-1;for(;i>=0;--i)r[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Ur=new M3;const rb="transparent",O3={boolean(n,e,t){return t>.5?e:n},color(n,e,t){const r=qy(n||rb),i=r.valid&&qy(e||rb);return i&&i.valid?i.mix(r,t).hexString():e},number(n,e,t){return n+(e-n)*t}};class P3{constructor(e,t,r,i){const o=t[r];i=ia([e.to,i,o,e.from]);const s=ia([e.from,o,i]);this._active=!0,this._fn=e.fn||O3[e.type||typeof s],this._easing=ga[e.easing]||ga.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=r,this._from=s,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,r){if(this._active){this._notify(!1);const i=this._target[this._prop],o=r-this._start,s=this._duration-o;this._start=r,this._duration=Math.floor(Math.max(s,e.duration)),this._total+=o,this._loop=!!e.loop,this._to=ia([e.to,t,i,e.from]),this._from=ia([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,r=this._duration,i=this._prop,o=this._from,s=this._loop,a=this._to;let l;if(this._active=o!==a&&(s||t<r),!this._active){this._target[i]=a,this._notify(!0);return}if(t<0){this._target[i]=o;return}l=t/r%2,l=s&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[i]=this._fn(o,a,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,r)=>{e.push({res:t,rej:r})})}_notify(e){const t=e?"res":"rej",r=this._promises||[];for(let i=0;i<r.length;i++)r[i][t]()}}class k_{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!Ne(e))return;const t=Object.keys(ct.animation),r=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const o=e[i];if(!Ne(o))return;const s={};for(const a of t)s[a]=o[a];(lt(o.properties)&&o.properties||[i]).forEach(a=>{(a===i||!r.has(a))&&r.set(a,s)})})}_animateOptions(e,t){const r=t.options,i=F3(e,r);if(!i)return[];const o=this._createAnimations(i,r);return r.$shared&&N3(e.options.$animations,r).then(()=>{e.options=r},()=>{}),o}_createAnimations(e,t){const r=this._properties,i=[],o=e.$animations||(e.$animations={}),s=Object.keys(t),a=Date.now();let l;for(l=s.length-1;l>=0;--l){const u=s[l];if(u.charAt(0)==="$")continue;if(u==="options"){i.push(...this._animateOptions(e,t));continue}const c=t[u];let d=o[u];const h=r.get(u);if(d)if(h&&d.active()){d.update(h,c,a);continue}else d.cancel();if(!h||!h.duration){e[u]=c;continue}o[u]=d=new P3(h,e,u,c),i.push(d)}return i}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const r=this._createAnimations(e,t);if(r.length)return Ur.add(this._chart,r),!0}}function N3(n,e){const t=[],r=Object.keys(e);for(let i=0;i<r.length;i++){const o=n[r[i]];o&&o.active()&&t.push(o.wait())}return Promise.all(t)}function F3(n,e){if(!e)return;let t=n.options;if(!t){n.options=e;return}return t.$shared&&(n.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function ib(n,e){const t=n&&n.options||{},r=t.reverse,i=t.min===void 0?e:0,o=t.max===void 0?e:0;return{start:r?o:i,end:r?i:o}}function L3(n,e,t){if(t===!1)return!1;const r=ib(n,t),i=ib(e,t);return{top:i.end,right:r.end,bottom:i.start,left:r.start}}function B3(n){let e,t,r,i;return Ne(n)?(e=n.top,t=n.right,r=n.bottom,i=n.left):e=t=r=i=n,{top:e,right:t,bottom:r,left:i,disabled:n===!1}}function R_(n,e){const t=[],r=n._getSortedDatasetMetas(e);let i,o;for(i=0,o=r.length;i<o;++i)t.push(r[i].index);return t}function ob(n,e,t,r={}){const i=n.keys,o=r.mode==="single";let s,a,l,u;if(e===null)return;let c=!1;for(s=0,a=i.length;s<a;++s){if(l=+i[s],l===t){if(c=!0,r.all)continue;break}u=n.values[l],yt(u)&&(o||e===0||Ar(e)===Ar(u))&&(e+=u)}return!c&&!r.all?0:e}function H3(n,e){const{iScale:t,vScale:r}=e,i=t.axis==="x"?"x":"y",o=r.axis==="x"?"x":"y",s=Object.keys(n),a=new Array(s.length);let l,u,c;for(l=0,u=s.length;l<u;++l)c=s[l],a[l]={[i]:c,[o]:n[c]};return a}function rh(n,e){const t=n&&n.options.stacked;return t||t===void 0&&e.stack!==void 0}function W3(n,e,t){return`${n.id}.${e.id}.${t.stack||t.type}`}function z3(n){const{min:e,max:t,minDefined:r,maxDefined:i}=n.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:i?t:Number.POSITIVE_INFINITY}}function V3(n,e,t){const r=n[e]||(n[e]={});return r[t]||(r[t]={})}function sb(n,e,t,r){for(const i of e.getMatchingVisibleMetas(r).reverse()){const o=n[i.index];if(t&&o>0||!t&&o<0)return i.index}return null}function ab(n,e){const{chart:t,_cachedMeta:r}=n,i=t._stacks||(t._stacks={}),{iScale:o,vScale:s,index:a}=r,l=o.axis,u=s.axis,c=W3(o,s,r),d=e.length;let h;for(let f=0;f<d;++f){const p=e[f],{[l]:g,[u]:m}=p,v=p._stacks||(p._stacks={});h=v[u]=V3(i,c,g),h[a]=m,h._top=sb(h,s,!0,r.type),h._bottom=sb(h,s,!1,r.type);const y=h._visualValues||(h._visualValues={});y[a]=m}}function ih(n,e){const t=n.scales;return Object.keys(t).filter(r=>t[r].axis===e).shift()}function U3(n,e){return Wi(n,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function j3(n,e,t){return Wi(n,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function qs(n,e){const t=n.controller.index,r=n.vScale&&n.vScale.axis;if(r){e=e||n._parsed;for(const i of e){const o=i._stacks;if(!o||o[r]===void 0||o[r][t]===void 0)return;delete o[r][t],o[r]._visualValues!==void 0&&o[r]._visualValues[t]!==void 0&&delete o[r]._visualValues[t]}}}const oh=n=>n==="reset"||n==="none",lb=(n,e)=>e?n:Object.assign({},n),$3=(n,e,t)=>n&&!e.hidden&&e._stacked&&{keys:R_(t,!0),values:null};class zi{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=rh(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&qs(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,r=this.getDataset(),i=(d,h,f,p)=>d==="x"?h:d==="r"?p:f,o=t.xAxisID=_e(r.xAxisID,ih(e,"x")),s=t.yAxisID=_e(r.yAxisID,ih(e,"y")),a=t.rAxisID=_e(r.rAxisID,ih(e,"r")),l=t.indexAxis,u=t.iAxisID=i(l,o,s,a),c=t.vAxisID=i(l,s,o,a);t.xScale=this.getScaleForId(o),t.yScale=this.getScaleForId(s),t.rScale=this.getScaleForId(a),t.iScale=this.getScaleForId(u),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&jy(this._data,this),e._stacked&&qs(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),r=this._data;if(Ne(t)){const i=this._cachedMeta;this._data=H3(t,i)}else if(r!==t){if(r){jy(r,this);const i=this._cachedMeta;qs(i),i._parsed=[]}t&&Object.isExtensible(t)&&RB(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,r=this.getDataset();let i=!1;this._dataCheck();const o=t._stacked;t._stacked=rh(t.vScale,t),t.stack!==r.stack&&(i=!0,qs(t),t.stack=r.stack),this._resyncElements(e),(i||o!==t._stacked)&&(ab(this,t._parsed),t._stacked=rh(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:r,_data:i}=this,{iScale:o,_stacked:s}=r,a=o.axis;let l=e===0&&t===i.length?!0:r._sorted,u=e>0&&r._parsed[e-1],c,d,h;if(this._parsing===!1)r._parsed=i,r._sorted=!0,h=i;else{lt(i[e])?h=this.parseArrayData(r,i,e,t):Ne(i[e])?h=this.parseObjectData(r,i,e,t):h=this.parsePrimitiveData(r,i,e,t);const f=()=>d[a]===null||u&&d[a]<u[a];for(c=0;c<t;++c)r._parsed[c+e]=d=h[c],l&&(f()&&(l=!1),u=d);r._sorted=l}s&&ab(this,h)}parsePrimitiveData(e,t,r,i){const{iScale:o,vScale:s}=e,a=o.axis,l=s.axis,u=o.getLabels(),c=o===s,d=new Array(i);let h,f,p;for(h=0,f=i;h<f;++h)p=h+r,d[h]={[a]:c||o.parse(u[p],p),[l]:s.parse(t[p],p)};return d}parseArrayData(e,t,r,i){const{xScale:o,yScale:s}=e,a=new Array(i);let l,u,c,d;for(l=0,u=i;l<u;++l)c=l+r,d=t[c],a[l]={x:o.parse(d[0],c),y:s.parse(d[1],c)};return a}parseObjectData(e,t,r,i){const{xScale:o,yScale:s}=e,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,u=new Array(i);let c,d,h,f;for(c=0,d=i;c<d;++c)h=c+r,f=t[h],u[c]={x:o.parse(Pi(f,a),h),y:s.parse(Pi(f,l),h)};return u}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,r){const i=this.chart,o=this._cachedMeta,s=t[e.axis],a={keys:R_(i,!0),values:t._stacks[e.axis]._visualValues};return ob(a,s,o.index,{mode:r})}updateRangeFromParsed(e,t,r,i){const o=r[t.axis];let s=o===null?NaN:o;const a=i&&r._stacks[t.axis];i&&a&&(i.values=a,s=ob(i,o,this._cachedMeta.index)),e.min=Math.min(e.min,s),e.max=Math.max(e.max,s)}getMinMax(e,t){const r=this._cachedMeta,i=r._parsed,o=r._sorted&&e===r.iScale,s=i.length,a=this._getOtherScale(e),l=$3(t,r,this.chart),u={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:d}=z3(a);let h,f;function p(){f=i[h];const g=f[a.axis];return!yt(f[e.axis])||c>g||d<g}for(h=0;h<s&&!(!p()&&(this.updateRangeFromParsed(u,e,f,l),o));++h);if(o){for(h=s-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(u,e,f,l);break}}return u}getAllParsedValues(e){const t=this._cachedMeta._parsed,r=[];let i,o,s;for(i=0,o=t.length;i<o;++i)s=t[i][e.axis],yt(s)&&r.push(s);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,r=t.iScale,i=t.vScale,o=this.getParsed(e);return{label:r?""+r.getLabelForValue(o[r.axis]):"",value:i?""+i.getLabelForValue(o[i.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=B3(_e(this.options.clip,L3(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,r=this._cachedMeta,i=r.data||[],o=t.chartArea,s=[],a=this._drawStart||0,l=this._drawCount||i.length-a,u=this.options.drawActiveElementsOnTop;let c;for(r.dataset&&r.dataset.draw(e,o,a,l),c=a;c<a+l;++c){const d=i[c];d.hidden||(d.active&&u?s.push(d):d.draw(e,o))}for(c=0;c<s.length;++c)s[c].draw(e,o)}getStyle(e,t){const r=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,t,r){const i=this.getDataset();let o;if(e>=0&&e<this._cachedMeta.data.length){const s=this._cachedMeta.data[e];o=s.$context||(s.$context=j3(this.getContext(),e,s)),o.parsed=this.getParsed(e),o.raw=i.data[e],o.index=o.dataIndex=e}else o=this.$context||(this.$context=U3(this.chart.getContext(),this.index)),o.dataset=i,o.index=o.datasetIndex=this.index;return o.active=!!t,o.mode=r,o}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",r){const i=t==="active",o=this._cachedDataOpts,s=e+"-"+t,a=o[s],l=this.enableOptionSharing&&Ia(r);if(a)return lb(a,l);const u=this.chart.config,c=u.datasetElementScopeKeys(this._type,e),d=i?[`${e}Hover`,"hover",e,""]:[e,""],h=u.getOptionScopes(this.getDataset(),c),f=Object.keys(ct.elements[e]),p=()=>this.getContext(r,i,t),g=u.resolveNamedOptions(h,f,p,d);return g.$shared&&(g.$shared=l,o[s]=Object.freeze(lb(g,l))),g}_resolveAnimations(e,t,r){const i=this.chart,o=this._cachedDataOpts,s=`animation-${t}`,a=o[s];if(a)return a;let l;if(i.options.animation!==!1){const c=this.chart.config,d=c.datasetAnimationScopeKeys(this._type,t),h=c.getOptionScopes(this.getDataset(),d);l=c.createResolver(h,this.getContext(e,r,t))}const u=new k_(i,l&&l.animations);return l&&l._cacheable&&(o[s]=Object.freeze(u)),u}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||oh(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const r=this.resolveDataElementOptions(e,t),i=this._sharedOptions,o=this.getSharedOptions(r),s=this.includeOptions(t,o)||o!==i;return this.updateSharedOptions(o,t,r),{sharedOptions:o,includeOptions:s}}updateElement(e,t,r,i){oh(i)?Object.assign(e,r):this._resolveAnimations(t,i).update(e,r)}updateSharedOptions(e,t,r){e&&!oh(t)&&this._resolveAnimations(void 0,t).update(e,r)}_setStyle(e,t,r,i){e.active=i;const o=this.getStyle(t,i);this._resolveAnimations(t,r,i).update(e,{options:!i&&this.getSharedOptions(o)||o})}removeHoverStyle(e,t,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,t,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,r=this._cachedMeta.data;for(const[a,l,u]of this._syncList)this[a](l,u);this._syncList=[];const i=r.length,o=t.length,s=Math.min(o,i);s&&this.parse(0,s),o>i?this._insertElements(i,o-i,e):o<i&&this._removeElements(o,i-o)}_insertElements(e,t,r=!0){const i=this._cachedMeta,o=i.data,s=e+t;let a;const l=u=>{for(u.length+=t,a=u.length-1;a>=s;a--)u[a]=u[a-t]};for(l(o),a=e;a<s;++a)o[a]=new this.dataElementType;this._parsing&&l(i._parsed),this.parse(e,t),r&&this.updateElements(o,e,t,"reset")}updateElements(e,t,r,i){}_removeElements(e,t){const r=this._cachedMeta;if(this._parsing){const i=r._parsed.splice(e,t);r._stacked&&qs(r,i)}r.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,r,i]=e;this[t](r,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function G3(n,e){if(!n._cache.$bar){const t=n.getMatchingVisibleMetas(e);let r=[];for(let i=0,o=t.length;i<o;i++)r=r.concat(t[i].controller.getAllParsedValues(n));n._cache.$bar=l_(r.sort((i,o)=>i-o))}return n._cache.$bar}function q3(n){const e=n.iScale,t=G3(e,n.type);let r=e._length,i,o,s,a;const l=()=>{s===32767||s===-32768||(Ia(a)&&(r=Math.min(r,Math.abs(s-a)||r)),a=s)};for(i=0,o=t.length;i<o;++i)s=e.getPixelForValue(t[i]),l();for(a=void 0,i=0,o=e.ticks.length;i<o;++i)s=e.getPixelForTick(i),l();return r}function Y3(n,e,t,r){const i=t.barThickness;let o,s;return Me(i)?(o=e.min*t.categoryPercentage,s=t.barPercentage):(o=i*r,s=1),{chunk:o/r,ratio:s,start:e.pixels[n]-o/2}}function X3(n,e,t,r){const i=e.pixels,o=i[n];let s=n>0?i[n-1]:null,a=n<i.length-1?i[n+1]:null;const l=t.categoryPercentage;s===null&&(s=o-(a===null?e.end-e.start:a-o)),a===null&&(a=o+o-s);const u=o-(o-Math.min(s,a))/2*l;return{chunk:Math.abs(a-s)/2*l/r,ratio:t.barPercentage,start:u}}function K3(n,e,t,r){const i=t.parse(n[0],r),o=t.parse(n[1],r),s=Math.min(i,o),a=Math.max(i,o);let l=s,u=a;Math.abs(s)>Math.abs(a)&&(l=a,u=s),e[t.axis]=u,e._custom={barStart:l,barEnd:u,start:i,end:o,min:s,max:a}}function T_(n,e,t,r){return lt(n)?K3(n,e,t,r):e[t.axis]=t.parse(n,r),e}function ub(n,e,t,r){const i=n.iScale,o=n.vScale,s=i.getLabels(),a=i===o,l=[];let u,c,d,h;for(u=t,c=t+r;u<c;++u)h=e[u],d={},d[i.axis]=a||i.parse(s[u],u),l.push(T_(h,d,o,u));return l}function sh(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function Q3(n,e,t){return n!==0?Ar(n):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function J3(n){let e,t,r,i,o;return n.horizontal?(e=n.base>n.x,t="left",r="right"):(e=n.base<n.y,t="bottom",r="top"),e?(i="end",o="start"):(i="start",o="end"),{start:t,end:r,reverse:e,top:i,bottom:o}}function Z3(n,e,t,r){let i=e.borderSkipped;const o={};if(!i){n.borderSkipped=o;return}if(i===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:s,end:a,reverse:l,top:u,bottom:c}=J3(n);i==="middle"&&t&&(n.enableBorderRadius=!0,(t._top||0)===r?i=u:(t._bottom||0)===r?i=c:(o[cb(c,s,a,l)]=!0,i=u)),o[cb(i,s,a,l)]=!0,n.borderSkipped=o}function cb(n,e,t,r){return r?(n=e4(n,e,t),n=db(n,t,e)):n=db(n,e,t),n}function e4(n,e,t){return n===e?t:n===t?e:n}function db(n,e,t){return n==="start"?e:n==="end"?t:n}function t4(n,{inflateAmount:e},t){n.inflateAmount=e==="auto"?t===1?.33:0:e}class n4 extends zi{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,r,i){return ub(e,t,r,i)}parseArrayData(e,t,r,i){return ub(e,t,r,i)}parseObjectData(e,t,r,i){const{iScale:o,vScale:s}=e,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,u=o.axis==="x"?a:l,c=s.axis==="x"?a:l,d=[];let h,f,p,g;for(h=r,f=r+i;h<f;++h)g=t[h],p={},p[o.axis]=o.parse(Pi(g,u),h),d.push(T_(Pi(g,c),p,s,h));return d}updateRangeFromParsed(e,t,r,i){super.updateRangeFromParsed(e,t,r,i);const o=r._custom;o&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,o.min),e.max=Math.max(e.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:r,vScale:i}=t,o=this.getParsed(e),s=o._custom,a=sh(s)?"["+s.start+", "+s.end+"]":""+i.getLabelForValue(o[i.axis]);return{label:""+r.getLabelForValue(o[r.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,r,i){const o=i==="reset",{index:s,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),u=a.isHorizontal(),c=this._getRuler(),{sharedOptions:d,includeOptions:h}=this._getSharedOptions(t,i);for(let f=t;f<t+r;f++){const p=this.getParsed(f),g=o||Me(p[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,c),v=(p._stacks||{})[a.axis],y={horizontal:u,base:g.base,enableBorderRadius:!v||sh(p._custom)||s===v._top||s===v._bottom,x:u?g.head:m.center,y:u?m.center:g.head,height:u?m.size:Math.abs(g.size),width:u?Math.abs(g.size):m.size};h&&(y.options=d||this.resolveDataElementOptions(f,e[f].active?"active":i));const b=y.options||e[f].options;Z3(y,b,v,s),t4(y,b,c.ratio),this.updateElement(e[f],f,y,i)}}_getStacks(e,t){const{iScale:r}=this._cachedMeta,i=r.getMatchingVisibleMetas(this._type).filter(c=>c.controller.options.grouped),o=r.options.stacked,s=[],a=this._cachedMeta.controller.getParsed(t),l=a&&a[r.axis],u=c=>{const d=c._parsed.find(f=>f[r.axis]===l),h=d&&d[c.vScale.axis];if(Me(h)||isNaN(h))return!0};for(const c of i)if(!(t!==void 0&&u(c))&&((o===!1||s.indexOf(c.stack)===-1||o===void 0&&c.stack===void 0)&&s.push(c.stack),c.index===e))break;return s.length||s.push(void 0),s}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const e=this.chart.scales,t=this.chart.options.indexAxis;return Object.keys(e).filter(r=>e[r].axis===t).shift()}_getAxis(){const e={},t=this.getFirstScaleIdForIndexAxis();for(const r of this.chart.data.datasets)e[_e(this.chart.options.indexAxis==="x"?r.xAxisID:r.yAxisID,t)]=!0;return Object.keys(e)}_getStackIndex(e,t,r){const i=this._getStacks(e,r),o=t!==void 0?i.indexOf(t):-1;return o===-1?i.length-1:o}_getRuler(){const e=this.options,t=this._cachedMeta,r=t.iScale,i=[];let o,s;for(o=0,s=t.data.length;o<s;++o)i.push(r.getPixelForValue(this.getParsed(o)[r.axis],o));const a=e.barThickness;return{min:a||q3(t),pixels:i,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:e.grouped,ratio:a?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:r,index:i},options:{base:o,minBarLength:s}}=this,a=o||0,l=this.getParsed(e),u=l._custom,c=sh(u);let d=l[t.axis],h=0,f=r?this.applyStack(t,l,r):d,p,g;f!==d&&(h=f-d,f=d),c&&(d=u.barStart,f=u.barEnd-u.barStart,d!==0&&Ar(d)!==Ar(u.barEnd)&&(h=0),h+=d);const m=!Me(o)&&!c?o:h;let v=t.getPixelForValue(m);if(this.chart.getDataVisibility(e)?p=t.getPixelForValue(h+f):p=v,g=p-v,Math.abs(g)<s){g=Q3(g,t,a)*s,d===a&&(v-=g/2);const y=t.getPixelForDecimal(0),b=t.getPixelForDecimal(1),x=Math.min(y,b),w=Math.max(y,b);v=Math.max(Math.min(v,w),x),p=v+g,r&&!c&&(l._stacks[t.axis]._visualValues[i]=t.getValueForPixel(p)-t.getValueForPixel(v))}if(v===t.getPixelForValue(a)){const y=Ar(g)*t.getLineWidthForValue(a)/2;v+=y,g-=y}return{size:g,base:v,head:p,center:p+g/2}}_calculateBarIndexPixels(e,t){const r=t.scale,i=this.options,o=i.skipNull,s=_e(i.maxBarThickness,1/0);let a,l;const u=this._getAxisCount();if(t.grouped){const c=o?this._getStackCount(e):t.stackCount,d=i.barThickness==="flex"?X3(e,t,i,c*u):Y3(e,t,i,c*u),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(_e(h,this.getFirstScaleIdForIndexAxis())),p=this._getStackIndex(this.index,this._cachedMeta.stack,o?e:void 0)+f;a=d.start+d.chunk*p+d.chunk/2,l=Math.min(s,d.chunk*d.ratio)}else a=r.getPixelForValue(this.getParsed(e)[r.axis],e),l=Math.min(s,t.min*t.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const e=this._cachedMeta,t=e.vScale,r=e.data,i=r.length;let o=0;for(;o<i;++o)this.getParsed(o)[t.axis]!==null&&!r[o].hidden&&r[o].draw(this._ctx)}}class r4 extends zi{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,r,i){const o=super.parsePrimitiveData(e,t,r,i);for(let s=0;s<o.length;s++)o[s]._custom=this.resolveDataElementOptions(s+r).radius;return o}parseArrayData(e,t,r,i){const o=super.parseArrayData(e,t,r,i);for(let s=0;s<o.length;s++){const a=t[r+s];o[s]._custom=_e(a[2],this.resolveDataElementOptions(s+r).radius)}return o}parseObjectData(e,t,r,i){const o=super.parseObjectData(e,t,r,i);for(let s=0;s<o.length;s++){const a=t[r+s];o[s]._custom=_e(a&&a.r&&+a.r,this.resolveDataElementOptions(s+r).radius)}return o}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let r=e.length-1;r>=0;--r)t=Math.max(t,e[r].size(this.resolveDataElementOptions(r))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,r=this.chart.data.labels||[],{xScale:i,yScale:o}=t,s=this.getParsed(e),a=i.getLabelForValue(s.x),l=o.getLabelForValue(s.y),u=s._custom;return{label:r[e]||"",value:"("+a+", "+l+(u?", "+u:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,r,i){const o=i==="reset",{iScale:s,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:u}=this._getSharedOptions(t,i),c=s.axis,d=a.axis;for(let h=t;h<t+r;h++){const f=e[h],p=!o&&this.getParsed(h),g={},m=g[c]=o?s.getPixelForDecimal(.5):s.getPixelForValue(p[c]),v=g[d]=o?a.getBasePixel():a.getPixelForValue(p[d]);g.skip=isNaN(m)||isNaN(v),u&&(g.options=l||this.resolveDataElementOptions(h,f.active?"active":i),o&&(g.options.radius=0)),this.updateElement(f,h,g,i)}}resolveDataElementOptions(e,t){const r=this.getParsed(e);let i=super.resolveDataElementOptions(e,t);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const o=i.radius;return t!=="active"&&(i.radius=0),i.radius+=_e(r&&r._custom,o),i}}function i4(n,e,t){let r=1,i=1,o=0,s=0;if(e<nt){const a=n,l=a+e,u=Math.cos(a),c=Math.sin(a),d=Math.cos(l),h=Math.sin(l),f=(b,x,w)=>Ma(b,a,l,!0)?1:Math.max(x,x*t,w,w*t),p=(b,x,w)=>Ma(b,a,l,!0)?-1:Math.min(x,x*t,w,w*t),g=f(0,u,d),m=f(xt,c,h),v=p(We,u,d),y=p(We+xt,c,h);r=(g-v)/2,i=(m-y)/2,o=-(g+v)/2,s=-(m+y)/2}return{ratioX:r,ratioY:i,offsetX:o,offsetY:s}}class ug extends zi{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data,{labels:{pointStyle:r,textAlign:i,color:o,useBorderRadius:s,borderRadius:a}}=e.legend.options;return t.labels.length&&t.datasets.length?t.labels.map((l,u)=>{const d=e.getDatasetMeta(0).controller.getStyle(u);return{text:l,fillStyle:d.backgroundColor,fontColor:o,hidden:!e.getDataVisibility(u),lineDash:d.borderDash,lineDashOffset:d.borderDashOffset,lineJoin:d.borderJoinStyle,lineWidth:d.borderWidth,strokeStyle:d.borderColor,textAlign:i,pointStyle:r,borderRadius:s&&(a||d.borderRadius),index:u}}):[]}},onClick(e,t,r){r.chart.toggleDataVisibility(t.index),r.chart.update()}}}};constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const r=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=r;else{let o=l=>+r[l];if(Ne(r[e])){const{key:l="value"}=this._parsing;o=u=>+Pi(r[u],l)}let s,a;for(s=e,a=e+t;s<a;++s)i._parsed[s]=o(s)}}_getRotation(){return ir(this.options.rotation-90)}_getCircumference(){return ir(this.options.circumference)}_getRotationExtents(){let e=nt,t=-nt;for(let r=0;r<this.chart.data.datasets.length;++r)if(this.chart.isDatasetVisible(r)&&this.chart.getDatasetMeta(r).type===this._type){const i=this.chart.getDatasetMeta(r).controller,o=i._getRotation(),s=i._getCircumference();e=Math.min(e,o),t=Math.max(t,o+s)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:r}=t,i=this._cachedMeta,o=i.data,s=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(r.width,r.height)-s)/2,0),l=Math.min(pB(this.options.cutout,a),1),u=this._getRingWeight(this.index),{circumference:c,rotation:d}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:p,offsetY:g}=i4(d,c,l),m=(r.width-s)/h,v=(r.height-s)/f,y=Math.max(Math.min(m,v)/2,0),b=r_(this.options.radius,y),x=Math.max(b*l,0),w=(b-x)/this._getVisibleDatasetWeightTotal();this.offsetX=p*b,this.offsetY=g*b,i.total=this.calculateTotal(),this.outerRadius=b-w*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-w*u,0),this.updateElements(o,0,o.length,e)}_circumference(e,t){const r=this.options,i=this._cachedMeta,o=this._getCircumference();return t&&r.animation.animateRotate||!this.chart.getDataVisibility(e)||i._parsed[e]===null||i.data[e].hidden?0:this.calculateCircumference(i._parsed[e]*o/nt)}updateElements(e,t,r,i){const o=i==="reset",s=this.chart,a=s.chartArea,u=s.options.animation,c=(a.left+a.right)/2,d=(a.top+a.bottom)/2,h=o&&u.animateScale,f=h?0:this.innerRadius,p=h?0:this.outerRadius,{sharedOptions:g,includeOptions:m}=this._getSharedOptions(t,i);let v=this._getRotation(),y;for(y=0;y<t;++y)v+=this._circumference(y,o);for(y=t;y<t+r;++y){const b=this._circumference(y,o),x=e[y],w={x:c+this.offsetX,y:d+this.offsetY,startAngle:v,endAngle:v+b,circumference:b,outerRadius:p,innerRadius:f};m&&(w.options=g||this.resolveDataElementOptions(y,x.active?"active":i)),v+=b,this.updateElement(x,y,w,i)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let r=0,i;for(i=0;i<t.length;i++){const o=e._parsed[i];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(i)&&!t[i].hidden&&(r+=Math.abs(o))}return r}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?nt*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,r=this.chart,i=r.data.labels||[],o=el(t._parsed[e],r.options.locale);return{label:i[e]||"",value:o}}getMaxBorderWidth(e){let t=0;const r=this.chart;let i,o,s,a,l;if(!e){for(i=0,o=r.data.datasets.length;i<o;++i)if(r.isDatasetVisible(i)){s=r.getDatasetMeta(i),e=s.data,a=s.controller;break}}if(!e)return 0;for(i=0,o=e.length;i<o;++i)l=a.resolveDataElementOptions(i),l.borderAlign!=="inner"&&(t=Math.max(t,l.borderWidth||0,l.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let r=0,i=e.length;r<i;++r){const o=this.resolveDataElementOptions(r);t=Math.max(t,o.offset||0,o.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let r=0;r<e;++r)this.chart.isDatasetVisible(r)&&(t+=this._getRingWeight(r));return t}_getRingWeight(e){return Math.max(_e(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class o4 extends zi{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:r,data:i=[],_dataset:o}=t,s=this.chart._animationsDisabled;let{start:a,count:l}=d_(t,i,s);this._drawStart=a,this._drawCount=l,h_(t)&&(a=0,l=i.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!o._decimated,r.points=i;const u=this.resolveDatasetElementOptions(e);this.options.showLine||(u.borderWidth=0),u.segment=this.options.segment,this.updateElement(r,void 0,{animated:!s,options:u},e),this.updateElements(i,a,l,e)}updateElements(e,t,r,i){const o=i==="reset",{iScale:s,vScale:a,_stacked:l,_dataset:u}=this._cachedMeta,{sharedOptions:c,includeOptions:d}=this._getSharedOptions(t,i),h=s.axis,f=a.axis,{spanGaps:p,segment:g}=this.options,m=Ss(p)?p:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||o||i==="none",y=t+r,b=e.length;let x=t>0&&this.getParsed(t-1);for(let w=0;w<b;++w){const _=e[w],C=v?_:{};if(w<t||w>=y){C.skip=!0;continue}const E=this.getParsed(w),S=Me(E[f]),D=C[h]=s.getPixelForValue(E[h],w),k=C[f]=o||S?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,E,l):E[f],w);C.skip=isNaN(D)||isNaN(k)||S,C.stop=w>0&&Math.abs(E[h]-x[h])>m,g&&(C.parsed=E,C.raw=u.data[w]),d&&(C.options=c||this.resolveDataElementOptions(w,_.active?"active":i)),v||this.updateElement(_,w,C,i),x=E}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,r=t.options&&t.options.borderWidth||0,i=e.data||[];if(!i.length)return r;const o=i[0].size(this.resolveDataElementOptions(0)),s=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(r,o,s)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}class I_ extends zi{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:r,color:i}}=e.legend.options;return t.labels.map((o,s)=>{const l=e.getDatasetMeta(0).controller.getStyle(s);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:i,lineWidth:l.borderWidth,pointStyle:r,hidden:!e.getDataVisibility(s),index:s}})}return[]}},onClick(e,t,r){r.chart.toggleDataVisibility(t.index),r.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,r=this.chart,i=r.data.labels||[],o=el(t._parsed[e].r,r.options.locale);return{label:i[e]||"",value:o}}parseObjectData(e,t,r,i){return x_.bind(this)(e,t,r,i)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((r,i)=>{const o=this.getParsed(i).r;!isNaN(o)&&this.chart.getDataVisibility(i)&&(o<t.min&&(t.min=o),o>t.max&&(t.max=o))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,r=e.options,i=Math.min(t.right-t.left,t.bottom-t.top),o=Math.max(i/2,0),s=Math.max(r.cutoutPercentage?o/100*r.cutoutPercentage:1,0),a=(o-s)/e.getVisibleDatasetCount();this.outerRadius=o-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(e,t,r,i){const o=i==="reset",s=this.chart,l=s.options.animation,u=this._cachedMeta.rScale,c=u.xCenter,d=u.yCenter,h=u.getIndexAngle(0)-.5*We;let f=h,p;const g=360/this.countVisibleElements();for(p=0;p<t;++p)f+=this._computeAngle(p,i,g);for(p=t;p<t+r;p++){const m=e[p];let v=f,y=f+this._computeAngle(p,i,g),b=s.getDataVisibility(p)?u.getDistanceFromCenterForValue(this.getParsed(p).r):0;f=y,o&&(l.animateScale&&(b=0),l.animateRotate&&(v=y=h));const x={x:c,y:d,innerRadius:0,outerRadius:b,startAngle:v,endAngle:y,options:this.resolveDataElementOptions(p,m.active?"active":i)};this.updateElement(m,p,x,i)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((r,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&t++}),t}_computeAngle(e,t,r){return this.chart.getDataVisibility(e)?ir(this.resolveDataElementOptions(e,t).angle||r):0}}class s4 extends ug{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}class a4 extends zi{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){const t=this._cachedMeta.vScale,r=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(r[t.axis])}}parseObjectData(e,t,r,i){return x_.bind(this)(e,t,r,i)}update(e){const t=this._cachedMeta,r=t.dataset,i=t.data||[],o=t.iScale.getLabels();if(r.points=i,e!=="resize"){const s=this.resolveDatasetElementOptions(e);this.options.showLine||(s.borderWidth=0);const a={_loop:!0,_fullLoop:o.length===i.length,options:s};this.updateElement(r,void 0,a,e)}this.updateElements(i,0,i.length,e)}updateElements(e,t,r,i){const o=this._cachedMeta.rScale,s=i==="reset";for(let a=t;a<t+r;a++){const l=e[a],u=this.resolveDataElementOptions(a,l.active?"active":i),c=o.getPointPositionForValue(a,this.getParsed(a).r),d=s?o.xCenter:c.x,h=s?o.yCenter:c.y,f={x:d,y:h,angle:c.angle,skip:isNaN(d)||isNaN(h),options:u};this.updateElement(l,a,f,i)}}}class l4 extends zi{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const t=this._cachedMeta,r=this.chart.data.labels||[],{xScale:i,yScale:o}=t,s=this.getParsed(e),a=i.getLabelForValue(s.x),l=o.getLabelForValue(s.y);return{label:r[e]||"",value:"("+a+", "+l+")"}}update(e){const t=this._cachedMeta,{data:r=[]}=t,i=this.chart._animationsDisabled;let{start:o,count:s}=d_(t,r,i);if(this._drawStart=o,this._drawCount=s,h_(t)&&(o=0,s=r.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=t;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=r;const u=this.resolveDatasetElementOptions(e);u.segment=this.options.segment,this.updateElement(a,void 0,{animated:!i,options:u},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(r,o,s,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,r,i){const o=i==="reset",{iScale:s,vScale:a,_stacked:l,_dataset:u}=this._cachedMeta,c=this.resolveDataElementOptions(t,i),d=this.getSharedOptions(c),h=this.includeOptions(i,d),f=s.axis,p=a.axis,{spanGaps:g,segment:m}=this.options,v=Ss(g)?g:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||o||i==="none";let b=t>0&&this.getParsed(t-1);for(let x=t;x<t+r;++x){const w=e[x],_=this.getParsed(x),C=y?w:{},E=Me(_[p]),S=C[f]=s.getPixelForValue(_[f],x),D=C[p]=o||E?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,_,l):_[p],x);C.skip=isNaN(S)||isNaN(D)||E,C.stop=x>0&&Math.abs(_[f]-b[f])>v,m&&(C.parsed=_,C.raw=u.data[x]),h&&(C.options=d||this.resolveDataElementOptions(x,w.active?"active":i)),y||this.updateElement(w,x,C,i),b=_}this.updateSharedOptions(d,i,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let a=0;for(let l=t.length-1;l>=0;--l)a=Math.max(a,t[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const r=e.dataset,i=r.options&&r.options.borderWidth||0;if(!t.length)return i;const o=t[0].size(this.resolveDataElementOptions(0)),s=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(i,o,s)/2}}var u4=Object.freeze({__proto__:null,BarController:n4,BubbleController:r4,DoughnutController:ug,LineController:o4,PieController:s4,PolarAreaController:I_,RadarController:a4,ScatterController:l4});function Zi(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class cg{static override(e){Object.assign(cg.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return Zi()}parse(){return Zi()}format(){return Zi()}add(){return Zi()}diff(){return Zi()}startOf(){return Zi()}endOf(){return Zi()}}var c4={_date:cg};function d4(n,e,t,r){const{controller:i,data:o,_sorted:s}=n,a=i._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&e===a.axis&&e!=="r"&&s&&o.length){const u=a._reversePixels?AB:Kr;if(r){if(i._sharedOptions){const c=o[0],d=typeof c.getRange=="function"&&c.getRange(e);if(d){const h=u(o,e,t-d),f=u(o,e,t+d);return{lo:h.lo,hi:f.hi}}}}else{const c=u(o,e,t);if(l){const{vScale:d}=i._cachedMeta,{_parsed:h}=n,f=h.slice(0,c.lo+1).reverse().findIndex(g=>!Me(g[d.axis]));c.lo-=Math.max(0,f);const p=h.slice(c.hi).findIndex(g=>!Me(g[d.axis]));c.hi+=Math.max(0,p)}return c}}return{lo:0,hi:o.length-1}}function Wc(n,e,t,r,i){const o=n.getSortedVisibleDatasetMetas(),s=t[e];for(let a=0,l=o.length;a<l;++a){const{index:u,data:c}=o[a],{lo:d,hi:h}=d4(o[a],e,s,i);for(let f=d;f<=h;++f){const p=c[f];p.skip||r(p,u,f)}}}function h4(n){const e=n.indexOf("x")!==-1,t=n.indexOf("y")!==-1;return function(r,i){const o=e?Math.abs(r.x-i.x):0,s=t?Math.abs(r.y-i.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(s,2))}}function ah(n,e,t,r,i){const o=[];return!i&&!n.isPointInArea(e)||Wc(n,t,e,function(a,l,u){!i&&!Qr(a,n.chartArea,0)||a.inRange(e.x,e.y,r)&&o.push({element:a,datasetIndex:l,index:u})},!0),o}function f4(n,e,t,r){let i=[];function o(s,a,l){const{startAngle:u,endAngle:c}=s.getProps(["startAngle","endAngle"],r),{angle:d}=s_(s,{x:e.x,y:e.y});Ma(d,u,c)&&i.push({element:s,datasetIndex:a,index:l})}return Wc(n,t,e,o),i}function p4(n,e,t,r,i,o){let s=[];const a=h4(t);let l=Number.POSITIVE_INFINITY;function u(c,d,h){const f=c.inRange(e.x,e.y,i);if(r&&!f)return;const p=c.getCenterPoint(i);if(!(!!o||n.isPointInArea(p))&&!f)return;const m=a(e,p);m<l?(s=[{element:c,datasetIndex:d,index:h}],l=m):m===l&&s.push({element:c,datasetIndex:d,index:h})}return Wc(n,t,e,u),s}function lh(n,e,t,r,i,o){return!o&&!n.isPointInArea(e)?[]:t==="r"&&!r?f4(n,e,t,i):p4(n,e,t,r,i,o)}function hb(n,e,t,r,i){const o=[],s=t==="x"?"inXRange":"inYRange";let a=!1;return Wc(n,t,e,(l,u,c)=>{l[s]&&l[s](e[t],i)&&(o.push({element:l,datasetIndex:u,index:c}),a=a||l.inRange(e.x,e.y,i))}),r&&!a?[]:o}var g4={modes:{index(n,e,t,r){const i=io(e,n),o=t.axis||"x",s=t.includeInvisible||!1,a=t.intersect?ah(n,i,o,r,s):lh(n,i,o,!1,r,s),l=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(u=>{const c=a[0].index,d=u.data[c];d&&!d.skip&&l.push({element:d,datasetIndex:u.index,index:c})}),l):[]},dataset(n,e,t,r){const i=io(e,n),o=t.axis||"xy",s=t.includeInvisible||!1;let a=t.intersect?ah(n,i,o,r,s):lh(n,i,o,!1,r,s);if(a.length>0){const l=a[0].datasetIndex,u=n.getDatasetMeta(l).data;a=[];for(let c=0;c<u.length;++c)a.push({element:u[c],datasetIndex:l,index:c})}return a},point(n,e,t,r){const i=io(e,n),o=t.axis||"xy",s=t.includeInvisible||!1;return ah(n,i,o,r,s)},nearest(n,e,t,r){const i=io(e,n),o=t.axis||"xy",s=t.includeInvisible||!1;return lh(n,i,o,t.intersect,r,s)},x(n,e,t,r){const i=io(e,n);return hb(n,i,"x",t.intersect,r)},y(n,e,t,r){const i=io(e,n);return hb(n,i,"y",t.intersect,r)}}};const M_=["left","top","right","bottom"];function Ys(n,e){return n.filter(t=>t.pos===e)}function fb(n,e){return n.filter(t=>M_.indexOf(t.pos)===-1&&t.box.axis===e)}function Xs(n,e){return n.sort((t,r)=>{const i=e?r:t,o=e?t:r;return i.weight===o.weight?i.index-o.index:i.weight-o.weight})}function m4(n){const e=[];let t,r,i,o,s,a;for(t=0,r=(n||[]).length;t<r;++t)i=n[t],{position:o,options:{stack:s,stackWeight:a=1}}=i,e.push({index:t,box:i,pos:o,horizontal:i.isHorizontal(),weight:i.weight,stack:s&&o+s,stackWeight:a});return e}function v4(n){const e={};for(const t of n){const{stack:r,pos:i,stackWeight:o}=t;if(!r||!M_.includes(i))continue;const s=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=o}return e}function y4(n,e){const t=v4(n),{vBoxMaxWidth:r,hBoxMaxHeight:i}=e;let o,s,a;for(o=0,s=n.length;o<s;++o){a=n[o];const{fullSize:l}=a.box,u=t[a.stack],c=u&&a.stackWeight/u.weight;a.horizontal?(a.width=c?c*r:l&&e.availableWidth,a.height=i):(a.width=r,a.height=c?c*i:l&&e.availableHeight)}return t}function b4(n){const e=m4(n),t=Xs(e.filter(u=>u.box.fullSize),!0),r=Xs(Ys(e,"left"),!0),i=Xs(Ys(e,"right")),o=Xs(Ys(e,"top"),!0),s=Xs(Ys(e,"bottom")),a=fb(e,"x"),l=fb(e,"y");return{fullSize:t,leftAndTop:r.concat(o),rightAndBottom:i.concat(l).concat(s).concat(a),chartArea:Ys(e,"chartArea"),vertical:r.concat(i).concat(l),horizontal:o.concat(s).concat(a)}}function pb(n,e,t,r){return Math.max(n[t],e[t])+Math.max(n[r],e[r])}function O_(n,e){n.top=Math.max(n.top,e.top),n.left=Math.max(n.left,e.left),n.bottom=Math.max(n.bottom,e.bottom),n.right=Math.max(n.right,e.right)}function x4(n,e,t,r){const{pos:i,box:o}=t,s=n.maxPadding;if(!Ne(i)){t.size&&(n[i]-=t.size);const d=r[t.stack]||{size:0,count:1};d.size=Math.max(d.size,t.horizontal?o.height:o.width),t.size=d.size/d.count,n[i]+=t.size}o.getPadding&&O_(s,o.getPadding());const a=Math.max(0,e.outerWidth-pb(s,n,"left","right")),l=Math.max(0,e.outerHeight-pb(s,n,"top","bottom")),u=a!==n.w,c=l!==n.h;return n.w=a,n.h=l,t.horizontal?{same:u,other:c}:{same:c,other:u}}function w4(n){const e=n.maxPadding;function t(r){const i=Math.max(e[r]-n[r],0);return n[r]+=i,i}n.y+=t("top"),n.x+=t("left"),t("right"),t("bottom")}function _4(n,e){const t=e.maxPadding;function r(i){const o={left:0,top:0,right:0,bottom:0};return i.forEach(s=>{o[s]=Math.max(e[s],t[s])}),o}return r(n?["left","right"]:["top","bottom"])}function oa(n,e,t,r){const i=[];let o,s,a,l,u,c;for(o=0,s=n.length,u=0;o<s;++o){a=n[o],l=a.box,l.update(a.width||e.w,a.height||e.h,_4(a.horizontal,e));const{same:d,other:h}=x4(e,t,a,r);u|=d&&i.length,c=c||h,l.fullSize||i.push(a)}return u&&oa(i,e,t,r)||c}function Hl(n,e,t,r,i){n.top=t,n.left=e,n.right=e+r,n.bottom=t+i,n.width=r,n.height=i}function gb(n,e,t,r){const i=t.padding;let{x:o,y:s}=e;for(const a of n){const l=a.box,u=r[a.stack]||{placed:0,weight:1},c=a.stackWeight/u.weight||1;if(a.horizontal){const d=e.w*c,h=u.size||l.height;Ia(u.start)&&(s=u.start),l.fullSize?Hl(l,i.left,s,t.outerWidth-i.right-i.left,h):Hl(l,e.left+u.placed,s,d,h),u.start=s,u.placed+=d,s=l.bottom}else{const d=e.h*c,h=u.size||l.width;Ia(u.start)&&(o=u.start),l.fullSize?Hl(l,o,i.top,h,t.outerHeight-i.bottom-i.top):Hl(l,o,e.top+u.placed,h,d),u.start=o,u.placed+=d,o=l.right}}e.x=o,e.y=s}var Zt={addBox(n,e){n.boxes||(n.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},n.boxes.push(e)},removeBox(n,e){const t=n.boxes?n.boxes.indexOf(e):-1;t!==-1&&n.boxes.splice(t,1)},configure(n,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(n,e,t,r){if(!n)return;const i=tn(n.options.layout.padding),o=Math.max(e-i.width,0),s=Math.max(t-i.height,0),a=b4(n.boxes),l=a.vertical,u=a.horizontal;$e(n.boxes,g=>{typeof g.beforeLayout=="function"&&g.beforeLayout()});const c=l.reduce((g,m)=>m.box.options&&m.box.options.display===!1?g:g+1,0)||1,d=Object.freeze({outerWidth:e,outerHeight:t,padding:i,availableWidth:o,availableHeight:s,vBoxMaxWidth:o/2/c,hBoxMaxHeight:s/2}),h=Object.assign({},i);O_(h,tn(r));const f=Object.assign({maxPadding:h,w:o,h:s,x:i.left,y:i.top},i),p=y4(l.concat(u),d);oa(a.fullSize,f,d,p),oa(l,f,d,p),oa(u,f,d,p)&&oa(l,f,d,p),w4(f),gb(a.leftAndTop,f,d,p),f.x+=f.w,f.y+=f.h,gb(a.rightAndBottom,f,d,p),n.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},$e(a.chartArea,g=>{const m=g.box;Object.assign(m,n.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class P_{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,r){}removeEventListener(e,t,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,r,i){return t=Math.max(0,t||e.width),r=r||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):r)}}isAttached(e){return!0}updateConfig(e){}}class C4 extends P_{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const vu="$chartjs",E4={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},mb=n=>n===null||n==="";function S4(n,e){const t=n.style,r=n.getAttribute("height"),i=n.getAttribute("width");if(n[vu]={initial:{height:r,width:i,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",mb(i)){const o=Zy(n,"width");o!==void 0&&(n.width=o)}if(mb(r))if(n.style.height==="")n.height=n.width/(e||2);else{const o=Zy(n,"height");o!==void 0&&(n.height=o)}return n}const N_=x3?{passive:!0}:!1;function D4(n,e,t){n&&n.addEventListener(e,t,N_)}function A4(n,e,t){n&&n.canvas&&n.canvas.removeEventListener(e,t,N_)}function k4(n,e){const t=E4[n.type]||n.type,{x:r,y:i}=io(n,e);return{type:t,chart:e,native:n,x:r!==void 0?r:null,y:i!==void 0?i:null}}function qu(n,e){for(const t of n)if(t===e||t.contains(e))return!0}function R4(n,e,t){const r=n.canvas,i=new MutationObserver(o=>{let s=!1;for(const a of o)s=s||qu(a.addedNodes,r),s=s&&!qu(a.removedNodes,r);s&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}function T4(n,e,t){const r=n.canvas,i=new MutationObserver(o=>{let s=!1;for(const a of o)s=s||qu(a.removedNodes,r),s=s&&!qu(a.addedNodes,r);s&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}const Pa=new Map;let vb=0;function F_(){const n=window.devicePixelRatio;n!==vb&&(vb=n,Pa.forEach((e,t)=>{t.currentDevicePixelRatio!==n&&e()}))}function I4(n,e){Pa.size||window.addEventListener("resize",F_),Pa.set(n,e)}function M4(n){Pa.delete(n),Pa.size||window.removeEventListener("resize",F_)}function O4(n,e,t){const r=n.canvas,i=r&&lg(r);if(!i)return;const o=c_((a,l)=>{const u=i.clientWidth;t(a,l),u<i.clientWidth&&t()},window),s=new ResizeObserver(a=>{const l=a[0],u=l.contentRect.width,c=l.contentRect.height;u===0&&c===0||o(u,c)});return s.observe(i),I4(n,o),s}function uh(n,e,t){t&&t.disconnect(),e==="resize"&&M4(n)}function P4(n,e,t){const r=n.canvas,i=c_(o=>{n.ctx!==null&&t(k4(o,n))},n);return D4(r,e,i),i}class N4 extends P_{acquireContext(e,t){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(S4(e,t),r):null}releaseContext(e){const t=e.canvas;if(!t[vu])return!1;const r=t[vu].initial;["height","width"].forEach(o=>{const s=r[o];Me(s)?t.removeAttribute(o):t.setAttribute(o,s)});const i=r.style||{};return Object.keys(i).forEach(o=>{t.style[o]=i[o]}),t.width=t.width,delete t[vu],!0}addEventListener(e,t,r){this.removeEventListener(e,t);const i=e.$proxies||(e.$proxies={}),s={attach:R4,detach:T4,resize:O4}[t]||P4;i[t]=s(e,t,r)}removeEventListener(e,t){const r=e.$proxies||(e.$proxies={}),i=r[t];if(!i)return;({attach:uh,detach:uh,resize:uh}[t]||A4)(e,t,i),r[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,r,i){return b3(e,t,r,i)}isAttached(e){const t=e&&lg(e);return!!(t&&t.isConnected)}}function F4(n){return!ag()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?C4:N4}class ni{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:t,y:r}=this.getProps(["x","y"],e);return{x:t,y:r}}hasValue(){return Ss(this.x)&&Ss(this.y)}getProps(e,t){const r=this.$animations;if(!t||!r)return this;const i={};return e.forEach(o=>{i[o]=r[o]&&r[o].active()?r[o]._to:this[o]}),i}}function L4(n,e){const t=n.options.ticks,r=B4(n),i=Math.min(t.maxTicksLimit||r,r),o=t.major.enabled?W4(e):[],s=o.length,a=o[0],l=o[s-1],u=[];if(s>i)return z4(e,u,o,s/i),u;const c=H4(o,e,i);if(s>0){let d,h;const f=s>1?Math.round((l-a)/(s-1)):null;for(Wl(e,u,c,Me(f)?0:a-f,a),d=0,h=s-1;d<h;d++)Wl(e,u,c,o[d],o[d+1]);return Wl(e,u,c,l,Me(f)?e.length:l+f),u}return Wl(e,u,c),u}function B4(n){const e=n.options.offset,t=n._tickSize(),r=n._length/t+(e?0:1),i=n._maxLength/t;return Math.floor(Math.min(r,i))}function H4(n,e,t){const r=V4(n),i=e.length/t;if(!r)return Math.max(i,1);const o=_B(r);for(let s=0,a=o.length-1;s<a;s++){const l=o[s];if(l>i)return l}return Math.max(i,1)}function W4(n){const e=[];let t,r;for(t=0,r=n.length;t<r;t++)n[t].major&&e.push(t);return e}function z4(n,e,t,r){let i=0,o=t[0],s;for(r=Math.ceil(r),s=0;s<n.length;s++)s===o&&(e.push(n[s]),i++,o=t[i*r])}function Wl(n,e,t,r,i){const o=_e(r,0),s=Math.min(_e(i,n.length),n.length);let a=0,l,u,c;for(t=Math.ceil(t),i&&(l=i-r,t=l/Math.floor(l/t)),c=o;c<0;)a++,c=Math.round(o+a*t);for(u=Math.max(o,0);u<s;u++)u===c&&(e.push(n[u]),a++,c=Math.round(o+a*t))}function V4(n){const e=n.length;let t,r;if(e<2)return!1;for(r=n[0],t=1;t<e;++t)if(n[t]-n[t-1]!==r)return!1;return r}const U4=n=>n==="left"?"right":n==="right"?"left":n,yb=(n,e,t)=>e==="top"||e==="left"?n[e]+t:n[e]-t,bb=(n,e)=>Math.min(e||n,n);function xb(n,e){const t=[],r=n.length/e,i=n.length;let o=0;for(;o<i;o+=r)t.push(n[Math.floor(o)]);return t}function j4(n,e,t){const r=n.ticks.length,i=Math.min(e,r-1),o=n._startPixel,s=n._endPixel,a=1e-6;let l=n.getPixelForTick(i),u;if(!(t&&(r===1?u=Math.max(l-o,s-l):e===0?u=(n.getPixelForTick(1)-l)/2:u=(l-n.getPixelForTick(i-1))/2,l+=i<e?u:-u,l<o-a||l>s+a)))return l}function $4(n,e){$e(n,t=>{const r=t.gc,i=r.length/2;let o;if(i>e){for(o=0;o<i;++o)delete t.data[r[o]];r.splice(0,i)}})}function Ks(n){return n.drawTicks?n.tickLength:0}function wb(n,e){if(!n.display)return 0;const t=At(n.font,e),r=tn(n.padding);return(lt(n.text)?n.text.length:1)*t.lineHeight+r.height}function G4(n,e){return Wi(n,{scale:e,type:"scale"})}function q4(n,e,t){return Wi(n,{tick:t,index:e,type:"tick"})}function Y4(n,e,t){let r=tg(n);return(t&&e!=="right"||!t&&e==="right")&&(r=U4(r)),r}function X4(n,e,t,r){const{top:i,left:o,bottom:s,right:a,chart:l}=n,{chartArea:u,scales:c}=l;let d=0,h,f,p;const g=s-i,m=a-o;if(n.isHorizontal()){if(f=jt(r,o,a),Ne(t)){const v=Object.keys(t)[0],y=t[v];p=c[v].getPixelForValue(y)+g-e}else t==="center"?p=(u.bottom+u.top)/2+g-e:p=yb(n,t,e);h=a-o}else{if(Ne(t)){const v=Object.keys(t)[0],y=t[v];f=c[v].getPixelForValue(y)-m+e}else t==="center"?f=(u.left+u.right)/2-m+e:f=yb(n,t,e);p=jt(r,s,i),d=t==="left"?-xt:xt}return{titleX:f,titleY:p,maxWidth:h,rotation:d}}class Oo extends ni{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:r,_suggestedMax:i}=this;return e=Pn(e,Number.POSITIVE_INFINITY),t=Pn(t,Number.NEGATIVE_INFINITY),r=Pn(r,Number.POSITIVE_INFINITY),i=Pn(i,Number.NEGATIVE_INFINITY),{min:Pn(e,r),max:Pn(t,i),minDefined:yt(e),maxDefined:yt(t)}}getMinMax(e){let{min:t,max:r,minDefined:i,maxDefined:o}=this.getUserBounds(),s;if(i&&o)return{min:t,max:r};const a=this.getMatchingVisibleMetas();for(let l=0,u=a.length;l<u;++l)s=a[l].controller.getMinMax(this,e),i||(t=Math.min(t,s.min)),o||(r=Math.max(r,s.max));return t=o&&t>r?r:t,r=i&&t>r?t:r,{min:Pn(t,Pn(r,t)),max:Pn(r,Pn(t,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Qe(this.options.beforeUpdate,[this])}update(e,t,r){const{beginAtZero:i,grace:o,ticks:s}=this.options,a=s.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=QB(this,o,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?xb(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||s.source==="auto")&&(this.ticks=L4(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,r;this.isHorizontal()?(t=this.left,r=this.right):(t=this.top,r=this.bottom,e=!e),this._startPixel=t,this._endPixel=r,this._reversePixels=e,this._length=r-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Qe(this.options.afterUpdate,[this])}beforeSetDimensions(){Qe(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Qe(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Qe(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Qe(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let r,i,o;for(r=0,i=e.length;r<i;r++)o=e[r],o.label=Qe(t.callback,[o.value,r,e],this)}afterTickToLabelConversion(){Qe(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Qe(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,r=bb(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,o=t.maxRotation;let s=i,a,l,u;if(!this._isVisible()||!t.display||i>=o||r<=1||!this.isHorizontal()){this.labelRotation=i;return}const c=this._getLabelSizes(),d=c.widest.width,h=c.highest.height,f=Ft(this.chart.width-d,0,this.maxWidth);a=e.offset?this.maxWidth/r:f/(r-1),d+6>a&&(a=f/(r-(e.offset?.5:1)),l=this.maxHeight-Ks(e.grid)-t.padding-wb(e.title,this.chart.options.font),u=Math.sqrt(d*d+h*h),s=Zp(Math.min(Math.asin(Ft((c.highest.height+6)/a,-1,1)),Math.asin(Ft(l/u,-1,1))-Math.asin(Ft(h/u,-1,1)))),s=Math.max(i,Math.min(o,s))),this.labelRotation=s}afterCalculateLabelRotation(){Qe(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Qe(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:r,title:i,grid:o}}=this,s=this._isVisible(),a=this.isHorizontal();if(s){const l=wb(i,t.options.font);if(a?(e.width=this.maxWidth,e.height=Ks(o)+l):(e.height=this.maxHeight,e.width=Ks(o)+l),r.display&&this.ticks.length){const{first:u,last:c,widest:d,highest:h}=this._getLabelSizes(),f=r.padding*2,p=ir(this.labelRotation),g=Math.cos(p),m=Math.sin(p);if(a){const v=r.mirror?0:m*d.width+g*h.height;e.height=Math.min(this.maxHeight,e.height+v+f)}else{const v=r.mirror?0:g*d.width+m*h.height;e.width=Math.min(this.maxWidth,e.width+v+f)}this._calculatePadding(u,c,m,g)}}this._handleMargins(),a?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,r,i){const{ticks:{align:o,padding:s},position:a}=this.options,l=this.labelRotation!==0,u=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const c=this.getPixelForTick(0)-this.left,d=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?u?(h=i*e.width,f=r*t.height):(h=r*e.height,f=i*t.width):o==="start"?f=t.width:o==="end"?h=e.width:o!=="inner"&&(h=e.width/2,f=t.width/2),this.paddingLeft=Math.max((h-c+s)*this.width/(this.width-c),0),this.paddingRight=Math.max((f-d+s)*this.width/(this.width-d),0)}else{let c=t.height/2,d=e.height/2;o==="start"?(c=0,d=e.height):o==="end"&&(c=t.height,d=0),this.paddingTop=c+s,this.paddingBottom=d+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Qe(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,r;for(t=0,r=e.length;t<r;t++)Me(e[t].label)&&(e.splice(t,1),r--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let r=this.ticks;t<r.length&&(r=xb(r,t)),this._labelSizes=e=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,r){const{ctx:i,_longestTextCache:o}=this,s=[],a=[],l=Math.floor(t/bb(t,r));let u=0,c=0,d,h,f,p,g,m,v,y,b,x,w;for(d=0;d<t;d+=l){if(p=e[d].label,g=this._resolveTickFontOptions(d),i.font=m=g.string,v=o[m]=o[m]||{data:{},gc:[]},y=g.lineHeight,b=x=0,!Me(p)&&!lt(p))b=$u(i,v.data,v.gc,b,p),x=y;else if(lt(p))for(h=0,f=p.length;h<f;++h)w=p[h],!Me(w)&&!lt(w)&&(b=$u(i,v.data,v.gc,b,w),x+=y);s.push(b),a.push(x),u=Math.max(b,u),c=Math.max(x,c)}$4(o,t);const _=s.indexOf(u),C=a.indexOf(c),E=S=>({width:s[S]||0,height:a[S]||0});return{first:E(0),last:E(t-1),widest:E(_),highest:E(C),widths:s,heights:a}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return DB(this._alignToPixels?Ji(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const r=t[e];return r.$context||(r.$context=q4(this.getContext(),e,r))}return this.$context||(this.$context=G4(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=ir(this.labelRotation),r=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),o=this._getLabelSizes(),s=e.autoSkipPadding||0,a=o?o.widest.width+s:0,l=o?o.highest.height+s:0;return this.isHorizontal()?l*r>a*i?a/r:l/i:l*i<a*r?l/r:a/i}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,r=this.chart,i=this.options,{grid:o,position:s,border:a}=i,l=o.offset,u=this.isHorizontal(),d=this.ticks.length+(l?1:0),h=Ks(o),f=[],p=a.setContext(this.getContext()),g=p.display?p.width:0,m=g/2,v=function(W){return Ji(r,W,g)};let y,b,x,w,_,C,E,S,D,k,M,B;if(s==="top")y=v(this.bottom),C=this.bottom-h,S=y-m,k=v(e.top)+m,B=e.bottom;else if(s==="bottom")y=v(this.top),k=e.top,B=v(e.bottom)-m,C=y+m,S=this.top+h;else if(s==="left")y=v(this.right),_=this.right-h,E=y-m,D=v(e.left)+m,M=e.right;else if(s==="right")y=v(this.left),D=e.left,M=v(e.right)-m,_=y+m,E=this.left+h;else if(t==="x"){if(s==="center")y=v((e.top+e.bottom)/2+.5);else if(Ne(s)){const W=Object.keys(s)[0],j=s[W];y=v(this.chart.scales[W].getPixelForValue(j))}k=e.top,B=e.bottom,C=y+m,S=C+h}else if(t==="y"){if(s==="center")y=v((e.left+e.right)/2);else if(Ne(s)){const W=Object.keys(s)[0],j=s[W];y=v(this.chart.scales[W].getPixelForValue(j))}_=y-m,E=_-h,D=e.left,M=e.right}const H=_e(i.ticks.maxTicksLimit,d),F=Math.max(1,Math.ceil(d/H));for(b=0;b<d;b+=F){const W=this.getContext(b),j=o.setContext(W),U=a.setContext(W),q=j.lineWidth,K=j.color,J=U.dash||[],ee=U.dashOffset,re=j.tickWidth,fe=j.tickColor,pe=j.tickBorderDash||[],ve=j.tickBorderDashOffset;x=j4(this,b,l),x!==void 0&&(w=Ji(r,x,q),u?_=E=D=M=w:C=S=k=B=w,f.push({tx1:_,ty1:C,tx2:E,ty2:S,x1:D,y1:k,x2:M,y2:B,width:q,color:K,borderDash:J,borderDashOffset:ee,tickWidth:re,tickColor:fe,tickBorderDash:pe,tickBorderDashOffset:ve}))}return this._ticksLength=d,this._borderValue=y,f}_computeLabelItems(e){const t=this.axis,r=this.options,{position:i,ticks:o}=r,s=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:u,padding:c,mirror:d}=o,h=Ks(r.grid),f=h+c,p=d?-c:f,g=-ir(this.labelRotation),m=[];let v,y,b,x,w,_,C,E,S,D,k,M,B="middle";if(i==="top")_=this.bottom-p,C=this._getXAxisLabelAlignment();else if(i==="bottom")_=this.top+p,C=this._getXAxisLabelAlignment();else if(i==="left"){const F=this._getYAxisLabelAlignment(h);C=F.textAlign,w=F.x}else if(i==="right"){const F=this._getYAxisLabelAlignment(h);C=F.textAlign,w=F.x}else if(t==="x"){if(i==="center")_=(e.top+e.bottom)/2+f;else if(Ne(i)){const F=Object.keys(i)[0],W=i[F];_=this.chart.scales[F].getPixelForValue(W)+f}C=this._getXAxisLabelAlignment()}else if(t==="y"){if(i==="center")w=(e.left+e.right)/2-f;else if(Ne(i)){const F=Object.keys(i)[0],W=i[F];w=this.chart.scales[F].getPixelForValue(W)}C=this._getYAxisLabelAlignment(h).textAlign}t==="y"&&(l==="start"?B="top":l==="end"&&(B="bottom"));const H=this._getLabelSizes();for(v=0,y=a.length;v<y;++v){b=a[v],x=b.label;const F=o.setContext(this.getContext(v));E=this.getPixelForTick(v)+o.labelOffset,S=this._resolveTickFontOptions(v),D=S.lineHeight,k=lt(x)?x.length:1;const W=k/2,j=F.color,U=F.textStrokeColor,q=F.textStrokeWidth;let K=C;s?(w=E,C==="inner"&&(v===y-1?K=this.options.reverse?"left":"right":v===0?K=this.options.reverse?"right":"left":K="center"),i==="top"?u==="near"||g!==0?M=-k*D+D/2:u==="center"?M=-H.highest.height/2-W*D+D:M=-H.highest.height+D/2:u==="near"||g!==0?M=D/2:u==="center"?M=H.highest.height/2-W*D:M=H.highest.height-k*D,d&&(M*=-1),g!==0&&!F.showLabelBackdrop&&(w+=D/2*Math.sin(g))):(_=E,M=(1-k)*D/2);let J;if(F.showLabelBackdrop){const ee=tn(F.backdropPadding),re=H.heights[v],fe=H.widths[v];let pe=M-ee.top,ve=0-ee.left;switch(B){case"middle":pe-=re/2;break;case"bottom":pe-=re;break}switch(C){case"center":ve-=fe/2;break;case"right":ve-=fe;break;case"inner":v===y-1?ve-=fe:v>0&&(ve-=fe/2);break}J={left:ve,top:pe,width:fe+ee.width,height:re+ee.height,color:F.backdropColor}}m.push({label:x,font:S,textOffset:M,options:{rotation:g,color:j,strokeColor:U,strokeWidth:q,textAlign:K,textBaseline:B,translation:[w,_],backdrop:J}})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-ir(this.labelRotation))return e==="top"?"left":"right";let i="center";return t.align==="start"?i="left":t.align==="end"?i="right":t.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:r,mirror:i,padding:o}}=this.options,s=this._getLabelSizes(),a=e+o,l=s.widest.width;let u,c;return t==="left"?i?(c=this.right+o,r==="near"?u="left":r==="center"?(u="center",c+=l/2):(u="right",c+=l)):(c=this.right-a,r==="near"?u="right":r==="center"?(u="center",c-=l/2):(u="left",c=this.left)):t==="right"?i?(c=this.left+o,r==="near"?u="right":r==="center"?(u="center",c-=l/2):(u="left",c-=l)):(c=this.left+a,r==="near"?u="left":r==="center"?(u="center",c+=l/2):(u="right",c=this.right)):u="right",{textAlign:u,x:c}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:r,top:i,width:o,height:s}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(r,i,o,s),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const i=this.ticks.findIndex(o=>o.value===e);return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const t=this.options.grid,r=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let o,s;const a=(l,u,c)=>{!c.width||!c.color||(r.save(),r.lineWidth=c.width,r.strokeStyle=c.color,r.setLineDash(c.borderDash||[]),r.lineDashOffset=c.borderDashOffset,r.beginPath(),r.moveTo(l.x,l.y),r.lineTo(u.x,u.y),r.stroke(),r.restore())};if(t.display)for(o=0,s=i.length;o<s;++o){const l=i[o];t.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),t.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:r,grid:i}}=this,o=r.setContext(this.getContext()),s=r.display?o.width:0;if(!s)return;const a=i.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let u,c,d,h;this.isHorizontal()?(u=Ji(e,this.left,s)-s/2,c=Ji(e,this.right,a)+a/2,d=h=l):(d=Ji(e,this.top,s)-s/2,h=Ji(e,this.bottom,a)+a/2,u=c=l),t.save(),t.lineWidth=o.width,t.strokeStyle=o.color,t.beginPath(),t.moveTo(u,d),t.lineTo(c,h),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,i=this._computeLabelArea();i&&Lc(r,i);const o=this.getLabelItems(e);for(const s of o){const a=s.options,l=s.font,u=s.label,c=s.textOffset;Ao(r,u,0,c,l,a)}i&&Bc(r)}drawTitle(){const{ctx:e,options:{position:t,title:r,reverse:i}}=this;if(!r.display)return;const o=At(r.font),s=tn(r.padding),a=r.align;let l=o.lineHeight/2;t==="bottom"||t==="center"||Ne(t)?(l+=s.bottom,lt(r.text)&&(l+=o.lineHeight*(r.text.length-1))):l+=s.top;const{titleX:u,titleY:c,maxWidth:d,rotation:h}=X4(this,l,t,a);Ao(e,r.text,0,0,o,{color:r.color,maxWidth:d,rotation:h,textAlign:Y4(a,t,i),textBaseline:"middle",translation:[u,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,r=_e(e.grid&&e.grid.z,-1),i=_e(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Oo.prototype.draw?[{z:t,draw:o=>{this.draw(o)}}]:[{z:r,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",i=[];let o,s;for(o=0,s=t.length;o<s;++o){const a=t[o];a[r]===this.id&&(!e||a.type===e)&&i.push(a)}return i}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return At(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class zl{constructor(e,t,r){this.type=e,this.scope=t,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let r;J4(t)&&(r=this.register(t));const i=this.items,o=e.id,s=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+e);return o in i||(i[o]=e,K4(e,s,r),this.override&&ct.override(e.id,e.overrides)),s}get(e){return this.items[e]}unregister(e){const t=this.items,r=e.id,i=this.scope;r in t&&delete t[r],i&&r in ct[i]&&(delete ct[i][r],this.override&&delete Do[r])}}function K4(n,e,t){const r=Ta(Object.create(null),[t?ct.get(t):{},ct.get(e),n.defaults]);ct.set(e,r),n.defaultRoutes&&Q4(e,n.defaultRoutes),n.descriptors&&ct.describe(e,n.descriptors)}function Q4(n,e){Object.keys(e).forEach(t=>{const r=t.split("."),i=r.pop(),o=[n].concat(r).join("."),s=e[t].split("."),a=s.pop(),l=s.join(".");ct.route(o,i,l,a)})}function J4(n){return"id"in n&&"defaults"in n}class Z4{constructor(){this.controllers=new zl(zi,"datasets",!0),this.elements=new zl(ni,"elements"),this.plugins=new zl(Object,"plugins"),this.scales=new zl(Oo,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,r){[...t].forEach(i=>{const o=r||this._getRegistryForType(i);r||o.isForType(i)||o===this.plugins&&i.id?this._exec(e,o,i):$e(i,s=>{const a=r||this._getRegistryForType(s);this._exec(e,a,s)})})}_exec(e,t,r){const i=Jp(e);Qe(r["before"+i],[],r),t[e](r),Qe(r["after"+i],[],r)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const r=this._typedRegistries[t];if(r.isForType(e))return r}return this.plugins}_get(e,t,r){const i=t.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+r+".");return i}}var br=new Z4;class eH{constructor(){this._init=void 0}notify(e,t,r,i){if(t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install")),this._init===void 0)return;const o=i?this._descriptors(e).filter(i):this._descriptors(e),s=this._notify(o,e,t,r);return t==="afterDestroy"&&(this._notify(o,e,"stop"),this._notify(this._init,e,"uninstall"),this._init=void 0),s}_notify(e,t,r,i){i=i||{};for(const o of e){const s=o.plugin,a=s[r],l=[t,i,o.options];if(Qe(a,l,s)===!1&&i.cancelable)return!1}return!0}invalidate(){Me(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const r=e&&e.config,i=_e(r.options&&r.options.plugins,{}),o=tH(r);return i===!1&&!t?[]:rH(e,o,i,t)}_notifyStateChanges(e){const t=this._oldCache||[],r=this._cache,i=(o,s)=>o.filter(a=>!s.some(l=>a.plugin.id===l.plugin.id));this._notify(i(t,r),e,"stop"),this._notify(i(r,t),e,"start")}}function tH(n){const e={},t=[],r=Object.keys(br.plugins.items);for(let o=0;o<r.length;o++)t.push(br.getPlugin(r[o]));const i=n.plugins||[];for(let o=0;o<i.length;o++){const s=i[o];t.indexOf(s)===-1&&(t.push(s),e[s.id]=!0)}return{plugins:t,localIds:e}}function nH(n,e){return!e&&n===!1?null:n===!0?{}:n}function rH(n,{plugins:e,localIds:t},r,i){const o=[],s=n.getContext();for(const a of e){const l=a.id,u=nH(r[l],i);u!==null&&o.push({plugin:a,options:iH(n.config,{plugin:a,local:t[l]},u,s)})}return o}function iH(n,{plugin:e,local:t},r,i){const o=n.pluginScopeKeys(e),s=n.getOptionScopes(r,o);return t&&e.defaults&&s.push(e.defaults),n.createResolver(s,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Af(n,e){const t=ct.datasets[n]||{};return((e.datasets||{})[n]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function oH(n,e){let t=n;return n==="_index_"?t=e:n==="_value_"&&(t=e==="x"?"y":"x"),t}function sH(n,e){return n===e?"_index_":"_value_"}function _b(n){if(n==="x"||n==="y"||n==="r")return n}function aH(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function kf(n,...e){if(_b(n))return n;for(const t of e){const r=t.axis||aH(t.position)||n.length>1&&_b(n[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function Cb(n,e,t){if(t[e+"AxisID"]===n)return{axis:e}}function lH(n,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(r=>r.xAxisID===n||r.yAxisID===n);if(t.length)return Cb(n,"x",t[0])||Cb(n,"y",t[0])}return{}}function uH(n,e){const t=Do[n.type]||{scales:{}},r=e.scales||{},i=Af(n.type,e),o=Object.create(null);return Object.keys(r).forEach(s=>{const a=r[s];if(!Ne(a))return console.error(`Invalid scale configuration for scale: ${s}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${s}`);const l=kf(s,a,lH(s,n),ct.scales[a.type]),u=sH(l,i),c=t.scales||{};o[s]=fa(Object.create(null),[{axis:l},a,c[l],c[u]])}),n.data.datasets.forEach(s=>{const a=s.type||n.type,l=s.indexAxis||Af(a,e),c=(Do[a]||{}).scales||{};Object.keys(c).forEach(d=>{const h=oH(d,l),f=s[h+"AxisID"]||h;o[f]=o[f]||Object.create(null),fa(o[f],[{axis:h},r[f],c[d]])})}),Object.keys(o).forEach(s=>{const a=o[s];fa(a,[ct.scales[a.type],ct.scale])}),o}function L_(n){const e=n.options||(n.options={});e.plugins=_e(e.plugins,{}),e.scales=uH(n,e)}function B_(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function cH(n){return n=n||{},n.data=B_(n.data),L_(n),n}const Eb=new Map,H_=new Set;function Vl(n,e){let t=Eb.get(n);return t||(t=e(),Eb.set(n,t),H_.add(t)),t}const Qs=(n,e,t)=>{const r=Pi(e,t);r!==void 0&&n.add(r)};class dH{constructor(e){this._config=cH(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=B_(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),L_(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Vl(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Vl(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Vl(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,r=this.type;return Vl(`${r}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const r=this._scopeCache;let i=r.get(e);return(!i||t)&&(i=new Map,r.set(e,i)),i}getOptionScopes(e,t,r){const{options:i,type:o}=this,s=this._cachedScopes(e,r),a=s.get(t);if(a)return a;const l=new Set;t.forEach(c=>{e&&(l.add(e),c.forEach(d=>Qs(l,e,d))),c.forEach(d=>Qs(l,i,d)),c.forEach(d=>Qs(l,Do[o]||{},d)),c.forEach(d=>Qs(l,ct,d)),c.forEach(d=>Qs(l,Sf,d))});const u=Array.from(l);return u.length===0&&u.push(Object.create(null)),H_.has(t)&&s.set(t,u),u}chartOptionScopes(){const{options:e,type:t}=this;return[e,Do[t]||{},ct.datasets[t]||{},{type:t},ct,Sf]}resolveNamedOptions(e,t,r,i=[""]){const o={$shared:!0},{resolver:s,subPrefixes:a}=Sb(this._resolverCache,e,i);let l=s;if(fH(s,t)){o.$shared=!1,r=Ni(r)?r():r;const u=this.createResolver(e,r,a);l=Ds(s,r,u)}for(const u of t)o[u]=l[u];return o}createResolver(e,t,r=[""],i){const{resolver:o}=Sb(this._resolverCache,e,r);return Ne(t)?Ds(o,t,void 0,i):o}}function Sb(n,e,t){let r=n.get(e);r||(r=new Map,n.set(e,r));const i=t.join();let o=r.get(i);return o||(o={resolver:ig(e,t),subPrefixes:t.filter(a=>!a.toLowerCase().includes("hover"))},r.set(i,o)),o}const hH=n=>Ne(n)&&Object.getOwnPropertyNames(n).some(e=>Ni(n[e]));function fH(n,e){const{isScriptable:t,isIndexable:r}=m_(n);for(const i of e){const o=t(i),s=r(i),a=(s||o)&&n[i];if(o&&(Ni(a)||hH(a))||s&&lt(a))return!0}return!1}var pH="4.5.1";const gH=["top","bottom","left","right","chartArea"];function Db(n,e){return n==="top"||n==="bottom"||gH.indexOf(n)===-1&&e==="x"}function Ab(n,e){return function(t,r){return t[n]===r[n]?t[e]-r[e]:t[n]-r[n]}}function kb(n){const e=n.chart,t=e.options.animation;e.notifyPlugins("afterRender"),Qe(t&&t.onComplete,[n],e)}function mH(n){const e=n.chart,t=e.options.animation;Qe(t&&t.onProgress,[n],e)}function W_(n){return ag()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const yu={},Rb=n=>{const e=W_(n);return Object.values(yu).filter(t=>t.canvas===e).pop()};function vH(n,e,t){const r=Object.keys(n);for(const i of r){const o=+i;if(o>=e){const s=n[i];delete n[i],(t>0||o>e)&&(n[o+t]=s)}}}function yH(n,e,t,r){return!t||n.type==="mouseout"?null:r?e:n}class dg{static defaults=ct;static instances=yu;static overrides=Do;static registry=br;static version=pH;static getChart=Rb;static register(...e){br.add(...e),Tb()}static unregister(...e){br.remove(...e),Tb()}constructor(e,t){const r=this.config=new dH(t),i=W_(e),o=Rb(i);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const s=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||F4(i)),this.platform.updateConfig(r);const a=this.platform.acquireContext(i,s.aspectRatio),l=a&&a.canvas,u=l&&l.height,c=l&&l.width;if(this.id=fB(),this.ctx=a,this.canvas=l,this.width=c,this.height=u,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new eH,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=TB(d=>this.update(d),s.resizeDelay||0),this._dataChanges=[],yu[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Ur.listen(this,"complete",kb),Ur.listen(this,"progress",mH),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:r,height:i,_aspectRatio:o}=this;return Me(e)?t&&o?o:i?r/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return br}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Jy(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Xy(this.canvas,this.ctx),this}stop(){return Ur.stop(this),this}resize(e,t){Ur.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const r=this.options,i=this.canvas,o=r.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(i,e,t,o),a=r.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,Jy(this,a,!0)&&(this.notifyPlugins("resize",{size:s}),Qe(r.onResize,[this,s],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};$e(t,(r,i)=>{r.id=i})}buildOrUpdateScales(){const e=this.options,t=e.scales,r=this.scales,i=Object.keys(r).reduce((s,a)=>(s[a]=!1,s),{});let o=[];t&&(o=o.concat(Object.keys(t).map(s=>{const a=t[s],l=kf(s,a),u=l==="r",c=l==="x";return{options:a,dposition:u?"chartArea":c?"bottom":"left",dtype:u?"radialLinear":c?"category":"linear"}}))),$e(o,s=>{const a=s.options,l=a.id,u=kf(l,a),c=_e(a.type,s.dtype);(a.position===void 0||Db(a.position,u)!==Db(s.dposition))&&(a.position=s.dposition),i[l]=!0;let d=null;if(l in r&&r[l].type===c)d=r[l];else{const h=br.getScale(c);d=new h({id:l,type:c,ctx:this.ctx,chart:this}),r[d.id]=d}d.init(a,e)}),$e(i,(s,a)=>{s||delete r[a]}),$e(r,s=>{Zt.configure(this,s,s.options),Zt.addBox(this,s)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,r=e.length;if(e.sort((i,o)=>i.index-o.index),r>t){for(let i=t;i<r;++i)this._destroyDatasetMeta(i);e.splice(t,r-t)}this._sortedMetasets=e.slice(0).sort(Ab("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((r,i)=>{t.filter(o=>o===r._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let r,i;for(this._removeUnreferencedMetasets(),r=0,i=t.length;r<i;r++){const o=t[r];let s=this.getDatasetMeta(r);const a=o.type||this.config.type;if(s.type&&s.type!==a&&(this._destroyDatasetMeta(r),s=this.getDatasetMeta(r)),s.type=a,s.indexAxis=o.indexAxis||Af(a,this.options),s.order=o.order||0,s.index=r,s.label=""+o.label,s.visible=this.isDatasetVisible(r),s.controller)s.controller.updateIndex(r),s.controller.linkScales();else{const l=br.getController(a),{datasetElementType:u,dataElementType:c}=ct.datasets[a];Object.assign(l,{dataElementType:br.getElement(c),datasetElementType:u&&br.getElement(u)}),s.controller=new l(this,r),e.push(s.controller)}}return this._updateMetasets(),e}_resetElements(){$e(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const r=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let u=0,c=this.data.datasets.length;u<c;u++){const{controller:d}=this.getDatasetMeta(u),h=!i&&o.indexOf(d)===-1;d.buildOrUpdateElements(h),s=Math.max(+d.getMaxOverflow(),s)}s=this._minPadding=r.layout.autoPadding?s:0,this._updateLayout(s),i||$e(o,u=>{u.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(Ab("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){$e(this.scales,e=>{Zt.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!Wy(t,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:r,start:i,count:o}of t){const s=r==="_removeElements"?-o:o;vH(e,i,s)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,r=o=>new Set(e.filter(s=>s[0]===o).map((s,a)=>a+","+s.splice(1).join(","))),i=r(0);for(let o=1;o<t;o++)if(!Wy(i,r(o)))return;return Array.from(i).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Zt.update(this,this.width,this.height,e);const t=this.chartArea,r=t.width<=0||t.height<=0;this._layers=[],$e(this.boxes,i=>{r&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,o)=>{i._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,r=this.data.datasets.length;t<r;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,r=this.data.datasets.length;t<r;++t)this._updateDataset(t,Ni(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const r=this.getDatasetMeta(e),i={meta:r,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(r.controller._update(t),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Ur.has(this)?this.attached&&!Ur.running(this)&&Ur.start(this):(this.draw(),kb({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,r=[];let i,o;for(i=0,o=t.length;i<o;++i){const s=t[i];(!e||s.visible)&&r.push(s)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,r={meta:e,index:e.index,cancelable:!0},i=A_(this,e);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(i&&Lc(t,i),e.controller.draw(),i&&Bc(t),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return Qr(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,r,i){const o=g4.modes[t];return typeof o=="function"?o(this,e,r,i):[]}getDatasetMeta(e){const t=this.data.datasets[e],r=this._metasets;let i=r.filter(o=>o&&o._dataset===t).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},r.push(i)),i}getContext(){return this.$context||(this.$context=Wi(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const r=this.getDatasetMeta(e);return typeof r.hidden=="boolean"?!r.hidden:!t.hidden}setDatasetVisibility(e,t){const r=this.getDatasetMeta(e);r.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,r){const i=r?"show":"hide",o=this.getDatasetMeta(e),s=o.controller._resolveAnimations(void 0,i);Ia(t)?(o.data[t].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),s.update(o,{visible:r}),this.update(a=>a.datasetIndex===e?i:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),Ur.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),Xy(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete yu[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,r=(o,s)=>{t.addEventListener(this,o,s),e[o]=s},i=(o,s,a)=>{o.offsetX=s,o.offsetY=a,this._eventHandler(o)};$e(this.options.events,o=>r(o,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,r=(l,u)=>{t.addEventListener(this,l,u),e[l]=u},i=(l,u)=>{e[l]&&(t.removeEventListener(this,l,u),delete e[l])},o=(l,u)=>{this.canvas&&this.resize(l,u)};let s;const a=()=>{i("attach",a),this.attached=!0,this.resize(),r("resize",o),r("detach",s)};s=()=>{this.attached=!1,i("resize",o),this._stop(),this._resize(0,0),r("attach",a)},t.isAttached(this.canvas)?a():s()}unbindEvents(){$e(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},$e(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,r){const i=r?"set":"remove";let o,s,a,l;for(t==="dataset"&&(o=this.getDatasetMeta(e[0].datasetIndex),o.controller["_"+i+"DatasetHoverStyle"]()),a=0,l=e.length;a<l;++a){s=e[a];const u=s&&this.getDatasetMeta(s.datasetIndex).controller;u&&u[i+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],r=e.map(({datasetIndex:o,index:s})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[s],index:s}});!Vu(r,t)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,t))}notifyPlugins(e,t,r){return this._plugins.notify(this,e,t,r)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,r){const i=this.options.hover,o=(l,u)=>l.filter(c=>!u.some(d=>c.datasetIndex===d.datasetIndex&&c.index===d.index)),s=o(t,e),a=r?e:o(e,t);s.length&&this.updateHoverStyle(s,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(e,t){const r={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},i=s=>(s.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",r,i)===!1)return;const o=this._handleEvent(e,t,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,i),(o||r.changed)&&this.render(),this}_handleEvent(e,t,r){const{_active:i=[],options:o}=this,s=t,a=this._getActiveElements(e,i,r,s),l=bB(e),u=yH(e,this._lastEvent,r,l);r&&(this._lastEvent=null,Qe(o.onHover,[e,a,this],this),l&&Qe(o.onClick,[e,a,this],this));const c=!Vu(a,i);return(c||t)&&(this._active=a,this._updateHoverStyles(a,i,t)),this._lastEvent=u,c}_getActiveElements(e,t,r,i){if(e.type==="mouseout")return[];if(!r)return t;const o=this.options.hover;return this.getElementsAtEventForMode(e,o.mode,o,i)}}function Tb(){return $e(dg.instances,n=>n._plugins.invalidate())}function bH(n,e,t){const{startAngle:r,x:i,y:o,outerRadius:s,innerRadius:a,options:l}=e,{borderWidth:u,borderJoinStyle:c}=l,d=Math.min(u/s,qt(r-t));if(n.beginPath(),n.arc(i,o,s-u/2,r+d/2,t-d/2),a>0){const h=Math.min(u/a,qt(r-t));n.arc(i,o,a+u/2,t-h/2,r+h/2,!0)}else{const h=Math.min(u/2,s*qt(r-t));if(c==="round")n.arc(i,o,h,t-We/2,r+We/2,!0);else if(c==="bevel"){const f=2*h*h,p=-f*Math.cos(t+We/2)+i,g=-f*Math.sin(t+We/2)+o,m=f*Math.cos(r+We/2)+i,v=f*Math.sin(r+We/2)+o;n.lineTo(p,g),n.lineTo(m,v)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function xH(n,e,t){const{startAngle:r,pixelMargin:i,x:o,y:s,outerRadius:a,innerRadius:l}=e;let u=i/a;n.beginPath(),n.arc(o,s,a,r-u,t+u),l>i?(u=i/l,n.arc(o,s,l,t+u,r-u,!0)):n.arc(o,s,i,t+xt,r-xt),n.closePath(),n.clip()}function wH(n){return rg(n,["outerStart","outerEnd","innerStart","innerEnd"])}function _H(n,e,t,r){const i=wH(n.options.borderRadius),o=(t-e)/2,s=Math.min(o,r*e/2),a=l=>{const u=(t-Math.min(o,l))*r/2;return Ft(l,0,Math.min(o,u))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:Ft(i.innerStart,0,s),innerEnd:Ft(i.innerEnd,0,s)}}function $o(n,e,t,r){return{x:t+n*Math.cos(e),y:r+n*Math.sin(e)}}function Yu(n,e,t,r,i,o){const{x:s,y:a,startAngle:l,pixelMargin:u,innerRadius:c}=e,d=Math.max(e.outerRadius+r+t-u,0),h=c>0?c+r+t+u:0;let f=0;const p=i-l;if(r){const F=c>0?c-r:0,W=d>0?d-r:0,j=(F+W)/2,U=j!==0?p*j/(j+r):p;f=(p-U)/2}const g=Math.max(.001,p*d-t/We)/d,m=(p-g)/2,v=l+m+f,y=i-m-f,{outerStart:b,outerEnd:x,innerStart:w,innerEnd:_}=_H(e,h,d,y-v),C=d-b,E=d-x,S=v+b/C,D=y-x/E,k=h+w,M=h+_,B=v+w/k,H=y-_/M;if(n.beginPath(),o){const F=(S+D)/2;if(n.arc(s,a,d,S,F),n.arc(s,a,d,F,D),x>0){const q=$o(E,D,s,a);n.arc(q.x,q.y,x,D,y+xt)}const W=$o(M,y,s,a);if(n.lineTo(W.x,W.y),_>0){const q=$o(M,H,s,a);n.arc(q.x,q.y,_,y+xt,H+Math.PI)}const j=(y-_/h+(v+w/h))/2;if(n.arc(s,a,h,y-_/h,j,!0),n.arc(s,a,h,j,v+w/h,!0),w>0){const q=$o(k,B,s,a);n.arc(q.x,q.y,w,B+Math.PI,v-xt)}const U=$o(C,v,s,a);if(n.lineTo(U.x,U.y),b>0){const q=$o(C,S,s,a);n.arc(q.x,q.y,b,v-xt,S)}}else{n.moveTo(s,a);const F=Math.cos(S)*d+s,W=Math.sin(S)*d+a;n.lineTo(F,W);const j=Math.cos(D)*d+s,U=Math.sin(D)*d+a;n.lineTo(j,U)}n.closePath()}function CH(n,e,t,r,i){const{fullCircles:o,startAngle:s,circumference:a}=e;let l=e.endAngle;if(o){Yu(n,e,t,r,l,i);for(let u=0;u<o;++u)n.fill();isNaN(a)||(l=s+(a%nt||nt))}return Yu(n,e,t,r,l,i),n.fill(),l}function EH(n,e,t,r,i){const{fullCircles:o,startAngle:s,circumference:a,options:l}=e,{borderWidth:u,borderJoinStyle:c,borderDash:d,borderDashOffset:h,borderRadius:f}=l,p=l.borderAlign==="inner";if(!u)return;n.setLineDash(d||[]),n.lineDashOffset=h,p?(n.lineWidth=u*2,n.lineJoin=c||"round"):(n.lineWidth=u,n.lineJoin=c||"bevel");let g=e.endAngle;if(o){Yu(n,e,t,r,g,i);for(let m=0;m<o;++m)n.stroke();isNaN(a)||(g=s+(a%nt||nt))}p&&xH(n,e,g),l.selfJoin&&g-s>=We&&f===0&&c!=="miter"&&bH(n,e,g),o||(Yu(n,e,t,r,g,i),n.stroke())}class SH extends ni{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,r){const i=this.getProps(["x","y"],r),{angle:o,distance:s}=s_(i,{x:e,y:t}),{startAngle:a,endAngle:l,innerRadius:u,outerRadius:c,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),h=(this.options.spacing+this.options.borderWidth)/2,f=_e(d,l-a),p=Ma(o,a,l)&&a!==l,g=f>=nt||p,m=Xr(s,u+h,c+h);return g&&m}getCenterPoint(e){const{x:t,y:r,startAngle:i,endAngle:o,innerRadius:s,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:l,spacing:u}=this.options,c=(i+o)/2,d=(s+a+u+l)/2;return{x:t+Math.cos(c)*d,y:r+Math.sin(c)*d}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:r}=this,i=(t.offset||0)/4,o=(t.spacing||0)/2,s=t.circular;if(this.pixelMargin=t.borderAlign==="inner"?.33:0,this.fullCircles=r>nt?Math.floor(r/nt):0,r===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const a=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(a)*i,Math.sin(a)*i);const l=1-Math.sin(Math.min(We,r||0)),u=i*l;e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,CH(e,this,u,o,s),EH(e,this,u,o,s),e.restore()}}function z_(n,e,t=e){n.lineCap=_e(t.borderCapStyle,e.borderCapStyle),n.setLineDash(_e(t.borderDash,e.borderDash)),n.lineDashOffset=_e(t.borderDashOffset,e.borderDashOffset),n.lineJoin=_e(t.borderJoinStyle,e.borderJoinStyle),n.lineWidth=_e(t.borderWidth,e.borderWidth),n.strokeStyle=_e(t.borderColor,e.borderColor)}function DH(n,e,t){n.lineTo(t.x,t.y)}function AH(n){return n.stepped?VB:n.tension||n.cubicInterpolationMode==="monotone"?UB:DH}function V_(n,e,t={}){const r=n.length,{start:i=0,end:o=r-1}=t,{start:s,end:a}=e,l=Math.max(i,s),u=Math.min(o,a),c=i<s&&o<s||i>a&&o>a;return{count:r,start:l,loop:e.loop,ilen:u<l&&!c?r+u-l:u-l}}function kH(n,e,t,r){const{points:i,options:o}=e,{count:s,start:a,loop:l,ilen:u}=V_(i,t,r),c=AH(o);let{move:d=!0,reverse:h}=r||{},f,p,g;for(f=0;f<=u;++f)p=i[(a+(h?u-f:f))%s],!p.skip&&(d?(n.moveTo(p.x,p.y),d=!1):c(n,g,p,h,o.stepped),g=p);return l&&(p=i[(a+(h?u:0))%s],c(n,g,p,h,o.stepped)),!!l}function RH(n,e,t,r){const i=e.points,{count:o,start:s,ilen:a}=V_(i,t,r),{move:l=!0,reverse:u}=r||{};let c=0,d=0,h,f,p,g,m,v;const y=x=>(s+(u?a-x:x))%o,b=()=>{g!==m&&(n.lineTo(c,m),n.lineTo(c,g),n.lineTo(c,v))};for(l&&(f=i[y(0)],n.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=i[y(h)],f.skip)continue;const x=f.x,w=f.y,_=x|0;_===p?(w<g?g=w:w>m&&(m=w),c=(d*c+x)/++d):(b(),n.lineTo(x,w),p=_,d=0,g=m=w),v=w}b()}function Rf(n){const e=n.options,t=e.borderDash&&e.borderDash.length;return!n._decimated&&!n._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?RH:kH}function TH(n){return n.stepped?w3:n.tension||n.cubicInterpolationMode==="monotone"?_3:oo}function IH(n,e,t,r){let i=e._path;i||(i=e._path=new Path2D,e.path(i,t,r)&&i.closePath()),z_(n,e.options),n.stroke(i)}function MH(n,e,t,r){const{segments:i,options:o}=e,s=Rf(e);for(const a of i)z_(n,o,a.style),n.beginPath(),s(n,e,a,{start:t,end:t+r-1})&&n.closePath(),n.stroke()}const OH=typeof Path2D=="function";function PH(n,e,t,r){OH&&!e.options.segment?IH(n,e,t,r):MH(n,e,t,r)}class zc extends ni{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const i=r.spanGaps?this._loop:this._fullLoop;f3(this._points,r,e,i,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=k3(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,r=e.length;return r&&t[e[r-1].end]}interpolate(e,t){const r=this.options,i=e[t],o=this.points,s=D_(this,{property:t,start:i,end:i});if(!s.length)return;const a=[],l=TH(r);let u,c;for(u=0,c=s.length;u<c;++u){const{start:d,end:h}=s[u],f=o[d],p=o[h];if(f===p){a.push(f);continue}const g=Math.abs((i-f[t])/(p[t]-f[t])),m=l(f,p,g,r.stepped);m[t]=e[t],a.push(m)}return a.length===1?a[0]:a}pathSegment(e,t,r){return Rf(this)(e,this,t,r)}path(e,t,r){const i=this.segments,o=Rf(this);let s=this._loop;t=t||0,r=r||this.points.length-t;for(const a of i)s&=o(e,this,a,{start:t,end:t+r-1});return!!s}draw(e,t,r,i){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(e.save(),PH(e,this,r,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Ib(n,e,t,r){const i=n.options,{[t]:o}=n.getProps([t],r);return Math.abs(e-o)<i.radius+i.hitRadius}class NH extends ni{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,r){const i=this.options,{x:o,y:s}=this.getProps(["x","y"],r);return Math.pow(e-o,2)+Math.pow(t-s,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,t){return Ib(this,e,"x",t)}inYRange(e,t){return Ib(this,e,"y",t)}getCenterPoint(e){const{x:t,y:r}=this.getProps(["x","y"],e);return{x:t,y:r}}size(e){e=e||this.options||{};let t=e.radius||0;t=Math.max(t,t&&e.hoverRadius||0);const r=t&&e.borderWidth||0;return(t+r)*2}draw(e,t){const r=this.options;this.skip||r.radius<.1||!Qr(this,t,this.size(r)/2)||(e.strokeStyle=r.borderColor,e.lineWidth=r.borderWidth,e.fillStyle=r.backgroundColor,Df(e,r,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function U_(n,e){const{x:t,y:r,base:i,width:o,height:s}=n.getProps(["x","y","base","width","height"],e);let a,l,u,c,d;return n.horizontal?(d=s/2,a=Math.min(t,i),l=Math.max(t,i),u=r-d,c=r+d):(d=o/2,a=t-d,l=t+d,u=Math.min(r,i),c=Math.max(r,i)),{left:a,top:u,right:l,bottom:c}}function Ci(n,e,t,r){return n?0:Ft(e,t,r)}function FH(n,e,t){const r=n.options.borderWidth,i=n.borderSkipped,o=g_(r);return{t:Ci(i.top,o.top,0,t),r:Ci(i.right,o.right,0,e),b:Ci(i.bottom,o.bottom,0,t),l:Ci(i.left,o.left,0,e)}}function LH(n,e,t){const{enableBorderRadius:r}=n.getProps(["enableBorderRadius"]),i=n.options.borderRadius,o=yo(i),s=Math.min(e,t),a=n.borderSkipped,l=r||Ne(i);return{topLeft:Ci(!l||a.top||a.left,o.topLeft,0,s),topRight:Ci(!l||a.top||a.right,o.topRight,0,s),bottomLeft:Ci(!l||a.bottom||a.left,o.bottomLeft,0,s),bottomRight:Ci(!l||a.bottom||a.right,o.bottomRight,0,s)}}function BH(n){const e=U_(n),t=e.right-e.left,r=e.bottom-e.top,i=FH(n,t/2,r/2),o=LH(n,t/2,r/2);return{outer:{x:e.left,y:e.top,w:t,h:r,radius:o},inner:{x:e.left+i.l,y:e.top+i.t,w:t-i.l-i.r,h:r-i.t-i.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,o.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(i.b,i.r))}}}}function ch(n,e,t,r){const i=e===null,o=t===null,a=n&&!(i&&o)&&U_(n,r);return a&&(i||Xr(e,a.left,a.right))&&(o||Xr(t,a.top,a.bottom))}function HH(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function WH(n,e){n.rect(e.x,e.y,e.w,e.h)}function dh(n,e,t={}){const r=n.x!==t.x?-e:0,i=n.y!==t.y?-e:0,o=(n.x+n.w!==t.x+t.w?e:0)-r,s=(n.y+n.h!==t.y+t.h?e:0)-i;return{x:n.x+r,y:n.y+i,w:n.w+o,h:n.h+s,radius:n.radius}}class zH extends ni{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:r,backgroundColor:i}}=this,{inner:o,outer:s}=BH(this),a=HH(s.radius)?Oa:WH;e.save(),(s.w!==o.w||s.h!==o.h)&&(e.beginPath(),a(e,dh(s,t,o)),e.clip(),a(e,dh(o,-t,s)),e.fillStyle=r,e.fill("evenodd")),e.beginPath(),a(e,dh(o,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,r){return ch(this,e,t,r)}inXRange(e,t){return ch(this,e,null,t)}inYRange(e,t){return ch(this,null,e,t)}getCenterPoint(e){const{x:t,y:r,base:i,horizontal:o}=this.getProps(["x","y","base","horizontal"],e);return{x:o?(t+i)/2:t,y:o?r:(r+i)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}var VH=Object.freeze({__proto__:null,ArcElement:SH,BarElement:zH,LineElement:zc,PointElement:NH});const Tf=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Mb=Tf.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function j_(n){return Tf[n%Tf.length]}function $_(n){return Mb[n%Mb.length]}function UH(n,e){return n.borderColor=j_(e),n.backgroundColor=$_(e),++e}function jH(n,e){return n.backgroundColor=n.data.map(()=>j_(e++)),e}function $H(n,e){return n.backgroundColor=n.data.map(()=>$_(e++)),e}function GH(n){let e=0;return(t,r)=>{const i=n.getDatasetMeta(r).controller;i instanceof ug?e=jH(t,e):i instanceof I_?e=$H(t,e):i&&(e=UH(t,e))}}function Ob(n){let e;for(e in n)if(n[e].borderColor||n[e].backgroundColor)return!0;return!1}function qH(n){return n&&(n.borderColor||n.backgroundColor)}function YH(){return ct.borderColor!=="rgba(0,0,0,0.1)"||ct.backgroundColor!=="rgba(0,0,0,0.1)"}var XH={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,e,t){if(!t.enabled)return;const{data:{datasets:r},options:i}=n.config,{elements:o}=i,s=Ob(r)||qH(i)||o&&Ob(o)||YH();if(!t.forceOverride&&s)return;const a=GH(n);r.forEach(a)}};function KH(n,e,t,r,i){const o=i.samples||r;if(o>=t)return n.slice(e,e+t);const s=[],a=(t-2)/(o-2);let l=0;const u=e+t-1;let c=e,d,h,f,p,g;for(s[l++]=n[c],d=0;d<o-2;d++){let m=0,v=0,y;const b=Math.floor((d+1)*a)+1+e,x=Math.min(Math.floor((d+2)*a)+1,t)+e,w=x-b;for(y=b;y<x;y++)m+=n[y].x,v+=n[y].y;m/=w,v/=w;const _=Math.floor(d*a)+1+e,C=Math.min(Math.floor((d+1)*a)+1,t)+e,{x:E,y:S}=n[c];for(f=p=-1,y=_;y<C;y++)p=.5*Math.abs((E-m)*(n[y].y-S)-(E-n[y].x)*(v-S)),p>f&&(f=p,h=n[y],g=y);s[l++]=h,c=g}return s[l++]=n[u],s}function QH(n,e,t,r){let i=0,o=0,s,a,l,u,c,d,h,f,p,g;const m=[],v=e+t-1,y=n[e].x,x=n[v].x-y;for(s=e;s<e+t;++s){a=n[s],l=(a.x-y)/x*r,u=a.y;const w=l|0;if(w===c)u<p?(p=u,d=s):u>g&&(g=u,h=s),i=(o*i+a.x)/++o;else{const _=s-1;if(!Me(d)&&!Me(h)){const C=Math.min(d,h),E=Math.max(d,h);C!==f&&C!==_&&m.push({...n[C],x:i}),E!==f&&E!==_&&m.push({...n[E],x:i})}s>0&&_!==f&&m.push(n[_]),m.push(a),c=w,o=0,p=g=u,d=h=f=s}}return m}function G_(n){if(n._decimated){const e=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function Pb(n){n.data.datasets.forEach(e=>{G_(e)})}function JH(n,e){const t=e.length;let r=0,i;const{iScale:o}=n,{min:s,max:a,minDefined:l,maxDefined:u}=o.getUserBounds();return l&&(r=Ft(Kr(e,o.axis,s).lo,0,t-1)),u?i=Ft(Kr(e,o.axis,a).hi+1,r,t)-r:i=t-r,{start:r,count:i}}var ZH={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,e,t)=>{if(!t.enabled){Pb(n);return}const r=n.width;n.data.datasets.forEach((i,o)=>{const{_data:s,indexAxis:a}=i,l=n.getDatasetMeta(o),u=s||i.data;if(ia([a,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const c=n.scales[l.xAxisID];if(c.type!=="linear"&&c.type!=="time"||n.options.parsing)return;let{start:d,count:h}=JH(l,u);const f=t.threshold||4*r;if(h<=f){G_(i);return}Me(s)&&(i._data=u,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(g){this._data=g}}));let p;switch(t.algorithm){case"lttb":p=KH(u,d,h,r,t);break;case"min-max":p=QH(u,d,h,r);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}i._decimated=p})},destroy(n){Pb(n)}};function eW(n,e,t){const r=n.segments,i=n.points,o=e.points,s=[];for(const a of r){let{start:l,end:u}=a;u=Vc(l,u,i);const c=If(t,i[l],i[u],a.loop);if(!e.segments){s.push({source:a,target:c,start:i[l],end:i[u]});continue}const d=D_(e,c);for(const h of d){const f=If(t,o[h.start],o[h.end],h.loop),p=S_(a,i,f);for(const g of p)s.push({source:g,target:h,start:{[t]:Nb(c,f,"start",Math.max)},end:{[t]:Nb(c,f,"end",Math.min)}})}}return s}function If(n,e,t,r){if(r)return;let i=e[n],o=t[n];return n==="angle"&&(i=qt(i),o=qt(o)),{property:n,start:i,end:o}}function tW(n,e){const{x:t=null,y:r=null}=n||{},i=e.points,o=[];return e.segments.forEach(({start:s,end:a})=>{a=Vc(s,a,i);const l=i[s],u=i[a];r!==null?(o.push({x:l.x,y:r}),o.push({x:u.x,y:r})):t!==null&&(o.push({x:t,y:l.y}),o.push({x:t,y:u.y}))}),o}function Vc(n,e,t){for(;e>n;e--){const r=t[e];if(!isNaN(r.x)&&!isNaN(r.y))break}return e}function Nb(n,e,t,r){return n&&e?r(n[t],e[t]):n?n[t]:e?e[t]:0}function q_(n,e){let t=[],r=!1;return lt(n)?(r=!0,t=n):t=tW(n,e),t.length?new zc({points:t,options:{tension:0},_loop:r,_fullLoop:r}):null}function Fb(n){return n&&n.fill!==!1}function nW(n,e,t){let i=n[e].fill;const o=[e];let s;if(!t)return i;for(;i!==!1&&o.indexOf(i)===-1;){if(!yt(i))return i;if(s=n[i],!s)return!1;if(s.visible)return i;o.push(i),i=s.fill}return!1}function rW(n,e,t){const r=aW(n);if(Ne(r))return isNaN(r.value)?!1:r;let i=parseFloat(r);return yt(i)&&Math.floor(i)===i?iW(r[0],e,i,t):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function iW(n,e,t,r){return(n==="-"||n==="+")&&(t=e+t),t===e||t<0||t>=r?!1:t}function oW(n,e){let t=null;return n==="start"?t=e.bottom:n==="end"?t=e.top:Ne(n)?t=e.getPixelForValue(n.value):e.getBasePixel&&(t=e.getBasePixel()),t}function sW(n,e,t){let r;return n==="start"?r=t:n==="end"?r=e.options.reverse?e.min:e.max:Ne(n)?r=n.value:r=e.getBaseValue(),r}function aW(n){const e=n.options,t=e.fill;let r=_e(t&&t.target,t);return r===void 0&&(r=!!e.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function lW(n){const{scale:e,index:t,line:r}=n,i=[],o=r.segments,s=r.points,a=uW(e,t);a.push(q_({x:null,y:e.bottom},r));for(let l=0;l<o.length;l++){const u=o[l];for(let c=u.start;c<=u.end;c++)cW(i,s[c],a)}return new zc({points:i,options:{}})}function uW(n,e){const t=[],r=n.getMatchingVisibleMetas("line");for(let i=0;i<r.length;i++){const o=r[i];if(o.index===e)break;o.hidden||t.unshift(o.dataset)}return t}function cW(n,e,t){const r=[];for(let i=0;i<t.length;i++){const o=t[i],{first:s,last:a,point:l}=dW(o,e,"x");if(!(!l||s&&a)){if(s)r.unshift(l);else if(n.push(l),!a)break}}n.push(...r)}function dW(n,e,t){const r=n.interpolate(e,t);if(!r)return{};const i=r[t],o=n.segments,s=n.points;let a=!1,l=!1;for(let u=0;u<o.length;u++){const c=o[u],d=s[c.start][t],h=s[c.end][t];if(Xr(i,d,h)){a=i===d,l=i===h;break}}return{first:a,last:l,point:r}}class Y_{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,r){const{x:i,y:o,radius:s}=this;return t=t||{start:0,end:nt},e.arc(i,o,s,t.end,t.start,!0),!r.bounds}interpolate(e){const{x:t,y:r,radius:i}=this,o=e.angle;return{x:t+Math.cos(o)*i,y:r+Math.sin(o)*i,angle:o}}}function hW(n){const{chart:e,fill:t,line:r}=n;if(yt(t))return fW(e,t);if(t==="stack")return lW(n);if(t==="shape")return!0;const i=pW(n);return i instanceof Y_?i:q_(i,r)}function fW(n,e){const t=n.getDatasetMeta(e);return t&&n.isDatasetVisible(e)?t.dataset:null}function pW(n){return(n.scale||{}).getPointPositionForValue?mW(n):gW(n)}function gW(n){const{scale:e={},fill:t}=n,r=oW(t,e);if(yt(r)){const i=e.isHorizontal();return{x:i?r:null,y:i?null:r}}return null}function mW(n){const{scale:e,fill:t}=n,r=e.options,i=e.getLabels().length,o=r.reverse?e.max:e.min,s=sW(t,e,o),a=[];if(r.grid.circular){const l=e.getPointPositionForValue(0,o);return new Y_({x:l.x,y:l.y,radius:e.getDistanceFromCenterForValue(s)})}for(let l=0;l<i;++l)a.push(e.getPointPositionForValue(l,s));return a}function hh(n,e,t){const r=hW(e),{chart:i,index:o,line:s,scale:a,axis:l}=e,u=s.options,c=u.fill,d=u.backgroundColor,{above:h=d,below:f=d}=c||{},p=i.getDatasetMeta(o),g=A_(i,p);r&&s.points.length&&(Lc(n,t),vW(n,{line:s,target:r,above:h,below:f,area:t,scale:a,axis:l,clip:g}),Bc(n))}function vW(n,e){const{line:t,target:r,above:i,below:o,area:s,scale:a,clip:l}=e,u=t._loop?"angle":e.axis;n.save();let c=o;o!==i&&(u==="x"?(Lb(n,r,s.top),fh(n,{line:t,target:r,color:i,scale:a,property:u,clip:l}),n.restore(),n.save(),Lb(n,r,s.bottom)):u==="y"&&(Bb(n,r,s.left),fh(n,{line:t,target:r,color:o,scale:a,property:u,clip:l}),n.restore(),n.save(),Bb(n,r,s.right),c=i)),fh(n,{line:t,target:r,color:c,scale:a,property:u,clip:l}),n.restore()}function Lb(n,e,t){const{segments:r,points:i}=e;let o=!0,s=!1;n.beginPath();for(const a of r){const{start:l,end:u}=a,c=i[l],d=i[Vc(l,u,i)];o?(n.moveTo(c.x,c.y),o=!1):(n.lineTo(c.x,t),n.lineTo(c.x,c.y)),s=!!e.pathSegment(n,a,{move:s}),s?n.closePath():n.lineTo(d.x,t)}n.lineTo(e.first().x,t),n.closePath(),n.clip()}function Bb(n,e,t){const{segments:r,points:i}=e;let o=!0,s=!1;n.beginPath();for(const a of r){const{start:l,end:u}=a,c=i[l],d=i[Vc(l,u,i)];o?(n.moveTo(c.x,c.y),o=!1):(n.lineTo(t,c.y),n.lineTo(c.x,c.y)),s=!!e.pathSegment(n,a,{move:s}),s?n.closePath():n.lineTo(t,d.y)}n.lineTo(t,e.first().y),n.closePath(),n.clip()}function fh(n,e){const{line:t,target:r,property:i,color:o,scale:s,clip:a}=e,l=eW(t,r,i);for(const{source:u,target:c,start:d,end:h}of l){const{style:{backgroundColor:f=o}={}}=u,p=r!==!0;n.save(),n.fillStyle=f,yW(n,s,a,p&&If(i,d,h)),n.beginPath();const g=!!t.pathSegment(n,u);let m;if(p){g?n.closePath():Hb(n,r,h,i);const v=!!r.pathSegment(n,c,{move:g,reverse:!0});m=g&&v,m||Hb(n,r,d,i)}n.closePath(),n.fill(m?"evenodd":"nonzero"),n.restore()}}function yW(n,e,t,r){const i=e.chart.chartArea,{property:o,start:s,end:a}=r||{};if(o==="x"||o==="y"){let l,u,c,d;o==="x"?(l=s,u=i.top,c=a,d=i.bottom):(l=i.left,u=s,c=i.right,d=a),n.beginPath(),t&&(l=Math.max(l,t.left),c=Math.min(c,t.right),u=Math.max(u,t.top),d=Math.min(d,t.bottom)),n.rect(l,u,c-l,d-u),n.clip()}}function Hb(n,e,t,r){const i=e.interpolate(t,r);i&&n.lineTo(i.x,i.y)}var bW={id:"filler",afterDatasetsUpdate(n,e,t){const r=(n.data.datasets||[]).length,i=[];let o,s,a,l;for(s=0;s<r;++s)o=n.getDatasetMeta(s),a=o.dataset,l=null,a&&a.options&&a instanceof zc&&(l={visible:n.isDatasetVisible(s),index:s,fill:rW(a,s,r),chart:n,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,i.push(l);for(s=0;s<r;++s)l=i[s],!(!l||l.fill===!1)&&(l.fill=nW(i,s,t.propagate))},beforeDraw(n,e,t){const r=t.drawTime==="beforeDraw",i=n.getSortedVisibleDatasetMetas(),o=n.chartArea;for(let s=i.length-1;s>=0;--s){const a=i[s].$filler;a&&(a.line.updateControlPoints(o,a.axis),r&&a.fill&&hh(n.ctx,a,o))}},beforeDatasetsDraw(n,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;const r=n.getSortedVisibleDatasetMetas();for(let i=r.length-1;i>=0;--i){const o=r[i].$filler;Fb(o)&&hh(n.ctx,o,n.chartArea)}},beforeDatasetDraw(n,e,t){const r=e.meta.$filler;!Fb(r)||t.drawTime!=="beforeDatasetDraw"||hh(n.ctx,r,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Wb=(n,e)=>{let{boxHeight:t=e,boxWidth:r=e}=n;return n.usePointStyle&&(t=Math.min(t,e),r=n.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:t,itemHeight:Math.max(e,t)}},xW=(n,e)=>n!==null&&e!==null&&n.datasetIndex===e.datasetIndex&&n.index===e.index;class zb extends ni{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,r){this.maxWidth=e,this.maxHeight=t,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=Qe(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(r=>e.filter(r,this.chart.data))),e.sort&&(t=t.sort((r,i)=>e.sort(r,i,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const r=e.labels,i=At(r.font),o=i.size,s=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=Wb(r,o);let u,c;t.font=i.string,this.isHorizontal()?(u=this.maxWidth,c=this._fitRows(s,o,a,l)+10):(c=this.maxHeight,u=this._fitCols(s,i,a,l)+10),this.width=Math.min(u,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,r,i){const{ctx:o,maxWidth:s,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],u=this.lineWidths=[0],c=i+a;let d=e;o.textAlign="left",o.textBaseline="middle";let h=-1,f=-c;return this.legendItems.forEach((p,g)=>{const m=r+t/2+o.measureText(p.text).width;(g===0||u[u.length-1]+m+2*a>s)&&(d+=c,u[u.length-(g>0?0:1)]=0,f+=c,h++),l[g]={left:0,top:f,row:h,width:m,height:i},u[u.length-1]+=m+a}),d}_fitCols(e,t,r,i){const{ctx:o,maxHeight:s,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],u=this.columnSizes=[],c=s-e;let d=a,h=0,f=0,p=0,g=0;return this.legendItems.forEach((m,v)=>{const{itemWidth:y,itemHeight:b}=wW(r,t,o,m,i);v>0&&f+b+2*a>c&&(d+=h+a,u.push({width:h,height:f}),p+=h+a,g++,h=f=0),l[v]={left:p,top:f,col:g,width:y,height:b},h=Math.max(h,y),f+=b+a}),d+=h,u.push({width:h,height:f}),d}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:r,labels:{padding:i},rtl:o}}=this,s=hs(o,this.left,this.width);if(this.isHorizontal()){let a=0,l=jt(r,this.left+i,this.right-this.lineWidths[a]);for(const u of t)a!==u.row&&(a=u.row,l=jt(r,this.left+i,this.right-this.lineWidths[a])),u.top+=this.top+e+i,u.left=s.leftForLtr(s.x(l),u.width),l+=u.width+i}else{let a=0,l=jt(r,this.top+e+i,this.bottom-this.columnSizes[a].height);for(const u of t)u.col!==a&&(a=u.col,l=jt(r,this.top+e+i,this.bottom-this.columnSizes[a].height)),u.top=l,u.left+=this.left+i,u.left=s.leftForLtr(s.x(u.left),u.width),l+=u.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Lc(e,this),this._draw(),Bc(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:r,ctx:i}=this,{align:o,labels:s}=e,a=ct.color,l=hs(e.rtl,this.left,this.width),u=At(s.font),{padding:c}=s,d=u.size,h=d/2;let f;this.drawTitle(),i.textAlign=l.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=u.string;const{boxWidth:p,boxHeight:g,itemHeight:m}=Wb(s,d),v=function(_,C,E){if(isNaN(p)||p<=0||isNaN(g)||g<0)return;i.save();const S=_e(E.lineWidth,1);if(i.fillStyle=_e(E.fillStyle,a),i.lineCap=_e(E.lineCap,"butt"),i.lineDashOffset=_e(E.lineDashOffset,0),i.lineJoin=_e(E.lineJoin,"miter"),i.lineWidth=S,i.strokeStyle=_e(E.strokeStyle,a),i.setLineDash(_e(E.lineDash,[])),s.usePointStyle){const D={radius:g*Math.SQRT2/2,pointStyle:E.pointStyle,rotation:E.rotation,borderWidth:S},k=l.xPlus(_,p/2),M=C+h;p_(i,D,k,M,s.pointStyleWidth&&p)}else{const D=C+Math.max((d-g)/2,0),k=l.leftForLtr(_,p),M=yo(E.borderRadius);i.beginPath(),Object.values(M).some(B=>B!==0)?Oa(i,{x:k,y:D,w:p,h:g,radius:M}):i.rect(k,D,p,g),i.fill(),S!==0&&i.stroke()}i.restore()},y=function(_,C,E){Ao(i,E.text,_,C+m/2,u,{strikethrough:E.hidden,textAlign:l.textAlign(E.textAlign)})},b=this.isHorizontal(),x=this._computeTitleHeight();b?f={x:jt(o,this.left+c,this.right-r[0]),y:this.top+c+x,line:0}:f={x:this.left+c,y:jt(o,this.top+x+c,this.bottom-t[0].height),line:0},__(this.ctx,e.textDirection);const w=m+c;this.legendItems.forEach((_,C)=>{i.strokeStyle=_.fontColor,i.fillStyle=_.fontColor;const E=i.measureText(_.text).width,S=l.textAlign(_.textAlign||(_.textAlign=s.textAlign)),D=p+h+E;let k=f.x,M=f.y;l.setWidth(this.width),b?C>0&&k+D+c>this.right&&(M=f.y+=w,f.line++,k=f.x=jt(o,this.left+c,this.right-r[f.line])):C>0&&M+w>this.bottom&&(k=f.x=k+t[f.line].width+c,f.line++,M=f.y=jt(o,this.top+x+c,this.bottom-t[f.line].height));const B=l.x(k);if(v(B,M,_),k=IB(S,k+p+h,b?k+D:this.right,e.rtl),y(l.x(k),M,_),b)f.x+=D+c;else if(typeof _.text!="string"){const H=u.lineHeight;f.y+=X_(_,H)+c}else f.y+=w}),C_(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,r=At(t.font),i=tn(t.padding);if(!t.display)return;const o=hs(e.rtl,this.left,this.width),s=this.ctx,a=t.position,l=r.size/2,u=i.top+l;let c,d=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+u,d=jt(e.align,d,this.right-h);else{const p=this.columnSizes.reduce((g,m)=>Math.max(g,m.height),0);c=u+jt(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}const f=jt(a,d,d+h);s.textAlign=o.textAlign(tg(a)),s.textBaseline="middle",s.strokeStyle=t.color,s.fillStyle=t.color,s.font=r.string,Ao(s,t.text,f,c,r)}_computeTitleHeight(){const e=this.options.title,t=At(e.font),r=tn(e.padding);return e.display?t.lineHeight+r.height:0}_getLegendItemAt(e,t){let r,i,o;if(Xr(e,this.left,this.right)&&Xr(t,this.top,this.bottom)){for(o=this.legendHitBoxes,r=0;r<o.length;++r)if(i=o[r],Xr(e,i.left,i.left+i.width)&&Xr(t,i.top,i.top+i.height))return this.legendItems[r]}return null}handleEvent(e){const t=this.options;if(!EW(e.type,t))return;const r=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const i=this._hoveredItem,o=xW(i,r);i&&!o&&Qe(t.onLeave,[e,i,this],this),this._hoveredItem=r,r&&!o&&Qe(t.onHover,[e,r,this],this)}else r&&Qe(t.onClick,[e,r,this],this)}}function wW(n,e,t,r,i){const o=_W(r,n,e,t),s=CW(i,r,e.lineHeight);return{itemWidth:o,itemHeight:s}}function _W(n,e,t,r){let i=n.text;return i&&typeof i!="string"&&(i=i.reduce((o,s)=>o.length>s.length?o:s)),e+t.size/2+r.measureText(i).width}function CW(n,e,t){let r=n;return typeof e.text!="string"&&(r=X_(e,t)),r}function X_(n,e){const t=n.text?n.text.length:0;return e*t}function EW(n,e){return!!((n==="mousemove"||n==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(n==="click"||n==="mouseup"))}var SW={id:"legend",_element:zb,start(n,e,t){const r=n.legend=new zb({ctx:n.ctx,options:t,chart:n});Zt.configure(n,r,t),Zt.addBox(n,r)},stop(n){Zt.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,e,t){const r=n.legend;Zt.configure(n,r,t),r.options=t},afterUpdate(n){const e=n.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(n,e){e.replay||n.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,e,t){const r=e.datasetIndex,i=t.chart;i.isDatasetVisible(r)?(i.hide(r),e.hidden=!0):(i.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const e=n.data.datasets,{labels:{usePointStyle:t,pointStyle:r,textAlign:i,color:o,useBorderRadius:s,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const u=l.controller.getStyle(t?0:void 0),c=tn(u.borderWidth);return{text:e[l.index].label,fillStyle:u.backgroundColor,fontColor:o,hidden:!l.visible,lineCap:u.borderCapStyle,lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:u.borderColor,pointStyle:r||u.pointStyle,rotation:u.rotation,textAlign:i||u.textAlign,borderRadius:s&&(a||u.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class hg extends ni{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const i=lt(r.text)?r.text.length:1;this._padding=tn(r.padding);const o=i*At(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:r,bottom:i,right:o,options:s}=this,a=s.align;let l=0,u,c,d;return this.isHorizontal()?(c=jt(a,r,o),d=t+e,u=o-r):(s.position==="left"?(c=r+e,d=jt(a,i,t),l=We*-.5):(c=o-e,d=jt(a,t,i),l=We*.5),u=i-t),{titleX:c,titleY:d,maxWidth:u,rotation:l}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const r=At(t.font),o=r.lineHeight/2+this._padding.top,{titleX:s,titleY:a,maxWidth:l,rotation:u}=this._drawArgs(o);Ao(e,t.text,0,0,r,{color:t.color,maxWidth:l,rotation:u,textAlign:tg(t.align),textBaseline:"middle",translation:[s,a]})}}function DW(n,e){const t=new hg({ctx:n.ctx,options:e,chart:n});Zt.configure(n,t,e),Zt.addBox(n,t),n.titleBlock=t}var AW={id:"title",_element:hg,start(n,e,t){DW(n,t)},stop(n){const e=n.titleBlock;Zt.removeBox(n,e),delete n.titleBlock},beforeUpdate(n,e,t){const r=n.titleBlock;Zt.configure(n,r,t),r.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ul=new WeakMap;var kW={id:"subtitle",start(n,e,t){const r=new hg({ctx:n.ctx,options:t,chart:n});Zt.configure(n,r,t),Zt.addBox(n,r),Ul.set(n,r)},stop(n){Zt.removeBox(n,Ul.get(n)),Ul.delete(n)},beforeUpdate(n,e,t){const r=Ul.get(n);Zt.configure(n,r,t),r.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const sa={average(n){if(!n.length)return!1;let e,t,r=new Set,i=0,o=0;for(e=0,t=n.length;e<t;++e){const a=n[e].element;if(a&&a.hasValue()){const l=a.tooltipPosition();r.add(l.x),i+=l.y,++o}}return o===0||r.size===0?!1:{x:[...r].reduce((a,l)=>a+l)/r.size,y:i/o}},nearest(n,e){if(!n.length)return!1;let t=e.x,r=e.y,i=Number.POSITIVE_INFINITY,o,s,a;for(o=0,s=n.length;o<s;++o){const l=n[o].element;if(l&&l.hasValue()){const u=l.getCenterPoint(),c=Ef(e,u);c<i&&(i=c,a=l)}}if(a){const l=a.tooltipPosition();t=l.x,r=l.y}return{x:t,y:r}}};function yr(n,e){return e&&(lt(e)?Array.prototype.push.apply(n,e):n.push(e)),n}function jr(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function RW(n,e){const{element:t,datasetIndex:r,index:i}=e,o=n.getDatasetMeta(r).controller,{label:s,value:a}=o.getLabelAndValue(i);return{chart:n,label:s,parsed:o.getParsed(i),raw:n.data.datasets[r].data[i],formattedValue:a,dataset:o.getDataset(),dataIndex:i,datasetIndex:r,element:t}}function Vb(n,e){const t=n.chart.ctx,{body:r,footer:i,title:o}=n,{boxWidth:s,boxHeight:a}=e,l=At(e.bodyFont),u=At(e.titleFont),c=At(e.footerFont),d=o.length,h=i.length,f=r.length,p=tn(e.padding);let g=p.height,m=0,v=r.reduce((x,w)=>x+w.before.length+w.lines.length+w.after.length,0);if(v+=n.beforeBody.length+n.afterBody.length,d&&(g+=d*u.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),v){const x=e.displayColors?Math.max(a,l.lineHeight):l.lineHeight;g+=f*x+(v-f)*l.lineHeight+(v-1)*e.bodySpacing}h&&(g+=e.footerMarginTop+h*c.lineHeight+(h-1)*e.footerSpacing);let y=0;const b=function(x){m=Math.max(m,t.measureText(x).width+y)};return t.save(),t.font=u.string,$e(n.title,b),t.font=l.string,$e(n.beforeBody.concat(n.afterBody),b),y=e.displayColors?s+2+e.boxPadding:0,$e(r,x=>{$e(x.before,b),$e(x.lines,b),$e(x.after,b)}),y=0,t.font=c.string,$e(n.footer,b),t.restore(),m+=p.width,{width:m,height:g}}function TW(n,e){const{y:t,height:r}=e;return t<r/2?"top":t>n.height-r/2?"bottom":"center"}function IW(n,e,t,r){const{x:i,width:o}=r,s=t.caretSize+t.caretPadding;if(n==="left"&&i+o+s>e.width||n==="right"&&i-o-s<0)return!0}function MW(n,e,t,r){const{x:i,width:o}=t,{width:s,chartArea:{left:a,right:l}}=n;let u="center";return r==="center"?u=i<=(a+l)/2?"left":"right":i<=o/2?u="left":i>=s-o/2&&(u="right"),IW(u,n,e,t)&&(u="center"),u}function Ub(n,e,t){const r=t.yAlign||e.yAlign||TW(n,t);return{xAlign:t.xAlign||e.xAlign||MW(n,e,t,r),yAlign:r}}function OW(n,e){let{x:t,width:r}=n;return e==="right"?t-=r:e==="center"&&(t-=r/2),t}function PW(n,e,t){let{y:r,height:i}=n;return e==="top"?r+=t:e==="bottom"?r-=i+t:r-=i/2,r}function jb(n,e,t,r){const{caretSize:i,caretPadding:o,cornerRadius:s}=n,{xAlign:a,yAlign:l}=t,u=i+o,{topLeft:c,topRight:d,bottomLeft:h,bottomRight:f}=yo(s);let p=OW(e,a);const g=PW(e,l,u);return l==="center"?a==="left"?p+=u:a==="right"&&(p-=u):a==="left"?p-=Math.max(c,h)+i:a==="right"&&(p+=Math.max(d,f)+i),{x:Ft(p,0,r.width-e.width),y:Ft(g,0,r.height-e.height)}}function jl(n,e,t){const r=tn(t.padding);return e==="center"?n.x+n.width/2:e==="right"?n.x+n.width-r.right:n.x+r.left}function $b(n){return yr([],jr(n))}function NW(n,e,t){return Wi(n,{tooltip:e,tooltipItems:t,type:"tooltip"})}function Gb(n,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?n.override(t):n}const K_={beforeTitle:zr,title(n){if(n.length>0){const e=n[0],t=e.chart.data.labels,r=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return t[e.dataIndex]}return""},afterTitle:zr,beforeBody:zr,beforeLabel:zr,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let e=n.dataset.label||"";e&&(e+=": ");const t=n.formattedValue;return Me(t)||(e+=t),e},labelColor(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:zr,afterBody:zr,beforeFooter:zr,footer:zr,afterFooter:zr};function fn(n,e,t,r){const i=n[e].call(t,r);return typeof i>"u"?K_[e].call(t,r):i}class qb extends ni{static positioners=sa;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,r=this.options.setContext(this.getContext()),i=r.enabled&&t.options.animation&&r.animations,o=new k_(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=NW(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:r}=t,i=fn(r,"beforeTitle",this,e),o=fn(r,"title",this,e),s=fn(r,"afterTitle",this,e);let a=[];return a=yr(a,jr(i)),a=yr(a,jr(o)),a=yr(a,jr(s)),a}getBeforeBody(e,t){return $b(fn(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:r}=t,i=[];return $e(e,o=>{const s={before:[],lines:[],after:[]},a=Gb(r,o);yr(s.before,jr(fn(a,"beforeLabel",this,o))),yr(s.lines,fn(a,"label",this,o)),yr(s.after,jr(fn(a,"afterLabel",this,o))),i.push(s)}),i}getAfterBody(e,t){return $b(fn(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:r}=t,i=fn(r,"beforeFooter",this,e),o=fn(r,"footer",this,e),s=fn(r,"afterFooter",this,e);let a=[];return a=yr(a,jr(i)),a=yr(a,jr(o)),a=yr(a,jr(s)),a}_createItems(e){const t=this._active,r=this.chart.data,i=[],o=[],s=[];let a=[],l,u;for(l=0,u=t.length;l<u;++l)a.push(RW(this.chart,t[l]));return e.filter&&(a=a.filter((c,d,h)=>e.filter(c,d,h,r))),e.itemSort&&(a=a.sort((c,d)=>e.itemSort(c,d,r))),$e(a,c=>{const d=Gb(e.callbacks,c);i.push(fn(d,"labelColor",this,c)),o.push(fn(d,"labelPointStyle",this,c)),s.push(fn(d,"labelTextColor",this,c))}),this.labelColors=i,this.labelPointStyles=o,this.labelTextColors=s,this.dataPoints=a,a}update(e,t){const r=this.options.setContext(this.getContext()),i=this._active;let o,s=[];if(!i.length)this.opacity!==0&&(o={opacity:0});else{const a=sa[r.position].call(this,i,this._eventPosition);s=this._createItems(r),this.title=this.getTitle(s,r),this.beforeBody=this.getBeforeBody(s,r),this.body=this.getBody(s,r),this.afterBody=this.getAfterBody(s,r),this.footer=this.getFooter(s,r);const l=this._size=Vb(this,r),u=Object.assign({},a,l),c=Ub(this.chart,r,u),d=jb(r,u,c,this.chart);this.xAlign=c.xAlign,this.yAlign=c.yAlign,o={opacity:1,x:d.x,y:d.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=s,this.$context=void 0,o&&this._resolveAnimations().update(this,o),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,r,i){const o=this.getCaretPosition(e,r,i);t.lineTo(o.x1,o.y1),t.lineTo(o.x2,o.y2),t.lineTo(o.x3,o.y3)}getCaretPosition(e,t,r){const{xAlign:i,yAlign:o}=this,{caretSize:s,cornerRadius:a}=r,{topLeft:l,topRight:u,bottomLeft:c,bottomRight:d}=yo(a),{x:h,y:f}=e,{width:p,height:g}=t;let m,v,y,b,x,w;return o==="center"?(x=f+g/2,i==="left"?(m=h,v=m-s,b=x+s,w=x-s):(m=h+p,v=m+s,b=x-s,w=x+s),y=m):(i==="left"?v=h+Math.max(l,c)+s:i==="right"?v=h+p-Math.max(u,d)-s:v=this.caretX,o==="top"?(b=f,x=b-s,m=v-s,y=v+s):(b=f+g,x=b+s,m=v+s,y=v-s),w=b),{x1:m,x2:v,x3:y,y1:b,y2:x,y3:w}}drawTitle(e,t,r){const i=this.title,o=i.length;let s,a,l;if(o){const u=hs(r.rtl,this.x,this.width);for(e.x=jl(this,r.titleAlign,r),t.textAlign=u.textAlign(r.titleAlign),t.textBaseline="middle",s=At(r.titleFont),a=r.titleSpacing,t.fillStyle=r.titleColor,t.font=s.string,l=0;l<o;++l)t.fillText(i[l],u.x(e.x),e.y+s.lineHeight/2),e.y+=s.lineHeight+a,l+1===o&&(e.y+=r.titleMarginBottom-a)}}_drawColorBox(e,t,r,i,o){const s=this.labelColors[r],a=this.labelPointStyles[r],{boxHeight:l,boxWidth:u}=o,c=At(o.bodyFont),d=jl(this,"left",o),h=i.x(d),f=l<c.lineHeight?(c.lineHeight-l)/2:0,p=t.y+f;if(o.usePointStyle){const g={radius:Math.min(u,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=i.leftForLtr(h,u)+u/2,v=p+l/2;e.strokeStyle=o.multiKeyBackground,e.fillStyle=o.multiKeyBackground,Df(e,g,m,v),e.strokeStyle=s.borderColor,e.fillStyle=s.backgroundColor,Df(e,g,m,v)}else{e.lineWidth=Ne(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,e.strokeStyle=s.borderColor,e.setLineDash(s.borderDash||[]),e.lineDashOffset=s.borderDashOffset||0;const g=i.leftForLtr(h,u),m=i.leftForLtr(i.xPlus(h,1),u-2),v=yo(s.borderRadius);Object.values(v).some(y=>y!==0)?(e.beginPath(),e.fillStyle=o.multiKeyBackground,Oa(e,{x:g,y:p,w:u,h:l,radius:v}),e.fill(),e.stroke(),e.fillStyle=s.backgroundColor,e.beginPath(),Oa(e,{x:m,y:p+1,w:u-2,h:l-2,radius:v}),e.fill()):(e.fillStyle=o.multiKeyBackground,e.fillRect(g,p,u,l),e.strokeRect(g,p,u,l),e.fillStyle=s.backgroundColor,e.fillRect(m,p+1,u-2,l-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,t,r){const{body:i}=this,{bodySpacing:o,bodyAlign:s,displayColors:a,boxHeight:l,boxWidth:u,boxPadding:c}=r,d=At(r.bodyFont);let h=d.lineHeight,f=0;const p=hs(r.rtl,this.x,this.width),g=function(E){t.fillText(E,p.x(e.x+f),e.y+h/2),e.y+=h+o},m=p.textAlign(s);let v,y,b,x,w,_,C;for(t.textAlign=s,t.textBaseline="middle",t.font=d.string,e.x=jl(this,m,r),t.fillStyle=r.bodyColor,$e(this.beforeBody,g),f=a&&m!=="right"?s==="center"?u/2+c:u+2+c:0,x=0,_=i.length;x<_;++x){for(v=i[x],y=this.labelTextColors[x],t.fillStyle=y,$e(v.before,g),b=v.lines,a&&b.length&&(this._drawColorBox(t,e,x,p,r),h=Math.max(d.lineHeight,l)),w=0,C=b.length;w<C;++w)g(b[w]),h=d.lineHeight;$e(v.after,g)}f=0,h=d.lineHeight,$e(this.afterBody,g),e.y-=o}drawFooter(e,t,r){const i=this.footer,o=i.length;let s,a;if(o){const l=hs(r.rtl,this.x,this.width);for(e.x=jl(this,r.footerAlign,r),e.y+=r.footerMarginTop,t.textAlign=l.textAlign(r.footerAlign),t.textBaseline="middle",s=At(r.footerFont),t.fillStyle=r.footerColor,t.font=s.string,a=0;a<o;++a)t.fillText(i[a],l.x(e.x),e.y+s.lineHeight/2),e.y+=s.lineHeight+r.footerSpacing}}drawBackground(e,t,r,i){const{xAlign:o,yAlign:s}=this,{x:a,y:l}=e,{width:u,height:c}=r,{topLeft:d,topRight:h,bottomLeft:f,bottomRight:p}=yo(i.cornerRadius);t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.beginPath(),t.moveTo(a+d,l),s==="top"&&this.drawCaret(e,t,r,i),t.lineTo(a+u-h,l),t.quadraticCurveTo(a+u,l,a+u,l+h),s==="center"&&o==="right"&&this.drawCaret(e,t,r,i),t.lineTo(a+u,l+c-p),t.quadraticCurveTo(a+u,l+c,a+u-p,l+c),s==="bottom"&&this.drawCaret(e,t,r,i),t.lineTo(a+f,l+c),t.quadraticCurveTo(a,l+c,a,l+c-f),s==="center"&&o==="left"&&this.drawCaret(e,t,r,i),t.lineTo(a,l+d),t.quadraticCurveTo(a,l,a+d,l),t.closePath(),t.fill(),i.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,r=this.$animations,i=r&&r.x,o=r&&r.y;if(i||o){const s=sa[e.position].call(this,this._active,this._eventPosition);if(!s)return;const a=this._size=Vb(this,e),l=Object.assign({},s,this._size),u=Ub(t,e,l),c=jb(e,l,u,t);(i._to!==c.x||o._to!==c.y)&&(this.xAlign=u.xAlign,this.yAlign=u.yAlign,this.width=a.width,this.height=a.height,this.caretX=s.x,this.caretY=s.y,this._resolveAnimations().update(this,c))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(t);const i={width:this.width,height:this.height},o={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const s=tn(t.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&a&&(e.save(),e.globalAlpha=r,this.drawBackground(o,e,i,t),__(e,t.textDirection),o.y+=s.top,this.drawTitle(o,e,t),this.drawBody(o,e,t),this.drawFooter(o,e,t),C_(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const r=this._active,i=e.map(({datasetIndex:a,index:l})=>{const u=this.chart.getDatasetMeta(a);if(!u)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:u.data[l],index:l}}),o=!Vu(r,i),s=this._positionChanged(i,t);(o||s)&&(this._active=i,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,r=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,o=this._active||[],s=this._getActiveElements(e,o,t,r),a=this._positionChanged(s,e),l=t||!Vu(s,o)||a;return l&&(this._active=s,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),l}_getActiveElements(e,t,r,i){const o=this.options;if(e.type==="mouseout")return[];if(!i)return t.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const s=this.chart.getElementsAtEventForMode(e,o.mode,o,r);return o.reverse&&s.reverse(),s}_positionChanged(e,t){const{caretX:r,caretY:i,options:o}=this,s=sa[o.position].call(this,e,t);return s!==!1&&(r!==s.x||i!==s.y)}}var FW={id:"tooltip",_element:qb,positioners:sa,afterInit(n,e,t){t&&(n.tooltip=new qb({chart:n,options:t}))},beforeUpdate(n,e,t){n.tooltip&&n.tooltip.initialize(t)},reset(n,e,t){n.tooltip&&n.tooltip.initialize(t)},afterDraw(n){const e=n.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(n.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",t)}},afterEvent(n,e){if(n.tooltip){const t=e.replay;n.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,e)=>e.bodyFont.size,boxWidth:(n,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:K_},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},LW=Object.freeze({__proto__:null,Colors:XH,Decimation:ZH,Filler:bW,Legend:SW,SubTitle:kW,Title:AW,Tooltip:FW});const BW=(n,e,t,r)=>(typeof e=="string"?(t=n.push(e)-1,r.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function HW(n,e,t,r){const i=n.indexOf(e);if(i===-1)return BW(n,e,t,r);const o=n.lastIndexOf(e);return i!==o?t:i}const WW=(n,e)=>n===null?null:Ft(Math.round(n),0,e);function Yb(n){const e=this.getLabels();return n>=0&&n<e.length?e[n]:n}class zW extends Oo{static id="category";static defaults={ticks:{callback:Yb}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const r=this.getLabels();for(const{index:i,label:o}of t)r[i]===o&&r.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(Me(e))return null;const r=this.getLabels();return t=isFinite(t)&&r[t]===e?t:HW(r,e,_e(t,e),this._addedLabels),WW(t,r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:r,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(r=0),t||(i=this.getLabels().length-1)),this.min=r,this.max=i}buildTicks(){const e=this.min,t=this.max,r=this.options.offset,i=[];let o=this.getLabels();o=e===0&&t===o.length-1?o:o.slice(e,t+1),this._valueRange=Math.max(o.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let s=e;s<=t;s++)i.push({value:s});return i}getLabelForValue(e){return Yb.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function VW(n,e){const t=[],{bounds:i,step:o,min:s,max:a,precision:l,count:u,maxTicks:c,maxDigits:d,includeBounds:h}=n,f=o||1,p=c-1,{min:g,max:m}=e,v=!Me(s),y=!Me(a),b=!Me(u),x=(m-g)/(d+1);let w=Vy((m-g)/p/f)*f,_,C,E,S;if(w<1e-14&&!v&&!y)return[{value:g},{value:m}];S=Math.ceil(m/w)-Math.floor(g/w),S>p&&(w=Vy(S*w/p/f)*f),Me(l)||(_=Math.pow(10,l),w=Math.ceil(w*_)/_),i==="ticks"?(C=Math.floor(g/w)*w,E=Math.ceil(m/w)*w):(C=g,E=m),v&&y&&o&&EB((a-s)/o,w/1e3)?(S=Math.round(Math.min((a-s)/w,c)),w=(a-s)/S,C=s,E=a):b?(C=v?s:C,E=y?a:E,S=u-1,w=(E-C)/S):(S=(E-C)/w,pa(S,Math.round(S),w/1e3)?S=Math.round(S):S=Math.ceil(S));const D=Math.max(Uy(w),Uy(C));_=Math.pow(10,Me(l)?D:l),C=Math.round(C*_)/_,E=Math.round(E*_)/_;let k=0;for(v&&(h&&C!==s?(t.push({value:s}),C<s&&k++,pa(Math.round((C+k*w)*_)/_,s,Xb(s,x,n))&&k++):C<s&&k++);k<S;++k){const M=Math.round((C+k*w)*_)/_;if(y&&M>a)break;t.push({value:M})}return y&&h&&E!==a?t.length&&pa(t[t.length-1].value,a,Xb(a,x,n))?t[t.length-1].value=a:t.push({value:a}):(!y||E===a)&&t.push({value:E}),t}function Xb(n,e,{horizontal:t,minRotation:r}){const i=ir(r),o=(t?Math.sin(i):Math.cos(i))||.001,s=.75*e*(""+n).length;return Math.min(e/o,s)}class Xu extends Oo{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Me(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:r}=this.getUserBounds();let{min:i,max:o}=this;const s=l=>i=t?i:l,a=l=>o=r?o:l;if(e){const l=Ar(i),u=Ar(o);l<0&&u<0?a(0):l>0&&u>0&&s(0)}if(i===o){let l=o===0?1:Math.abs(o*.05);a(o+l),e||s(i-l)}this.min=i,this.max=o}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:r}=e,i;return r?(i=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),t=t||11),t&&(i=Math.min(t,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let r=this.getTickLimit();r=Math.max(2,r);const i={maxTicks:r,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},o=this._range||this,s=VW(i,o);return e.bounds==="ticks"&&o_(s,this,"value"),e.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}configure(){const e=this.ticks;let t=this.min,r=this.max;if(super.configure(),this.options.offset&&e.length){const i=(r-t)/Math.max(e.length-1,1)/2;t-=i,r+=i}this._startValue=t,this._endValue=r,this._valueRange=r-t}getLabelForValue(e){return el(e,this.chart.options.locale,this.options.ticks.format)}}class UW extends Xu{static id="linear";static defaults={ticks:{callback:Fc.formatters.numeric}};determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=yt(e)?e:0,this.max=yt(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,r=ir(this.options.ticks.minRotation),i=(e?Math.sin(r):Math.cos(r))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,o.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const Na=n=>Math.floor(wi(n)),eo=(n,e)=>Math.pow(10,Na(n)+e);function Kb(n){return n/Math.pow(10,Na(n))===1}function Qb(n,e,t){const r=Math.pow(10,t),i=Math.floor(n/r);return Math.ceil(e/r)-i}function jW(n,e){const t=e-n;let r=Na(t);for(;Qb(n,e,r)>10;)r++;for(;Qb(n,e,r)<10;)r--;return Math.min(r,Na(n))}function $W(n,{min:e,max:t}){e=Pn(n.min,e);const r=[],i=Na(e);let o=jW(e,t),s=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),l=i>o?Math.pow(10,i):0,u=Math.round((e-l)*s)/s,c=Math.floor((e-l)/a/10)*a*10;let d=Math.floor((u-c)/Math.pow(10,o)),h=Pn(n.min,Math.round((l+c+d*Math.pow(10,o))*s)/s);for(;h<t;)r.push({value:h,major:Kb(h),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(o++,d=2,s=o>=0?1:s),h=Math.round((l+c+d*Math.pow(10,o))*s)/s;const f=Pn(n.max,h);return r.push({value:f,major:Kb(f),significand:d}),r}class GW extends Oo{static id="logarithmic";static defaults={ticks:{callback:Fc.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const r=Xu.prototype.parse.apply(this,[e,t]);if(r===0){this._zero=!0;return}return yt(r)&&r>0?r:null}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=yt(e)?Math.max(0,e):null,this.max=yt(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!yt(this._userMin)&&(this.min=e===eo(this.min,0)?eo(this.min,-1):eo(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let r=this.min,i=this.max;const o=a=>r=e?r:a,s=a=>i=t?i:a;r===i&&(r<=0?(o(1),s(10)):(o(eo(r,-1)),s(eo(i,1)))),r<=0&&o(eo(i,-1)),i<=0&&s(eo(r,1)),this.min=r,this.max=i}buildTicks(){const e=this.options,t={min:this._userMin,max:this._userMax},r=$W(t,this);return e.bounds==="ticks"&&o_(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(e){return e===void 0?"0":el(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=wi(e),this._valueRange=wi(this.max)-wi(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(wi(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function Mf(n){const e=n.ticks;if(e.display&&n.display){const t=tn(e.backdropPadding);return _e(e.font&&e.font.size,ct.font.size)+t.height}return 0}function qW(n,e,t){return t=lt(t)?t:[t],{w:zB(n,e.string,t),h:t.length*e.lineHeight}}function Jb(n,e,t,r,i){return n===r||n===i?{start:e-t/2,end:e+t/2}:n<r||n>i?{start:e-t,end:e}:{start:e,end:e+t}}function YW(n){const e={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},t=Object.assign({},e),r=[],i=[],o=n._pointLabels.length,s=n.options.pointLabels,a=s.centerPointLabels?We/o:0;for(let l=0;l<o;l++){const u=s.setContext(n.getPointLabelContext(l));i[l]=u.padding;const c=n.getPointPosition(l,n.drawingArea+i[l],a),d=At(u.font),h=qW(n.ctx,d,n._pointLabels[l]);r[l]=h;const f=qt(n.getIndexAngle(l)+a),p=Math.round(Zp(f)),g=Jb(p,c.x,h.w,0,180),m=Jb(p,c.y,h.h,90,270);XW(t,e,f,g,m)}n.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),n._pointLabelItems=JW(n,r,i)}function XW(n,e,t,r,i){const o=Math.abs(Math.sin(t)),s=Math.abs(Math.cos(t));let a=0,l=0;r.start<e.l?(a=(e.l-r.start)/o,n.l=Math.min(n.l,e.l-a)):r.end>e.r&&(a=(r.end-e.r)/o,n.r=Math.max(n.r,e.r+a)),i.start<e.t?(l=(e.t-i.start)/s,n.t=Math.min(n.t,e.t-l)):i.end>e.b&&(l=(i.end-e.b)/s,n.b=Math.max(n.b,e.b+l))}function KW(n,e,t){const r=n.drawingArea,{extra:i,additionalAngle:o,padding:s,size:a}=t,l=n.getPointPosition(e,r+i+s,o),u=Math.round(Zp(qt(l.angle+xt))),c=tz(l.y,a.h,u),d=ZW(u),h=ez(l.x,a.w,d);return{visible:!0,x:l.x,y:c,textAlign:d,left:h,top:c,right:h+a.w,bottom:c+a.h}}function QW(n,e){if(!e)return!0;const{left:t,top:r,right:i,bottom:o}=n;return!(Qr({x:t,y:r},e)||Qr({x:t,y:o},e)||Qr({x:i,y:r},e)||Qr({x:i,y:o},e))}function JW(n,e,t){const r=[],i=n._pointLabels.length,o=n.options,{centerPointLabels:s,display:a}=o.pointLabels,l={extra:Mf(o)/2,additionalAngle:s?We/i:0};let u;for(let c=0;c<i;c++){l.padding=t[c],l.size=e[c];const d=KW(n,c,l);r.push(d),a==="auto"&&(d.visible=QW(d,u),d.visible&&(u=d))}return r}function ZW(n){return n===0||n===180?"center":n<180?"left":"right"}function ez(n,e,t){return t==="right"?n-=e:t==="center"&&(n-=e/2),n}function tz(n,e,t){return t===90||t===270?n-=e/2:(t>270||t<90)&&(n-=e),n}function nz(n,e,t){const{left:r,top:i,right:o,bottom:s}=t,{backdropColor:a}=e;if(!Me(a)){const l=yo(e.borderRadius),u=tn(e.backdropPadding);n.fillStyle=a;const c=r-u.left,d=i-u.top,h=o-r+u.width,f=s-i+u.height;Object.values(l).some(p=>p!==0)?(n.beginPath(),Oa(n,{x:c,y:d,w:h,h:f,radius:l}),n.fill()):n.fillRect(c,d,h,f)}}function rz(n,e){const{ctx:t,options:{pointLabels:r}}=n;for(let i=e-1;i>=0;i--){const o=n._pointLabelItems[i];if(!o.visible)continue;const s=r.setContext(n.getPointLabelContext(i));nz(t,s,o);const a=At(s.font),{x:l,y:u,textAlign:c}=o;Ao(t,n._pointLabels[i],l,u+a.lineHeight/2,a,{color:s.color,textAlign:c,textBaseline:"middle"})}}function Q_(n,e,t,r){const{ctx:i}=n;if(t)i.arc(n.xCenter,n.yCenter,e,0,nt);else{let o=n.getPointPosition(0,e);i.moveTo(o.x,o.y);for(let s=1;s<r;s++)o=n.getPointPosition(s,e),i.lineTo(o.x,o.y)}}function iz(n,e,t,r,i){const o=n.ctx,s=e.circular,{color:a,lineWidth:l}=e;!s&&!r||!a||!l||t<0||(o.save(),o.strokeStyle=a,o.lineWidth=l,o.setLineDash(i.dash||[]),o.lineDashOffset=i.dashOffset,o.beginPath(),Q_(n,t,s,r),o.closePath(),o.stroke(),o.restore())}function oz(n,e,t){return Wi(n,{label:t,index:e,type:"pointLabel"})}class sz extends Xu{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Fc.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=tn(Mf(this.options)/2),t=this.width=this.maxWidth-e.width,r=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+r/2+e.top),this.drawingArea=Math.floor(Math.min(t,r)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=yt(e)&&!isNaN(e)?e:0,this.max=yt(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Mf(this.options))}generateTickLabels(e){Xu.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,r)=>{const i=Qe(this.options.pointLabels.callback,[t,r],this);return i||i===0?i:""}).filter((t,r)=>this.chart.getDataVisibility(r))}fit(){const e=this.options;e.display&&e.pointLabels.display?YW(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,r,i){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((r-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,r,i))}getIndexAngle(e){const t=nt/(this._pointLabels.length||1),r=this.options.startAngle||0;return qt(e*t+ir(r))}getDistanceFromCenterForValue(e){if(Me(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Me(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const r=t[e];return oz(this.getContext(),e,r)}}getPointPosition(e,t,r=0){const i=this.getIndexAngle(e)-xt+r;return{x:Math.cos(i)*t+this.xCenter,y:Math.sin(i)*t+this.yCenter,angle:i}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:r,right:i,bottom:o}=this._pointLabelItems[e];return{left:t,top:r,right:i,bottom:o}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const r=this.ctx;r.save(),r.beginPath(),Q_(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),r.closePath(),r.fillStyle=e,r.fill(),r.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:r,grid:i,border:o}=t,s=this._pointLabels.length;let a,l,u;if(t.pointLabels.display&&rz(this,s),i.display&&this.ticks.forEach((c,d)=>{if(d!==0||d===0&&this.min<0){l=this.getDistanceFromCenterForValue(c.value);const h=this.getContext(d),f=i.setContext(h),p=o.setContext(h);iz(this,f,l,s,p)}}),r.display){for(e.save(),a=s-1;a>=0;a--){const c=r.setContext(this.getPointLabelContext(a)),{color:d,lineWidth:h}=c;!h||!d||(e.lineWidth=h,e.strokeStyle=d,e.setLineDash(c.borderDash),e.lineDashOffset=c.borderDashOffset,l=this.getDistanceFromCenterForValue(t.reverse?this.min:this.max),u=this.getPointPosition(a,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(u.x,u.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,r=t.ticks;if(!r.display)return;const i=this.getIndexAngle(0);let o,s;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!t.reverse)return;const u=r.setContext(this.getContext(l)),c=At(u.font);if(o=this.getDistanceFromCenterForValue(this.ticks[l].value),u.showLabelBackdrop){e.font=c.string,s=e.measureText(a.label).width,e.fillStyle=u.backdropColor;const d=tn(u.backdropPadding);e.fillRect(-s/2-d.left,-o-c.size/2-d.top,s+d.width,c.size+d.height)}Ao(e,a.label,0,-o,c,{color:u.color,strokeColor:u.textStrokeColor,strokeWidth:u.textStrokeWidth})}),e.restore()}drawTitle(){}}const Uc={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},yn=Object.keys(Uc);function Zb(n,e){return n-e}function e0(n,e){if(Me(e))return null;const t=n._adapter,{parser:r,round:i,isoWeekday:o}=n._parseOpts;let s=e;return typeof r=="function"&&(s=r(s)),yt(s)||(s=typeof r=="string"?t.parse(s,r):t.parse(s)),s===null?null:(i&&(s=i==="week"&&(Ss(o)||o===!0)?t.startOf(s,"isoWeek",o):t.startOf(s,i)),+s)}function t0(n,e,t,r){const i=yn.length;for(let o=yn.indexOf(n);o<i-1;++o){const s=Uc[yn[o]],a=s.steps?s.steps:Number.MAX_SAFE_INTEGER;if(s.common&&Math.ceil((t-e)/(a*s.size))<=r)return yn[o]}return yn[i-1]}function az(n,e,t,r,i){for(let o=yn.length-1;o>=yn.indexOf(t);o--){const s=yn[o];if(Uc[s].common&&n._adapter.diff(i,r,s)>=e-1)return s}return yn[t?yn.indexOf(t):0]}function lz(n){for(let e=yn.indexOf(n)+1,t=yn.length;e<t;++e)if(Uc[yn[e]].common)return yn[e]}function n0(n,e,t){if(!t)n[e]=!0;else if(t.length){const{lo:r,hi:i}=eg(t,e),o=t[r]>=e?t[r]:t[i];n[o]=!0}}function uz(n,e,t,r){const i=n._adapter,o=+i.startOf(e[0].value,r),s=e[e.length-1].value;let a,l;for(a=o;a<=s;a=+i.add(a,1,r))l=t[a],l>=0&&(e[l].major=!0);return e}function r0(n,e,t){const r=[],i={},o=e.length;let s,a;for(s=0;s<o;++s)a=e[s],i[a]=s,r.push({value:a,major:!1});return o===0||!t?r:uz(n,r,i,t)}class Of extends Oo{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const r=e.time||(e.time={}),i=this._adapter=new c4._date(e.adapters.date);i.init(t),fa(r.displayFormats,i.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:e0(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,r=e.time.unit||"day";let{min:i,max:o,minDefined:s,maxDefined:a}=this.getUserBounds();function l(u){!s&&!isNaN(u.min)&&(i=Math.min(i,u.min)),!a&&!isNaN(u.max)&&(o=Math.max(o,u.max))}(!s||!a)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),i=yt(i)&&!isNaN(i)?i:+t.startOf(Date.now(),r),o=yt(o)&&!isNaN(o)?o:+t.endOf(Date.now(),r)+1,this.min=Math.min(i,o-1),this.max=Math.max(i+1,o)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],r=e[e.length-1]),{min:t,max:r}}buildTicks(){const e=this.options,t=e.time,r=e.ticks,i=r.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const o=this.min,s=this.max,a=kB(i,o,s);return this._unit=t.unit||(r.autoSkip?t0(t.minUnit,this.min,this.max,this._getLabelCapacity(o)):az(this,a.length,t.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:lz(this._unit),this.initOffsets(i),e.reverse&&a.reverse(),r0(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,r=0,i,o;this.options.offset&&e.length&&(i=this.getDecimalForValue(e[0]),e.length===1?t=1-i:t=(this.getDecimalForValue(e[1])-i)/2,o=this.getDecimalForValue(e[e.length-1]),e.length===1?r=o:r=(o-this.getDecimalForValue(e[e.length-2]))/2);const s=e.length<3?.5:.25;t=Ft(t,0,s),r=Ft(r,0,s),this._offsets={start:t,end:r,factor:1/(t+1+r)}}_generate(){const e=this._adapter,t=this.min,r=this.max,i=this.options,o=i.time,s=o.unit||t0(o.minUnit,t,r,this._getLabelCapacity(t)),a=_e(i.ticks.stepSize,1),l=s==="week"?o.isoWeekday:!1,u=Ss(l)||l===!0,c={};let d=t,h,f;if(u&&(d=+e.startOf(d,"isoWeek",l)),d=+e.startOf(d,u?"day":s),e.diff(r,t,s)>1e5*a)throw new Error(t+" and "+r+" are too far apart with stepSize of "+a+" "+s);const p=i.ticks.source==="data"&&this.getDataTimestamps();for(h=d,f=0;h<r;h=+e.add(h,a,s),f++)n0(c,h,p);return(h===r||i.bounds==="ticks"||f===1)&&n0(c,h,p),Object.keys(c).sort(Zb).map(g=>+g)}getLabelForValue(e){const t=this._adapter,r=this.options.time;return r.tooltipFormat?t.format(e,r.tooltipFormat):t.format(e,r.displayFormats.datetime)}format(e,t){const i=this.options.time.displayFormats,o=this._unit,s=t||i[o];return this._adapter.format(e,s)}_tickFormatFunction(e,t,r,i){const o=this.options,s=o.ticks.callback;if(s)return Qe(s,[e,t,r],this);const a=o.time.displayFormats,l=this._unit,u=this._majorUnit,c=l&&a[l],d=u&&a[u],h=r[t],f=u&&d&&h&&h.major;return this._adapter.format(e,i||(f?d:c))}generateTickLabels(e){let t,r,i;for(t=0,r=e.length;t<r;++t)i=e[t],i.label=this._tickFormatFunction(i.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+r)*t.factor)}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,r=this.ctx.measureText(e).width,i=ir(this.isHorizontal()?t.maxRotation:t.minRotation),o=Math.cos(i),s=Math.sin(i),a=this._resolveTickFontOptions(0).size;return{w:r*o+a*s,h:r*s+a*o}}_getLabelCapacity(e){const t=this.options.time,r=t.displayFormats,i=r[t.unit]||r.millisecond,o=this._tickFormatFunction(e,0,r0(this,[e],this._majorUnit),i),s=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return a>0?a:1}getDataTimestamps(){let e=this._cache.data||[],t,r;if(e.length)return e;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(t=0,r=i.length;t<r;++t)e=e.concat(i[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,r;if(e.length)return e;const i=this.getLabels();for(t=0,r=i.length;t<r;++t)e.push(e0(this,i[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return l_(e.sort(Zb))}}function $l(n,e,t){let r=0,i=n.length-1,o,s,a,l;t?(e>=n[r].pos&&e<=n[i].pos&&({lo:r,hi:i}=Kr(n,"pos",e)),{pos:o,time:a}=n[r],{pos:s,time:l}=n[i]):(e>=n[r].time&&e<=n[i].time&&({lo:r,hi:i}=Kr(n,"time",e)),{time:o,pos:a}=n[r],{time:s,pos:l}=n[i]);const u=s-o;return u?a+(l-a)*(e-o)/u:a}class cz extends Of{static id="timeseries";static defaults=Of.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=$l(t,this.min),this._tableRange=$l(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:r}=this,i=[],o=[];let s,a,l,u,c;for(s=0,a=e.length;s<a;++s)u=e[s],u>=t&&u<=r&&i.push(u);if(i.length<2)return[{time:t,pos:0},{time:r,pos:1}];for(s=0,a=i.length;s<a;++s)c=i[s+1],l=i[s-1],u=i[s],Math.round((c+l)/2)!==u&&o.push({time:u,pos:s/(a-1)});return o}_generate(){const e=this.min,t=this.max;let r=super.getDataTimestamps();return(!r.includes(e)||!r.length)&&r.splice(0,0,e),(!r.includes(t)||r.length===1)&&r.push(t),r.sort((i,o)=>i-o)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),r=this.getLabelTimestamps();return t.length&&r.length?e=this.normalize(t.concat(r)):e=t.length?t:r,e=this._cache.all=e,e}getDecimalForValue(e){return($l(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return $l(this._table,r*this._tableRange+this._minPos,!0)}}var dz=Object.freeze({__proto__:null,CategoryScale:zW,LinearScale:UW,LogarithmicScale:GW,RadialLinearScale:sz,TimeScale:Of,TimeSeriesScale:cz});const hz=[u4,VH,LW,dz];dg.register(...hz);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var J_=function(n,e){return(J_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function cr(n,e){function t(){this.constructor=n}J_(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function oe(n,e,t,r){return new(t||(t=Promise))((function(i,o){function s(u){try{l(r.next(u))}catch(c){o(c)}}function a(u){try{l(r.throw(u))}catch(c){o(c)}}function l(u){u.done?i(u.value):new t((function(c){c(u.value)})).then(s,a)}l((r=r.apply(n,[])).next())}))}function se(n,e){var t,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return(function(c){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,r=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){s=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(c[0]===6&&s.label<i[1]){s.label=i[1],i=c;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(c);break}i[2]&&s.ops.pop(),s.trys.pop();continue}c=e.call(n,s)}catch(d){c=[6,d],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}})([l,u])}}}var fz=(function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(o){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return pz(r,s[0],s[1]),s.join("=")})),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach((function(o){var s=o.split(":"),a=s[0],l=s[1];e.urlFlags[a]=(function(u,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+u+".")})(a,l)}))}},n})();function pz(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function X(){return Z_}var Z_=null,Ku=new Map,Pf=new Map;function eC(n,e){var t=nC(n,e);return Ku.get(t)}function gz(n){return Pf.get(n)}function i0(n){for(var e=Ku.entries(),t=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var s=o[0],a=o[1];s.split("_")[0]===n&&t.push(a)}return t}function tC(n){var e=n.kernelName,t=n.backendName,r=nC(e,t);if(Ku.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");Ku.set(r,n)}function mz(n){var e=n.kernelName;Pf.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),Pf.set(e,n)}function nC(n,e){return e+"_"+n}function Nf(n,e,t){return Math.max(n,Math.min(e,t))}function rC(n){return n%2==0?n:n+1}function vz(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function T(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function je(n,e,t){t===void 0&&(t=""),T(Lt(n,e),(function(){return t+" Shapes "+n+" and "+e+" must match"}))}function Ns(n){T(n!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function ks(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||kr(n)&&!t)for(var r=0;r<n.length;++r)ks(n[r],e,t);else e.push(n);return e}function le(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Lt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function wt(n){return n%1==0}function yz(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function Ff(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function fs(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function o0(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise((function(r,i){var o=0,s=function(){if(n())r();else{o++;var a=e(o);t!=null&&o>=t?i():setTimeout(s,a)}};s()}))}function bz(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function Mt(n,e){var t=e.length;return T((n=n==null?e.map((function(r,i){return i})):[].concat(n)).every((function(r){return r>=-t&&r<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n})),T(n.every((function(r){return wt(r)})),(function(){return"All values in axis param must be integers but got axis "+n})),n.map((function(r){return r<0?t+r:r}))}function co(n,e){for(var t=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:Mt(e,n).sort(),s=0,a=0;a<n.length;++a){if(o!=null){if(o[s]===a&&n[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(o[s]==null||o[s]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),o[s]<=a&&s++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Fa(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function Qu(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function xz(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function wz(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function _z(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function kr(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function iC(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function Cz(n){if(n==null)return 0;var e=0;return n.forEach((function(t){return e+=t.length})),e}function fg(n){return typeof n=="string"||n instanceof String}function Ez(n){return typeof n=="boolean"}function Sz(n){return typeof n=="number"}function tl(n){return Array.isArray(n)?tl(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":Sz(n)?"float32":fg(n)?"string":Ez(n)?"bool":"float32"}function Lf(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Bf(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function Rr(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function oC(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=ks(n)),t&&xz(n,e),(function(o,s){return o instanceof Float32Array&&s==="float32"||o instanceof Int32Array&&s==="int32"||o instanceof Uint8Array&&s==="bool"})(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function s0(n,e){if(n.length===0)return e[0];var t=n.reduce((function(r,i){return r*i}));if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return(function r(i,o,s){var a=new Array;if(o.length===1)for(var l=o[0],u=0;u<l;u++)a[u]=s[i+u];else{l=o[0];var c=o.slice(1),d=c.reduce((function(h,f){return h*f}));for(u=0;u<l;u++)a[u]=r(i+u*d,c,s)}return a})(0,n,e)}function sC(n,e){for(var t=nl(n,e),r=0;r<t.length;r++)t[r]=1;return t}function nl(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function _r(){return X().platform.now()}function aC(n){n.forEach((function(e){T(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."}))}))}function Dz(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",X().platform.encode(n,e)}function Ju(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",X().platform.decode(n,e)}function a0(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function Az(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}var kz=(function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Rz)}return n.prototype.profileKernel=function(e,t,r){var i,o=this,s=this.backendTimer.time((function(){i=r()}));return i.forEach((function(a){a.data().then((function(l){(function(u,c,d){if(c!=="float32")return!1;for(var h=0;h<u.length;h++){var f=u[h];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+d+"'"),!0}})(l,a.dtype,e),s.then((function(u){var c="";u.getExtraProfileInfo!=null&&(c=u.getExtraProfileInfo()),o.logger.logKernelProfile(e,a,l,u.kernelMs,t,c)}))}))})),i},n})(),Rz=(function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o,s){var a=typeof i=="number"?fs(i+"ms",9):i.error,l=fs(e,25),u=t.rank,c=t.size,d=fs(t.shape.toString(),14),h="";for(var f in o){var p=o[f].shape||t.shape,g=p.length;h+=f+": "+g+"D "+(g>0?p:"")+" "}console.log("%c"+l+"	%c"+a+"	%c"+u+"D "+d+"	%c"+c+"	%c"+h+"	%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n})(),l0=20,Js=3,ph=7;function Tz(n,e,t,r){var i=Rr(e),o=(function(u,c,d,h){var f=le(c),p=h[h.length-1],g=new Array(p).fill(0),m=c.length,v=d==="complex64"?ea(u):u;if(m>1)for(var y=0;y<f/p;y++)for(var b=y*p,x=0;x<p;x++)g[x]=Math.max(g[x],Zs(v[b+x],0,d).length);return g})(n,e,t,i),s=e.length,a=(function u(c,d,h,f,p,g){g===void 0&&(g=!0);var m=h==="complex64"?2:1,v=d[0],y=d.length;if(y===0)return h==="complex64"?[Zs(ea(c)[0],0,h)]:h==="bool"?[lC(c[0])]:[c[0].toString()];if(y===1){if(v>l0){var b=Js*m,x=Array.from(c.slice(0,b)),w=Array.from(c.slice((v-Js)*m,v*m));return h==="complex64"&&(x=ea(x),w=ea(w)),["["+x.map((function(F,W){return Zs(F,p[W],h)})).join(", ")+", ..., "+w.map((function(F,W){return Zs(F,p[v-Js+W],h)})).join(", ")+"]"]}return["["+(h==="complex64"?ea(c):Array.from(c)).map((function(F,W){return Zs(F,p[W],h)})).join(", ")+"]"]}var _=d.slice(1),C=f.slice(1),E=f[0]*m,S=[];if(v>l0){for(var D=0;D<Js;D++){var k=(M=D*E)+E;S.push.apply(S,u(c.slice(M,k),_,h,C,p,!1))}for(S.push("..."),D=v-Js;D<v;D++)k=(M=D*E)+E,S.push.apply(S,u(c.slice(M,k),_,h,C,p,D===v-1))}else for(D=0;D<v;D++){var M;k=(M=D*E)+E,S.push.apply(S,u(c.slice(M,k),_,h,C,p,D===v-1))}var B=y===2?",":"";for(S[0]="["+S[0]+B,D=1;D<S.length-1;D++)S[D]=" "+S[D]+B;var H=`,
`;for(D=2;D<y;D++)H+=`
`;return S[S.length-1]=" "+S[S.length-1]+"]"+(g?"":H),S})(n,e,t,i,o),l=["Tensor"];return r&&(l.push("  dtype: "+t),l.push("  rank: "+s),l.push("  shape: ["+e+"]"),l.push("  values:")),l.push(a.map((function(u){return"    "+u})).join(`
`)),l.join(`
`)}function Zs(n,e,t){return fs(Array.isArray(n)?parseFloat(n[0].toFixed(ph))+" + "+parseFloat(n[1].toFixed(ph))+"j":fg(n)?"'"+n+"'":t==="bool"?lC(n):parseFloat(n.toFixed(ph)).toString(),e)}function lC(n){return n===0?"false":"true"}function ea(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var La=(function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=le(e),r!=null){var o=r.length;T(o===this.size,(function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Qu(t,this.size),this.strides=Rr(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),T(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var l=e[e.length-1],u=0;u<e.length-1;++u)l+=this.strides[u]*e[u];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Cr().makeTensor(this.values,this.shape,this.dtype)},n})(),Cr=null,G=null,uC=null,ft=(function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=le(e),this.strides=Rr(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),T(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),G.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return oe(this,void 0,void 0,(function(){var e;return se(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,G.buffer(this.shape,this.dtype,e)]}}))}))},n.prototype.bufferSync=function(){return G.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return oe(this,void 0,void 0,(function(){var e;return se(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,s0(this.shape,e)]}}))}))},n.prototype.arraySync=function(){return s0(this.shape,this.dataSync())},n.prototype.data=function(){return oe(this,void 0,void 0,(function(){var e,t;return se(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=Cr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map((function(i){return Ju(i)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}}))}))},n.prototype.dataSync=function(){this.throwIfDisposed();var e=Cr().readSync(this.dataId);if(this.dtype==="string")try{return e.map((function(t){return Ju(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return oe(this,void 0,void 0,(function(){var e;return se(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Cr().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},n.prototype.dispose=function(){this.isDisposed||(Cr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),G.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),G.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),G.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),G.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),G.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),G.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),G.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),Tz(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),G.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),G.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),G.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),G.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),G.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),G.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),G.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),G.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),G.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),G.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),G.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),G.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,o){return r===void 0&&(r=.001),uC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.batchNorm=function(e,t,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),G.batchNorm(this,e,t,r,i,o)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),G.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),G.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),G.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),G.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),G.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),G.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),G.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),G.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),G.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),G.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),G.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),G.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),G.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),G.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),G.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),G.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),G.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),G.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),G.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),G.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),G.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),G.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),G.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),G.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),G.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),G.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),G.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),G.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),G.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),G.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),G.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),G.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),G.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),G.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),G.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),G.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),G.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),G.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),G.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),G.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),G.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),G.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),G.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),G.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),G.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),G.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),G.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),G.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),G.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),G.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),G.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),G.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),G.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),G.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),G.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),G.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),G.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),G.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),G.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),G.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),G.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),G.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),G.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),G.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),G.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),G.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),G.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),G.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),G.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),G.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),G.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),G.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),G.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),G.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),G.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),G.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),G.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),G.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),G.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),G.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),G.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),G.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),G.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),G.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),G.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),G.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),G.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),G.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,s){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),G.conv1d(this,e,t,r,i,o,s)},n.prototype.conv2d=function(e,t,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),G.conv2d(this,e,t,r,i,o,s)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),G.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),G.depthwiseConv2d(this,e,t,r,i,o,s)},n.prototype.separableConv2d=function(e,t,r,i,o,s){return o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),G.separableConv2d(this,e,t,r,i,o,s)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),G.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),G.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),G.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),G.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Cr().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),G.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),G.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),G.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),G.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,s,a,l){return i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),l===void 0&&(l=0),this.throwIfDisposed(),G.stridedSlice(this,e,t,r,i,o,s,a,l)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),G.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),G.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),G.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),G.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),G.spectral.irfft(this)},n})();Object.defineProperty(ft,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var u0,Hf,Wf,zf,Vf,Rs=(function(n){function e(t,r,i,o){var s=n.call(this,t.shape,t.dtype,t.dataId,o)||this;return s.trainable=r,s.name=i,s}return cr(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Lt(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Cr().disposeTensor(this),this.dataId=t.dataId,Cr().incRef(this,null)},e.prototype.dispose=function(){Cr().disposeVariable(this),this.isDisposedInternal=!0},e})(ft);Object.defineProperty(Rs,Symbol.hasInstance,{value:function(n){return n instanceof ft&&n.assign!=null&&n.assign instanceof Function}}),(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(u0||(u0={})),(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Hf||(Hf={})),(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Wf||(Wf={})),(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(zf||(zf={})),(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Vf||(Vf={}));var Iz={float32:zf,int32:Hf,bool:Wf,complex64:Vf};function Vt(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return Iz[n][e]}function gh(n){return Vt(n,"int32")}function gt(n,e){if(n.dtype===e.dtype)return[n,e];var t=Vt(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function Mz(n,e){T(n.dtype===e.dtype,(function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"}))}function cC(n){var e=[];return(function t(r,i,o){if(r!=null){if(r instanceof ft)return void i.push(r);if(s=r,!(!Array.isArray(s)&&typeof s!="object")){var s,a=r;for(var l in a){var u=a[l];o.has(u)||(o.add(u),t(u,i,o))}}}})(n,e,new Set),e}var mh,c0=(function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n})(),Oz=(function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new c0}return n.prototype.ready=function(){return oe(this,void 0,void 0,(function(){var e,t,r;return se(this,(function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return oe(this,void 0,void 0,(function(){var t,r,i;return se(this,(function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new kz(this.backendInstance),[2,!0]}}))}))},n.prototype.setupRegisteredKernels=function(){var e=this;i0(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)}))},n.prototype.disposeRegisteredKernels=function(e){var t=this;i0(e).forEach((function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])}))},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then((function(a){return!(o<t.pendingBackendInitId)&&(t.registry[e]=a,t.pendingBackendInit=null,!0)})).catch((function(a){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)}));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority}))},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),o=i.success,s=i.asyncInit;if(s||o)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,o=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun((function(){return i.startScope(o)}),(function(){return i.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],(function(i){return{x:function(){return i.toFloat()}}}),[]),t},n.prototype.runKernel=function(e,t,r,i,o){return this.runKernelFunc(null,t,null,e,r,i,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),o=0;r.forEach((function(l){o+=l.dtype==="complex64"?3:1}));var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-t-o-s;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,o,s,a){var l,u=this;s===void 0&&(s=[]),a===void 0&&(a=[]);var c=[],d=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var h,f=function(y){d&&(c=y.map((function(b){return u.keep(u.clone(b))})))},p=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=eC(i,this.backendName);return h=v!=null?function(){var y=u.backend.numDataIds();m=v.kernelFunc({inputs:t,attrs:o,backend:u.backend});var b=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(i,y,b);var x=b.map((function(_){var C=_.dataId,E=_.shape,S=_.dtype;return u.makeTensorFromDataId(C,E,S)})),w=x.filter((function(_,C){return a[C]}));return f((s||[]).slice().concat(w)),x}:function(){var y=u.backend.numDataIds();m=u.tidy((function(){return e(u.backend,f)}));var b=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(i,y,b),b},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){l=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(i,t,(function(){return h()})):h()})),d&&this.addTapeNode(i,t,l,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(y){return t[y].shape})),outputShapes:l.map((function(y){return y.shape}))}),Array.isArray(m)?l:l[0]},n.prototype.makeTensor=function(e,t,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=e;r==="string"&&fg(e[0])&&(o=e.map((function(c){return Dz(c)})));var s=i.write(o,t,r),a=new ft(t,r,s,this.nextTensorId());if(this.incRef(a,i),r==="string"){var l=this.state.tensorInfo.get(s),u=Cz(o);this.state.numBytes+=u-l.bytes,l.bytes=u}return a},n.prototype.makeTensorFromDataId=function(e,t,r,i){var o=new ft(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},n.prototype.makeVariable=function(e,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new Rs(e,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*iC(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Rs||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return oe(this,void 0,void 0,(function(){var t,r;return se(this,(function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(o){return o.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,i,o){var s=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},l=gz(e);l!=null&&(i=l.gradFunc),i!=null&&(a.gradient=function(u){return u=u.map((function(c,d){if(c==null){var h=r[d],f=nl(h.size,h.dtype);return s.makeTensor(f,h.shape,h.dtype)}return c})),i(u.length>1?u:u[0],o)}),this.state.activeTape.push(a)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=cC(e),i=new Set(r.map((function(l){return l.id}))),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(l){l.kept||l.scopeId!==a.id||t.track(l)}))},n.prototype.gradients=function(e,t,r,i){var o=this;if(i===void 0&&(i=!1),T(t.length>0,(function(){return"gradients() received an empty list of xs."})),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun((function(){return o.startTape()}),(function(){return o.endTape()}),(function(){return o.tidy("forward",e)}));T(s instanceof ft,(function(){return"The result y returned by f() must be a tensor."}));var a=(function(l,u,c){for(var d={},h={},f=0;f<u.length;f++)d[u[f].id]=!0;for(f=0;f<l.length;f++){var p=(_=l[f]).inputs;for(var g in p){for(var m=p[g],v=!1,y=0;y<u.length;y++)if(d[m.id]){_.outputs.forEach((function(D){return d[D.id]=!0})),v=!0,h[_.id]=!0;break}if(v)break}}var b={};b[c.id]=!0;var x={};for(f=l.length-1;f>=0;f--)for(p=(_=l[f]).inputs,y=0;y<_.outputs.length;y++)if(b[_.outputs[y].id]){for(var g in p)b[p[g].id]=!0,x[_.id]=!0;break}var w=[];for(f=0;f<l.length;f++){var _;if(h[(_=l[f]).id]&&x[_.id]){var C={};for(var g in _.inputs){var E=_.inputs[g];d[E.id]&&(C[g]=E)}var S=Object.assign({},_);S.inputs=C,S.outputs=_.outputs,w.push(S)}}return w})(this.state.activeTape,t,s);if(!i&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var l,u,c={};c[s.id]=r??(l=s.shape,u=sC(le(l),"float32"),N.makeTensor(u,l,"float32")),(function(h,f,p){for(var g=function(v){var y=f[v],b=[];if(y.outputs.forEach((function(C){var E=h[C.id];E!=null?b.push(E):b.push(null)})),y.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var x=y.gradient(b),w=function(C){if(!(C in x))throw new Error("Cannot backprop through input "+C+". Available gradients found: "+Object.keys(x)+".");var E=p((function(){return x[C]()}));if(E.dtype!=="float32")throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+C+" must have 'float32' dtype, but has '"+E.dtype+"'");var S=y.inputs[C];if(!Lt(E.shape,S.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+C+"' has shape '"+E.shape+"', which does not match the shape of the input '"+S.shape+"'");if(h[S.id]==null)h[S.id]=E;else{var D=h[S.id];h[S.id]=D.add(E),D.dispose()}};for(var _ in y.inputs)w(_)},m=f.length-1;m>=0;m--)g(m)})(c,a,(function(h){return o.tidy(h)}));var d=t.map((function(h){return c[h.id]}));return o.state.gradientDepth===0&&(o.state.activeTape.forEach((function(h){for(var f=0,p=h.saved;f<p.length;f++)p[f].dispose()})),o.state.activeTape=null),{value:s,grads:d}}))},n.prototype.customGrad=function(e){var t=this;return T(Lf(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];T(i.every((function(a){return a instanceof ft})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var s={};return i.forEach((function(a,l){s[l]=a})),t.runKernelFunc((function(a,l){return T((r=e.apply(void 0,i.concat([l]))).value instanceof ft,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),T(Lf(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),s,(function(a,l){var u=r.gradFunc(a,l),c=Array.isArray(u)?u:[u];T(c.length===i.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),T(c.every((function(h){return h instanceof ft})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var d={};return c.forEach((function(h,f){d[f]=function(){return h}})),d}))}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return oe(this,void 0,void 0,(function(){var t,r;return se(this,(function(i){switch(i.label){case 0:return t=_r(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=_r()-t,[2,r]}}))}))},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new c0,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n})(),N=(function(){var n=(function(){if(mh==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}mh=t}return mh})();if(n._tfengine==null){var e=new fz(n);n._tfengine=new Oz(e)}return(function(t){Z_=t})(n._tfengine.ENV),Cr=function(){return n._tfengine},n._tfengine})();function dC(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Vr=X();Vr.registerFlag("DEBUG",(function(){return!1}),(function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Vr.registerFlag("IS_BROWSER",(function(){return dC()})),Vr.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),Vr.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Vr.registerFlag("PROD",(function(){return!1})),Vr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Vr.getBool("DEBUG")})),Vr.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Vr.registerFlag("IS_TEST",(function(){return!1}));var Ba,Ln,Fn,so={},vh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Pz(n,e){so[n]=e}function Nr(n){n in so||(so[n]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",(function(i){i.preventDefault(),delete so[t]}),!1),t===1?r.getContext("webgl",vh)||r.getContext("experimental-webgl",vh):r.getContext("webgl2",vh)})(n));var e=so[n];return e.isContextLost()?(delete so[n],Nr(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),so[n])}function jc(n,e){return[e,n]}function va(n){var e=le(n);return Ff(Math.ceil(e/4))}function rl(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function pg(n,e){var t,r,i,o,s,a,l,u,c,d=n;return X().getNumber("WEBGL_VERSION")===2?(t=d.R32F,r=d.R16F,i=d.RGBA16F,o=d.RGBA32F,s=d.RED,a=4,l=1,u=d.HALF_FLOAT,c=d.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=d.RGBA,s=n.RGBA,a=4,l=4,u=e!=null?e.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:l,textureTypeHalfFloat:u,textureTypeFloat:c}}function ce(n,e,t){var r=t();return e&&(function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+Bz(i,o))})(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Ba||(Ba={})),(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Ln||(Ln={})),(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Fn||(Fn={}));var Nz=596e-10,Fz=65504;function Lz(n){return!!(X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Nz<Math.abs(n)&&Math.abs(n)<Fz)}function Bz(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Gl(n,e,t){return ri(n,e,(function(){return n.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function Hz(n,e,t){var r=ri(n,e,(function(){return n.createShader(n.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(ce(n,e,(function(){return n.shaderSource(r,t)})),ce(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Wz(n,e,t){var r=ri(n,e,(function(){return n.createShader(n.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(ce(n,e,(function(){return n.shaderSource(r,t)})),ce(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw(function(i,o){var s=zz.exec(o);if(s==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],l=i.split(`
`),u=l.length.toString().length+2,c=l.map((function(m,v){return fs((v+1).toString(),u)+m})),d=0,h=0;h<c.length;h++)d=Math.max(c[h].length,d);var f=c.slice(0,a-1),p=c.slice(a-1,a),g=c.slice(a);console.log(f.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+fs(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join(`
`))})(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var yh,bh,zz=/ERROR: [0-9]+:([0-9]+):/g;function Vz(n,e){return ri(n,e,(function(){return n.createProgram()}),"Unable to create WebGLProgram.")}function Uz(n,e,t){if(ce(n,e,(function(){return n.linkProgram(t)})),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function xh(n,e,t){if(ce(n,e,(function(){return n.validateProgram(t)})),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function jz(n,e,t){var r=ri(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return ce(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),ce(n,e,(function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function $z(n,e,t){var r=ri(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return ce(n,e,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)})),ce(n,e,(function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function Gz(n,e){return ri(n,e,(function(){return n.createTexture()}),"Unable to create WebGLTexture.")}function qz(n,e){var t=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function Yz(n,e){return ri(n,e,(function(){return n.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function d0(n,e,t,r,i,o,s,a){var l=n.getAttribLocation(t,r);return l!==-1&&(ce(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,i)})),ce(n,e,(function(){return n.vertexAttribPointer(l,o,n.FLOAT,!1,s,a)})),ce(n,e,(function(){return n.enableVertexAttribArray(l)})),!0)}function Xz(n,e,t,r){eV(n,r),ce(n,e,(function(){return n.activeTexture(n.TEXTURE0+r)})),ce(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)}))}function Kz(n,e,t,r){return ri(n,e,(function(){return n.getUniformLocation(t,r)}),'uniform "'+r+'" not present in program.')}function Qz(n,e,t){return n.getUniformLocation(e,t)}function Jz(n,e,t,r,i,o){ce(n,e,(function(){return Xz(n,e,r,o)})),ce(n,e,(function(){return n.uniform1i(i,o)}))}function wh(n,e,t,r){ce(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)})),ce(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}))}function h0(n,e,t){ce(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)})),ce(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)}))}function ql(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Zz(n,e))}function Zz(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function ri(n,e,t,r){var i=ce(n,e,(function(){return t()}));if(i==null)throw new Error(r);return i}function eV(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function Zu(n,e){return e===void 0&&(e=2),le(n.slice(0,n.length-e))}function ec(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function _h(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Zu(n)].concat(ec(n))),e}function tV(n,e){var t;e===void 0&&(e=!1);var r=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map((function(u,c){return c>=n.length-2?rC(n[c]):n[c]}))).length===1&&(n=[2,n[0]])),n.length!==2){var i=co(n);n=i.newShape}var o=le(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var s=Zu(n),a=2,l=2;return n.length&&(a=(t=ec(n))[0],l=t[1]),Ff(o=s*(a/2)*(l/2)).map((function(u){return 2*u}))}return Ff(o)}function Yl(n){return n%2==0}function Xl(n,e){if(Lt(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Yl(t)&&Yl(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Yl(n[0])&&Yl(e[0])}function nV(n){if(yh==null){var e=Nr(n);yh=e.getParameter(e.MAX_TEXTURE_SIZE)}return yh}function rV(n){if(bh==null){var e=Nr(n);bh=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,bh)}function iV(n){if(n===0)return 0;var e=Nr(n);return Xn(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Xn(e,"EXT_disjoint_timer_query")?1:0}function Xn(n,e){return n.getExtension(e)!=null}function f0(n){try{if(Nr(n)!=null)return!0}catch{return!1}return!1}function oV(n){if(n===0)return!1;var e=Nr(n);if(n===1){if(!Xn(e,"OES_texture_float"))return!1}else if(!Xn(e,"EXT_color_buffer_float"))return!1;return Uf(e)}function sV(n){if(n===0)return!1;var e=Nr(n);if(n!==1){if(Xn(e,"EXT_color_buffer_float"))return Uf(e);if(Xn(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return(function(r,i){var o=pg(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var l=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(a),l})(e,t)}return!1}return!!Xn(e,"OES_texture_float")&&!!Xn(e,"WEBGL_color_buffer_float")&&Uf(e)}function Uf(n){var e=pg(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function aV(n){return n===2&&Nr(n).fenceSync!=null}var be=X();function hC(n){X().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ie(n,e){return N.tidy(n,e)}function Cn(n){cC(n).forEach((function(e){return e.dispose()}))}function lV(n){return N.keep(n)}function tc(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];X().getBool("IS_TEST")||console.warn.apply(console,n)}function Vi(n,e){var t=n;if(kr(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||kr(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&X().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function i(o,s,a){if(a=a||[],!Array.isArray(o)&&!kr(o))return void T(s.length===0,(function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"}));T(s.length>0,(function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"})),T(o.length===s[0],(function(){return"Element arr["+a.join("][")+"] should have "+s[0]+" elements, but has "+o.length+" elements"}));for(var l=s.slice(1),u=0;u<o.length;++u)i(o[u],l,a.concat(u))})(n,r,[]),r}function p0(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function A(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof ft)return p0(r,n.dtype,e,t),n;var i=tl(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),p0(r,i,e,t),n==null||!kr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var s=Vi(n,i);kr(n)||Array.isArray(n)||(n=[n]);var a=i!=="string"?oC(n,i,X().getBool("DEBUG")):ks(n,[],!0);return N.makeTensor(a,s,i)}function nc(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map((function(i,o){return A(i,e+"["+o+"]",t)}),r)}function fC(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function uV(n,e,t){for(var r=n.length+e.length,i=[],o=0,s=0,a=0;a<r;a++)t.indexOf(a)===-1?i.push(n[o++]):i.push(e[s++]);return i}function Gt(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map((function(o){return n[o]}))]}function En(n,e){return uV(n,e.map((function(t){return 1})),e)}function Nn(n,e,t){T(fC(e,t),(function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."}))}function Fr(n,e){if(fC(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach((function(i){return t.push(i)})),t}function gg(n){return n.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Lr(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function cV(n,e){var t=n[0].length;n.forEach((function(i,o){T(i.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"}))})),T(e>=0&&e<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var r=n[0];n.forEach((function(i,o){for(var s=0;s<t;s++)T(s===e||i[s]===r[s],(function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."}))}))}function Ts(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function P(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];N.startScope(t);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),N.endScope(a),a}catch(l){throw N.endScope(null),l}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}be.registerFlag("HAS_WEBGL",(function(){return be.getNumber("WEBGL_VERSION")>0})),be.registerFlag("WEBGL_VERSION",(function(){return f0(2)?2:f0(1)?1:0})),be.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return be.get("WEBGL_VERSION")===2})),be.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),be.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),be.registerFlag("WEBGL_PACK",(function(){return be.getBool("HAS_WEBGL")})),be.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_PACK_CLIP",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_PACK_REDUCE",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_CONV_IM2COL",(function(){return be.getBool("WEBGL_PACK")})),be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return nV(be.getNumber("WEBGL_VERSION"))})),be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return rV(be.getNumber("WEBGL_VERSION"))})),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var n=be.getNumber("WEBGL_VERSION");return n===0?0:iV(n)})),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n})),be.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return oV(be.getNumber("WEBGL_VERSION"))})),be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!be.getBool("WEBGL_FORCE_F16_TEXTURES")&&be.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return sV(be.getNumber("WEBGL_VERSION"))})),be.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return aV(be.getNumber("WEBGL_VERSION"))})),be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),uC=hC;var zt=P({complex_:function(n,e){var t=A(n,"real","complex"),r=A(e,"imag","complex");return je(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),N.runKernelFunc((function(i){return i.complex(t,r)}),{$real:t,$imag:r})}}),Yn=P({real_:function(n){var e=A(n,"input","real");return N.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),Er=P({imag_:function(n){var e=A(n,"input","imag");return N.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function Ut(n,e,t){return Ui(n,e,Vi(n,t),t)}function Ui(n,e,t,r){if(r==null&&(r=tl(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!kr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){aC(e);var i=le(e),o=le(t);T(i===o,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o}));for(var s=0;s<t.length;++s){var a=t[s],l=s!==t.length-1||a!==le(e.slice(s));T(t[s]===e[s]||!l,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "}))}}return kr(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?oC(n,r,X().getBool("DEBUG")):ks(n,[],!0),N.makeTensor(n,e,r)}function te(n,e){if((kr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&kr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ui(n,[],[],e)}function Et(n,e){Ns(n);var t=Vi(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ui(n,null,t,e)}function ki(n,e,t){if(Ns(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Vi(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ui(n,e,r,t)}function mg(n,e,t){if(Ns(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Vi(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ui(n,e,r,t)}function vn(n,e,t){if(Ns(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Vi(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ui(n,e,r,t)}function dV(n,e,t){if(Ns(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Vi(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ui(n,e,r,t)}function hV(n,e,t){if(Ns(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Vi(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Ui(n,e=e||r,r,t)}function fV(n,e,t,r){return e===void 0&&(e=!0),N.makeVariable(n,e,t,r)}function Fs(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Fs(n,"float32"),r=et(n,"float32");return zt(t,r)}var i=sC(le(n),e);return N.makeTensor(i,n,e)}function et(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=et(n,"float32"),r=et(n,"float32");return zt(t,r)}var i=nl(le(n),e);return N.makeTensor(i,n,e)}function Tr(n,e,t){return N.runKernelFunc((function(r){return r.fill(n,e,t)}),{})}function pV(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return N.runKernelFunc((function(r){return r.linspace(n,e,t)}),{})}function rc(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return et([0],r);var i=nl(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return Et(i,r)}var pC=P({onesLike_:function(n){var e=A(n,"x","onesLike");if(e.dtype==="complex64"){var t=pC(Yn(e)),r=Le(Er(e));return zt(t,r)}return N.runKernelFunc((function(i){return i.onesLike(e)}),{$x:e},(function(i,o){return{$x:function(){return Le(i)}}}))}}),Le=P({zerosLike_:function(n){var e=A(n,"x","zerosLike");return N.runKernelFunc((function(t){return t.zerosLike(e)}),{$x:e},(function(t,r){return{$x:function(){return Le(t)}}}))}}),kt=P({concat_:function(n,e){e===void 0&&(e=0),T(n.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=nc(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")})),e=Mt(e,t[0].shape)[0];var r=Ts(t.map((function(a){return a.shape})),e);if(le(r)===0)return Ut([],r);if((t=t.filter((function(a){return a.size>0}))).length===1)return t[0];var i=t.map((function(a){return a.shape}));cV(i,e);var o=t,s={axis:e};return N.runKernelFunc((function(a){return a.concat(t,e)}),o,(function(a){var l=i.map((function(u){return u[e]}));return vg(a,l,e).map((function(u){return function(){return u}}))}),"Concat",s)}}),gV=P({concat1d_:function(n){return kt(n,0)}}),mV=P({concat2d_:function(n,e){return kt(n,e)}}),vV=P({concat3d_:function(n,e){return kt(n,e)}}),yV=P({concat4d_:function(n,e){return kt(n,e)}}),vg=P({split_:function(n,e,t){t===void 0&&(t=0);var r,i=A(n,"x","split");return t=Mt(t,i.shape)[0],typeof e=="number"?(T(i.shape[t]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(i.shape[t]/e)):(T(i.shape[t]===e.reduce((function(o,s){return o+s})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),N.runKernelFunc((function(o){return o.split(i,r,t)}),{$x:i},(function(o){return{$x:function(){return kt(o,t)}}}))}});function Po(n,e){return n(e={exports:{}},e.exports),e.exports}var bV=Po((function(n){(function(e,t,r){function i(a){var l,u=this,c=(l=4022871197,function(d){d=d.toString();for(var h=0;h<d.length;h++){var f=.02519603282416938*(l+=d.charCodeAt(h));f-=l=f>>>0,l=(f*=l)>>>0,l+=4294967296*(f-=l)}return 23283064365386963e-26*(l>>>0)});u.next=function(){var d=2091639*u.s0+23283064365386963e-26*u.c;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=0|d)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(a),u.s0<0&&(u.s0+=1),u.s1-=c(a),u.s1<0&&(u.s1+=1),u.s2-=c(a),u.s2<0&&(u.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function s(a,l){var u=new i(a),c=l&&l.state,d=u.next;return d.int32=function(){return 4294967296*u.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=s:this.alea=s})(0,n)})),xV=Po((function(n){(function(e,t,r){function i(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(0|a)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=0|u.charCodeAt(c),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function s(a,l){var u=new i(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=s:this.xor128=s})(0,n)})),wV=Po((function(n){(function(e,t,r){function i(a){var l=this,u="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^d^d<<1)|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(0|a)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=0|u.charCodeAt(c),c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function s(a,l){var u=new i(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=s:this.xorwow=s})(0,n)})),_V=Po((function(n){(function(e,t,r){function i(a){var l=this;l.next=function(){var u,c,d=l.x,h=l.i;return u=d[h],c=(u^=u>>>7)^u<<24,c^=(u=d[h+1&7])^u>>>10,c^=(u=d[h+3&7])^u>>>3,c^=(u=d[h+4&7])^u<<7,u=d[h+7&7],c^=(u^=u<<13)^u<<9,d[h]=c,l.i=h+1&7,c},(function(u,c){var d,h=[];if(c===(0|c))h[0]=c;else for(c=""+c,d=0;d<c.length;++d)h[7&d]=h[7&d]<<15^c.charCodeAt(d)+h[d+1&7]<<13;for(;h.length<8;)h.push(0);for(d=0;d<8&&h[d]===0;++d);for(d==8?h[7]=-1:h[d],u.x=h,u.i=0,d=256;d>0;--d)u.next()})(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function s(a,l){a==null&&(a=+new Date);var u=new i(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,c&&(c.x&&o(c,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=s:this.xorshift7=s})(0,n)})),CV=Po((function(n){(function(e,t,r){function i(a){var l=this;l.next=function(){var u,c,d=l.w,h=l.X,f=l.i;return l.w=d=d+1640531527|0,c=h[f+34&127],u=h[f=f+1&127],c^=c<<13,u^=u<<17,c^=c>>>15,u^=u>>>12,c=h[f]=c^u,l.i=f,c+(d^d>>>16)|0},(function(u,c){var d,h,f,p,g,m=[],v=128;for(c===(0|c)?(h=c,c=null):(c+="\0",h=0,v=Math.max(v,c.length)),f=0,p=-32;p<v;++p)c&&(h^=c.charCodeAt((p+32)%c.length)),p===0&&(g=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(g=g+1640531527|0,f=(d=m[127&p]^=h+g)==0?f+1:0);for(f>=128&&(m[127&(c&&c.length||0)]=-1),f=127,p=512;p>0;--p)h=m[f+34&127],d=m[f=f+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,m[f]=h^d;u.w=g,u.X=m,u.i=f})(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function s(a,l){a==null&&(a=+new Date);var u=new i(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,c&&(c.X&&o(c,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=s:this.xor4096=s})(0,n)})),EV=Po((function(n){(function(e,t,r){function i(a){var l=this,u="";l.next=function(){var d=l.b,h=l.c,f=l.d,p=l.a;return d=d<<25^d>>>7^h,h=h-f|0,f=f<<24^f>>>8^p,p=p-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-f|0,l.d=f<<16^h>>>16^p,l.a=p-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=0|a):u+=a;for(var c=0;c<u.length+20;c++)l.b^=0|u.charCodeAt(c),l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function s(a,l){var u=new i(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=s:this.tychei=s})(0,n)})),ao=Po((function(n){(function(e,t){var r,i=this,o=256,s=6,a="random",l=t.pow(o,s),u=t.pow(2,52),c=2*u,d=o-1;function h(v,y,b){var x=[],w=g((function E(S,D){var k,M=[],B=typeof S;if(D&&B=="object")for(k in S)try{M.push(E(S[k],D-1))}catch{}return M.length?M:B=="string"?S:S+"\0"})((y=y==1?{entropy:!0}:y||{}).entropy?[v,m(e)]:v??(function(){try{var E;return r&&(E=r.randomBytes)?E=E(o):(E=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(E)),m(E)}catch{var S=i.navigator,D=S&&S.plugins;return[+new Date,i,D,i.screen,m(e)]}})(),3),x),_=new f(x),C=function(){for(var E=_.g(s),S=l,D=0;E<u;)E=(E+D)*o,S*=o,D=_.g(1);for(;E>=c;)E/=2,S/=2,D>>>=1;return(E+D)/S};return C.int32=function(){return 0|_.g(4)},C.quick=function(){return _.g(4)/4294967296},C.double=C,g(m(_.S),e),(y.pass||b||function(E,S,D,k){return k&&(k.S&&p(k,_),E.state=function(){return p(_,{})}),D?(t[a]=E,S):E})(C,w,"global"in y?y.global:this==t,y.state)}function f(v){var y,b=v.length,x=this,w=0,_=x.i=x.j=0,C=x.S=[];for(b||(v=[b++]);w<o;)C[w]=w++;for(w=0;w<o;w++)C[w]=C[_=d&_+v[w%b]+(y=C[w])],C[_]=y;(x.g=function(E){for(var S,D=0,k=x.i,M=x.j,B=x.S;E--;)S=B[k=d&k+1],D=D*o+B[d&(B[k]=B[M=d&M+S])+(B[M]=S)];return x.i=k,x.j=M,D})(o)}function p(v,y){return y.i=v.i,y.j=v.j,y.S=v.S.slice(),y}function g(v,y){for(var b,x=v+"",w=0;w<x.length;)y[d&w]=d&(b^=19*y[d&w])+x.charCodeAt(w++);return m(y)}function m(v){return String.fromCharCode.apply(0,v)}if(t["seed"+a]=h,g(t.random(),e),n.exports){n.exports=h;try{r=require("crypto")}catch{}}})([],Math)}));ao.alea=bV,ao.xor128=xV,ao.xorwow=wV,ao.xorshift7=_V,ao.xor4096=CV,ao.tychei=EV;var $c=ao.alea,yg=(function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=$c(s.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s;while(a>=1||a===0);var l=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*o*l,r=this.mean+this.stdDev*s*l,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n})(),SV=(function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var o=i||Math.random();this.randu=$c(o.toString()),this.randn=new yg(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,o,s;;){do i=this.randn.nextValue(),s=1+this.c*i;while(s<=0);if(s*=s*s,t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-s+Math.log(s)),(o=this.randu())<t||Math.log(o)<r)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n})(),DV=(function(){function n(e,t,r,i){var o=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=$c(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n})();function we(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",aC(n),new La(n,e,t)}function AV(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var gC=P({batchToSpaceND_:function(n,e,t){var r=A(n,"x","batchToSpaceND"),i=e.reduce((function(o,s){return o*s}));return T(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),T(t.length===e.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length})),T(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i})),N.runKernelFunc((function(o){return o.batchToSpaceND(r,e,t)}),{$x:r},(function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}}))}}),kV=P({broadcastTo_:function(n,e){var t=A(n,"broadcastTo","x"),r=t.shape;if(e.some((function(l){return!(l>0)||l%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=Array.from(e),s=e.length-1;s>=0;s--)if(t.shape[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=o.map((function(l,u){return l>1?u:-1})).filter((function(l){return l>=0}));return a.length===0?t.clone():N.runKernelFunc((function(l){return l.tile(t,o)}),{input:t},(function(l){return{input:function(){return l.sum(a,!0)}}}))}}),RV=P({cast_:function(n,e){var t=A(n,"x","cast");if(!wz(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return N.runKernelFunc((function(i){return i.cast(t,e)}),{x:t},(function(i){return{x:function(){return i.clone()}}}),"Cast",r)}}),TV=P({clone_:function(n){var e=A(n,"x","clone",null);return N.runKernelFunc((function(){return N.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{$x:e},(function(t){return{$x:function(){return t.toFloat()}}}))}}),IV=P({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=A(n,"x","cumsum"),o=Fr([e|=0],i.rank),s=i;o!=null&&(s=i.transpose(o));var a=Lr(1,i.rank)[0],l=N.runKernelFunc((function(u){return u.cumsum(s,a,t,r)}),{permutedX:s},(function(u){return{permutedX:function(){return u.cumsum(e,t,!r)}}}));return o!=null&&(l=l.transpose(o)),l}}),MV=P({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=A(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],s=t==="NHWC"?r.shape[3]:r.shape[1];return T(i*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape})),T(o*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape})),T(s%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+r.shape})),N.runKernelFunc((function(a){return a.depthToSpace(r,e,t)}),{$x:r})}}),qn=P({expandDims_:function(n,e){e===void 0&&(e=0);var t=A(n,"x","expandDims",null);T(e<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=t.shape.slice();return e<0&&(T(-(t.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),e=t.rank+e+1),r.splice(e,0,1),or(t,r)}}),mC=P({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=we([n,e],r),o=n<=e?n:e,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(n,e);if(t==null)return a;if(t.length===1)return ps(qn(a,0),[t[0],1,1]);if(t.length===2)return ps(qn(qn(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return ps(qn(qn(qn(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),OV=P({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=A(n,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);t=t||Math.random();var a=s===1?i.as2D(1,-1):i,l=N.runKernelFunc((function(u){return u.multinomial(a,r,e,t)}),{logits2D:a});return s===1?l.as1D():l}}),jf=P({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=A(n,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),N.runKernelFunc((function(s){return s.oneHot(i,e,t,r)}),{$indices:i},(function(s){return{$indices:function(){return et(i.shape,"float32")}}})).reshape(o)}}),No=P({pad_:function(n,e,t){t===void 0&&(t=0);var r=A(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t};return N.runKernelFunc((function(o){return o.pad(r,e,t)}),{x:r},(function(o){var s=e.map((function(a){return a[0]}));return{x:function(){return o.slice(s,r.shape)}}}),"PadV2",i)}}),PV=P({pad1d_:function(n,e,t){return t===void 0&&(t=0),T(e.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),No(n,[e],t)}}),NV=P({pad2d_:function(n,e,t){return t===void 0&&(t=0),T(e.length===2&&e[0].length===2&&e[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),No(n,e,t)}}),FV=P({pad3d_:function(n,e,t){return t===void 0&&(t=0),T(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),No(n,e,t)}}),LV=P({pad4d_:function(n,e,t){return t===void 0&&(t=0),T(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),No(n,e,t)}}),BV=P({rand_:function(n,e,t){var r=le(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return N.makeTensor(i,n,t)}}),HV=P({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new yg(e,t,r,!1,i),s=we(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),WV=P({randomGamma_:function(n,e,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new SV(e,t,r,i),s=we(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),vC=P({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=we(n,r),s=new DV(e,t,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),or=P({reshape_:function(n,e){var t=A(n,"x","reshape",null);e=bz(e,t.size),T(t.size===le(e),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:e};return N.runKernelFunc((function(i){return i.reshape(t,e)}),{x:t},(function(i){return{x:function(){return i.reshape(t.shape)}}}),"Reshape",r)}}),yC=P({spaceToBatchND_:function(n,e,t){var r=A(n,"x","spaceToBatchND");return T(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),T(t.length===e.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length})),T(r.shape.reduce((function(i,o,s){return s>0&&s<=e.length?i&&(o+t[s-1][0]+t[s-1][1])%e[s-1]==0:i}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()})),N.runKernelFunc((function(i){return i.spaceToBatchND(r,e,t)}),{$x:r},(function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}}))}}),bC=P({squeeze_:function(n,e){var t=A(n,"x","squeeze");return or(t,co(t.shape,e).newShape)}}),Vn=P({stack_:function(n,e){e===void 0&&(e=0);var t=nc(n,"tensors","stack");if(T(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;T(e<=r,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(a){je(i,a.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(a){T(o===a.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var s=t.map((function(a){return a.expandDims(e)}));return kt(s,e)}}),ps=P({tile_:function(n,e){var t=A(n,"x","tile",null);T(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}));var r=[t],i={reps:e};return N.runKernelFunc((function(o,s){var a=o.tile(t,e);return s([t]),a}),{x:t},(function(o,s){var a=s[0];return{x:function(){var l=Le(a);if(a.rank===1)for(var u=0;u<e[0];++u)l=l.add(o.slice([u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(u=0;u<e[0];++u)for(var c=0;c<e[1];++c)l=l.add(o.slice([u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(u=0;u<e[0];++u)for(c=0;c<e[1];++c)for(var d=0;d<e[2];++d)l=l.add(o.slice([u*a.shape[0],c*a.shape[1],d*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(u=0;u<e[0];++u)for(c=0;c<e[1];++c)for(d=0;d<e[2];++d)for(var h=0;h<e[3];++h)l=l.add(o.slice([u*a.shape[0],c*a.shape[1],d*a.shape[2],h*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return l}}}),"Tile",i,r)}}),zV=P({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new yg(e,t,r,!0,i),s=we(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),Rt=P({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=A(n,"x","unstack");T(e>=-t.shape.length&&e<t.shape.length,(function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),e<0&&(e+=t.shape.length);var r={axis:e};return N.runKernelFunc((function(i){return i.unstack(t,e)}),{x:t},(function(i){return{x:function(){return Vn(i,e)}}}),"Unpack",r)}}),VV=function(n,e){return oe(this,void 0,void 0,(function(){var t,r,i,o,s,a,l,u,c,d;return se(this,(function(h){switch(h.label){case 0:return t=A(n,"x","setdiff1d"),r=A(e,"y","setdiff1d"),T(t.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."})),T(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),T(r.rank===1,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,t.data()];case 1:return i=h.sent(),[4,r.data()];case 2:for(o=h.sent(),s=new Set(o),a=0,c=0;c<i.length;c++)s.has(i[c])||a++;for(l=new La([a],t.dtype),u=new La([a],"int32"),c=0,d=0;c<i.length;c++)s.has(i[c])||(l.values[d]=i[c],u.values[d]=c,d++);return[2,[l.toTensor(),u.toTensor()]]}}))}))};function ic(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,s=0;s<o;++s)i=i.concat([n[s+1]/e[s],e[s]]);i=i.concat(n.slice(o+1))}return i}function oc(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function sc(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function xC(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function wC(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function _C(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var s=n.shape,a=t.slice();a.pop();var l=1;for(o=r;o<n.rank;++o)l*=s[o],a.push(s[o]);var u=Rr(n.shape).map((function(c){return c/l})).concat([1]).slice(0,r);return[a,i,l,u]}var CC=30;function Ch(n){return n<=CC?n:Bf(n,Math.floor(Math.sqrt(n)))}function UV(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var s=0;s<i;++s)if(t.shape[s]!==e.shape[s])throw new Error(o+" updates.shape["+s+"] ("+t.shape[s]+") != indices.shape["+s+"] ("+e.shape[s]+").");for(s=0;s<t.rank-i;++s)if(t.shape[s+i]!==n[s+r])throw new Error(o+" updates.shape["+(s+i)+"] ("+t.shape[s+i]+") != shape["+(s+i)+"] ("+n[s+i]+")")}function jV(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}UV(t,e,n)}function ac(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=t.length,s=1,a=i;a<o;++a)s*=t[a];var l=i<1?1:i;return{sliceRank:i,numUpdates:le(e.shape)/l,sliceSize:s,strides:Rr(t.slice(0,i)).concat([1]),outputSize:le(t)}}function $V(n,e,t){T(n.rank===e.length,(function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."})),T(n.rank===t.length,(function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."}));for(var r=function(o){T(e[o]+t[o]<=n.shape[o],(function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"}))},i=0;i<n.rank;++i)r(i)}function g0(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function bg(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function GV(n,e,t,r,i){var o=e[i],s=t[i]||1;(n&1<<i||o==null)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=Nf(0,o,a-1)}function qV(n,e,t,r,i){var o=e[i],s=t[i]||1;(n&1<<i||o==null)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=s>0?Nf(0,o,a):Nf(-1,o,a-1)}function EC(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function SC(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function YV(n,e){T(Lf(n),(function(){return"The f passed in variableGrads(f) must be a function"})),T(e==null||Array.isArray(e)&&e.every((function(c){return c instanceof Rs})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=e!=null;if(!t)for(var r in e=[],N.registeredVariables)e.push(N.registeredVariables[r]);var i=t?e.filter((function(c){return!c.trainable})):null,o=e.length;T((e=e.filter((function(c){return c.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."}));var s=N.gradients(n,e,null,!0),a=s.value,l=s.grads;T(l.some((function(c){return c!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),T(a.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"}));var u={};return e.forEach((function(c,d){l[d]!=null&&(u[c.name]=l[d])})),i?.forEach((function(c){return u[c.name]=null})),{value:a,grads:u}}function Gc(n){return N.customGrad(n)}var ii=P({softmax_:function(n,e){e===void 0&&(e=-1);var t=A(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return N.runKernelFunc((function(r,i){var o=r.softmax(t,e);return i([o]),o}),{logits:t},(function(r,i){var o=i[0],s=r.mul(o);return{logits:function(){return s.sub(s.sum([e],!0).mul(o))}}}),"Softmax",{dim:e},[],[!0])}}),XV=P({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=A(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Gc((function(r,i){var o=r.max(e,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(e,!0).log());return i([a]),{value:a,gradFunc:function(l,u){var c=u[0].exp();return l.sub(l.sum(e,!0).mul(c))}}}))(t)}}),DC=(function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n})(),AC=(function(){function n(){}return n.prototype.time=function(e){return z("time")},n.prototype.read=function(e){return z("read")},n.prototype.readSync=function(e){return z("readSync")},n.prototype.numDataIds=function(){return z("numDataIds")},n.prototype.disposeData=function(e){return z("disposeData")},n.prototype.write=function(e,t,r){return z("write")},n.prototype.move=function(e,t,r,i){return z("move")},n.prototype.memory=function(){return z("memory")},n.prototype.floatPrecision=function(){return z("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return z("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,z("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return z("slice")},n.prototype.stridedSlice=function(e,t,r,i){return z("stridedSlice")},n.prototype.unstack=function(e,t){return z("unstack")},n.prototype.reverse=function(e,t){return z("reverse")},n.prototype.concat=function(e,t){return z("concat")},n.prototype.neg=function(e){return z("neg")},n.prototype.add=function(e,t){return z("add")},n.prototype.addN=function(e){return z("addN")},n.prototype.subtract=function(e,t){return z("subtract")},n.prototype.multiply=function(e,t){return z("multiply")},n.prototype.realDivide=function(e,t){return z("realDivide")},n.prototype.floorDiv=function(e,t){return z("floorDiv")},n.prototype.sum=function(e,t){return z("sum")},n.prototype.prod=function(e,t){return z("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return z("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return z("argMin")},n.prototype.argMax=function(e,t){return z("argMax")},n.prototype.equal=function(e,t){return z("equal")},n.prototype.notEqual=function(e,t){return z("notEqual")},n.prototype.less=function(e,t){return z("less")},n.prototype.lessEqual=function(e,t){return z("lessEqual")},n.prototype.greater=function(e,t){return z("greater")},n.prototype.greaterEqual=function(e,t){return z("greaterEqual")},n.prototype.logicalNot=function(e){return z("logicalNot")},n.prototype.logicalAnd=function(e,t){return z("logicalAnd")},n.prototype.logicalOr=function(e,t){return z("logicalOr")},n.prototype.where=function(e){return z("where")},n.prototype.select=function(e,t,r){return z("select")},n.prototype.topk=function(e,t,r){return z("topk")},n.prototype.min=function(e,t){return z("min")},n.prototype.minimum=function(e,t){return z("minimum")},n.prototype.mod=function(e,t){return z("mod")},n.prototype.max=function(e,t){return z("max")},n.prototype.maximum=function(e,t){return z("maximum")},n.prototype.all=function(e,t){return z("all")},n.prototype.any=function(e,t){return z("any")},n.prototype.squaredDifference=function(e,t){return z("squaredDifference")},n.prototype.ceil=function(e){return z("ceil")},n.prototype.floor=function(e){return z("floor")},n.prototype.round=function(e){return z("round")},n.prototype.sign=function(e){return z("sign")},n.prototype.isNaN=function(e){return z("isNaN")},n.prototype.isInf=function(e){return z("isInf")},n.prototype.isFinite=function(e){return z("isFinite")},n.prototype.pow=function(e,t){return z("pow")},n.prototype.exp=function(e){return z("exp")},n.prototype.expm1=function(e){return z("expm1")},n.prototype.softmax=function(e,t){return z("softmax")},n.prototype.log=function(e){return z("log")},n.prototype.log1p=function(e){return z("log1p")},n.prototype.sqrt=function(e){return z("sqrt")},n.prototype.rsqrt=function(e){return z("rsqrt")},n.prototype.square=function(e){return z("square")},n.prototype.reciprocal=function(e){return z("reciprocal")},n.prototype.relu=function(e){return z("relu")},n.prototype.relu6=function(e){return z("relu6")},n.prototype.prelu=function(e,t){return z("prelu")},n.prototype.elu=function(e){return z("elu")},n.prototype.eluDer=function(e,t){return z("eluDer")},n.prototype.selu=function(e){return z("selu")},n.prototype.int=function(e){return z("int")},n.prototype.clip=function(e,t,r){return z("clip")},n.prototype.abs=function(e){return z("abs")},n.prototype.complexAbs=function(e){return z("complexAbs")},n.prototype.sigmoid=function(e){return z("sigmoid")},n.prototype.softplus=function(e){return z("softplus")},n.prototype.sin=function(e){return z("sin")},n.prototype.cos=function(e){return z("cos")},n.prototype.tan=function(e){return z("tan")},n.prototype.asin=function(e){return z("asin")},n.prototype.acos=function(e){return z("acos")},n.prototype.atan=function(e){return z("atan")},n.prototype.atan2=function(e,t){return z("atan2")},n.prototype.sinh=function(e){return z("sinh")},n.prototype.cosh=function(e){return z("cosh")},n.prototype.tanh=function(e){return z("tanh")},n.prototype.asinh=function(e){return z("asinh")},n.prototype.acosh=function(e){return z("acosh")},n.prototype.atanh=function(e){return z("atanh")},n.prototype.erf=function(e){return z("erf")},n.prototype.step=function(e,t){return z("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,z("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return z("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return z("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return z("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,z("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return z("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return z("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return z("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return z("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return z("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return z("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return z("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return z("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return z("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return z("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return z("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return z("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return z("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return z("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return z("reshape")},n.prototype.cast=function(e,t){return z("cast")},n.prototype.tile=function(e,t){return z("tile")},n.prototype.pad=function(e,t,r){return z("pad")},n.prototype.transpose=function(e,t){return z("transpose")},n.prototype.gather=function(e,t,r){return z("gather")},n.prototype.gatherND=function(e,t){return z("gatherND")},n.prototype.scatterND=function(e,t,r){return z("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return z("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return z("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return z("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return z("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return z("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return z("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,o,s){return z("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){return z("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,o,s,a){return z("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return z("multinomial")},n.prototype.oneHot=function(e,t,r,i){return z("oneHot")},n.prototype.cumsum=function(e,t,r,i){return z("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return z("nonMaxSuppression")},n.prototype.fft=function(e){return z("fft")},n.prototype.ifft=function(e){return z("ifft")},n.prototype.complex=function(e,t){return z("complex")},n.prototype.real=function(e){return z("real")},n.prototype.imag=function(e){return z("imag")},n.prototype.cropAndResize=function(e,t,r,i,o,s){return z("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return z("depthToSpace")},n.prototype.split=function(e,t,r){return z("split")},n.prototype.sparseToDense=function(e,t,r,i){return z("sparseToDense")},n.prototype.diag=function(e){return z("diag")},n.prototype.fill=function(e,t,r){return z("fill")},n.prototype.onesLike=function(e){return z("onesLike")},n.prototype.zerosLike=function(e){return z("zerosLike")},n.prototype.linspace=function(e,t,r){return z("linspace")},n.prototype.dispose=function(){return z("dispose")},n})();function z(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ei(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i,s=n[o]||1;(e[e.length-1-i]||1)>1&&s===1&&r.unshift(o)}return r}function Tt(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1,s=e[o];(i==null||i===1&&s>1)&&t.unshift(o)}return t}function Oe(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];o==null&&(o=1);var s=e[e.length-i-1];if(s==null&&(s=1),o===1)t.unshift(s);else if(s===1)t.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}function Ha(n,e,t,r,i,o,s){s===void 0&&(s="channelsLast");var a,l=cc(e),u=l[0],c=l[1];if(s==="channelsLast")a=[u,c,n[3],n[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);a=[u,c,n[1],n[1]]}return Fo(n,a,t,r,i,o,!1,s)}function lc(n,e,t,r,i,o,s){s===void 0&&(s="NDHWC");var a,l,u=$f(e),c=u[0],d=u[1],h=u[2];if(s==="NDHWC")l="channelsLast",a=[c,d,h,n[4],n[4]];else{if(s!=="NCDHW")throw new Error("Unknown dataFormat "+s);l="channelsFirst",a=[c,d,h,n[1],n[1]]}return uc(n,a,t,r,i,!1,l,o)}function Fo(n,e,t,r,i,o,s,a){s===void 0&&(s=!1),a===void 0&&(a="channelsLast");var l=[-1,-1,-1,-1],u=l[0],c=l[1],d=l[2],h=l[3];if(a==="channelsLast")u=n[0],c=n[1],d=n[2],h=n[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);u=n[0],h=n[1],c=n[2],d=n[3]}var f,p=e[0],g=e[1],m=e[3],v=cc(t),y=v[0],b=v[1],x=cc(r),w=x[0],_=x[1],C=gs(p,w),E=gs(g,_),S=(function(H,F,W,j,U,q,K,J){var ee,re,fe;if(typeof H=="number"){ee={top:H,bottom:H,left:H,right:H,type:H===0?"VALID":"NUMBER"};var pe=(function(Re,Be,He,rt,Ke){rt==null&&(rt=kC(Re,Be,He));var Ze=Re[0],Dn=Re[1],An=ya((Ze-Be+2*rt)/He+1,Ke);T(wt(An),(function(){return"The output # of rows ("+An+") must be an integer. Change the stride and/or zero pad parameters"}));var Ot=ya((Dn-Be+2*rt)/He+1,Ke);return T(wt(Ot),(function(){return"The output # of columns ("+Ot+") must be an integer. Change the stride and/or zero pad parameters"})),[An,Ot]})([F,W],q,j,H,J);re=pe[0],fe=pe[1]}else if(H==="same"){re=Math.ceil(F/j),fe=Math.ceil(W/U);var ve=Math.max(0,(re-1)*j+q-F),Ae=Math.max(0,(fe-1)*U+K-W),Ce=Math.floor(ve/2),ke=ve-Ce,dt=Math.floor(Ae/2);ee={top:Ce,bottom:ke,left:dt,right:Ae-dt,type:"SAME"}}else{if(H!=="valid")throw Error("Unknown padding parameter: "+H);ee={top:0,bottom:0,left:0,right:0,type:"VALID"},re=Math.ceil((F-q+1)/j),fe=Math.ceil((W-K+1)/U)}return{padInfo:ee,outHeight:re,outWidth:fe}})(i,c,d,y,b,C,E,o),D=S.padInfo,k=S.outHeight,M=S.outWidth,B=s?m*h:m;return a==="channelsFirst"?f=[u,B,k,M]:a==="channelsLast"&&(f=[u,k,M,B]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:d,inChannels:h,outHeight:k,outWidth:M,outChannels:B,padInfo:D,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:E,dilationHeight:w,dilationWidth:_,inShape:n,outShape:f,filterShape:e}}function uc(n,e,t,r,i,o,s,a){o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=[-1,-1,-1,-1,-1],u=l[0],c=l[1],d=l[2],h=l[3],f=l[4];if(s==="channelsLast")u=n[0],c=n[1],d=n[2],h=n[3],f=n[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);u=n[0],f=n[1],c=n[2],d=n[3],h=n[4]}var p,g=e[0],m=e[1],v=e[2],y=e[4],b=$f(t),x=b[0],w=b[1],_=b[2],C=$f(r),E=C[0],S=C[1],D=C[2],k=gs(g,E),M=gs(m,S),B=gs(v,D),H=(function(K,J,ee,re,fe,pe,ve,Ae,Ce,ke,dt){var Re,Be,He,rt;if(typeof K=="number"){Re={top:K,bottom:K,left:K,right:K,front:K,back:K,type:K===0?"VALID":"NUMBER"};var Ke=(function(Br,hn,Ls,Hr,Un,Ho){Un==null&&(Un=kC(Br,hn,Hr));var ad=Br[0],ld=Br[1],dl=Br[2],Bs=ya((ad-hn+2*Un)/Hr+1,Ho);T(wt(Bs),(function(){return"The output # of depths ("+Bs+") must be an integer. Change the stride and/or zero pad parameters"}));var Hs=ya((ld-hn+2*Un)/Hr+1,Ho);T(wt(Hs),(function(){return"The output # of rows ("+Hs+") must be an integer. Change the stride and/or zero pad parameters"}));var qe=ya((dl-hn+2*Un)/Hr+1,Ho);return T(wt(qe),(function(){return"The output # of columns ("+qe+") must be an integer. Change the stride and/or zero pad parameters"})),[Bs,Hs,qe,Ls]})([J,ee,re,1],Ae,1,fe,K,dt);Be=Ke[0],He=Ke[1],rt=Ke[2]}else if(K==="same"){Be=Math.ceil(J/fe),He=Math.ceil(ee/pe),rt=Math.ceil(re/ve);var Ze=(Be-1)*fe+Ae-J,Dn=(He-1)*pe+Ce-ee,An=(rt-1)*ve+ke-re,Ot=Math.floor(Ze/2),ui=Ze-Ot,Qn=Math.floor(Dn/2),Jn=Dn-Qn,kn=Math.floor(An/2);Re={top:Qn,bottom:Jn,left:kn,right:An-kn,front:Ot,back:ui,type:"SAME"}}else{if(K!=="valid")throw Error("Unknown padding parameter: "+K);Re={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Be=Math.ceil((J-Ae+1)/fe),He=Math.ceil((ee-Ce+1)/pe),rt=Math.ceil((re-ke+1)/ve)}return{padInfo:Re,outDepth:Be,outHeight:He,outWidth:rt}})(i,c,d,h,x,w,_,k,M,B,a),F=H.padInfo,W=H.outDepth,j=H.outHeight,U=H.outWidth,q=o?y*f:y;return s==="channelsFirst"?p=[u,q,W,j,U]:s==="channelsLast"&&(p=[u,W,j,U,q]),{batchSize:u,dataFormat:s,inDepth:c,inHeight:d,inWidth:h,inChannels:f,outDepth:W,outHeight:j,outWidth:U,outChannels:q,padInfo:F,strideDepth:x,strideHeight:w,strideWidth:_,filterDepth:g,filterHeight:m,filterWidth:v,effectiveFilterDepth:k,effectiveFilterHeight:M,effectiveFilterWidth:B,dilationDepth:E,dilationHeight:S,dilationWidth:D,inShape:n,outShape:p,filterShape:e}}function kC(n,e,t,r){r===void 0&&(r=1);var i=gs(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function cc(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function $f(n){return typeof n=="number"?[n,n,n]:n}function gs(n,e){return e<=1?n:n+(n-1)*(e-1)}function ya(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function Is(n){var e=cc(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function Sn(n,e){return Is(n)||Is(e)}function xg(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function RC(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=et(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!_z(n.dtype,e))return N.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var s=t.real(n);return o=s.cast(e),s.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var a=te(0,n.dtype);return o=t.notEqual(n,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function Gf(n,e){return N.makeTensorFromDataId(n.dataId,e,n.dtype)}function TC(n,e,t){var r=(e-n)/(t-1),i=nl(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Et(i,"float32")}function qf(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function m0(n,e){return{real:n[2*e],imag:n[2*e+1]}}function KV(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function QV(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function JV(n,e,t){var r=(function(o,s,a){return(function(l,u,c){for(var d=0,h=l.length,f=0,p=!1;d<h;){var g=c(u,l[f=d+(h-d>>>1)]);g>0?d=f+1:(h=f,p=!g)}return p?d:-d-1})(o,s,a||ZV)})(n,e,t),i=r<0?-(r+1):r;n.splice(i,0,e)}function ZV(n,e){return n>e?1:n<e?-1:0}function wg(n,e,t,r,i){return IC(n,e,t,r,i,0).selectedIndices}function _g(n,e,t,r,i,o){var s=IC(n,e,t,r,i,o);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function IC(n,e,t,r,i,o,s,a){a===void 0&&(a=!1);for(var l=Array.from(e).map((function(x,w){return{score:x,boxIndex:w,suppressBeginIndex:0}})).filter((function(x){return x.score>i})).sort(v0),u=o>0?-.5/o:0,c=[],d=[];c.length<t&&l.length>0;){var h=l.pop(),f=h.score,p=h.boxIndex,g=h.suppressBeginIndex;if(f<i)break;for(var m=!1,v=c.length-1;v>=g;--v){var y=eU(n,p,c[v]);if(y>=r){m=!0;break}if(h.score=h.score*tU(r,u,y),h.score<=i)break}h.suppressBeginIndex=c.length,m||(h.score===f?(c.push(p),d.push(h.score)):h.score>i&&JV(l,h,v0))}var b=c.length;return a&&(c.fill(0,b),d.fill(0,b)),{selectedIndices:Et(c,"int32"),selectedScores:Et(d,"float32"),numValidOutputs:te(b,"int32")}}function eU(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(a-o)*(l-s),p=(d-u)*(h-c);if(f<=0||p<=0)return 0;var g=Math.max(o,u),m=Math.max(s,c),v=Math.min(a,d),y=Math.min(l,h),b=Math.max(v-g,0)*Math.max(y-m,0);return b/(f+p-b)}function tU(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function v0(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function MC(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map((function(o){i[t]=o;var s=n.slice(r,i);return r[t]+=o,s}))}function OC(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=we(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(n.rank),a=0;a<s.length;a++)s[a]=o[a]%n.shape[a];var l=n.locToIndex(s);i.values[r]=n.values[l]}return i.toTensor()}function PC(n,e,t,r,i){for(var o=e[e.length-1],s=[n.length/o,o],a=s[0],l=s[1],u=Fa(t,a*r),c=Fa("int32",a*r),d=0;d<a;d++){for(var h=d*l,f=n.subarray(h,h+l),p=[],g=0;g<f.length;g++)p.push({value:f[g],index:g});p.sort((function(x,w){return w.value-x.value}));var m=d*r,v=u.subarray(m,m+r),y=c.subarray(m,m+r);for(g=0;g<r;g++)v[g]=p[g].value,y[g]=p[g].index}var b=e.slice();return b[b.length-1]=r,[Ut(u,b,t),Ut(c,b,"int32")]}function Cg(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=we(n,"int32"),o=we([t.length,n.length],"int32");for(r=0;r<t.length;r++){var s=i.indexToLoc(t[r]),a=r*n.length;o.values.set(s,a)}return o.toTensor()}var nU=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((function(i,o){return"T"+o}));var t=[];this.variableNames.forEach((function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")}));var r=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},rU=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((function(i,o){return"T"+o}));var t=[];this.variableNames.forEach((function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")}));var r=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},iU=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,o=n.inSize,s=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];var a=e==="max"?">":"<",l=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+l+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function NC(n,e){return["x","y","z","w","u","v"].slice(0,e).map((function(t){return n+"."+t}))}function bn(n,e){return e===1?[n]:NC(n,e)}function Qt(){var n,e,t,r,i,o,s,a,l,u;return X().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}function fo(n,e,t){t===void 0&&(t="index");var r=Rr(e);return r.map((function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"})).join("")}function Eg(n){var e=Rr(n).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var FC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function oU(n,e,t,r){var i=[];n.forEach((function(f){var p=le(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?i.push("uniform float "+f.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+f.name+";"),i.push("uniform int offset"+f.name+";"))}));var o,s,a=i.join(`
`),l=n.map((function(f){return(function(p,g,m){m===void 0&&(m=!1);var v="";v+=m?LC(p):Qo(p);var y=p.shapeInfo.logicalShape,b=g.logicalShape;return y.length<=b.length&&(v+=m?(function(x,w){var _,C=x.name,E=C.charAt(0).toUpperCase()+C.slice(1),S="get"+E+"AtOutCoords",D=x.shapeInfo.logicalShape.length,k=w.logicalShape.length,M=Ei(x.shapeInfo.logicalShape,w.logicalShape),B=Je(k),H=k-D,F=["x","y","z","w","u","v"];_=D===0?"":k<2&&M.length>=1?"coords = 0;":M.map((function(ee){return"coords."+F[ee+H]+" = 0;"})).join(`
`);var W="";W=k<2&&D>0?"coords":x.shapeInfo.logicalShape.map((function(ee,re){return"coords."+F[re+H]})).join(", ");var j="return outputValue;",U=le(x.shapeInfo.logicalShape)===1,q=le(w.logicalShape)===1;if(D!==1||U||q){if(U&&!q)j=k===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(M.length){var K=D-2,J=D-1;M.indexOf(K)>-1&&M.indexOf(J)>-1?j="return vec4(outputValue.x);":M.indexOf(K)>-1?j="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":M.indexOf(J)>-1&&(j="return vec4(outputValue.xx, outputValue.zz);")}}else j=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+S+`() {
      `+B+` coords = getOutputCoords();
      `+_+`
      vec4 outputValue = get`+E+"("+W+`);
      `+j+`
    }
  `})(p,g):(function(x,w){var _=x.name,C=_.charAt(0).toUpperCase()+_.slice(1),E="get"+C+"AtOutCoords",S=w.texShape,D=x.shapeInfo.texShape,k=x.shapeInfo.logicalShape.length,M=w.logicalShape.length;if(!x.shapeInfo.isUniform&&k===M&&x.shapeInfo.flatOffset==null&&Lt(D,S))return`
      float `+E+`() {
        return sampleTexture(`+_+`, resultUV);
      }
    `;var B,H=Je(M),F=Ei(x.shapeInfo.logicalShape,w.logicalShape),W=M-k,j=["x","y","z","w","u","v"];B=k===0?"":M<2&&F.length>=1?"coords = 0;":F.map((function(q){return"coords."+j[q+W]+" = 0;"})).join(`
`);var U="";return U=M<2&&k>0?"coords":x.shapeInfo.logicalShape.map((function(q,K){return"coords."+j[K+W]})).join(", "),`
    float `+E+`() {
      `+H+` coords = getOutputCoords();
      `+B+`
      return get`+C+"("+U+`);
    }
  `})(p,g)),v})(f,e,r)})).join(`
`),u=e.texShape,c=Qt(),d=(function(f){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+f.texture2D+`(textureSampler, uv).r;
    }
  `})(c),h=(function(f){return f.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+f.varyingFs+` vec2 resultUV;
    `+f.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+f.defineSpecialNaN+`
    `+f.defineSpecialInf+`
    `+f.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+sU+`
    `+aU+`
    `+lU+`
  `})(c);return e.isPacked?(o=(function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(x,w){var _=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];return _[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return 2 * (resTexRC.x * `+_[1]+` + resTexRC.y);
    }
  `})(0,p);case 2:return(function(x,w){var _=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];if(Lt(x,w))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `;var C=Math.ceil(x[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec2(r, c);
    }
  `})(f,p);case 3:return g=f,m=p,v=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],y=Math.ceil(g[2]/2),b=y*Math.ceil(g[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+b+`;
      index -= b * `+b+`;

      int r = 2 * (index / `+y+`);
      int c = imod(index, `+y+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(x,w){for(var _=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)],C=Math.ceil(x[x.length-1]/2),E=C*Math.ceil(x[x.length-2]/2),S=E,D="",k="b, r, c",M=2;M<x.length-1;M++)S*=x[x.length-M-1],D=`
      int b`+M+" = index / "+S+`;
      index -= b`+M+" * "+S+`;
    `+D,k="b"+M+", "+k;return`
    ivec`+x.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+D+`

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec`+x.length+"("+k+`);
    }
  `})(f,p)}var g,m,v,y,b})(e.logicalShape,u),s=(function(f){return`
    void setOutput(vec4 val) {
      `+f.output+` = val;
    }
  `})(c)):(o=(function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(v,y){return y[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+y[1]+`.0);
      }
    `:y[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+y[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      return resTexRC.x * `+y[1]+` + resTexRC.y;
    }
  `})(0,p);case 2:return(function(v,y){return Lt(v,y)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+y[0]+", "+y[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `})(f,p);case 3:return g=p,m=fo(["r","c","d"],f),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;
      `+m+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(v,y){var b=fo(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      `+b+`
      return ivec4(r, c, d, d2);
    }
  `})(f,p);case 5:return(function(v,y){var b=fo(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+y[0]+`,
                             `+y[1]+`));

      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+b+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(f,p);case 6:return(function(v,y){var b=fo(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+b+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(f,p);default:throw new Error(f.length+"-D output sampling is not yet supported")}var g,m})(e.logicalShape,u),s=(function(f){return`
    void setOutput(float val) {
      `+f.output+` = vec4(val, 0, 0, 0);
    }
  `})(c)),r&&(h+=uU),[h,d,s,a,o,l,t].join(`
`)}function Qo(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape,s=o[0],a=o[1];if(s===1&&a===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var l=t.shapeInfo.texShape,u=l[0],c=l[1],d=to(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+u+", "+c+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 1:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Go(t)+`
      }
    `;var o=t.shapeInfo.texShape,s=o[0],a=o[1];if(a===1&&s===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var l=to(r);return a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+l+") + 0.5) / "+s+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+l+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+a+", index + "+l+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 2:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(s!=null&&Lt(r,s)){var a=s[0],l=s[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+a+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var u=co(r),c=u.newShape,d=u.keptDims,h=c;if(h.length<r.length){var f=Jo(t,h);return`
      `+Qo(f)+`
      float `+o+`(int row, int col) {
        return `+o+"("+Zo(["row","col"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Go(t)+`
      }
    `;var p=s[0],g=s[1],m=to(i);return g===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:p===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+g+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+m+`;
    vec2 uv = uvFromFlat(`+p+", "+g+`, index);
    return sampleTexture(`+i+`, uv);
  }
`})(n);case 3:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],l=co(r),u=l.newShape,c=l.keptDims,d=u;if(d.length<r.length){var h=Jo(t,d);return`
        `+Qo(h)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+Zo(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+a+`, 1)));
        `+Go(t)+`
      }
    `;var f=t.shapeInfo.texShape,p=f[0],g=f[1],m=t.shapeInfo.flatOffset;if(g===s&&m==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+g+".0, "+p+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(g===a&&m==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+".0, "+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var v=to(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+a+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+p+", "+g+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `})(n);case 4:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,l=r[1]*a,u=co(r),c=u.newShape,d=u.keptDims;if(c.length<r.length){var h=Jo(t,c);return`
      `+Qo(h)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+Zo(["row","col","depth","depth2"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+a+", "+s+`, 1)));
        `+Go(t)+`
      }
    `;var f=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,g=p[0],m=p[1];if(m===l&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(m===s&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var v=to(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+a+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+g+", "+m+", index + "+v+`);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 5:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,l=r[2]*a,u=r[1]*l,c=co(r),d=c.newShape,h=c.keptDims;if(d.length<r.length){var f=Jo(t,d);return`
      `+Qo(f)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+Zo(["row","col","depth","depth2","depth3"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+u+", "+l+", "+a+", "+s+`)) +
          depth3;
        `+Go(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,m=g[0],v=g[1];if(v===u&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+l+", "+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===s&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=to(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+l+" + depth * "+a+` +
          depth2 * `+s+" + depth3 + "+y+`;
      vec2 uv = uvFromFlat(`+m+", "+v+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 6:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=co(r),a=s.newShape,l=s.keptDims;if(a.length<r.length){var u=Jo(t,a);return`
      `+Qo(u)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+Zo(["row","col","depth","depth2","depth3","depth4"],l)+`);
      }
    `}var c=r[5],d=r[4]*c,h=r[3]*d,f=r[2]*h,p=r[1]*f;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+f+", "+h+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Go(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,v=m[0],y=m[1];if(y===p&&g==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+h+", "+d+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===c&&g==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var b=to(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+f+" + depth * "+h+` +
          depth2 * `+d+" + depth3 * "+c+" + depth4 + "+b+`;
      vec2 uv = uvFromFlat(`+v+", "+y+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function LC(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Qt(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(i){var o=i.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=Qt();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+l[0]+", "+l[1]+`, index);
      return `+u.texture2D+"("+o+`, uv);
    }
  `})(n);case 2:return(function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,u=l[0],c=l[1],d=Qt();if(l!=null&&Lt(o,l))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+u+`.0);

        return `+d.texture2D+"("+s+`, uv);
      }
    `;var h=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],f=Math.ceil(o[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+f+", "+h[0]+", "+h[1]+`, row, col);
      return `+d.texture2D+"("+s+`, uv);
    }
  `})(n);case 3:return(function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,u=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];if(o[0]===1){var c=o.slice(1),d=Jo(i,c);return`
        `+LC(d)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+Zo(["b","row","col"],[1,2])+`);
        }
      `}var h=u[0],f=u[1],p=Math.ceil(o[2]/2),g=p*Math.ceil(o[1]/2),m=Qt();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+h+", "+f+", "+g+", "+p+`, b, row, col);
      return `+m.texture2D+"("+s+`, uv);
    }
  `})(n);default:return(function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,l="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=c[0],h=c[1],f=Math.ceil(o[s-1]/2),p=f*Math.ceil(o[s-2]/2),g="int b, int row, int col",m="b * "+p+" + (row / 2) * "+f+" + (col / 2)",v=2;v<s-1;v++)g="int b"+v+", "+g,p*=o[s-v-1],m="b"+v+" * "+p+" + "+m;var y=Qt();return`
    vec4 `+l+"("+g+`) {
      int index = `+m+`;
      int texR = index / `+h+`;
      int texC = index - texR * `+h+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+h+", "+d+`);
      return `+y.texture2D+"("+a+`, uv);
    }
  `})(n)}}var sU=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,aU=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,lU=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,uU=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function to(n){return"offset"+n}function Go(n){var e=n.name,t=le(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Je(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Jo(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Zo(n,e){return e.map((function(t){return n[t]})).join(", ")}var cU=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(n.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var i=n[n.length-1],o=Math.ceil(i/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,l=this.outputShape,u=l.length,c=Je(u),d=bn("coords",u);if(o===1){var h=Je(a=u+1);s=`
        `+h+" sourceLocR = "+h+"("+d.join()+`, 0);
        ++`+d[u-1]+`;
        `+h+" sourceLocG = "+h+"("+d.join()+`, 0);
        ++`+d[u-2]+`;
        `+h+" sourceLocA = "+h+"("+d.join()+`, 0);
        --`+d[u-1]+`;
        `+h+" sourceLocB = "+h+"("+d.join()+`, 0);
        --`+d[u-2]+";"}else a=u,s=`
        `+c+` sourceLocR = coords;
        ++`+d[u-1]+`;
        `+c+` sourceLocG = coords;
        ++`+d[u-2]+`;
        `+c+` sourceLocA = coords;
        --`+d[u-1]+`;
        `+c+` sourceLocB = coords;
        --`+d[u-2]+";";var f=["x","y","z","w","u","v"].slice(0,a),p="."+f[a-1],g=f.map((function(E){return"int "+E})),m=bn("sourceLocR",a-1).concat("inIdx.r"),v=bn("sourceLocG",a-1).concat("inIdx.g"),y=bn("sourceLocB",a-1).concat("inIdx.b"),b=bn("sourceLocA",a-1).concat("inIdx.a"),x=t==="max"?"greaterThan":"lessThan",w=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+b.join()+")));",_=`vec4(
            getAChannel(`+m.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+b.join()+") : 0.)",C=r?"":`
      float getBestIndicesAChannel(`+g.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+g.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+C+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+d[u-1]+" < "+(l[u-1]-1)+`;
        bool hasNextRow = `+d[u-2]+" < "+(l[u-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+_+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+w+`
          vec4 candidate = `+_+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+x+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},dU=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,s=n.dilationWidth,a=n.effectiveFilterHeight,l=n.effectiveFilterWidth,u=a-1-n.padInfo.top,c=l-1-n.padInfo.left,d=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+u+", "+c+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},hU=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterDepth,d=n.effectiveFilterHeight,h=n.effectiveFilterWidth,f=c-1-n.padInfo.front,p=d-1-n.padInfo.top,g=h-1-n.padInfo.left,m=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+p+", "+g+`);
      const float avgMultiplier = float(`+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+l+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+u+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},fU=function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Oe(n,e),Oe(n,t);var s="0.0";r!=null&&(Oe(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";i!=null&&(Oe(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},pU=function(n,e,t,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Oe(n,e),Oe(n,t);var s="vec4(0.0)";r!=null&&(Oe(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";i!=null&&(Oe(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},gU="return areal * breal - aimag * bimag;",mU="return areal * bimag + aimag * breal;",y0=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Oe(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Eh="return a + b;",Sh="return a - b;",b0="return a * b;",BC="return (a < 0.) ? b * a : a;",vt=function(n,e,t){this.variableNames=["A","B"],this.outputShape=Oe(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},HC=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,$r=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Oe(e,t);var i=this.outputShape.length,o="";if(r)if(i===0||le(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+Je(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=bn("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+s[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+s[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},vU=(function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),yU=(function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),bU=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},xU=function(n){this.outputShape=[],this.outputShape=Ts(n,1),this.variableNames=n.map((function(a,l){return"T"+l}));var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,s=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},wU=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ts(n,e);var t=this.outputShape,r=t.length,i=Je(r),o=bn("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map((function(m,v){return"T"+v}));var a=new Array(n.length-1);a[0]=n[0][e];for(var l=1;l<a.length;l++)a[l]=a[l-1]+n[l][e];var u=s[e],c=s.slice(-2),d=s.join(),h="if ("+u+" < "+a[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+c.join()+`));
        }`;for(l=1;l<a.length;l++){var f=a[l-1];h+=`
        if (`+u+" < "+a[l]+"  && "+u+" >= "+a[l-1]+`) {
          return getChannel(
            getT`+l+"("+Kl(s,u,f)+`),
            vec2(`+Kl(c,u,f)+`));
        }`}var p=a.length,g=a[a.length-1];h+=`
        return getChannel(
          getT`+p+"("+Kl(s,u,g)+`),
          vec2(`+Kl(c,u,g)+"));",this.userCode=`
      float getValue(`+s.map((function(m){return"int "+m}))+`) {
        `+h+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+t[r-2]+` &&
            `+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function Kl(n,e,t){var r=n.indexOf(e);return n.map((function(i,o){return o===r?i+" - "+t:i})).join()}var _U=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},CU=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dataFormat==="channelsLast",s=e-1-n.padInfo.top,a=t-1-n.padInfo.left,l=o?1:2,u=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+l+"], coords["+u+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},EU=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,o=n.padInfo.top,s=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+s+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},SU=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=e-1-n.padInfo.front,l=t-1-n.padInfo.top,u=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+l+", "+u+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},DU=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},AU=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,s=t-1-n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},x0=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,s=n.strideHeight,a=n.strideWidth,l=n.dilationHeight,u=n.dilationWidth,c=n.filterHeight,d=n.filterWidth,h=4*Math.floor(n.inChannels/4),f=n.inChannels%4,p=n.dataFormat==="channelsLast",g=p?1:2,m=p?2:3,v=p?3:1,y="",b="";t&&(y=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,b="result = activation(result);");var x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+s+", "+a+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+g+"], coords["+m+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+h+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(f===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+h+`) *
                    getW(wR, wC, `+h+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+h+`, xR, xC) *
                    getW(wR, wC, `+h+`, d2);
              }

            } else if (`+(f===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(f===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2),
                getW(wR, wC, `+h+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1),
                  getX(batch, xR, xC, `+h+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC),
                  getX(batch, `+h+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+x+`
        `+b+`
        setOutput(result);
      }
    `},kU=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,u=n.dilationWidth,c=n.filterDepth,d=n.filterHeight,h=n.filterWidth,f=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`; wC++) {
              int xC = xCCorner + wC * `+u+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},w0=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,d=n.dilationWidth,h=n.filterHeight,f=n.filterWidth,p=n.outChannels/n.inChannels,g="",m="";t&&(g=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,m="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+g+`

      const ivec2 strides = ivec2(`+l+", "+u+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+m+`
        setOutput(result);
      }
    `},_0=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,d=n.dilationWidth,h=n.filterHeight,f=n.filterWidth,p=f,g="int xR; int xC; int xCOffset;",m=0;m<h;m++)for(var v=0;v<f;v++)g+=`
          vec4 xTexelR`+m+"C"+2*v+` = vec4(0.);
          vec4 wR`+m+"C"+v+` = vec4(0.);
          vec4 xR`+m+"C"+v+" = vec4(0.);";for(m=0;m<h;m++)for(var y=0;y<p;y++){if(g+=`
          xR = xRCorner + `+m*c+`;
          xC = xCCorner + `+(v=2*y)*d+`;
        `,u===1){if(v<f&&(g+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+m+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+m+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+m+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+m+"C"+v+" = vec4(previous.zw, xTexelR"+m+"C"+v+`.xy);
                } else {
                  xR`+m+"C"+v+" = vec4(0, 0, xTexelR"+m+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+m+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+v+` = vec4(0.);
                }

                xR`+m+"C"+v+" = xTexelR"+m+"C"+v+`;
              `,v+1<f)){var b=a%2==0?rC(d):d;d%2==0&&a%2==1||d%2!=0&&a%2!=1?(g+=`
                  xCOffset = xC + `+a%2+" + "+b+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+m+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(g+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+m+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+v+` = vec4(0.);
                    }
                  `),g+=`
                  xR`+m+"C"+(v+1)+` = vec4(
                    xTexelR`+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+`.xy);
                `):g+=`
                  xCOffset = xC + `+b+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+m+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(v+1)+" = xTexelR"+m+"C"+(v+2)+`;
                `}}else v<f&&(g+=`
              if(xR >= 0 && xR < `+i+`) {
            `,a%2==1?(g+=`
                xCOffset = xC + 1 - `+u+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+m+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+m+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(v+2)+` = vec4(0.);
                }

                xR`+m+"C"+v+` = vec4(
                  xTexelR`+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+`.zw);
              `,v+1<f&&(g+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+u+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(v+1)+" = vec4(xTexelR"+m+"C"+(v+2)+`.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+m+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+u+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+m+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(v+2)+` = vec4(0.);
                }

                xR`+m+"C"+v+` = vec4(
                  xTexelR`+m+"C"+v+".xy, xTexelR"+m+"C"+(v+2)+`.xy);
              `,v+1<f&&(g+=`
                  xR`+m+"C"+(v+1)+` = vec4(
                    xTexelR`+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+`.zw);
                `)),g+="}");v<f&&(g+=`
            vec4 wTexelR`+m+"C"+v+" = getW("+m+", "+v+`, d1, q);
            wR`+m+"C"+v+" = vec4(wTexelR"+m+"C"+v+".xz, wTexelR"+m+"C"+v+`.xz);
          `,v+1<f&&(g+=`
              vec4 wTexelR`+m+"C"+(v+1)+" = getW("+m+", "+(v+1)+`, d1, q);
              wR`+m+"C"+(v+1)+` =
                vec4(wTexelR`+m+"C"+(v+1)+".xz, wTexelR"+m+"C"+(v+1)+".xz);"))}for(m=0;m<h;m++)for(v=0;v<f;v++)g+="dotProd += xR"+m+"C"+v+" * wR"+m+"C"+v+";";var x="",w="";t&&(x=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,w="result = activation(result);");var _=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+l+", "+u+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+g+`

        vec4 result = dotProd;
        `+_+`
        `+w+`
        setOutput(result);
      }
    `},RU=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],s=n[1],a=n[2],l=n[3],u=e[0],c=t[0],d=t[1];this.outputShape=[u,c,d,l];var h=r==="bilinear"?1:0,f=[s-1+".0",a-1+".0"],p=f[0],g=f[1],m=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=m[0],y=m[1],b=m[2],x=d>1?[""+(a-1)/(d-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g],w=x[0],_=x[1],C=x[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+w+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+y+`;
        float width_scale = `+_+`;

        float in_y = `+b+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+C+`;
        if( in_x < 0.0 || in_x > `+g+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+h+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},TU=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Je(r)+` coords = getOutputCoords();
        int end = `+C0(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+C0(r,"coords")+` = idx;
          val += getX(`+(function(s,a){if(s===1)return""+a;if(s===2)return a+".x, "+a+".y";if(s===3)return a+".x, "+a+".y, "+a+".z";if(s===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function C0(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var IU=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ba.DENSE;var e=va(n),t=Qt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+fo(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},MU=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ba.DENSE;var e=va(n),t=Qt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+fo(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},OU=(function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n})(),PU=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},NU=function(n){this.variableNames=["A"],this.outTexUsage=Ln.DOWNLOAD;var e=Qt();this.outputShape=n,this.userCode=`
      `+FC+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},FU=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ln.DOWNLOAD;var e=Qt();this.outputShape=n,this.userCode=`
      `+FC+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},LU=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Qt(),i=e[0],o=e[1];this.outputShape=n;var s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+Eg(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `},BU=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Qt(),i=e[0],o=e[1];this.outputShape=n;var s="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var u=0;u<=1;u++){var c=2*l+u;s+=`
          localCoords = coords;
          if(localCoords[2] + `+u+" < "+n[2]+`) {
            localCoords[2] += `+u+`;
            if(localCoords[1] + `+l+" < "+n[1]+`) {
              localCoords[1] += `+l+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Eg(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+s+`

        `+r.output+" = "+a+`;
      }
    `},HU="return real * expR - imag * expI;",WU="return real * expI + imag * expR;",E0=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},zU=(function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n})(),VU=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=Je(this.rank),o=(function(s,a){var l=s.length;if(l>4)throw Error("Gather for rank "+l+" is not yet supported");if(l===1)return"int(getIndices(resRC))";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],d=0;d<s.length;d++)d===a?c.push("int(getIndices("+u[d]+"))"):c.push(""+u[d]);return c.join()})(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},UU=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=Je(e.length),i=Je(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function jU(n,e){var t=Qt();return Hz(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function $U(n,e){return jz(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function GU(n,e){return $z(n,e,new Uint16Array([0,1,2,2,1,3]))}function il(n,e,t,r,i,o,s){qz(t,r);var a=Gz(n,e),l=n.TEXTURE_2D;return ce(n,e,(function(){return n.bindTexture(l,a)})),ce(n,e,(function(){return n.texParameteri(l,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)})),ce(n,e,(function(){return n.texParameteri(l,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)})),ce(n,e,(function(){return n.texParameteri(l,n.TEXTURE_MIN_FILTER,n.NEAREST)})),ce(n,e,(function(){return n.texParameteri(l,n.TEXTURE_MAG_FILTER,n.NEAREST)})),ce(n,e,(function(){return n.texImage2D(l,0,i,t,r,0,o,s,null)})),ce(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)})),a}function qU(n,e,t,r,i){var o=jc(t,r);return il(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function YU(n,e,t,r,i){var o=jc(t,r);return il(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function XU(n,e,t,r,i){var o=jc(t,r);return il(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function KU(n,e,t,r,i){var o=rl(t,r);return il(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function QU(n,e,t,r,i){var o=rl(t,r);return il(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function JU(n,e,t,r){return ce(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),d0(n,e,t,"clipSpacePos",r,3,20,0)&&d0(n,e,t,"uv",r,2,20,12)}function ZU(n,e,t,r,i,o,s){var a,l,u;ce(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),l=n.UNSIGNED_BYTE,u=n.RGBA):(a=new Float32Array(r*i*4),l=n.FLOAT,u=s.internalFormatPackedFloat),a.set(o),ce(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,u,r,i,0,n.RGBA,l,a)})),ce(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function ej(n,e,t,r){ce(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),r.data instanceof Uint8Array?ce(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)})):ce(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)})),ce(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function tj(n,e,t,r,i){var o=n.createBuffer();ce(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)}));var s=16*t*r;return ce(n,e,(function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)})),ce(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)})),ce(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)})),o}function nj(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function rj(n,e,t,r,i){var o=jc(t,r),s=o[0],a=o[1],l=new Uint8Array(t*r*4);return ce(n,e,(function(){return n.readPixels(0,0,s,a,i.downloadTextureFormat,n.UNSIGNED_BYTE,l)})),new Float32Array(l.buffer)}function ij(n,e,t,r,i,o,s,a){var l=n,u=new Float32Array((function(c,d){var h=rl(c,d);return h[0]*h[1]*4})(o,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function oj(n,e,t,r){var i=new Float32Array(t*r*4);return ce(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)})),i}var sj=(function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=X().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,Pz(t,e)):this.gl=Nr(t);var r="WEBGL_color_buffer_float";if(X().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Gl(this.gl,this.debug,"OES_texture_float"),Xn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Gl(this.gl,this.debug,"OES_texture_half_float");else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Xn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Gl(this.gl,this.debug,"EXT_color_buffer_half_float");else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Xn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Xn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=$U(this.gl,this.debug),this.indexBuffer=GU(this.gl,this.debug),this.framebuffer=Yz(this.gl,this.debug),this.textureConfig=pg(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return X().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;ce(t,this.debug,(function(){return t.finish()})),ce(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),ce(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),ce(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),ce(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),ce(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),qU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),YU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),XU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),ej(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),ZU(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),QU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),KU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(h0(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ce(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,(function(){return rj(i.gl,i.debug,t,r,i.textureConfig)}))},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,s){return ij(this.gl,e,0,0,0,o,s,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return nj(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=tj(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(X().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},t=s}else X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,(function(){return oj(i.gl,i.debug,t,r)}))},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=Wz(t,this.debug,e),i=jU(t,this.debug),o=Vz(t,this.debug);return ce(t,this.debug,(function(){return t.attachShader(o,i)})),ce(t,this.debug,(function(){return t.attachShader(o,r)})),Uz(t,this.debug,o),this.debug&&xh(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=JU(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&ce(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&xh(this.gl,this.debug,this.program),ce(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?Kz(this.gl,this.debug,e,t):Qz(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),ce(this.gl,this.debug,(function(){return r.gl.getAttribLocation(e,t)}))},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),Jz(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=rl(t,r),o=i[0],s=i[1];this.setOutputMatrixTextureDriver(e,o,s)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&xh(this.gl,this.debug,this.program),ql(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),ce(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),ce(this.gl,this.debug,(function(){return e.gl.finish()}))},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Gl(this.gl,this.debug,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return oe(this,void 0,void 0,(function(){var t=this;return se(this,(function(r){switch(r.label){case 0:return[4,o0((function(){return t.disposed||t.isQueryAvailable(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return r()}))}))},n.prototype.pollItems=function(){for(var e=(function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1})(this.itemsToPoll.map((function(r){return r.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||o0((function(){return r.pollItems(),r.itemsToPoll.length===0}))},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),wh(this.gl,this.debug,e,this.framebuffer),this.debug&&ql(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(wh(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ql(this.gl)):h0(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;wh(i,this.debug,e,this.framebuffer),this.debug&&ql(i),this.outputTexture=e,ce(i,this.debug,(function(){return i.viewport(0,0,t,r)})),ce(i,this.debug,(function(){return i.scissor(0,0,t,r)}))},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),ce(this.gl,this.debug,(function(){return o.gl.scissor(e,t,r,i)}))},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n})();function S0(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach((function(t,r){var i=t.logicalShape,o=e[r],s=o.shape;if(!Lt(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,l=o.isUniform?null:o.texData.texShape;if(!Lt(a,l))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+l+" must match")}}))}var aj=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,s=t.strideHeight,a=t.padInfo,l=t.outWidth,u=t.dilationWidth,c=t.dilationHeight,d=t.dataFormat,h=a.left,f=a.top,p=i*r,g=Qt(),m=d==="channelsLast",v=m?0:1,y=m?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+=`
          blockIndex = rc.y + `+w+`;
          pos = rc.x + `+x+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+l+")) * "+s+" - "+f+`;
            d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 < `+e[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+l+".) * "+o+". - "+h+`.);
              d1 = offsetX + `+u+" * (int(mod(float(pos), "+p+".) / "+i+`.));

              if(d1 < `+e[y]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+m+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*x+w)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*x+w)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+b+`

        `+g.output+` = result;
      }
    `},lj=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,s=e,a=n[3]-1;this.outputShape=n;var l="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+l+")":i===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},uj=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},cj=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=e,a=n[3]-1;this.outputShape=n;var l="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+l+")":i===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},dj=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,o=n.effectiveFilterWidth,s=i-1-n.padInfo.top,a=o-1-n.padInfo.left,l=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},hj=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.dilationDepth,o=n.dilationHeight,s=n.dilationWidth,a=n.effectiveFilterDepth,l=n.effectiveFilterHeight,u=n.effectiveFilterWidth,c=a-1-n.padInfo.front,d=l-1-n.padInfo.top,h=u-1-n.padInfo.left,f=a*l*u-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+d+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+a+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+l+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+u+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+f+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+l+" * "+u+` +
                  wR * `+u+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Dh=function(n,e,t,r,i,o,s){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),s===void 0&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var a=t?n[1]:n[2],l=Math.ceil(a/2),u=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",d=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";o&&(f=s?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,p="result = activation(result);");var g=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+f+`

      const float sharedDimension = `+l+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+l+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+h[0]+`);
          result += (`+d[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+g+`

        `+p+`

        setOutput(result);
      }
    `},fj=(function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n})(),pj=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},gj=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=bn("rc",e),r=Je(e),i=(function(a,l,u){if(a===1)return"rc > "+l[0];for(var c="",d=a-2;d<a;d++)c+=u[d]+" >= "+l[d],d<a-1&&(c+="||");return c})(e,n,t),o=(function(a,l,u,c){if(a===1)return"";var d=c.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+l+`;
    bool rEdge = rp1 >= `+u+`;
  `})(e,n[n.length-1],n[n.length-2],t),s=(function(a,l){var u=a.length,c=(function(d,h){for(var f=[],p=0;p<=1;p++)for(var g=0;g<=1;g++){for(var m=(p===0?"r":"rp1")+", "+(g===0?"c":"cp1"),v=2;v<d;v++)m=h[h.length-1-v]+","+m;f.push(m)}return f})(u,l);return u===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"})(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+s+`));
          }
        }
      `}},mj=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map((function(l,u){return l[0]+n[u]+l[1]}));var r=n.length,i=Je(r),o=e.map((function(l){return l[0]})).join(","),s=e.map((function(l,u){return l[0]+n[u]})).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},vj=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(m,v){return m[0]+n[v]+m[1]}));for(var r=n.length,i=Je(r),o=e.map((function(m){return m[0]})).join(","),s=e.map((function(m,v){return m[0]+n[v]})).join(","),a=bn("rc",r),l=bn("source",r),u=a[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+l.slice(-2).join()+")",d=[i+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+u+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+u+") {"],h=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,g=r===1?2:4;p<g;p++)f+=`
        `+d[p]+`
        if (`+h+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+l.join()+"), "+c+`);
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `},Ah=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,o=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,u=n.effectiveFilterWidth,c=n.padInfo.top,d=n.padInfo.left;this.outputShape=n.outShape;var h=e==="avg",f="0.0";if(h||(f="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+l+`;
              wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+u+`;
                wC += `+a+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+u+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var g=4*Math.floor(r/4),m=r%4,v=`
      if (`+h+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+d+`);
      const float initializationValue = `+f+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+f+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+l+`;
            wR += `+s+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+g+`; wC += 4) {
            int xC = xCCorner + wC * `+a+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              getValue(batch, xR, xC + 3 * `+a+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+g+`;
          if (`+(m===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(m===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(m===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+p+`);
      }
    `}},kh=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterDepth,d=n.effectiveFilterHeight,h=n.effectiveFilterWidth,f=n.padInfo.front,p=n.padInfo.top,g=n.padInfo.left;this.outputShape=n.outShape;var m=e==="avg",v="0.0";if(m||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+o+", "+s+`);
        const ivec3 pads = ivec3(`+f+", "+p+", "+g+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+a+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+l+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+h+`;
                  wC += `+u+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+h+` +
                      wR * `+h+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(y="avgValue / count");var b=4*Math.floor(r/4),x=r%4,w=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+f+", "+p+", "+g+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+b+`; wC += 4) {
              int xC = xCCorner + wC * `+u+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+u+`, ch)
              );

              `+w+`
            }

            int xC = xCCorner + `+b+`;
            if (`+(x===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+w+`
            } else if (`+(x===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                initializationValue,
                initializationValue
              );

              `+w+`
            } else if (`+(x===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                initializationValue
              );

              `+w+`
            }
          }
          setOutput(`+y+`);
        }
      }
    `}},yj=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var s="0.0",a="";e==="prod"?s="1.0":e==="min"?(s="1.0 / 1e-20",a="min"):e==="max"&&(s="-1.0 / 1e-20",a="max");var l=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?l="sumValue":e==="prod"?l="prodValue":e==="all"?l="allValue":e==="any"&&(l="anyValue");var u=4*Math.floor(t/4),c=t%4,d=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,h="vec4";e==="all"?(s="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):e==="any"&&(s="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");var f="";i%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(c===1)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===2)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===3)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+l+`);
      }
    `},bj=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+fo(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Eg(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},xj=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],l=s[2],u=[t&&a>1?i-1:i,t&&l>1?o-1:o],c=[t&&a>1?a-1:a,t&&l>1?l-1:l],d=u[0]/c[0],h=u[1]/c[1],f=1/d,p=1/h,g=2*Math.ceil(f)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+g+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},wj=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var l=[r&&e>1?o-1:o,r&&t>1?s-1:s],u=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/u[0]+`,
          `+l[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},_j=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var l=[r&&e>1?o-1:o,r&&t>1?s-1:s],u=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+l[0]/u[0]+`,
          `+l[1]/u[1]+`,
          `+l[1]/u[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},Cj=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],l=s[2],u=[t&&a>1?i-1:i,t&&l>1?o-1:o],c=[t&&a>1?a-1:a,t&&l>1?l-1:l],d=u[0]/c[0],h=u[1]/c[1],f=1/d,p=1/h,g=2*Math.ceil(f)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+g+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+u[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+u[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Ej=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var l=[r&&e>1?o-1:o,r&&t>1?s-1:s],u=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/u[0]+`,
          `+l[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},Sj=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map((function(o,s){return(function(a){return e.indexOf(a)!==-1&&n[a]!==1?n[a]+" - coords["+a+"] - 1":"coords["+a+"]"})(s)})).join(","),i=Je(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},Dj=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=bn("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],s=Je(t);function a(l){var u=n.map((function(c,d){return(function(h,f){return e.indexOf(h)!==-1&&n[h]!==1?n[h]+" - "+f[h]+" - 1":""+f[h]})(d,l)}));return"getChannel(getX("+u.join(",")+"), vec2("+u.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(l){return a(l)})(r.slice())+`;
          if(`+i+`){
            result.g = `+(function(l){return l[t-1]="("+l[t-1]+" + 1)",a(l)})(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+(function(l){return l[t-2]="("+l[t-2]+" + 1)",a(l)})(r.slice())+`;
            if(`+i+`) {
              result.a = `+(function(l){return l[t-1]="("+l[t-1]+" + 1)",l[t-2]="("+l[t-2]+" + 1)",a(l)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},D0=function(n,e,t,r,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=Je(i.length),l=Je(o.length),u="";t===1?u="i":t===2&&(u="i, j");var c="getIndices("+u+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var h="getUpdates("+d+")",f=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+i+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+h+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Aj=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,s=o*Math.ceil(i/t);this.outputShape=[r,s];var a=4*Math.floor(t/4),l=t%4,u=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+u+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(l===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+u+`
        } else if (`+(l===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+u+`
        } else if (`+(l===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+u+`
        }
        setOutput(sumValue);
      }
    `},kj=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],l=0;l<e.length;l++)a.push(""+o[l]),l<n&&s.push(""+o[l]);r=s.join(),i=a.join()}var u=Je(t);this.userCode=`
      void main() {
        `+u+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},Rj=(function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=Je(this.rank),i="uniform int start["+this.rank+"];",o=(function(s){if(s===1)return"sourceLoc";if(s<=6)return Rh.slice(0,s).map((function(a){return"sourceLoc."+a})).join(",");throw Error("Slicing for rank "+s+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map((function(s,a){return"sourceLoc."+Rh[a]+" = start["+a+"] + coords."+Rh[a]+";"})).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),Rh=["x","y","z","w","u","v"],Tj=(function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Je(this.rank),r=bn("coords",this.rank),i=bn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a=`
      result.x = `+s+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+s+`;
        --`+i[this.rank-1]+`;
      }
    `,l=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map((function(c,d){return"start["+d+"]"})).join()+");":e.map((function(c,d){return i[d]+" = "+r[d]+" + start["+d+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+u+`
        vec4 result = vec4(0.);
        `+a+`
        `+l+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),Ij=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=Je(t.length),o=Je(t.length),s="";if(r===1)s="coords * strides + begin";else{var a=0;s=t.map((function(l,u){return a++,t.length===1?"coords * strides["+u+"] + begin["+u+"]":"coords["+(a-1)+"] * strides["+u+"] + begin["+u+"]"})).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `},Mj=(function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=A0(t,r),s=k0(e,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===Fn.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Fn.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Fn.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Fn.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Fn.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var o=k0(t,A0(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(r){e.gpgpu.deleteMatrixTexture(r)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(i){e.gpgpu.deleteMatrixTexture(i)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n})();function A0(n,e){if(n===Ln.UPLOAD)return Fn.PACKED_2X2_FLOAT32;if(n===Ln.RENDER||n==null)return(function(t){return X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Fn.PACKED_2X2_FLOAT32:Fn.UNPACKED_FLOAT32:t?Fn.PACKED_2X2_FLOAT16:Fn.UNPACKED_FLOAT16})(e);if(n===Ln.DOWNLOAD||n===Ln.PIXELS)return Fn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function k0(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var Oj=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=Je(this.rank),o=(function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+s[0]+")";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],u=[],c=0;c<s.length;c++)u.push("imod("+l[c]+", "+s[c]+")");return u.join()})(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},Pj=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=Je(this.rank),o=(function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],u=new Array(a),c=0;c<s.length;c++)u[s[c]]=l[c];return u.join()})(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},Nj=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Je(this.rank),o=NC("rc",this.rank),s=new Array(this.rank);for(r=0;r<e.length;r++)s[e[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",l="++"+o[this.rank-1]+" < "+t[this.rank-1],u="getChannel(getA("+s.join()+"), "+a+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+u+`;
      if(`+l+`) {
        result[1] = `+u+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+u+`;
        if(`+l+`) {
          result[3] = `+u+`;
        }
      }
      setOutput(result);
    }
    `},Sg=1.7580993408473768,Dg=1.0507009873554805,De=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},dr="if (isnan(x)) return x;",Fj="return x;",R0="return abs(x);",WC=dr+`
  return (x < 0.0) ? 0.0 : x;
`,zC=dr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,VC="return (x >= 0.0) ? x : (exp(x) - 1.0);",Lj=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Sg+`;
  float scale = `+Dg+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,T0="return -x;",I0="return ceil(x);",M0="return floor(x);",O0="return exp(x);",P0="return exp(x) - 1.0;",Bj=dr+`
  return sin(x);
`,Hj=dr+`
  return cos(x);
`,Wj=dr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,zj=dr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Vj=dr+`
  return atan(x);
`,Uj=dr+"return log(x + sqrt(x * x + 1.0));",jj=dr+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,$j=dr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Ql="return x;",Gj="return x;",UC=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jC=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$C=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ta=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},qj=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=bn("rc",e),r=Je(e),i=(function(a,l){if(a===1)return"rc";for(var u="",c=0;c<a;c++)u+=l[c],c<a-1&&(u+=",");return u})(e,t),o=t.slice(-2),s=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `},Jl={};function Zl(n,e){if(e===void 0&&(e=!1),n==="linear")return e?Gj:Fj;if(n==="relu")return e?UC:WC;if(n==="elu")return e?$C:VC;if(n==="relu6")return e?jC:zC;if(n==="prelu")return e?HC:BC;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var Yj=600,Xj=(function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!X().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=Nr(X().getNumber("WEBGL_VERSION"));i.binaryCache=((r=X().getNumber("WEBGL_VERSION"))in Jl||(Jl[r]={}),Jl[r]),i.gpgpu=new sj(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new Mj(i.gpgpu),i.numMBBeforeWarning=X().global.screen==null?1024:X().global.screen.height*X().global.screen.width*window.devicePixelRatio*Yj/1024/1024,i.texData=new DC(i,N),i}return cr(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(X().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:t,usage:Ln.UPLOAD}),o},e.prototype.move=function(t,r,i,o){if(X().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:r,usage:Ln.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,o=r.dtype,s=r.complexTensors,a=r.slice,l=r.shape,u=r.isPacked;if(a!=null){var c=void 0;c=u?new ta(l,Ql):new De(l,Ql);var d=this.runWebGLProgram(c,[{dataId:t,shape:l,dtype:o}],o),h=this.readSync(d.dataId);return this.disposeData(d.dataId),h}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;var f,p,g=this.activeTimers!=null;return g&&(f=_r()),o==="complex64"?p=qf(s.real.dataSync(),s.imag.dataSync()):p=this.getValuesFromTexture(t),g&&(this.downloadWaitMs+=_r()-f),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return oe(this,void 0,void 0,(function(){var r,i,o,s,a,l,u,c,d,h,f,p,g,m,v,y,b,x,w,_,C,E;return se(this,(function(S){switch(S.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise((function(D){return r.push(D)}))];if(i=this.texData.get(t),o=i.values,s=i.shape,a=i.slice,l=i.dtype,u=i.complexTensors,c=i.isPacked,a!=null)return d=void 0,d=c?new ta(s,Ql):new De(s,Ql),h=this.runWebGLProgram(d,[{dataId:t,shape:s,dtype:l}],l),f=this.read(h.dataId),this.disposeData(h.dataId),[2,f];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&X().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,l!=="complex64"&&X().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(t),m=this.texData.get(g.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[m.texture].concat(va(s)))),this.pendingRead.set(t,[]),l==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:S.sent(),S.label=2;case 2:return l!=="complex64"?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return y=S.sent(),b=y[0],x=y[1],v=qf(b,x),[3,5];case 4:p==null?v=this.getValuesFromTexture(t):(w=le(s),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,w)),S.label=5;case 5:return g!=null&&this.disposeData(g.dataId),_=this.convertAndCacheOnCPU(t,v),C=this.pendingRead.get(t),this.pendingRead.delete(t),C.forEach((function(D){return D(_)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,_]}}))}))},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!Lz(i))throw X().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),o=i.shape,s=i.dtype,a=i.isPacked,l=le(o);if(X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),c=this.texData.get(u.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(va(o))).subarray(0,l);return this.disposeData(u.dataId),d}var h=X().getBool("WEBGL_PACK")&&a===!0,f=h?_h(o):o,p=h?new FU(f):new NU(f),g=this.runWebGLProgram(p,[{shape:f,dtype:s,dataId:t}],"float32"),m=this.texData.get(g.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,l);return this.disposeData(g.dataId),v},e.prototype.time=function(t){return oe(this,void 0,void 0,(function(){var r,i,o,s,a,l,u;return se(this,(function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),s=ks(this.activeTimers.map((function(d){return d.query}))).filter((function(d){return d!=null})),a=ks(this.activeTimers.map((function(d){return d.name}))).filter((function(d){return d!=null})),this.activeTimers=r,o&&(this.programTimersStack=null),l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return u=c.sent(),l.kernelMs=vz(u),l.getExtraProfileInfo=function(){return u.map((function(d,h){return{name:a[h],ms:d}})).map((function(d){return d.name+": "+d.ms})).join(", ")},[3,3];case 2:l.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:_r(),endMs:null}},e.prototype.endTimer=function(t){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=_r(),t)},e.prototype.getQueryTime=function(t){return oe(this,void 0,void 0,(function(){var r;return se(this,(function(i){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,o=r.dtype,s=r.texShape,a=r.usage,l=r.isPacked,u=r.slice,c=u&&u.origDataId||t,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(i,s,a,l)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return X().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=N.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every((function(o){return i.texData.get(o.dataId).texture==null&&o.size<r}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:N.keep(t.clone()),imag:N.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(le(i)===0)return Ut([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,s=EC(t.shape,r,i);if(o||!s){var a=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Tj(i):new Rj(i),l=a.getCustomSetupFunc(r);return this.compileAndRun(a,[t],null,l)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var o=this.texData.get(t.dataId),s=this.makeOutput(i,t.dtype),a=this.texData.get(s.dataId);Object.assign(a,o),a.shape=i,a.dtype=t.dtype;var l=SC(r,t.strides);o.slice&&(l+=o.slice.flatOffset),a.slice={flatOffset:l,origDataId:o.slice&&o.slice.origDataId||t.dataId};var u=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,u+1),s},e.prototype.stridedSlice=function(t,r,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,o);var s=bg(r,i,o);if(s.some((function(l){return l===0})))return Ut([],s);var a=new Ij(r,o,s);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,r){var i=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Dj(t.shape,r):new Sj(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map((function(f){return Yn(f)})),o=t.map((function(f){return Er(f)}));return zt(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(t.length/2),a=this.concat(t.slice(0,s),r),l=this.concat(t.slice(s),r);return this.concat([a,l],r)}if(X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var u=new wU(t.map((function(f){return f.shape})),r);return this.compileAndRun(u,t)}var c=Ts(t.map((function(f){return f.shape})),r),d=t.map((function(f){return f.as2D(-1,le(f.shape.slice(r)))})),h=new xU(d.map((function(f){return f.shape})));return this.compileAndRun(h,d).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,T0,t.dtype);var r=new De(t.shape,T0);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,o){var s=i?t.shape[2]:t.shape[1],a=o?r.shape[1]:r.shape[2],l=i?t.shape[1]:t.shape[2],u=t.shape[0];if((s===1||a===1)&&l>1e3){i&&(t=t.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var c=a===1?t:t.as3D(u,l,1),d=a===1?2:1,h=a===1?r.as3D(u,1,l):r;return this.multiply(c,h).sum(d,!0)}var f=Vt(t.dtype,r.dtype),p=new Dh(t.shape,[u,s,a],i,o);return this.compileAndRun(p,[t,r],f)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,s=t.transposeB,a=t.bias,l=t.activation,u=t.preluActivationWeights,c=o?r.shape[2]:r.shape[1],d=s?i.shape[1]:i.shape[2],h=r.shape[0],f=Vt(r.dtype,i.dtype),p=a!=null,g=u!=null,m=l?Zl(l,!0):null,v=new Dh(r.shape,[h,c,d],o,s,p,m,g),y=[r,i];return a&&y.push(a),u&&y.push(u),this.compileAndRun(v,y,f)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),o=this.texData.get(r.dataId),s=new y0(gU,t.shape,r.shape),a=new y0(mU,t.shape,r.shape),l=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],u=this.compileAndRun(s,l),c=this.compileAndRun(a,l),d=this.complex(u,c);return u.dispose(),c.dispose(),d}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,b0,t.dtype);var h=new vt(b0,t.shape,r.shape);return this.compileAndRun(h,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,o,s,a){var l=[t,r,i],u=null;a!=null&&(u=a.shape,l.push(a));var c=null;if(s!=null&&(c=s.shape,l.push(s)),X().getBool("WEBGL_PACK_NORMALIZATION")){var d=new pU(t.shape,r.shape,i.shape,u,c,o);return this.compileAndRun(d,l)}var h=new fU(t.shape,r.shape,i.shape,u,c,o);return this.compileAndRun(h,l)},e.prototype.localResponseNormalization4D=function(t,r,i,o,s){var a=X().getBool("WEBGL_PACK_NORMALIZATION")?new cj(t.shape,r,i,o,s):new lj(t.shape,r,i,o,s);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,r,i,o,s,a,l){var u=new uj(r.shape,o,s,a,l);return this.compileAndRun(u,[r,i,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map((function(s){return Ju(s)}));return OC(we(t.shape,t.dtype,i),r)}var o=new Oj(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,r,i){var o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vj(t.shape,r,i):new mj(t.shape,r,i);return this.compileAndRun(o,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var i=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Nj(t.shape,r):new Pj(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var o=new VU(t.shape,r.size,i);return this.compileAndRun(o,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){T(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var o=r.reduce((function(d,h){return d*h})),s=ic(t.shape,r,o),a=oc(s.length,r.length),l=sc(t.shape,r,o),u=xC(i,r.length),c=wC(l,i,r.length);return t.reshape(s).transpose(a).reshape(l).slice(u,c)},e.prototype.spaceToBatchND=function(t,r,i){T(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var o=r.reduce((function(h,f){return h*f})),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<t.shape.length;++a)s.push([0,0]);var l=t.pad(s),u=ic(l.shape,r,o,!1),c=oc(u.length,r.length,!1),d=sc(l.shape,r,o,!1);return l.reshape(u).transpose(c).reshape(d)},e.prototype.reduce=function(t,r,i){var o=t.shape[0],s=t.shape[1],a=Ch(s),l=new yj({windowSize:a,inSize:s,batchSize:o},r),u=this.compileAndRun(l,[t],i);return u.shape[1]===1?u:this.reduce(u,r,i)},e.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var o=t.shape[0],s=t.shape[1];i!=null&&(o=i.shape[0],s=i.shape[1]);var a=Ch(s),l=new iU({windowSize:a,inSize:s,batchSize:o},r,i==null),u=[t];i!=null&&u.push(i);var c=this.compileAndRun(l,u,"int32");return c.shape[1]===1?c:this.argReduce(t,r,c)},e.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:t.shape,s=Ch(o[o.length-1]),a=new cU(o,s,r,i==null),l=i==null?[t]:[t,i],u=this.compileAndRun(a,l,"int32");return u.rank===t.rank?this.argReducePacked(t,r,u):u},e.prototype.sum=function(t,r){Nn("sum",r,t.rank);var i=Gt(t.shape,r),o=i[0],s=le(i[1]),a=t.as2D(-1,s),l=gh(t.dtype);return this.reduce(a,"sum",l).reshape(o)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=Gt(t.shape,r),o=i[0],s=le(i[1]),a=t.as2D(-1,s),l=gh(t.dtype);return this.reduce(a,"prod",l).reshape(o)},e.prototype.unsortedSegmentSum=function(t,r,i){var o=0,s=Fr([o],t.rank),a=t;s!=null&&(a=t.transpose(s),o=Lr(1,t.rank)[0]);var l=(function(f,p,g){for(var m=[],v=f.length,y=0;y<v;y++)y!==p?m.push(f[y]):m.push(g);return m})(a.shape,o,i),u=le([a.shape[o]]),c=a.as2D(-1,u),d=gh(t.dtype),h=this.segOpCompute(c,"unsortedSegmentSum",r,d,i).reshape(l);return s!=null&&(h=h.transpose(gg(s))),h},e.prototype.segOpCompute=function(t,r,i,o,s){var a=t.shape[0],l=t.shape[1],u=(function(h,f){var p,g=!1;for(h<=CC?(p=h,g=!0):p=Bf(h,Math.floor(Math.sqrt(h)));!g;)p>f||p===h?g=!0:p=Bf(h,p+1);return p})(l,s),c=new Aj({windowSize:u,inSize:l,batchSize:a,numSegments:s}),d=this.compileAndRun(c,[t,i],o);return d.shape[1]===s?d:(i=rc(0,s).tile([l/u]),this.segOpCompute(d,r,i,o,s))},e.prototype.argMinMaxReduce=function(t,r,i){var o=[r];if(Nn("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!X().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var s=Gt(t.shape,o),a=s[0],l=le(s[1]),u=t.as2D(-1,l);return this.argReduce(u,i).reshape(a)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var s=new TU(t.shape,i,o);return this.compileAndRun(s,[t])},e.prototype.equal=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new vt("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new vt("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new vt("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new vt("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new vt("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new vt("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new De(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new vt("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new vt("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var o=new kj(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,i],Vt(r.dtype,i.dtype))},e.prototype.where=function(t){tc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return Cg(t.shape,r)},e.prototype.topk=function(t,r,i){return PC(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Nn("min",r,t.rank);var i=Gt(t.shape,r),o=i[0],s=le(i[1]),a=t.as2D(-1,s);return this.reduce(a,"min",a.dtype).reshape(o)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new vt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new vt(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);Nn("max",r,t.rank);var i=Gt(t.shape,r),o=i[0],s=le(i[1]),a=t.as2D(-1,s);return this.reduce(a,"max",a.dtype).reshape(o)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new vt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){Nn("all",r,t.rank);var i=Gt(t.shape,r),o=i[0],s=le(i[1]),a=t.as2D(-1,s);return this.reduce(a,"all",a.dtype).reshape(o)},e.prototype.any=function(t,r){Nn("any",r,t.rank);var i=Gt(t.shape,r),o=i[0],s=le(i[1]),a=t.as2D(-1,s);return this.reduce(a,"any",a.dtype).reshape(o)},e.prototype.realDivide=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new vt(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new vt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Eh);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=Vt(t.dtype,r.dtype);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Eh,i);var o=new vt(Eh,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var o=new ta(t.shape,r);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,o,s){s===void 0&&(s=!1);var a=new $r(i,t.shape,r.shape,s);return this.compileAndRun(a,[t,r],o)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var o=this,s=this.texData.get(t.dataId),a=this.texData.get(r.dataId),l=[[s.complexTensors.real,a.complexTensors.real],[s.complexTensors.imag,a.complexTensors.imag]].map((function(h){var f=h[0],p=h[1],g=o.makeComplexComponentTensorInfo(t,f),m=o.makeComplexComponentTensorInfo(r,p),v=new vt(i,t.shape,r.shape);return o.compileAndRun(v,[g,m],Vt(f.dtype,p.dtype))})),u=l[0],c=l[1],d=this.complex(u,c);return u.dispose(),c.dispose(),d},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>X().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([i,o])}var s=t.map((function(u){return u.dtype})).reduce((function(u,c){return Vt(u,c)})),a=t.map((function(u){return u.shape})),l=X().getBool("WEBGL_PACK")?new rU(t[0].shape,a):new nU(t[0].shape,a);return this.compileAndRun(l,t,s)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Sh);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=Vt(t.dtype,r.dtype);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Sh,t.dtype);var o=new vt(Sh,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.pow=function(t,r){var i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new vt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),o=Vt(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,I0,t.dtype);var r=new De(t.shape,I0);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,M0,t.dtype);var r=new De(t.shape,M0);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new De(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new De(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new De(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new De(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new De(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,O0,t.dtype);var r=new De(t.shape,O0);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,P0,t.dtype);var r=new De(t.shape,P0);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=Mt([r],t.shape),o=this.max(t,i),s=En(o.shape,i),a=this.subtract(t,o.reshape(s)),l=this.exp(a),u=this.sum(l,i).reshape(s);return this.realDivide(l,u)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new De(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new De(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new De(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new De(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new De(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=X().getBool("WEBGL_PACK")?new ta(t.shape,UC):new De(t.shape,WC),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=X().getBool("WEBGL_PACK")?new ta(t.shape,jC):new De(t.shape,zC),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(HC,t.shape,r.shape):new vt(BC,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$C,t.dtype);var r=new De(t.shape,VC);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new vt("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new De(t.shape,Lj);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new De(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var o,s=(o=X().getBool("WEBGL_PACK_CLIP")?new yU(t.shape):new vU(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[t],null,s)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,R0,t.dtype);var r=new De(t.shape,R0);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new bU(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var r=new De(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new De(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new De(t.shape,Bj);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new De(t.shape,Hj);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new De(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new De(t.shape,Wj);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new De(t.shape,zj);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new De(t.shape,Vj);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new vt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new De(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new De(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new De(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new De(t.shape,Uj);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new De(t.shape,jj);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new De(t.shape,$j);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new De(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i=new De(t.shape,(function(o){return o===void 0&&(o=0),dr+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `})(r));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,o,s,a){var l=t.shape,u=this.texData.get(t.dataId),c=i.inChannels,d=l[0]*l[1]*l[2],h=i.outChannels,f=i.dataFormat==="channelsLast",p=(d===1||h===1)&&c>1e3,g=l[2]%2!=0&&!!u.isPacked;if(p||!X().getBool("WEBGL_LAZILY_UNPACK")||!X().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var m=f?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],v=this.reshape(t,[1,m,i.inChannels]),y=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:y,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),i.outShape)}var b=f?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),x={dataId:t.dataId,shape:[1,b,i.inChannels],dtype:t.dtype},w=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,T(Xl(u.shape,x.shape),(function(){return"packed reshape "+u.shape+" to "+x.shape+" isn't free"}));var _=this.reshape(r,[1,i.inChannels,i.outChannels]),C=this.fusedBatchMatMul({a:x,b:_,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),E=this.texData.get(C.dataId);return T(E.isPacked,(function(){return"batchMatMul result is expected to be packed"})),u.shape=w,E.shape=i.outShape,N.makeTensorFromDataId(C.dataId,i.outShape,C.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,o,s,a){var l=i.filterWidth,u=i.filterHeight,c=i.inChannels,d=i.outWidth,h=i.outHeight,f=i.dataFormat==="channelsLast",p=l*u*c,g=h*d,m=[p,g],v=t.squeeze([0]),y=r.reshape([1,p,-1]),b=new aj(m,v.shape,i),x=this.compileAndRun(b,[v]).reshape([1,m[0],m[1]]),w=o!=null,_=a!=null,C=s?Zl(s,!0):null,E=new Dh(x.shape,[1,g,i.outChannels],!0,!1,w,C,_),S=[x,y];o&&S.push(o),_&&S.push(a);var D=this.compileAndRun(E,S);return f?D.reshape([1,h,d,i.outChannels]):D.reshape([1,i.outChannels,h,d])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,s=t.bias,a=t.activation,l=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,s,a,l);if(X().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,s,a,l);var u=s!=null,c=l!=null,d=a?Zl(a,!1):null,h=new x0(o,u,d,c),f=[r,i];return s&&f.push(s),l&&f.push(l),this.compileAndRun(h,f)},e.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(X().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var o=new x0(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var o=new CU(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var o=new _U(i);return this.compileAndRun(o,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,o=t.filter,s=t.convInfo,a=t.bias,l=t.activation,u=t.preluActivationWeights,c=X().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,d=l?Zl(l,c):null,h=[i,o],f=a!=null,p=u!=null;return f&&h.push(a),p&&h.push(u),c?(r=new _0(s,f,d,p),this.compileAndRun(r,h)):(r=new w0(s,f,d,p),this.compileAndRun(r,h))},e.prototype.depthwiseConv2D=function(t,r,i){var o;return X().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new _0(i),this.compileAndRun(o,[t,r])):(o=new w0(i),this.compileAndRun(o,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var o=new AU(i);return this.compileAndRun(o,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var o=new DU(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3d=function(t,r,i){var o=new kU(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var o=new SU(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var o=new EU(i);return this.compileAndRun(o,[t,r])},e.prototype.maxPool=function(t,r){var i=new Ah(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new Ah(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,o){var s=new Ah(o,"max",!0),a=this.compileAndRun(s,[r]),l=new dj(o),u=this.compileAndRun(l,[t,a],r.dtype);return a.dispose(),u},e.prototype.avgPoolBackprop=function(t,r,i){var o=new dU(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.cast=function(t,r){return RC(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),s=0,a=0;a<t.rank;a++)a!==r&&(o[s++]=t.shape[a]);var l=new Array(t.rank).fill(0),u=t.shape.slice();u[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)l[r]=a,c[a]=this.slice(t,l,u).reshape(o);return c},e.prototype.avgPool3d=function(t,r){var i=new kh(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var o=new hU(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new kh(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,o){var s=new kh(o,"max",!0),a=this.compileAndRun(s,[r]),l=new hj(o),u=this.compileAndRun(l,[t,a],r.dtype);return a.dispose(),u},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!Xl(t.shape,r)&&(i.texture===null||!Xl(i.shape,r))){var o=this.packedReshape(t,r);return N.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return Gf(t,r)},e.prototype.resizeBilinear=function(t,r,i,o){var s=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new _j(t.shape,r,i,o):new wj(t.shape,r,i,o);return this.compileAndRun(s,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var o=new xj(t,r,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,o){var s=new Ej(t.shape,r,i,o);return this.compileAndRun(s,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var o=new Cj(t,r,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,r,i,o){var s=r?t:ii(t),a=s.shape[0],l=s.shape[1],u=new fj(a,l,i),c=u.getCustomSetupFunc(o);return this.compileAndRun(u,[s],"int32",c)},e.prototype.oneHot=function(t,r,i,o){var s=new pj(t.size,r,i,o);return this.compileAndRun(s,[t])},e.prototype.diag=function(t){var r=new PU(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,o,s){return tc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),wg(t.dataSync(),r.dataSync(),i,o,s)},e.prototype.cropAndResize=function(t,r,i,o,s,a){var l=new RU(t.shape,r.shape,o,s,a);return this.compileAndRun(l,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){T(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));var o=t.shape[0],s=i==="NHWC"?t.shape[1]:t.shape[2],a=i==="NHWC"?t.shape[2]:t.shape[3],l=i==="NHWC"?t.shape[3]:t.shape[1],u=s*r,c=a*r,d=l/(r*r),h=new OU(i==="NHWC"?[o,u,c,d]:[o,d,u,c],r,i);return this.compileAndRun(h,[t])},e.prototype.split=function(t,r,i){return MC(t,r,i)},e.prototype.scatterND=function(t,r,i){var o=ac(0,t,i),s=o.sliceRank,a=o.numUpdates,l=o.sliceSize,u=o.strides,c=o.outputSize,d=[c/l,l],h=t.reshape([a,s]),f=r.reshape([a,l]);if(c===0)return Gf(Ut([]),i);var p=te(0),g=new D0(a,s,h.rank,f.rank,u,d);return this.compileAndRun(g,[f,h,p]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,o){var s=ac(0,t,i),a=s.sliceRank,l=s.numUpdates,u=s.strides,c=s.outputSize,d=new D0(l,a,t.rank,r.rank,u,[c,1]);return this.compileAndRun(d,[r,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),o=new E0(HU,t.shape,r),s=new E0(WU,t.shape,r),a=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],l=this.compileAndRun(o,a),u=this.compileAndRun(s,a),c=this.complex(l,u).as2D(t.shape[0],t.shape[1]);return l.dispose(),u.dispose(),c},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],s=_C(t,r),a=s[0],l=s[1],u=s[2],c=s[3],d=r.reshape([l,o]),h=t.reshape([t.size/u,u]),f=new UU(o,c,[l,u]);return this.compileAndRun(f,[h,d]).reshape(a)},e.prototype.fill=function(t,r,i){if((i=i||tl(r))==="string"){var o=Qu(i,le(t));return o.fill(r),N.makeTensor(o,t,i,this)}var s=new zU(t,r),a=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,a)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return TC(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return N.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new qj(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new gj(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[Zu(t.shape)].concat(ec(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},s=[Zu(r)].concat(ec(r)),a=new bj(s,i),l=this.runWebGLProgram(a,[o],t.dtype,null,!0);return{dataId:l.dataId,shape:r,dtype:l.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),o=i.isPacked,s=i.shape,a=i.dtype,l=_h(s);return r=o?new MU(l):new IU(l),{dtype:a,shape:s,dataId:this.runWebGLProgram(r,[{shape:l,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,o,s){var a=this;s===void 0&&(s=!1);var l=this.makeTensorInfo(t.outputShape,i),u=this.texData.get(l.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===Ba.DENSE){var c=va(t.outputShape);u.texShape=c.map((function(b){return 2*b}))}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),le(l.shape)===0)return u.values=Fa(l.dtype,0),l;var d=[],h=r.map((function(b){if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var x=a.texData.get(b.dataId);if(x.texture==null){if(!t.packedInputs&&le(b.shape)<=X().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:x.values};t.packedInputs&&(x.isPacked=!0,x.shape=b.shape)}else if(!!x.isPacked!=!!t.packedInputs)b=x.isPacked?a.unpackTensor(b):a.packTensor(b),d.push(b),x=a.texData.get(b.dataId);else if(x.isPacked&&!Xl(x.shape,b.shape)){var w=b,_=b.shape;b.shape=x.shape,b=a.packedReshape(b,_),d.push(b),x=a.texData.get(b.dataId),w.shape=_}return a.uploadToGPU(b.dataId),{shape:b.shape,texData:x,isUniform:!1}}));this.uploadToGPU(l.dataId);var f,p={shape:l.shape,texData:u,isUniform:!1},g=(function(b,x,w){var _="";x.concat(w).forEach((function(S){var D=S.texData!=null&&S.texData.slice!=null&&S.texData.slice.flatOffset>0,k=S.isUniform?"uniform":S.texData.texShape;_+=S.shape+"_"+k+"_"+D}));var C=b.userCode,E=b.constructor.name;return E+="_"+_+"_"+C})(t,h,p),m=this.getAndSaveBinary(g,(function(){return(function(b,x,w,_){var C=x.userCode,E=w.map((function(U,q){var K={logicalShape:U.shape,texShape:U.isUniform?null:U.texData.texShape,isUniform:U.isUniform,isPacked:!U.isUniform&&U.texData.isPacked,flatOffset:null};return U.texData!=null&&U.texData.slice!=null&&U.texData.slice.flatOffset>0&&(K.flatOffset=U.texData.slice.flatOffset),{name:x.variableNames[q],shapeInfo:K}})),S=E.map((function(U){return U.shapeInfo})),D={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},k=oU(E,D,C,x.packedInputs),M=b.createProgram(k),B=null,H=b.getUniformLocation(M,"NAN",!1);X().getNumber("WEBGL_VERSION")===1&&(B=b.getUniformLocation(M,"INFINITY",!1));for(var F={},W=0;W<x.variableNames.length;W++){var j=x.variableNames[W];F[j]=b.getUniformLocation(M,j,!1),F["offset"+j]=b.getUniformLocation(M,"offset"+j,!1)}return{program:x,source:k,webGLProgram:M,uniformLocations:F,inShapeInfos:S,outShapeInfo:D,infLoc:B,nanLoc:H}})(a.gpgpu,t,h,p)})),v=this.activeTimers!=null;if(v&&(f=this.startTimer()),(function(b,x,w,_,C){S0(x.inShapeInfos,w),S0([x.outShapeInfo],[_]);var E=_.texData.texture,S=_.texData.texShape;_.texData.isPacked?b.setOutputPackedMatrixTexture(E,S[0],S[1]):b.setOutputMatrixTexture(E,S[0],S[1]),b.setProgram(x.webGLProgram),X().getNumber("WEBGL_VERSION")===1&&x.infLoc!==null&&b.gl.uniform1f(x.infLoc,1/0),x.nanLoc!==null&&b.gl.uniform1f(x.nanLoc,NaN),w.forEach((function(D,k){var M=x.program.variableNames[k],B=x.uniformLocations[M],H=x.uniformLocations["offset"+M];if(B!=null)if(D.isUniform)if(le(D.shape)<2)b.gl.uniform1f(B,D.uniformValues[0]);else{var F=D.uniformValues;F instanceof Float32Array||(F=new Float32Array(F)),b.gl.uniform1fv(B,F)}else D.texData.slice!=null&&H!=null&&b.gl.uniform1i(H,D.texData.slice.flatOffset),b.setInputMatrixTexture(D.texData.texture,B,k)})),C?.(b,x.webGLProgram),b.executeProgram()})(this.gpgpu,m,h,p,o),d.forEach((function(b){return a.disposeData(b.dataId)})),v&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)})),!X().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&s===!1){var y=this.unpackTensor(l);return this.disposeData(l.dataId),y}return l},e.prototype.compileAndRun=function(t,r,i,o,s){s===void 0&&(s=!1),i=i||r[0].dtype;var a=this.runWebGLProgram(t,r,i,o,s);return N.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(X().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ie((function(){if(!X().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=X().getBool("DEBUG");X().set("DEBUG",!1);var i=t.abs(te(1e-8)).dataSync()[0];if(X().set("DEBUG",r),i>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),o=i.shape,s=i.dtype,a=i.values,l=i.texture,u=i.usage,c=i.isPacked;if(l==null){var d,h=this.activeTimers!=null;h&&(d=_r());var f=i.texShape;if(f==null&&(f=tV(o,c),i.texShape=f),a!=null){var p=_h(o),g=void 0,m=f[1],v=f[0],y=a instanceof Uint8Array;c?(m=(r=rl(f[0],f[1]))[0],v=r[1],g=new BU(p,[v,m],y)):g=new LU(p,[v,m],y);var b=this.makeTensorInfo([v,m],s);this.texData.get(b.dataId).usage=y?Ln.PIXELS:Ln.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),m,v,a);var x=this.runWebGLProgram(g,[b],s,null,!0),w=this.texData.get(x.dataId);i.texture=w.texture,i.texShape=w.texShape,i.isPacked=w.isPacked,i.usage=w.usage,this.disposeData(b.dataId),this.texData.delete(x.dataId),i.values=null,h&&(this.uploadWaitMs+=_r()-d)}else{var _=this.acquireTexture(f,u,s,c);i.texture=_}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=(function(s,a){if(a==="float32"||a==="complex64")return s;if(a==="int32"||a==="bool"){for(var l=a==="int32"?new Int32Array(s.length):new Uint8Array(s.length),u=0;u<l.length;++u)l[u]=Math.round(s[u]);return l}throw new Error("Unknown dtype "+a)})(r,o)),i.values},e.prototype.acquireTexture=function(t,r,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*iC(r)},e})(AC);dC()&&N.registerBackend("webgl",(function(){return new Xj}),2);var Kj=P({square_:function(n){var e=A(n,"x","square"),t=[e];return N.runKernelFunc((function(r,i){return i([e]),r.square(e)}),{x:e},null,"Square",{},t,[])}}),Wa="SquaredDifference",GC=P({squaredDifference_:function(n,e){var t,r=A(n,"a","squaredDifference"),i=A(e,"b","squaredDifference");t=gt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape);var o={a:r,b:i},s=[r,i];return N.runKernelFunc((function(a,l){var u=a.squaredDifference(r,i);return l([r,i]),u}),o,(function(a,l){var u=l[0],c=l[1],d=te(2);return{a:function(){return a.mul(u.sub(c).mul(d))},b:function(){return a.mul(c.sub(u).mul(d))}}}),Wa,{},s,[])}}),Qj=P({abs_:function(n){var e=A(n,"x","abs");return e.dtype==="complex64"?N.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):N.runKernelFunc((function(t,r){var i=t.abs(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}}),"Abs")}}),Jj=P({acos_:function(n){var e=A(n,"x","acos");return N.runKernelFunc((function(t,r){var i=t.acos(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(te(1).sub(i.toFloat().square()).sqrt()).neg()}}}))}}),Zj=P({acosh_:function(n){var e=A(n,"x","acosh");return N.runKernelFunc((function(t,r){var i=t.acosh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}}))}}),e$=P({asin_:function(n){var e=A(n,"x","asin");return N.runKernelFunc((function(t,r){var i=t.asin(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(te(1).sub(i.toFloat().square()).sqrt())}}}))}}),t$=P({asinh_:function(n){var e=A(n,"x","asinh");return N.runKernelFunc((function(t,r){var i=t.asinh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(te(1).add(i.toFloat().square()).sqrt())}}}))}}),n$=P({atan_:function(n){var e=A(n,"x","atan");return N.runKernelFunc((function(t,r){var i=t.atan(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}}))}}),r$=P({atanh_:function(n){var e=A(n,"x","atanh");return N.runKernelFunc((function(t,r){var i=t.atanh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(te(1).sub(i.toFloat().square()))}}}))}}),i$=P({ceil_:function(n){var e=A(n,"x","ceil");return N.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return Le(t)}}}))}}),Ag=P({clipByValue_:function(n,e,t){var r=A(n,"x","clipByValue");T(e<=t,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}));var i=[r],o={min:e,max:t};return N.runKernelFunc((function(s,a){var l=s.clip(r,e,t);return a([r]),l}),{x:r},(function(s,a){var l=a[0];return{x:function(){return s.where(l.greaterEqual(e).logicalAnd(l.lessEqual(t)),Le(s))}}}),"ClipByValue",o,i)}}),o$=P({cos_:function(n){var e=A(n,"x","cos"),t=[e];return N.runKernelFunc((function(r,i){var o=r.cos(e);return i([e]),o}),{x:e},(function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}}),"Cos",{},t)}}),s$=P({cosh_:function(n){var e=A(n,"x","cosh");return N.runKernelFunc((function(t,r){var i=t.cosh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}}))}}),a$=P({erf_:function(n){var e=A(n,"x","erf");return T(e.dtype==="int32"||e.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),e.dtype==="int32"&&(e=e.toFloat()),N.runKernelFunc((function(t,r){var i=t.erf(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),Yf=P({exp_:function(n){var e=A(n,"x","exp");return N.runKernelFunc((function(t,r){var i=t.exp(e);return r([i]),i}),{x:e},(function(t,r){return{x:function(){return t.mulStrict(r[0])}}}),"Exp",{},[],[!0])}}),l$=P({expm1_:function(n){var e=A(n,"x","expm1");return N.runKernelFunc((function(t,r){var i=t.expm1(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}}))}}),u$=P({floor_:function(n){var e=A(n,"x","floor");return N.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return Le(t)}}}))}}),c$=P({log_:function(n){var e=A(n,"x","log"),t=[e];return N.runKernelFunc((function(r,i){var o=r.log(e);return i([e]),o}),{x:e},(function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}}),"Log",{},t)}}),d$=P({log1p_:function(n){var e=A(n,"x","log1p");return N.runKernelFunc((function(t,r){var i=t.log1p(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}}))}}),h$=P({logSigmoid_:function(n){var e=A(n,"x","logSigmoid");return N.runKernelFunc((function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}}))}}),dc=P({neg_:function(n){var e=A(n,"x","neg"),t=[e];return N.runKernelFunc((function(r){return r.neg(e)}),{x:e},(function(r){return{x:function(){return r.neg()}}}),"Neg",{},t)}}),f$=P({reciprocal_:function(n){var e=A(n,"x","reciprocal");return N.runKernelFunc((function(t,r){var i=t.reciprocal(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}}))}}),p$=P({round_:function(n){var e=A(n,"x","round");return N.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return Le(t)}}}))}}),qC=P({rsqrt_:function(n){var e=A(n,"x","rsqrt"),t=[e];return N.runKernelFunc((function(r,i){var o=r.rsqrt(e);return i([e]),o}),{x:e},(function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),YC=P({sigmoid_:function(n){var e=A(n,"x","sigmoid");return N.runKernelFunc((function(t,r){var i=t.sigmoid(e);return r([i]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(te(1).sub(i)))}}}),"Sigmoid")}}),g$=P({sign_:function(n){var e=A(n,"x","sign");return N.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return Le(t)}}}))}}),m$=P({isNaN_:function(n){var e=A(n,"x","isNaN");return N.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return Le(t)}}}))}}),v$=P({isInf_:function(n){var e=A(n,"x","isInf");return N.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return Le(t)}}}))}}),y$=P({isFinite_:function(n){var e=A(n,"x","isFinite");return N.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return Le(t)}}}))}}),b$=P({sin_:function(n){var e=A(n,"x","sin"),t=[e];return N.runKernelFunc((function(r,i){var o=r.sin(e);return i([e]),o}),{x:e},(function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}}),"Sin",{},t)}}),x$=P({sinh_:function(n){var e=A(n,"x","sinh");return N.runKernelFunc((function(t,r){var i=t.sinh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}}))}}),w$=P({softplus_:function(n){var e=A(n,"x","softplus");return N.runKernelFunc((function(t,r){var i=t.softplus(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}}))}}),_$=P({sqrt_:function(n){var e=A(n,"x","sqrt");return N.runKernelFunc((function(t,r){var i=t.sqrt(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}}))}}),C$=P({step_:function(n,e){e===void 0&&(e=0);var t=A(n,"x","step");return N.runKernelFunc((function(r){return r.step(t,e)}),{$x:t},(function(r){return{$x:function(){return Le(r)}}}))}}),E$=P({tan_:function(n){var e=A(n,"x","tan");return N.runKernelFunc((function(t,r){var i=t.tan(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}}))}}),S$=P({tanh_:function(n){var e=A(n,"x","tanh");return N.runKernelFunc((function(t,r){var i=t.tanh(e);return r([i]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return te(1).sub(i.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function XC(n,e,t,r,i,o){var s,a,l=A(n,"x","batchNorm"),u=A(e,"mean","batchNorm"),c=A(t,"variance","batchNorm");return i!=null&&(s=A(i,"scale","batchNorm")),r!=null&&(a=A(r,"offset","batchNorm")),T(l.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),T(u.rank===2||u.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."})),T(c.rank===2||c.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."})),s!=null&&T(s.rank===2||s.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."})),a!=null&&T(a.rank===2||a.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."})),ol(l,u,c,a,s,o)}function KC(n,e,t,r,i,o){var s,a,l=A(n,"x","batchNorm"),u=A(e,"mean","batchNorm"),c=A(t,"variance","batchNorm");return i!=null&&(s=A(i,"scale","batchNorm")),r!=null&&(a=A(r,"offset","batchNorm")),T(l.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),T(u.rank===3||u.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."})),T(c.rank===3||c.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."})),s!=null&&T(s.rank===3||s.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."})),a!=null&&T(a.rank===3||a.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."})),ol(l,u,c,a,s,o)}function QC(n,e,t,r,i,o){var s,a,l=A(n,"x","batchNorm"),u=A(e,"mean","batchNorm"),c=A(t,"variance","batchNorm");return i!=null&&(s=A(i,"scale","batchNorm")),r!=null&&(a=A(r,"offset","batchNorm")),T(l.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+l.rank+"."})),T(u.rank===4||u.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."})),T(c.rank===4||c.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."})),s!=null&&T(s.rank===4||s.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."})),a!=null&&T(a.rank===4||a.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."})),ol(l,u,c,a,s,o)}function ol(n,e,t,r,i,o){o==null&&(o=.001);var s,a,l,u=A(n,"x","batchNorm"),c=A(e,"mean","batchNorm"),d=A(t,"variance","batchNorm");i!=null&&(s=A(i,"scale","batchNorm")),r!=null&&(a=A(r,"offset","batchNorm")),T(c.rank===d.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),T(a==null||c.rank===a.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),T(s==null||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),l=u.rank===0||u.rank===1?u.as4D(1,1,1,u.size):u.rank===2?u.as4D(1,1,u.shape[0],u.shape[1]):u.rank===3?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u;var h=[u,c,d,s];return N.runKernelFunc((function(f,p){var g=f.batchNormalization(l,eu(c),eu(d),o,eu(s),eu(a));return p([u,c,d,s]),g}),{x:u,mean:c,variance:d,scale:s,offset:a},(function(f,p){var g=p,m=g[0],v=g[1],y=g[2],b=g[3],x=b??te(1),w=Tt(v.shape,l.shape),_=[];if(v.rank===1){for(var C=0;C<l.shape.length-1;++C)_.push(l.shape[C]);_.push(1)}var E=m.sub(v),S=f.mul(x),D=qC(y.add(te(o))),k=D.mul(D).mul(D).mul(te(-.5));return{x:function(){return v.rank===1?f.mul(ps(D.as4D(1,1,1,v.shape[0]),_)).mul(x).reshape(m.shape):f.mul(D).mul(x).reshape(m.shape)},mean:function(){var M=D.mul(te(-1)).mul(S);return v.rank===1&&(M=M.sum(w)),M.reshape(v.shape)},variance:function(){var M=k.mul(E).mul(S);return v.rank===1&&(M=M.sum(w)),M.reshape(v.shape)},scale:function(){var M=E.mul(D),B=f.mul(M);return v.rank===1&&(B=B.sum(w)),B.reshape(v.shape)},offset:function(){var M=f;return v.rank===1&&(M=M.sum(w)),M.reshape(v.shape)}}}),"BatchNormalization",{varianceEpsilon:o},h).reshape(u.shape)}function eu(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function qc(){hC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var D$=P({batchNormalization2d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),qc(),XC(n,e,t,o,i,r)}}),A$=P({batchNormalization3d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),qc(),KC(n,e,t,o,i,r)}}),k$=P({batchNormalization4d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),qc(),QC(n,e,t,o,i,r)}}),R$=P({batchNormalization_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),qc(),ol(n,e,t,o,i,r)}}),JC=P({batchNorm_:ol}),T$=P({batchNorm2d_:XC}),I$=P({batchNorm3d_:KC}),M$=P({batchNorm4d_:QC}),Yc=P({logicalAnd_:function(n,e){var t=A(n,"a","logicalAnd","bool"),r=A(e,"b","logicalAnd","bool");return Oe(t.shape,r.shape),N.runKernelFunc((function(i){return i.logicalAnd(t,r)}),{a:t,b:r},null,"LogicalAnd")}}),O$=P({logicalNot_:function(n){var e=A(n,"x","logicalNot","bool");return N.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),ZC=P({logicalOr_:function(n,e){var t=A(n,"a","logicalOr","bool"),r=A(e,"b","logicalOr","bool");return Oe(t.shape,r.shape),N.runKernelFunc((function(i){return i.logicalOr(t,r)}),{$a:t,$b:r})}}),P$=P({logicalXor_:function(n,e){var t=A(n,"a","logicalXor","bool"),r=A(e,"b","logicalXor","bool");return Oe(t.shape,r.shape),ZC(n,e).logicalAnd(Yc(n,e).logicalNot())}}),ko=P({where_:function(n,e,t){var r=A(e,"a","where"),i=A(t,"b","where"),o=A(n,"condition","where","bool");return je(r.shape,i.shape,"Error in where: "),o.rank===1?T(o.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):je(o.shape,i.shape,"Error in where: "),N.runKernelFunc((function(s,a){var l=s.select(o,r,i);return a([o]),l}),{$condition:o,$a:r,$b:i},(function(s,a){var l=a[0];return{$condition:function(){return Le(l).toFloat()},$a:function(){return s.mul(l.cast(s.dtype))},$b:function(){return s.mul(l.logicalNot().cast(s.dtype))}}}))}}),eE=function(n){return oe(this,void 0,void 0,(function(){var e,t,r;return se(this,(function(i){switch(i.label){case 0:return[4,(e=A(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=Cg(e.shape,t),n!==e&&e.dispose(),[2,r]}}))}))},Ie=P({add_:function(n,e){var t,r=A(n,"a","add"),i=A(e,"b","add");t=gt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return N.runKernelFunc((function(s){return s.add(r,i)}),{a:r,b:i},(function(s){return{a:function(){var a=s,l=Tt(r.shape,o);return l.length>0&&(a=a.sum(l)),a.reshape(r.shape)},b:function(){var a=s,l=Tt(i.shape,o);return l.length>0&&(a=a.sum(l)),a.reshape(i.shape)}}}),"Add")}}),N$=P({addN_:function(n){T(Array.isArray(n),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),T(n.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length}));var e=n.map((function(i,o){return A(i,"tensors"+o,"addN")})),t=e[0];e.forEach((function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(i){if(!Lt(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return N.runKernelFunc((function(i){return i.addN(e)}),r,(function(i){var o={};return e.forEach((function(s,a){o[a]=function(){return i.clone()}})),o}),"AddN")}}),F$=P({addStrict_:function(n,e){var t=A(n,"a","addStrict"),r=A(e,"b","addStrict");return je(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),L$=P({atan2_:function(n,e){var t,r=A(n,"a","atan2"),i=A(e,"b","atan2");t=gt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return N.runKernelFunc((function(s,a){var l=s.atan2(r,i);return a([r,i]),l}),{$a:r,$b:i},(function(s,a){var l=a[0],u=a[1];return{$a:function(){var c=Ie(l.square(),u.square()),d=s.mul(u.div(c)),h=Tt(l.shape,o);return h.length>0&&(d=d.sum(h)),d.reshape(l.shape)},$b:function(){var c=Ie(l.square(),u.square()),d=dc(s.mul(l.div(c))),h=Tt(u.shape,o);return h.length>0&&(d=d.sum(h)),d.reshape(u.shape)}}}))}}),nr=P({div_:function(n,e){var t,r=A(n,"a","div"),i=A(e,"b","div");if(t=gt(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return tE(r,i);var o=Oe(r.shape,i.shape);return N.runKernelFunc((function(s,a){var l=s.realDivide(r,i);return a([r,i]),l}),{a:r,b:i},(function(s,a){var l=a[0],u=a[1];return{a:function(){var c=s.div(u.toFloat()),d=Tt(l.shape,o);return d.length>0?c.sum(d).reshape(l.shape):c},b:function(){var c=s.mul(l.toFloat()),d=Tt(u.shape,o);d.length>0&&(c=c.sum(d).reshape(u.shape));var h=u.square();return c.div(h.toFloat()).neg()}}}),"Div")}}),B$=P({divNoNan_:function(n,e){var t,r=A(n,"a","div"),i=A(e,"b","div");r=(t=gt(r,i))[0],i=t[1];var o=nr(r,i),s=Le(o),a=i.equal(s);return ko(a,s,o)}}),H$=P({divStrict_:function(n,e){var t=A(n,"a","div"),r=A(e,"b","div");return je(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),tE=P({floorDiv_:function(n,e){var t,r=A(n,"a","floorDiv"),i=A(e,"b","floorDiv");t=gt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return N.runKernelFunc((function(s,a){var l=s.floorDiv(r,i);return a([r,i]),l}),{a:r,b:i},(function(s,a){var l=a[0],u=a[1];return{a:function(){var c=s.div(u.toFloat()),d=Tt(l.shape,o);return d.length>0?c.sum(d).reshape(l.shape):c},b:function(){var c=s.mul(l.toFloat()),d=Tt(u.shape,o);d.length>0&&(c=c.sum(d).reshape(u.shape));var h=u.square();return c.div(h.toFloat()).neg()}}}),"FloorDiv")}}),kg=P({maximum_:function(n,e){var t,r=A(n,"a","maximum"),i=A(e,"b","maximum");return t=gt(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Oe(r.shape,i.shape),N.runKernelFunc((function(o,s){var a=o.maximum(r,i);return s([r,i]),a}),{a:r,b:i},(function(o,s){var a=s[0],l=s[1];return{a:function(){return o.mul(a.greaterEqual(l).toFloat())},b:function(){return o.mul(a.less(l).toFloat())}}}),"Maximum")}}),W$=P({maximumStrict_:function(n,e){var t=A(n,"a","maximumStrict"),r=A(e,"b","maximumStrict");return je(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),nE=P({minimum_:function(n,e){var t,r=A(n,"a","minimum"),i=A(e,"b","minimum");return t=gt(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Oe(r.shape,i.shape),N.runKernelFunc((function(o,s){var a=o.minimum(r,i);return s([r,i]),a}),{a:r,b:i},(function(o,s){var a=s[0],l=s[1];return{a:function(){return o.mul(a.lessEqual(l).toFloat())},b:function(){return o.mul(a.greater(l).toFloat())}}}),"Minimum")}}),z$=P({minimumStrict_:function(n,e){var t=A(n,"a","minimumStrict"),r=A(e,"b","minimumStrict");return je(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),V$=P({mod_:function(n,e){var t,r=A(n,"a","mod"),i=A(e,"b","mod");t=gt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return N.runKernelFunc((function(s,a){var l=s.mod(r,i);return a([r,i]),l}),{$a:r,$b:i},(function(s,a){var l=a[0],u=a[1];return{$a:function(){var c=Tt(l.shape,o);return c.length>0?s.sum(c).reshape(l.shape):s},$b:function(){var c=s.mul(l.div(u).floor().neg()),d=Tt(u.shape,o);return d.length>0?c.sum(d).reshape(u.shape):c}}}))}}),U$=P({modStrict_:function(n,e){var t=A(n,"a","modStrict"),r=A(e,"b","modStrict");return je(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),en=P({mul_:function(n,e){var t,r=A(n,"a","mul"),i=A(e,"b","mul");t=gt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return N.runKernelFunc((function(s,a){var l=s.multiply(r,i);return a([r,i]),l}),{a:r,b:i},(function(s,a){var l=a[0],u=a[1];return{a:function(){var c=s.mul(u.toFloat()),d=Tt(l.shape,o);return d.length>0?c.sum(d).reshape(l.shape):c},b:function(){var c=s.mul(l.toFloat()),d=Tt(u.shape,o);return d.length>0?c.sum(d).reshape(u.shape):c}}}),"Mul")}}),j$=P({mulStrict_:function(n,e){var t=A(n,"a","mul"),r=A(e,"b","mul");return je(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),hc=P({pow_:function(n,e){var t,r=A(n,"base","pow"),i=A(e,"exp","pow");t=gt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape),s=[r,i];return N.runKernelFunc((function(a,l){var u=a.pow(r,i);return l([r,i,u]),u}),{a:r,b:i},(function(a,l){var u=l[0],c=l[1],d=l[2];return{a:function(){var h=c.toFloat(),f=a.mul(h.mul(u.pow(h.sub(te(1))))),p=Tt(u.shape,o);return p.length>0&&(f=f.sum(p)),f.reshape(u.shape)},b:function(){var h=u.greater(0),f=u.log().where(h,Le(u)),p=a.mul(d.mul(f)),g=Tt(c.shape,o);return g.length>0&&(p=p.sum(g)),p.reshape(c.shape)}}}),"Pow",{},s,[!0])}}),$$=P({powStrict_:function(n,e){return je(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),G$=P({squaredDifferenceStrict_:function(n,e){var t=A(n,"a","squaredDifferenceStrict"),r=A(e,"b","squaredDifferenceStrict");return je(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),It=P({sub_:function(n,e){var t,r=A(n,"a","sub"),i=A(e,"b","sub");t=gt(r,i),r=t[0],i=t[1];var o=Oe(r.shape,i.shape);return N.runKernelFunc((function(s){return s.subtract(r,i)}),{a:r,b:i},(function(s){return{a:function(){var a=s,l=Tt(r.shape,o);return l.length>0&&(a=a.sum(l)),a.reshape(r.shape)},b:function(){var a=s,l=Tt(i.shape,o);return l.length>0&&(a=a.sum(l)),a.neg().reshape(i.shape)}}}),"Sub")}}),q$=P({subStrict_:function(n,e){var t=A(n,"a","subStrict"),r=A(e,"b","subStrict");return je(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),rE=P({equal_:function(n,e){var t,r=A(n,"a","equal"),i=A(e,"b","equal");return t=gt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),N.runKernelFunc((function(o){return o.equal(r,i)}),{$a:r,$b:i})}}),Y$=P({equalStrict_:function(n,e){var t=A(n,"a","equalStrict"),r=A(e,"b","equalStrict");return je(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),X$=P({greater_:function(n,e){var t,r=A(n,"a","greater"),i=A(e,"b","greater");return t=gt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),N.runKernelFunc((function(o){return o.greater(r,i)}),{a:r,b:i},null,"Greater")}}),iE=P({greaterEqual_:function(n,e){var t,r=A(n,"a","greaterEqual"),i=A(e,"b","greaterEqual");return t=gt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),N.runKernelFunc((function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a}),{a:r,b:i},(function(o,s){var a=s[0],l=s[1];return{a:function(){return Le(a)},b:function(){return Le(l)}}}),"GreaterEqual")}}),K$=P({greaterEqualStrict_:function(n,e){var t=A(n,"a","greaterEqualStrict"),r=A(e,"b","greaterEqualStrict");return je(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),Q$=P({greaterStrict_:function(n,e){var t=A(n,"a","greaterStrict"),r=A(e,"b","greaterStrict");return je(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),J$=P({less_:function(n,e){var t,r=A(n,"a","less"),i=A(e,"b","less");return t=gt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),N.runKernelFunc((function(o){return o.less(r,i)}),{a:r,b:i},null,"Less")}}),Z$=P({lessEqual_:function(n,e){var t,r=A(n,"a","lessEqual"),i=A(e,"b","lessEqual");return t=gt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),N.runKernelFunc((function(o,s){var a=o.lessEqual(r,i);return s([r,i]),a}),{a:r,b:i},null,"LessEqual")}}),e5=P({lessEqualStrict_:function(n,e){var t=A(n,"a","lessEqualStrict"),r=A(e,"b","lessEqualStrict");return je(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),t5=P({lessStrict_:function(n,e){var t=A(n,"a","lessStrict"),r=A(e,"b","lessStrict");return je(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),n5=P({notEqual_:function(n,e){var t,r=A(n,"a","notEqual"),i=A(e,"b","notEqual");return t=gt(r,i),r=t[0],i=t[1],Oe(r.shape,i.shape),N.runKernelFunc((function(o){return o.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),r5=P({notEqualStrict_:function(n,e){var t=A(n,"a","notEqualStrict"),r=A(e,"b","notEqualStrict");return je(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function N0(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function F0(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Rg=P({gather_:function(n,e,t){t===void 0&&(t=0);var r=A(n,"x","gather"),i=A(e,"indices","gather","int32");t=Mt(t,r.shape)[0];var o=(function(s,a,l){for(var u=s.shape[l],c=[],d=1,h=1,f=0;f<l;f++)c.push(s.shape[f]),d*=s.shape[f];for(f=0;f<a.rank;f++)c.push(a.shape[f]);for(f=l+1;f<s.rank;f++)c.push(s.shape[f]),h*=s.shape[f];return{batchSize:d,sliceSize:h,dimSize:u,outputShape:c}})(r,i,t);return N.runKernelFunc((function(s,a){var l=s.gather(r,i.flatten(),t);return a([i]),l}),{x:r,indices:i},(function(s,a){var l=a[0];return{x:function(){var u=r.shape,c=l.size,d=u.slice(0,t),h=d.length,f=u.slice(t,u.length).slice(1),p=f.length,g=N0(0,h),m=N0(h+1,h+1+p),v=F0([d,[c],f]),y=s.reshape(v),b=l.reshape([c]),x=F0([[h],g,m]),w=y.transpose(x),_=oE(w,b,r.shape[t]),C=gg(x);return _=_.transpose(C)},indices:function(){return l}}}),"Gather",{axis:t}).reshape(o.outputShape)}}),oE=P({unsortedSegmentSum_:function(n,e,t){var r=A(n,"x","unsortedSegmentSum"),i=A(e,"segmentIds","unsortedSegmentSum","int32");return T(wt(t),(function(){return"numSegments must be of dtype int"})),N.runKernelFunc((function(o,s){var a=o.unsortedSegmentSum(r,i,t);return s([i]),a}),{$x:r},(function(o,s){var a=s[0];return{$x:function(){return(function(l,u){for(var c=kg(u,Le(u)),d=Rg(l,c),h=iE(u,te(0,"int32")),f=d.rank-h.rank,p=0;p<f;++p)h=qn(h,p+1);h=Yc(h,Fs(d.shape,"bool"));var g=Le(d);return ko(h,d,g)})(o,a)}}}))}}),i5=function(n,e,t){return oe(this,void 0,void 0,(function(){var r,i,o,s,a,l,u,c,d,h,f,p,g;return se(this,(function(m){switch(m.label){case 0:for(r=A(n,"tensor","boolMask"),i=A(e,"mask","boolMask","bool"),o=t??0,s=i.rank,a=r.shape,T(s>0,(function(){return"mask cannot be scalar"})),je(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),l=1,u=o;u<o+s;u++)l*=a[u];return c=a.slice(0,o).concat([l],a.slice(o+s)),d=r.reshape(c),h=i.reshape([-1]),[4,eE(h)];case 1:return f=m.sent(),p=f.squeeze([1]),g=Rg(d,p,o),n!==r&&r.dispose(),e!==i&&i.dispose(),p.dispose(),d.dispose(),h.dispose(),f.dispose(),[2,g]}}))}))};function sE(n,e,t,r,i,o,s){o===void 0&&(o="NHWC"),T(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var a=n,l=e,u=!1;e.rank===3&&(u=!0,l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),T(a.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."})),T(l.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank})),T(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var c=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];T(c===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."})),T(d===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+t.shape[3]+"."})),s!=null&&T(wt(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."}));var h=xg(o),f=Fo(a,t.shape,r,1,i,s,!1,h),p=N.runKernelFunc((function(g,m){var v=g.conv2dDerInput(l,t,f);return m([t,l]),v}),{dy4D:l,filter:t},(function(g,m){var v=m[0],y=m[1];return{dy4D:function(){return Kn(g,v,r,i,o,1,s)},filter:function(){return Tg(g,y,v.shape,r,i,o,s)}}}));return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Th(n){var e=(function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o})(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function aE(n,e,t,r,i){T(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var o=n,s=e,a=!1;e.rank===4&&(a=!0,s=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var l=o[4],u=s.shape[4];T(o.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."})),T(s.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank})),T(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),T(l===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[3]+"."})),T(u===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+t.shape[4]+"."}));var c=uc(o,t.shape,r,1,i),d=N.runKernelFunc((function(h){return h.conv3dDerInput(s,t,c)}),{dy5D:s});return a?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var o5=P({conv1d_:function(n,e,t,r,i,o,s){i===void 0&&(i="NWC"),o===void 0&&(o=1);var a=A(n,"x","conv1d"),l=A(e,"filter","conv1d"),u=a,c=!1;a.rank===2&&(c=!0,u=a.as3D(1,a.shape[0],a.shape[1])),T(u.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."})),T(l.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."})),s!=null&&T(wt(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."})),T(u.shape[2]===l.shape[1],(function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+l.shape[1]+"."})),T(Sn(t,o),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"})),T(i==="NWC",(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),h=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),f=Kn(h,d,[1,t],r,"NHWC",[1,o],s);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),Kn=P({conv2d_:function(n,e,t,r,i,o,s){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var a=A(n,"x","conv2d"),l=A(e,"filter","conv2d"),u=a,c=!1;a.rank===3&&(c=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(u.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."})),T(l.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."})),s!=null&&T(wt(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}));var d=i==="NHWC"?u.shape[3]:u.shape[1];T(d===l.shape[2],(function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+l.shape[2]+"."})),T(Sn(t,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}));var h=xg(i),f=Fo(u.shape,l.shape,t,o,r,s,!1,h),p=[l,u],g=N.runKernelFunc((function(m,v){var y=m.conv2d(u,l,f);return v([l,u]),y}),{x:u,filter:l},(function(m,v){var y=v,b=y[0],x=y[1];return T(Is(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"})),{x:function(){return lE(x.shape,m,b,t,r,i)},filter:function(){return Tg(x,m,b.shape,t,r,i)}}}),"Conv2D",f,p);return c?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),s5=P({conv3d_:function(n,e,t,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var s=A(n,"x","conv3d"),a=A(e,"filter","conv3d"),l=s,u=!1;s.rank===4&&(u=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),T(l.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+l.rank+"."})),T(a.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."})),T(l.shape[4]===a.shape[3],(function(){return"Error in conv3d: depth of input ("+l.shape[4]+") must match input depth for filter "+a.shape[3]+"."})),T((function(h,f){return Th(h)||Th(f)})(t,o),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),T(i==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var c=uc(l.shape,a.shape,t,o,r),d=N.runKernelFunc((function(h,f){var p=h.conv3d(l,a,c);return f([l,a]),p}),{x:l,$filter:a},(function(h,f){T(Th(o),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}));var p=f[0],g=f[1];return{x:function(){return aE(p.shape,h,g,t,r)},$filter:function(){return(function(m,v,y,b,x){var w=m;m.rank===4&&(w=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var _=v;_.rank===4&&(_=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),T(w.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+w.shape+"."})),T(_.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."})),T(y.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."})),T(w.shape[4]===y[3],(function(){return"Error in conv3dDerFilter: depth of input "+w.shape[4]+") must match input depth in filter ("+y[3]+"."})),T(_.shape[4]===y[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+y[4]+")."}));var C=uc(w.shape,y,b,1,x);return N.runKernelFunc((function(E){return E.conv3dDerFilter(w,_,C)}),{x5D:w,dy5D:_})})(p,h,g.shape,t,r)}}}));return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Tg=P({conv2dDerFilter_:function(n,e,t,r,i,o,s){o===void 0&&(o="NHWC");var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var l=e;l.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),T(a.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."})),T(l.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."})),T(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var u=o==="NHWC"?a.shape[3]:a.shape[1],c=o==="NHWC"?l.shape[3]:l.shape[1];T(u===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+t[2]+"."})),T(c===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."})),s!=null&&T(wt(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."}));var d=xg(o),h=Fo(a.shape,t,r,1,i,s,!1,d);return N.runKernelFunc((function(f){return f.conv2dDerFilter(a,l,h)}),{x4D:a,dy4D:l})}}),lE=P({conv2dDerInput_:sE}),Xc=P({depthwiseConv2d_:function(n,e,t,r,i,o,s){o===void 0&&(o=[1,1]);var a=A(n,"x","depthwiseConv2d"),l=A(e,"filter","depthwiseConv2d"),u=a,c=!1;a.rank===3&&(c=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(u.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."})),T(l.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."})),T(u.shape[3]===l.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."})),o==null&&(o=[1,1]),T(Sn(t,o),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),s!=null&&T(wt(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}));var d=Fo(u.shape,l.shape,t,o,r,s,!0),h=[u,l],f=N.runKernelFunc((function(p,g){var m=p.depthwiseConv2D(u,l,d);return g([u,l]),m}),{x:u,filter:l},(function(p,g){T(Is(o),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"}));var m=g[0],v=g[1];return{x:function(){return uE(m.shape,p,v,d)},filter:function(){return cE(m,p,v.shape,d)}}}),"DepthwiseConv2dNative",d,h);return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),uE=P({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=N.runKernelFunc((function(a){return a.depthwiseConv2DDerInput(i,t,r)}),{dy4D:i});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),cE=P({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),N.runKernelFunc((function(s){return s.depthwiseConv2DDerFilter(i,o,r)}),{x4D:i,dy4D:o})}}),Ig=P({separableConv2d_:function(n,e,t,r,i,o,s){o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC");var a=A(n,"x","separableConv2d"),l=A(e,"depthwiseFilter","separableConv2d"),u=A(t,"pointwiseFilter","separableConv2d"),c=a,d=!1;if(a.rank===3&&(d=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(c.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."})),T(l.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."})),T(u.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."})),T(u.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."})),T(u.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."}));var h=l.shape[2],f=l.shape[3];T(u.shape[2]===h*f,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+u.shape[2]+"."}));var p=Xc(c,l,r,i,s,o),g=Kn(p,u,1,"valid",s);return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),a5=P({conv2dTranspose_:function(n,e,t,r,i,o){return sE(t,A(n,"x","conv2dTranspose"),A(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),l5=P({conv3dTranspose_:function(n,e,t,r,i){return aE(t,A(n,"x","conv3dTranspose"),A(e,"filter","conv3dTranspose"),r,i)}}),Kc=P({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=A(n,"a","matMul"),s=A(e,"b","matMul");i=gt(o,s),o=i[0],s=i[1];var a=t?o.shape[o.rank-2]:o.shape[o.rank-1],l=r?s.shape[s.rank-1]:s.shape[s.rank-2],u=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?s.shape[s.rank-2]:s.shape[s.rank-1],d=o.shape.slice(0,-2),h=s.shape.slice(0,-2),f=le(d),p=le(h);T(o.rank>=2&&s.rank>=2&&o.rank===s.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."})),T(Lt(d,h),(function(){return"Error in matMul: outer dimensions ("+d+") and ("+h+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."})),T(a===l,(function(){return"Error in matMul: inner shapes ("+a+") and ("+l+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+t+" and transposeB="+r+" must match."}));var g=o.shape.slice(0,-2).concat([u,c]),m=t?o.as3D(f,a,u):o.as3D(f,u,a),v=r?s.as3D(p,c,l):s.as3D(p,l,c),y={transposeA:t,transposeB:r};return N.runKernelFunc((function(b,x){var w=b.batchMatMul(m,v,t,r);return x([m,v]),w}),{a:m,b:v},(function(b,x){var w=x,_=w[0],C=w[1];return t||r?!t&&r?{a:function(){return b.matMul(C,!1,!1)},b:function(){return b.matMul(_,!0,!1)}}:t&&!r?{a:function(){return C.matMul(b,!1,!0)},b:function(){return _.matMul(b,!1,!1)}}:{a:function(){return C.matMul(b,!0,!0)},b:function(){return b.matMul(_,!0,!0)}}:{a:function(){return b.matMul(C,!1,!0)},b:function(){return _.matMul(b,!0,!1)}}}),"BatchMatMul",y).reshape(g)}}),u5=P({dot_:function(n,e){var t=A(n,"t1","dot"),r=A(e,"t2","dot");T(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."}));var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return T(i===o,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."})),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),c5=P({outerProduct_:function(n,e){var t=A(n,"v1","outerProduct"),r=A(e,"v2","outerProduct");return T(t.rank===1&&r.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."})),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),sl=P({reverse_:function(n,e){var t=A(n,"x","reverse");if(t.rank===0)return t.clone();var r=Mt(e,t.shape);return N.runKernelFunc((function(i){return i.reverse(t,r)}),{$x:t},(function(i){return{$x:function(){return i.reverse(r)}}})).reshapeAs(t)}}),d5=P({reverse1d_:function(n){var e=A(n,"x","reverse");return T(e.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),sl(e,0)}}),h5=P({reverse2d_:function(n,e){var t=A(n,"x","reverse");return T(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),sl(t,e)}}),f5=P({reverse3d_:function(n,e){var t=A(n,"x","reverse");return T(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),sl(t,e)}}),p5=P({reverse4d_:function(n,e){var t=A(n,"x","reverse");return T(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),sl(t,e)}});function dE(n,e,t,r,i,o){var s=A(n,"x","maxPool"),a=s,l=!1;s.rank===3&&(l=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(a.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."})),T(Sn(t,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"})),o!=null&&T(wt(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var u=Ha(a.shape,e,t,r,i,o);if(u.filterWidth===1&&u.filterHeight===1&&Lt(u.inShape,u.outShape))return s.clone();var c=[a],d=N.runKernelFunc((function(h,f){var p=h.maxPool(a,u);return f([a,p]),p}),{x:a},(function(h,f){var p=f[0],g=f[1];return{x:function(){return(function(m,v,y,b,x,w,_,C){var E=A(m,"dy","maxPoolBackprop"),S=A(v,"input","maxPoolBackprop"),D=A(y,"output","maxPoolBackprop");T(S.rank===E.rank,(function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+E.rank+")"})),T(Sn(x,w),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+w+"'"})),T(E.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."})),T(S.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+S.rank+"."}));var k=Ha(S.shape,b,x,w,_,C);return N.runKernelFunc((function(M){return M.maxPoolBackprop(E,S,D,k)}),{$dy:E,$input:S})})(h,p,g,e,t,r,i)}}}),"MaxPool",u,c);return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function hE(n,e,t,r,i,o){var s=A(n,"x","avgPool","float32");T(Sn(t,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}));var a=s,l=!1;s.rank===3&&(l=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(a.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."})),o!=null&&T(wt(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var u=Ha(a.shape,e,t,r,i,o);if(u.filterWidth===1&&u.filterHeight===1&&Lt(u.inShape,u.outShape))return s.clone();var c=N.runKernelFunc((function(d){return d.avgPool(a,u)}),{x:a},(function(d){return{x:function(){return(function(h,f,p,g,m,v){var y=A(h,"dy","avgPoolBackprop"),b=A(f,"input","avgPoolBackprop");T(b.rank===y.rank,(function(){return"Rank of input ("+b.rank+") does not match rank of dy ("+y.rank+")"})),T(Sn(g,m),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"}));var x=b,w=y,_=!1;b.rank===3&&(_=!0,x=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]),w=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),T(w.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+w.rank+"."})),T(x.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+x.rank+"."}));var C=Ha(x.shape,p,g,m,v),E=N.runKernelFunc((function(S){return S.avgPoolBackprop(w,x,C)}),{dy4D:w,input4D:x});return _?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E})(d,a,e,t,r,i)}}}),"AvgPool",u);return c=c.cast(s.dtype),l?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Pt=P({maxPool_:function(n,e,t,r,i){return dE(n,e,t,1,r,i)}}),al=P({avgPool_:function(n,e,t,r,i){return hE(n,e,t,1,r,i)}}),g5=P({pool_:function(n,e,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var s=A(n,"x","maxPool"),a=s,l=!1;s.rank===3&&(l=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(Sn(o,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}));var u,c=Ha(a.shape,e,o,i,r),d=[c.dilationHeight,c.dilationWidth];u=r==="same"?(function(x,w){var _=x.map((function(S,D){return S+(S-1)*(w[D]-1)})).map((function(S){return S-1})),C=_.map((function(S){return Math.floor(S/2)})),E=_.map((function(S,D){return S-C[D]}));return _.map((function(S,D){return[C[D],E[D]]}))})([c.filterHeight,c.filterWidth],d):[[0,0],[0,0]];var h=d[0]===1&&d[1]===1,f=(function(x,w,_){var C=_.map((function(H){return H[0]})),E=_.map((function(H){return H[1]})),S=x.concat(C,E),D=w.map((function(H,F){return(H-S[F]%H)%H})),k=E.map((function(H,F){return H+D[F]})),M=w.map((function(H,F){return[C[F],k[F]]})),B=w.map((function(H,F){return[0,D[F]]}));return[M,B]})([c.inHeight,c.inWidth],d,u),p=f[0],g=f[1],m=h?r:"valid",v=h?a:yC(a,d,p),y=(t==="avg"?function(){return hE(v,e,o,1,m)}:function(){return dE(v,e,o,1,m)})(),b=h?y:gC(y,d,g);return l?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),m5=P({maxPool3d_:function(n,e,t,r,i,o,s){o===void 0&&(o="NDHWC");var a=A(n,"x","maxPool3d"),l=a,u=!1;a.rank===4&&(u=!0,l=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),s==null&&(s=[1,1,1]),T(l.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+l.rank+"."})),T(o==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),T(Sn(t,s),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"})),i!=null&&T(wt(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var c=lc(l.shape,e,t,s,r,i,o),d=N.runKernelFunc((function(h,f){var p=h.maxPool3d(l,c);return f([l,p]),p}),{x:l},(function(h,f){var p=f[0],g=f[1];return{x:function(){return(function(m,v,y,b,x,w,_,C){var E=A(m,"dy","maxPool3dBackprop"),S=A(v,"input","maxPool3dBackprop"),D=A(y,"output","maxPool3dBackprop"),k=E,M=S,B=D,H=!1;S.rank===4&&(H=!0,k=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),M=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),B=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3])),T(k.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+k.rank+"."})),T(M.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."})),T(B.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+B.rank+"."})),w==null&&(w=[1,1,1]),T(Sn(x,w),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+w+"'"})),C!=null&&T(wt(_),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+C+" but got pad "+_+"."}));var F=lc(M.shape,b,x,w,_,C),W=N.runKernelFunc((function(j){return j.maxPool3dBackprop(k,M,B,F)}),{dy5D:k,input5D:M});return H?W.as4D(W.shape[1],W.shape[2],W.shape[3],W.shape[4]):W})(h,p,g,e,t,s,r,i)}}}));return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),v5=P({avgPool3d_:function(n,e,t,r,i,o,s){o===void 0&&(o="NDHWC");var a=A(n,"x","avgPool3d","float32"),l=a,u=!1;a.rank===4&&(u=!0,l=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),s==null&&(s=[1,1,1]),T(l.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+l.rank+"."})),T(o==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),T(Sn(t,s),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"})),i!=null&&T(wt(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var c=lc(l.shape,e,t,s,r,i,o),d=N.runKernelFunc((function(h){return h.avgPool3d(l,c)}),{x:l},(function(h){return{x:function(){return(function(f,p,g,m,v,y,b){var x=A(f,"dy","avgPool3dBackprop"),w=A(p,"input","avgPool3dBackprop"),_=x,C=w,E=!1;w.rank===4&&(E=!0,_=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3]),C=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3])),T(_.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."})),T(C.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+C.rank+"."})),v==null&&(v=[1,1,1]),T(Sn(m,v),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+v+"'"})),b!=null&&T(wt(y),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+b+" but got pad "+y+"."}));var S=lc(C.shape,g,m,v,y,b),D=N.runKernelFunc((function(k){return k.avgPool3dBackprop(_,C,S)}),{dy5D:_,input5D:C});return E?D.as4D(D.shape[1],D.shape[2],D.shape[3],D.shape[4]):D})(h,l,e,t,s,r,i)}}}));return d=d.cast(l.dtype),u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Or=P({slice_:function(n,e,t){var r,i,o=A(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach((function(l){T(l!==-1,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map((function(l,u){return l>=0?l:(T(l===-1,(function(){return"Negative size values should be exactly -1 but got "+l+" for the slice() size at index "+u+"."})),o.shape[u]-r[u])})),$V(o,r,i);var s=o.shape,a={begin:r,size:i};return N.runKernelFunc((function(l){return l.slice(o,r,i)}),{x:o},(function(l){for(var u=[],c=0;c<l.rank;c++)u.push([r[c],s[c]-r[c]-i[c]]);return{x:function(){return l.pad(u)}}}),"Slice",a)}}),y5=P({slice1d_:function(n,e,t){var r=A(n,"x","slice1d");return T(r.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Or(r,[e],[t])}}),b5=P({slice2d_:function(n,e,t){var r=A(n,"x","slice2d");return T(r.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Or(r,e,t)}}),fE=P({slice3d_:function(n,e,t){var r=A(n,"x","slice3d");return T(r.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Or(r,e,t)}}),x5=P({slice4d_:function(n,e,t){var r=A(n,"x","slice4d");return T(r.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Or(r,e,t)}});function pE(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(En(e.shape,r))),n.rank<t.rank&&(n=n.reshape(En(n.shape,r))),{x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return i==null?o:o.transpose(i)}}}var w5=P({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=A(n,"x","all","bool"),i=Mt(e,r.shape),o=i,s=Fr(o,r.rank);s!=null&&(r=r.transpose(s),o=Lr(o.length,r.rank));var a=N.runKernelFunc((function(u){return u.all(r,o)}),{$x:r});if(t){var l=En(a.shape,i);return a.reshape(l)}return a}}),_5=P({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=A(n,"x","any","bool"),i=Mt(e,r.shape),o=i,s=Fr(o,r.rank);s!=null&&(r=r.transpose(s),o=Lr(o.length,r.rank));var a=N.runKernelFunc((function(u){return u.any(r,o)}),{$x:r});if(t){var l=En(a.shape,i);return a.reshape(l)}return a}}),C5=P({argMax_:function(n,e){e===void 0&&(e=0);var t=A(n,"x","argMax");e==null&&(e=0);var r=Mt(e,t.shape),i=Fr(r,t.rank);i!=null&&(t=t.transpose(i),r=Lr(r.length,t.rank));var o={axis:r[0]},s=[t];return N.runKernelFunc((function(a,l){var u=a.argMax(t,r[0]);return l([t]),u}),{x:t},(function(a,l){var u=l[0];return{x:function(){return Le(u)}}}),"ArgMax",o,s)}}),E5=P({argMin_:function(n,e){e===void 0&&(e=0);var t=A(n,"x","argMin");e==null&&(e=0);var r=Mt(e,t.shape),i=Fr(r,t.rank);return i!=null&&(t=t.transpose(i),r=Lr(r.length,t.rank)),N.runKernelFunc((function(o,s){var a=o.argMin(t,r[0]);return s([t]),a}),{$x:t},(function(o,s){var a=s[0];return{$x:function(){return Le(a)}}}))}}),S5=P({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=A(n,"x","logSumExp"),i=Mt(e,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(t){var l=En(a.shape,i);return a.reshape(l)}return a}}),Qc=P({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=A(n,"x","max"),i=r,o=Mt(e,r.shape),s=o,a=Fr(s,r.rank);a!=null&&(r=r.transpose(a),s=Lr(s.length,r.rank));var l=[r],u=N.runKernelFunc((function(d,h){var f=d.max(r,s);return h([i,f]),f}),{x:r},(function(d,h){return pE(d,h[1],h[0],o,a)}),"Max",{axes:s},l,[!0]);if(t){var c=En(u.shape,o);u=u.reshape(c)}return u}}),D5=P({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=A(n,"x","mean"),i=Mt(e,r.shape),o=le(Gt(r.shape,i)[1]);return Gc((function(s){var a=te(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(l){var u=s.shape.slice();return i.forEach((function(c){u[c]=1})),l.reshape(u).mul(Fs(s.shape,"float32")).div(o)}}}))(r)}}),A5=P({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=A(n,"x","min"),i=r,o=Mt(e,r.shape),s=o,a=Fr(s,r.rank);a!=null&&(r=r.transpose(a),s=Lr(s.length,r.rank));var l=[r],u=N.runKernelFunc((function(d,h){var f=d.min(r,s);return h([i,f]),f}),{x:r},(function(d,h){return pE(d,h[1],h[0],o,a)}),"Min",{axes:s},l,[!0]);if(t){var c=En(u.shape,o);u=u.reshape(c)}return u}}),k5=P({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Mt(e,(n=A(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=En(i.shape,r));var s=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,t)}}}),gE=P({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=A(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=Mt(e,r.shape);return Gc((function(o){var s=Fr(i,o.rank),a=i,l=o;s!=null&&(l=o.transpose(s),a=Lr(a.length,o.rank));var u=function(f){var p=o.shape.slice();return i.forEach((function(g){p[g]=1})),f.reshape(p).mul(Fs(o.shape,"float32"))},c={axes:a},d=N.runKernelFunc((function(f){return f.sum(l,a)}),{x:l},(function(f){return{x:function(){return u(f)}}}),"Sum",c);if(t){var h=En(d.shape,i);d=d.reshape(h)}return{value:d,gradFunc:u}}))(r)}}),R5=P({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=A(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=Mt(e,r.shape),o=Fr(i,r.rank),s=i,a=r;o!=null&&(a=r.transpose(o),s=Lr(s.length,r.rank));var l=N.runKernelFunc((function(c){return c.prod(a,s)}),{permutedX:a});if(t){var u=En(l.shape,i);l=l.reshape(u)}return l}}),mE=P({elu_:function(n){var e=A(n,"x","elu");return N.runKernelFunc((function(t,r){var i=t.elu(e);return r([i]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return N.runKernelFunc((function(o){return o.eluDer(t,i)}),{dy:t,y:i})}}}))}}),T5=P({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=A(n,"x","leakyRelu");return kg(te(e).mul(t),t)}}),vE=P({prelu_:function(n,e){var t=A(n,"x","prelu"),r=A(e,"alpha","prelu");return N.runKernelFunc((function(i,o){var s=i.prelu(t,r);return o([t,r]),s}),{x:t,alpha:r},(function(i,o){var s=o[0],a=o[1],l=s.greater(0);return{x:function(){return ko(l,i,i.mul(a))},alpha:function(){var u=ko(l,Le(i),i.mul(s)),c=Tt(a.shape,i.shape);return c.length>0&&(u=u.sum(c)),u.reshape(a.shape)}}}),"Prelu")}}),pt=P({relu_:function(n){var e=A(n,"x","relu");return e.dtype==="bool"?e.toInt():N.runKernelFunc((function(t,r){var i=t.relu(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}}),"Relu")}}),yE=P({relu6_:function(n){var e=A(n,"x","relu6");return e.dtype==="bool"?e.toInt():N.runKernelFunc((function(t,r){var i=t.relu6(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}}),"Relu6")}}),I5=P({selu_:function(n){var e=A(n,"x","selu");return N.runKernelFunc((function(t,r){var i=t.selu(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){var o=i.greater(te(0)),s=te(Sg),a=te(Dg),l=t.mul(a),u=t.mul(s).mul(i.toFloat().exp());return ko(o,l,u)}}}))}}),Fi=P({transpose_:function(n,e){var t=A(n,"x","transpose");if(e==null&&(e=t.shape.map((function(i,o){return o})).reverse()),T(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."})),e.forEach((function(i){T(i>=0&&i<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e}))})),t.rank<=1)return t.clone();var r={perm:e};return N.runKernelFunc((function(i){return i.transpose(t,e)}),{x:t},(function(i){var o=gg(e);return{x:function(){return i.transpose(o)}}}),"Transpose",r)}}),M5=P({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=A(n,"x","localResponseNormalization");T(o.rank===4||o.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."})),T(wt(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var s=o,a=!1;o.rank===3&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var l=N.runKernelFunc((function(u,c){var d=u.localResponseNormalization4D(s,e,t,r,i);return c([s,d]),d}),{x4D:s},(function(u,c){var d=c[0],h=c[1];return{x4D:function(){return N.runKernelFunc((function(f){return f.LRNGrad(u,d,h,e,t,r,i)}),{})}}}));return a?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),bE=P({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=(function a(l,u,c){if(c===void 0&&(c=null),l.rank===0)return l.abs();if(l.rank!==1&&c===null)return a(l.reshape([-1]),u,c);if(l.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(u===1)return l.abs().sum(c);if(u===1/0)return l.abs().max(c);if(u===-1/0)return l.abs().min(c);if(u==="euclidean"||u===2)return l.abs().pow(te(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}if(Array.isArray(c)&&c.length===2){if(u===1)return l.abs().sum(c[0]).max(c[1]-1);if(u===1/0)return l.abs().sum(c[1]).max(c[0]);if(u===-1/0)return l.abs().sum(c[1]).min(c[0]);if(u==="fro"||u==="euclidean")return l.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}throw new Error("Error in norm: invalid axis: "+c)})(n=A(n,"x","norm"),e,t),o=i.shape;if(r){var s=Mt(t,n.shape);o=En(i.shape,s)}return i.reshape(o)}}),O5=P({basicLSTMCell_:function(n,e,t,r,i,o){var s=A(n,"forgetBias","basicLSTMCell"),a=A(e,"lstmKernel","basicLSTMCell"),l=A(t,"lstmBias","basicLSTMCell"),u=A(r,"data","basicLSTMCell"),c=A(i,"c","basicLSTMCell"),d=A(o,"h","basicLSTMCell"),h=u.concat(d,1).matMul(a).add(l),f=h.shape[0],p=h.shape[1]/4,g=[f,p],m=h.slice([0,0],g),v=h.slice([0,p],g),y=h.slice([0,2*p],g),b=h.slice([0,3*p],g),x=m.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(s.add(y).sigmoid())),w=x.tanh().mulStrict(b.sigmoid());return[x,w]}}),P5=P({multiRNNCell_:function(n,e,t,r){for(var i=A(e,"data","multiRNNCell"),o=nc(t,"c","multiRNNCell"),s=nc(r,"h","multiRNNCell"),a=i,l=[],u=0;u<n.length;u++){var c=n[u](a,o[u],s[u]);l.push(c[0]),l.push(c[1]),a=c[1]}var d=[],h=[];for(u=0;u<l.length;u+=2)d.push(l[u]),h.push(l[u+1]);return[d,h]}}),N5=P({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var o=A(n,"v","movingAverage"),s=A(e,"x","movingAverage"),a=A(t,"decay","movingAverage");Mz(o,s),T(Lt(o.shape,s.shape),(function(){return"Shape mismatch in v and x"}));var l=te(1),u=l.sub(a),c=s.sub(o).mul(u);if(i){T(r!=null,(function(){return"When using zeroDebias: true, step is required."}));var d=A(r,"step","movingAverage");c=c.div(l.sub(hc(a,d)))}return o.add(c)}}),F5=P({stridedSlice_:function(n,e,t,r,i,o,s,a,l){if(i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),l===void 0&&(l=0),r==null&&(r=new Array(e.length)),s!==0)throw new Error("ellipsis mask is not yet supported");var u=A(n,"x","stridedSlice"),c=g0(a),d=u.shape.slice();c.forEach((function(m){e[m]=0,t[m]=1,d.splice(m,0,1)})),u=u.reshape(d);for(var h=0;h<u.rank;h++)e[h]=GV(i,e,r,u.shape,h),t[h]=qV(o,t,r,u.shape,h),r[h]=r[h]||1;var f=g0(l);f.forEach((function(m){t[m]=e[m]+1,r[m]=1}));var p=bg(e,t,r),g=p.filter((function(m,v){return f.indexOf(v)===-1}));return r.every((function(m){return m===1}))?Or(u,e,p).reshape(g):N.runKernelFunc((function(m){return m.stridedSlice(u,e,t,r)}),{$x:u}).reshape(g)}}),L5=P({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=A(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=N.runKernelFunc((function(s){return s.topk(r,e,t)}),{$x:r});return{values:o[0],indices:o[1]}}}),B5=P({scatterND_:function(n,e,t){var r=A(n,"indices","scatterND","int32"),i=A(e,"updates","scatterND");return jV(i,r,t),N.runKernelFunc((function(o){return o.scatterND(r,i,t)}),{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),Mg=P({fft_:function(n){T(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return N.runKernelFunc((function(i){return i.fft(r)}),{input:n}).reshape(n.shape)}}),fc=P({ifft_:function(n){T(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return N.runKernelFunc((function(i){return i.ifft(r)}),{input:n}).reshape(n.shape)}}),Og=P({rfft_:function(n,e){T(n.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+n.dtype}));var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var o=n.shape.map((function(v){return 0})),s=n.shape.map((function(v){return v}));s[n.shape.length-1]=e,t=n.slice(o,s),r=e}else if(e!=null&&e>r){var a=n.shape.map((function(v){return v}));a[n.shape.length-1]=e-r,t=n.concat(et(a),n.shape.length-1),r=e}else t=n;var l=t.zerosLike(),u=zt(t,l).as2D(i,r),c=Mg(u),d=Math.floor(r/2)+1,h=Yn(c),f=Er(c),p=h.split([d,r-d],h.shape.length-1),g=f.split([d,r-d],f.shape.length-1),m=t.shape.slice();return m[t.shape.length-1]=d,zt(p[0],g[0]).reshape(m)}}),xE=P({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=fc(r);return Yn(i)}var o=[t,2*(e-1)],s=Yn(n).as2D(t,e),a=Er(n).as2D(t,e),l=s.slice([0,1],[t,e-2]).reverse(1),u=a.slice([0,1],[t,e-2]).reverse(1).mul(te(-1)),c=s.concat(l,1),d=a.concat(u,1);return r=zt(c,d).as2D(o[0],o[1]),i=fc(r),Yn(i)}}),H5=Object.freeze({fft:Mg,ifft:fc,rfft:Og,irfft:xE}),W5=P({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=A(n,"sparseIndices","sparseToDense","int32"),o=A(e,"sparseValues","sparseToDense"),s=A(r,"defaultValue","sparseToDense",o.dtype);return(function(a,l,u,c){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var d=a.rank>0?a.shape[0]:1,h=a.rank>1?a.shape[1]:1;if(u.length!==h)throw new Error("outputShape has incorrect number of elements:, "+u.length+", should be: "+h+".");var f=l.size;if(l.rank!==0&&(l.rank!==1||f!==d))throw new Error("sparseValues has incorrect shape "+l.shape+", should be [] or ["+d+"]");if(l.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(i,o,t,s),N.runKernelFunc((function(a){return a.sparseToDense(i,o,t,s)}),{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),z5=P({gatherND_:function(n,e){var t=A(e,"indices","gatherND","int32"),r=A(n,"x","gatherND");return N.runKernelFunc((function(i){return i.gatherND(r,t)}),{x:r,indices:t},null,"GatherNd")}}),V5=P({diag_:function(n){var e=A(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return N.runKernelFunc((function(r){return r.diag(e)}),{$x:e}).reshape(t)}}),U5=P({dropout_:function(n,e,t,r){var i=A(n,"x","dropout");if(T(i.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),T(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),e===0)return n instanceof ft?i.clone():i;var o=(function(l,u){if(u==null)return l.shape.slice();if(Lt(l.shape,u))return u;if(l.shape.length===u.length){for(var c=[],d=0;d<l.shape.length;d++)u[d]==null&&l.shape[d]!=null?c.push(l.shape[d]):c.push(u[d]);return c}return u})(i,t),s=1-e,a=vC(o,0,1,"float32",r).add(s).floor().div(s);return i.mul(a)}});function wE(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var s=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(s)}return Et(i,"float32")}var Pg=P({hannWindow_:function(n){return wE(n,.5,.5)}}),_E=P({hammingWindow_:function(n){return wE(n,.54,.46)}}),Ng=P({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,s=[];o+e<=n.size;)s.push(Or(n,o,e)),o+=t;if(r)for(;o<n.size;){var a=o+e-n.size,l=kt([Or(n,o,e-a),Tr([a],i)]);s.push(l),o+=t}return s.length===0?ki([],[0,e]):kt(s).as2D(s.length,e)}}),CE=P({stft_:function(n,e,t,r,i){var o;i===void 0&&(i=Pg),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var s=Ng(n,e,t),a=en(s,i(e)),l=[],u=0;u<s.shape[0];u++)l.push(Og(a.slice([u,0],[1,e]),r));return kt(l)}}),j5=Object.freeze({hannWindow:Pg,hammingWindow:_E,frame:Ng,stft:CE}),Jt,$5=function(n,e,t){return t===void 0&&(t=1),oe(this,void 0,void 0,(function(){var r,i,o,s,a,l,u,c,d,h,f,p,g,m;return se(this,(function(v){switch(v.label){case 0:return r=A(n,"predictions","inTopK"),i=A(e,"targets","inTopK"),T(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),T(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),je(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],T(t>0&&t<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t})),[4,r.data()];case 1:return s=v.sent(),[4,i.data()];case 2:for(a=v.sent(),l=[s.length/o,o],c=l[1],d=Fa("bool",u=l[0]),h=0;h<u;h++){for(f=h*c,p=s.subarray(f,f+c),g=[],m=0;m<p.length;m++)g.push({value:p[m],index:m});for(g.sort((function(y,b){return b.value-y.value})),d[h]=0,m=0;m<t;m++)if(g[m].index===a[h]){d[h]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,Ut(d,i.shape,"bool")]}}))}))};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Jt||(Jt={}));var G5=P({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=Jt.SUM_BY_NONZERO_WEIGHTS);var i=A(n,"labels","absoluteDifference"),o=A(e,"predictions","absoluteDifference"),s=null;t!=null&&(s=A(t,"weights","absoluteDifference")),je(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return oi(a,s,r)}}),oi=P({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=Jt.SUM_BY_NONZERO_WEIGHTS);var r=A(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=A(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===Jt.NONE)return o;if(t===Jt.SUM)return o.sum();if(t===Jt.MEAN){if(i==null)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(te(s)):a}if(t===Jt.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(te(r.size));var l=i.mul(Fs(r.shape)).notEqual(te(0)).sum().toFloat();return o.sum().div(l)}throw Error("Unknown reduction: "+t)}}),q5=P({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=Jt.SUM_BY_NONZERO_WEIGHTS);var o=A(n,"labels","cosineDistance"),s=A(e,"predictions","cosineDistance"),a=null;r!=null&&(a=A(r,"weights","cosineDistance")),je(o.shape,s.shape,"Error in cosineDistance: ");var l=te(1).sub(o.mul(s).sum(t,!0));return oi(l,a,i)}}),Y5=P({hingeLoss_:function(n,e,t,r){r===void 0&&(r=Jt.SUM_BY_NONZERO_WEIGHTS);var i=A(n,"labels","hingeLoss"),o=A(e,"predictions","hingeLoss"),s=null;t!=null&&(s=A(t,"weights","hingeLoss")),je(i.shape,o.shape,"Error in hingeLoss: ");var a=te(1);i=te(2).mul(i).sub(a);var l=a.sub(i.mul(o)).relu();return oi(l,s,r)}}),X5=P({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Jt.SUM_BY_NONZERO_WEIGHTS);var o=A(n,"labels","huberLoss"),s=A(e,"predictions","huberLoss"),a=null;t!=null&&(a=A(t,"weights","huberLoss")),je(o.shape,s.shape,"Error in huberLoss: ");var l=te(r),u=s.sub(o).abs(),c=nE(u,l),d=u.sub(c),h=te(.5).mul(c.square()).add(l.mul(d));return oi(h,a,i)}}),K5=P({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Jt.SUM_BY_NONZERO_WEIGHTS);var o=A(n,"labels","logLoss"),s=A(e,"predictions","logLoss"),a=null;t!=null&&(a=A(t,"weights","logLoss")),je(o.shape,s.shape,"Error in logLoss: ");var l=te(1),u=te(r),c=o.mul(s.add(u).log()).neg().sub(l.sub(o).mul(l.sub(s).add(u).log()));return oi(c,a,i)}}),Q5=P({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=Jt.SUM_BY_NONZERO_WEIGHTS);var i=A(n,"labels","meanSquaredError"),o=A(e,"predictions","meanSquaredError"),s=null;t!=null&&(s=A(t,"weights","meanSquaredError")),je(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return oi(a,s,r)}}),J5=P({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Jt.SUM_BY_NONZERO_WEIGHTS);var o=A(n,"multiClassLabels","sigmoidCrossEntropy"),s=A(e,"logits","sigmoidCrossEntropy"),a=null;if(t!=null&&(a=A(t,"weights","sigmoidCrossEntropy")),je(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var l=te(r),u=te(1),c=te(.5);o=o.mul(u.sub(l)).add(c.mul(l))}var d=(function(h,f){var p=A(h,"labels","sigmoidCrossEntropyWithLogits"),g=A(f,"logits","sigmoidCrossEntropyWithLogits");je(p.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=g.relu(),v=g.mul(p),y=g.abs().neg().exp().log1p();return m.sub(v).add(y)})(o,s);return oi(d,a,i)}}),Z5=P({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Jt.SUM_BY_NONZERO_WEIGHTS);var o=A(n,"onehotLabels","softmaxCrossEntropy"),s=A(e,"logits","softmaxCrossEntropy"),a=null;if(t!=null&&(a=A(t,"weights","softmaxCrossEntropy")),je(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var l=te(r),u=te(1),c=te(o.shape[1]);o=o.mul(u.sub(l)).add(l.div(c))}var d=(function(h,f,p){if(p===void 0&&(p=-1),p===-1&&(p=f.rank-1),p!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+p);return Gc((function(g,m,v){var y=m.logSumExp([p],!0),b=m.toFloat().sub(y);return v([g,b]),{value:b.mul(g).neg().sum([p]),gradFunc:function(x,w){var _=w[0],C=w[1],E=En(x.shape,[p]);return[x.reshape(E).mul(_.toFloat().sub(C.exp())),x.reshape(E).mul(C.exp().sub(_.toFloat()))]}}}))(h,f)})(o,s);return oi(d,a,i)}}),eG=Object.freeze({get Reduction(){return Jt},absoluteDifference:G5,computeWeightedLoss:oi,cosineDistance:q5,hingeLoss:Y5,huberLoss:X5,logLoss:K5,meanSquaredError:Q5,sigmoidCrossEntropy:J5,softmaxCrossEntropy:Z5});function L0(n,e){return e===void 0&&(e=!1),N.tidy((function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=mC(t),o=n.clone(),s=ki([[1]],[1,1]),a=s.clone(),l=t>=r?r:t,u=function(d){var h,f=o,p=a,g=i;h=N.tidy((function(){var m=o.slice([d,d],[t-d,1]),v=m.norm(),y=o.slice([d,d],[1,1]),b=ki([[-1]]).where(y.greater(0),ki([[1]])),x=y.sub(b.mul(v)),w=m.div(x);a=w.shape[0]===1?s.clone():s.concat(w.slice([1,0],[w.shape[0]-1,w.shape[1]]),0);var _=b.matMul(x).div(v).neg(),C=o.slice([d,0],[t-d,r]),E=_.mul(a);if(d===0)o=C.sub(E.matMul(a.transpose().matMul(C)));else{var S=C.sub(E.matMul(a.transpose().matMul(C)));o=o.slice([0,0],[d,r]).concat(S,0)}var D=i.slice([0,d],[t,i.shape[1]-d]);if(d===0)i=D.sub(D.matMul(a).matMul(E.transpose()));else{var k=D.sub(D.matMul(a).matMul(E.transpose()));i=i.slice([0,0],[t,d]).concat(k,1)}return[a,o,i]})),a=h[0],o=h[1],i=h[2],Cn([f,p,g])},c=0;c<l;++c)u(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]}))}var tG=P({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=A(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),s=o[0],a=o[1];if(!(e<=s))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+s+").");if(!(t<=a))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+a+").");e<0&&(e=s),t<0&&(t=a);var l=rc(0,s,1,"int32").reshape([-1,1]),u=rc(0,a,1,"int32"),c=It(l,u),d=Yc(c.lessEqual(te(+e,"int32")),c.greaterEqual(te(-t,"int32"))),h=et([s,a],r.dtype);return Vn(Rt(r.reshape([-1,s,a])).map((function(f){return ko(d,f,h)}))).reshape(i)}}),nG=P({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,T(n!=null&&n.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=n[0].shape[0],r=function(l){T(n[l].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[l].shape[0]+" vs. "+t+")"}))},i=1;i<n.length;++i)r(i)}else e=!0,n=vg(n,n.shape[0],0).map((function(l){return bC(l,[0])}));T(n.length<=n[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."}));var o=[],s=n,a=function(l){o.push(N.tidy((function(){var u=s[l];if(l>0)for(var c=0;c<l;++c){var d=gE(o[c].mulStrict(u)).mul(o[c]);u=u.sub(d)}return u.div(bE(u,"euclidean"))})))};for(i=0;i<n.length;++i)a(i);return e?Vn(o,0):o}}),rG=P({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return L0(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce((function(s,a){return s*a})),r=Rt(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach((function(s){var a=L0(s,e),l=a[0],u=a[1];i.push(l),o.push(u)})),[Vn(i,0).reshape(n.shape),Vn(o,0).reshape(n.shape)]}}),iG=Object.freeze({bandPart:tG,gramSchmidt:nG,qr:rG});function Jc(n,e,t,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var s=n.shape[0];return t=Math.min(t,s),T(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),T(n.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"})),T(n.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]})),T(e.rank===1,(function(){return"scores must be a 1D tensor"})),T(e.shape[0]===s,(function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+e.shape[0]})),T(0<=o&&o<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"})),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var oG=P({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=A(n,"images","resizeBilinear");T(r.rank===3||r.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),T(e.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],l=N.runKernelFunc((function(u,c){return c([i]),u.resizeBilinear(i,s,a,t)}),{x:i},(function(u,c){return{x:function(){return N.runKernelFunc((function(d){return d.resizeBilinearBackprop(u,c[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:s,newWidth:a});return o?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),sG=P({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=A(n,"images","resizeNearestNeighbor");T(r.rank===3||r.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),T(e.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),T(r.dtype==="float32"||r.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],l=N.runKernelFunc((function(u,c){return c([i]),u.resizeNearestNeighbor(i,s,a,t)}),{batchImages:i},(function(u,c){return{batchImages:function(){return N.runKernelFunc((function(d){return d.resizeNearestNeighborBackprop(u,c[0],t)}),{})}}}));return o?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),aG=P({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=A(n,"boxes","nonMaxSuppression"),s=A(e,"scores","nonMaxSuppression"),a=Jc(o,s,t,r,i);t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;var l={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return N.runKernelFunc((function(u){return u.nonMaxSuppression(o,s,t,r,i)}),{boxes:o,scores:s},null,"NonMaxSuppressionV3",l)}}),lG=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),oe(this,void 0,void 0,(function(){var o,s,a,l,u,c,d;return se(this,(function(h){switch(h.label){case 0:return o=A(n,"boxes","nonMaxSuppressionAsync"),s=A(e,"scores","nonMaxSuppressionAsync"),a=Jc(o,s,t,r,i),t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return l=h.sent(),u=l[0],c=l[1],d=wg(u,c,t,r,i),o!==n&&o.dispose(),s!==e&&s.dispose(),[2,d]}}))}))},uG=P({nonMaxSuppressionWithScore_:function(n,e,t,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var s=A(n,"boxes","nonMaxSuppression"),a=A(e,"scores","nonMaxSuppression"),l=Jc(s,a,t,r,i,o),u={maxOutputSize:t=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:i=l.scoreThreshold,softNmsSigma:o=l.softNmsSigma},c=N.runKernel("NonMaxSuppressionV5",{boxes:s,scores:a},u);return{selectedIndices:c[0],selectedScores:c[1]}}}),cG=function(n,e,t,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),oe(this,void 0,void 0,(function(){var s,a,l,u,c,d,h;return se(this,(function(f){switch(f.label){case 0:return s=A(n,"boxes","nonMaxSuppressionAsync"),a=A(e,"scores","nonMaxSuppressionAsync"),l=Jc(s,a,t,r,i,o),t=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,o=l.softNmsSigma,[4,Promise.all([s.data(),a.data()])];case 1:return u=f.sent(),c=u[0],d=u[1],h=_g(c,d,t,r,i,o),s!==n&&s.dispose(),a!==e&&a.dispose(),[2,h]}}))}))},dG=P({cropAndResize_:function(n,e,t,r,i,o){var s=A(n,"image","cropAndResize"),a=A(e,"boxes","cropAndResize","float32"),l=A(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var u=a.shape[0];return T(s.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."})),T(a.rank===2&&a.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+a.shape+"."})),T(l.rank===1&&l.shape[0]===u,(function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+a.shape+"."})),T(r.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),T(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),T(i==="bilinear"||i==="nearest",(function(){return"method must be bilinear or nearest, but was "+i})),N.runKernelFunc((function(c,d){return c.cropAndResize(s,a,l,r,i,o)}),{images:s,boxes:a,boxInd:l},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),Fg=Object.freeze({resizeBilinear:oG,resizeNearestNeighbor:sG,nonMaxSuppression:aG,nonMaxSuppressionAsync:lG,nonMaxSuppressionWithScore:uG,nonMaxSuppressionWithScoreAsync:cG,cropAndResize:dG}),Lg=function(n,e){return!(n>0)||e==="linear"},Bg=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Hg=function(n,e){var t=e,r=Tt(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},Wg=function(n,e,t){if(e==="linear")return n;if(e==="relu")return pt(n);if(e==="elu")return mE(n);if(e==="relu6")return yE(n);if(e==="prelu")return vE(n,t);throw new Error("Unknown fused activation "+e+".")},hG=P({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,o=i!==void 0&&i,s=n.transposeB,a=s!==void 0&&s,l=n.bias,u=n.activation,c=u===void 0?"linear":u,d=n.preluActivationWeights;if(Lg(N.state.gradientDepth,c)===!1){var h=Kc(t,r,o,a);return l!=null&&(h=Ie(h,l)),Wg(h,c,d)}var f=A(t,"a","fused matMul"),p=A(r,"b","fused matMul");e=gt(f,p),f=e[0],p=e[1];var g=o?f.shape[f.rank-2]:f.shape[f.rank-1],m=a?p.shape[p.rank-1]:p.shape[p.rank-2],v=o?f.shape[f.rank-1]:f.shape[f.rank-2],y=a?p.shape[p.rank-2]:p.shape[p.rank-1],b=f.shape.slice(0,-2),x=p.shape.slice(0,-2),w=le(b),_=le(x);T(f.rank>=2&&p.rank>=2&&f.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."})),T(Lt(b,x),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."})),T(g===m,(function(){return"Error in fused matMul: inner shapes ("+g+") and ("+m+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+a+" must match."}));var C,E,S=f.shape.slice(0,-2).concat([v,y]),D=o?f.as3D(w,g,v):f.as3D(w,v,g),k=a?p.as3D(_,y,m):p.as3D(_,m,y);l!=null&&Oe(S,(C=gt(C=A(l,"bias","fused matMul"),f)[0]).shape),d!=null&&(E=A(d,"prelu weights","fused matMul"));var M={a:D,b:k};l!=null&&(M.bias=C),d!=null&&(M.preluActivationWeights=E);var B=[D,k];return N.runKernelFunc((function(H,F){var W=H.fusedBatchMatMul({a:D,b:k,transposeA:o,transposeB:a,bias:C,activation:c,preluActivationWeights:E});return F([D,k,W]),W}),M,(function(H,F){var W=F[0],j=F[1],U=F[2],q=Bg(H,U,c),K={};return l!=null&&(K={bias:function(){return Hg(C,q)}}),Object.assign(o||a?!o&&a?{a:function(){return q.matMul(j,!1,!1)},b:function(){return q.matMul(W,!0,!1)}}:o&&!a?{a:function(){return j.matMul(q,!1,!0)},b:function(){return W.matMul(q,!1,!1)}}:{a:function(){return j.matMul(q,!0,!0)},b:function(){return q.matMul(W,!0,!0)}}:{a:function(){return q.matMul(j,!1,!0)},b:function(){return W.matMul(q,!0,!1)}},K)}),"_FusedMatMul",{transposeA:o,transposeB:a,activation:c},B,[!0]).reshape(S)}}),fG=P({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,a=n.dilations,l=a===void 0?[1,1]:a,u=n.dimRoundingMode,c=n.bias,d=n.activation,h=d===void 0?"linear":d,f=n.preluActivationWeights;if(h=h||"linear",Lg(N.state.gradientDepth,h)===!1){var p=Kn(e,t,r,i,s,l,u);return c!=null&&(p=Ie(p,c)),Wg(p,h,f)}var g=A(e,"x","conv2d"),m=A(t,"filter","conv2d"),v=g,y=!1;g.rank===3&&(y=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),T(v.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."})),T(m.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),u!=null&&T(wt(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+"."})),T(v.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),T(Sn(r,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"})),T(s==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."}));var b,x,w=Fo(v.shape,m.shape,r,l,i,u);c!=null&&(b=gt(b=A(c,"bias","fused conv2d"),g)[0],Oe(w.outShape,b.shape)),f!=null&&(x=A(f,"prelu weights","fused conv2d"));var _={x:v,filter:m};c!=null&&(_.bias=b),f!=null&&(_.preluActivationWeights=x);var C=[m,v],E=N.runKernelFunc((function(S,D){var k=S.fusedConv2d({input:v,filter:m,convInfo:w,bias:b,activation:h,preluActivationWeights:x});return D([m,v,k]),k}),_,(function(S,D){var k=D,M=k[0],B=k[1],H=k[2],F=Bg(S,H,h);T(Is(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+l+"'"}));var W={};return c!=null&&(W={bias:function(){return Hg(b,F)}}),Object.assign({x:function(){return lE(B.shape,F,M,r,i)},filter:function(){return Tg(B,F,M.shape,r,i)}},W)}),"FusedConv2D",{convInfo:w,activation:h},C,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),pG=P({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,a=n.dilations,l=a===void 0?[1,1]:a,u=n.dimRoundingMode,c=n.bias,d=n.activation,h=d===void 0?"linear":d,f=n.preluActivationWeights;if(Lg(N.state.gradientDepth,h)===!1){var p=Xc(e,t,r,i,s,l,u);return c!=null&&(p=Ie(p,c)),Wg(p,h,f)}var g=A(e,"x","depthwiseConv2d"),m=A(t,"filter","depthwiseConv2d"),v=g,y=!1;g.rank===3&&(y=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),T(v.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."})),T(m.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),T(v.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),l==null&&(l=[1,1]),T(Sn(r,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"})),u!=null&&T(wt(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+i+"."}));var b,x,w=Fo(v.shape,m.shape,r,l,i,u,!0);c!=null&&(b=gt(b=A(c,"bias","fused conv2d"),g)[0],Oe(w.outShape,b.shape)),f!=null&&(x=A(f,"prelu weights","fused depthwiseConv2d"));var _={x:v,filter:m};c!=null&&(_.bias=b),f!=null&&(_.preluActivationWeights=x);var C=[m,v],E=N.runKernelFunc((function(S,D){var k=S.fusedDepthwiseConv2D({input:v,filter:m,convInfo:w,bias:b,activation:h,preluActivationWeights:x});return D([m,v,k]),k}),_,(function(S,D){T(Is(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+l+"'"}));var k=D[0],M=D[1],B=D[2],H=Bg(S,B,h),F={};return c!=null&&(F={bias:function(){return Hg(b,H)}}),Object.assign({x:function(){return uE(M.shape,H,k,w)},filter:function(){return cE(M,H,k.shape,w)}},F)}),"FusedDepthwiseConv2D",{convInfo:w,activation:h},C,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),gG=Object.freeze({matMul:hG,conv2d:fG,depthwiseConv2d:pG}),mG=Object.freeze({image:Fg,linalg:iG,losses:eG,spectral:H5,fused:gG,signal:j5,square:Kj,squaredDifference:GC,conv1d:o5,conv2d:Kn,conv3d:s5,depthwiseConv2d:Xc,separableConv2d:Ig,conv2dTranspose:a5,conv3dTranspose:l5,op:P,batchNormalization2d:D$,batchNormalization3d:A$,batchNormalization4d:k$,batchNormalization:R$,batchNorm:JC,batchNorm2d:T$,batchNorm3d:I$,batchNorm4d:M$,booleanMaskAsync:i5,complex:zt,real:Yn,imag:Er,concat:kt,concat1d:gV,concat2d:mV,concat3d:vV,concat4d:yV,split:vg,matMul:Kc,dot:u5,outerProduct:c5,reverse:sl,reverse1d:d5,reverse2d:h5,reverse3d:f5,reverse4d:p5,maxPool:Pt,avgPool:al,pool:g5,maxPool3d:m5,avgPool3d:v5,slice:Or,slice1d:y5,slice2d:b5,slice3d:fE,slice4d:x5,abs:Qj,acos:Jj,acosh:Zj,asin:e$,asinh:t$,atan:n$,atanh:r$,ceil:i$,clipByValue:Ag,cos:o$,cosh:s$,erf:a$,exp:Yf,expm1:l$,floor:u$,log:c$,log1p:d$,logSigmoid:h$,neg:dc,reciprocal:f$,round:p$,rsqrt:qC,sigmoid:YC,sign:g$,isNaN:m$,isInf:v$,isFinite:y$,sin:b$,sinh:x$,softplus:w$,sqrt:_$,step:C$,tan:E$,tanh:S$,all:w5,any:_5,argMax:C5,argMin:E5,logSumExp:S5,max:Qc,mean:D5,min:A5,moments:k5,sum:gE,prod:R5,equal:rE,equalStrict:Y$,greater:X$,greaterEqual:iE,greaterEqualStrict:K$,greaterStrict:Q$,less:J$,lessEqual:Z$,lessEqualStrict:e5,lessStrict:t5,notEqual:n5,notEqualStrict:r5,add:Ie,addN:N$,addStrict:F$,atan2:L$,div:nr,divNoNan:B$,divStrict:H$,floorDiv:tE,maximum:kg,maximumStrict:W$,minimum:nE,minimumStrict:z$,mod:V$,modStrict:U$,mul:en,mulStrict:j$,pow:hc,powStrict:$$,squaredDifferenceStrict:G$,sub:It,subStrict:q$,elu:mE,leakyRelu:T5,prelu:vE,relu:pt,relu6:yE,selu:I5,logicalAnd:Yc,logicalNot:O$,logicalOr:ZC,logicalXor:P$,where:ko,whereAsync:eE,buffer:we,print:AV,batchToSpaceND:gC,broadcastTo:kV,cast:RV,clone:TV,cumsum:IV,depthToSpace:MV,expandDims:qn,eye:mC,multinomial:OV,oneHot:jf,pad:No,pad1d:PV,pad2d:NV,pad3d:FV,pad4d:LV,rand:BV,randomNormal:HV,randomGamma:WV,randomUniform:vC,reshape:or,spaceToBatchND:yC,squeeze:bC,stack:Vn,tile:ps,truncatedNormal:zV,unstack:Rt,setdiff1dAsync:VV,fill:Tr,linspace:pV,ones:Fs,range:rc,scalar:te,tensor:Ut,tensor1d:Et,tensor2d:ki,tensor3d:mg,tensor4d:vn,tensor5d:dV,tensor6d:hV,variable:fV,zeros:et,onesLike:pC,zerosLike:Le,transpose:Fi,softmax:ii,logSoftmax:XV,localResponseNormalization:M5,norm:bE,gather:Rg,unsortedSegmentSum:oE,basicLSTMCell:O5,multiRNNCell:P5,movingAverage:N5,stridedSlice:F5,topk:L5,scatterND:B5,fft:Mg,ifft:fc,rfft:Og,irfft:xE,sparseToDense:W5,gatherND:z5,diag:V5,dropout:U5,hannWindow:Pg,hammingWindow:_E,frame:Ng,stft:CE,inTopKAsync:$5});function Q(n,e){Array.isArray(n)||(n=[n]),n.forEach((function(t){t!=null&&T(t.dtype!=="complex64",(function(){return e+" does not support complex64 tensors."}))}))}function Ih(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var vG=(function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new DC(t,N),t}return cr(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,X().get("IS_NODE")&&tc(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,r,i,o){this.data.set(t,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return oe(this,void 0,void 0,(function(){return se(this,(function(r){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,o=r.complexTensors;return i==="complex64"?qf(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map((function(o){return Ju(o)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return we(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var o=this.write(t,r,i);return N.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return oe(this,void 0,void 0,(function(){var r;return se(this,(function(i){return r=_r(),t(),[2,{kernelMs:_r()-r}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:N.keep(t.clone()),imag:N.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(Q(t,"slice"),EC(t.shape,r,i)){var o=SC(r,t.strides),s=le(i);return Ut(this.readSync(t.dataId).subarray(o,o+s),i,t.dtype)}for(var a=we(i,t.dtype),l=this.bufferSync(t),u=0;u<a.size;++u){var c=a.indexToLoc(u).map((function(d,h){return d+r[h]}));a.values[u]=l.get.apply(l,c)}return a.toTensor()},e.prototype.stridedSlice=function(t,r,i,o){Q(t,"stridedSlice");var s=bg(r,i,o);if(s.some((function(f){return f===0})))return Ut([],s);for(var a=we(s,t.dtype),l=this.bufferSync(t),u=0;u<a.size;u++){for(var c=a.indexToLoc(u),d=new Array(c.length),h=0;h<d.length;h++)d[h]=c[h]*o[h]+r[h];a.set.apply(a,[l.get.apply(l,d)].concat(c))}return a.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=we([t.size,t.size],t.dtype),o=i.values,s=0;s<r.length;s++)o[s*t.size+s]=r[s];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),s=0,a=0;a<t.rank;a++)a!==r&&(o[s++]=t.shape[a]);var l=new Array(t.rank).fill(0),u=t.shape.slice();u[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)l[r]=a,c[a]=this.slice(t,l,u).reshape(o);return c},e.prototype.reverse=function(t,r){Q(t,"reverse");for(var i=we(t.shape,t.dtype),o=this.bufferSync(t),s=function(l){var u=i.indexToLoc(l),c=u.slice();r.forEach((function(d){return c[d]=t.shape[d]-1-c[d]})),i.set.apply(i,[o.get.apply(o,c)].concat(u))},a=0;a<i.size;a++)s(a);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var o=t.map((function(f){return Yn(f)})),s=t.map((function(f){return Er(f)}));return zt(this.concat(o,r),this.concat(s,r))}var a=t.map((function(f){var p=le(f.shape.slice(r));return f.as2D(-1,p)})),l=Ts(a.map((function(f){return f.shape})),1),u=we(l,t[0].dtype).values;if(a[0].shape[0]===1){var c=0;a.forEach((function(f){u.set(i.readSync(f.dataId),c),c+=f.size}))}else{var d=0;a.forEach((function(f){for(var p=i.readSync(f.dataId),g=0,m=0;m<f.shape[0];++m)for(var v=m*l[1]+d,y=0;y<f.shape[1];++y)u[v+y]=p[g++];d+=f.shape[1]}))}var h=Ts(t.map((function(f){return f.shape})),r);return Ut(u,h,t[0].dtype)},e.prototype.neg=function(t){return Q(t,"neg"),this.multiply(te(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,o,s,a){return{real:i+s,imag:o+a}})):this.broadcastedBinaryOp(t,r,Vt(t.dtype,r.dtype),(function(i,o){return i+o}))},e.prototype.addN=function(t){var r=this;Q(t,"addN");for(var i=t.map((function(c){return r.readSync(c.dataId)})),o=we(t[0].shape,t[0].dtype),s=o.values,a=0;a<t.length;a++)for(var l=i[a],u=0;u<s.length;u++)s[u]+=l[u];return o.toTensor()},e.prototype.softmax=function(t,r){var i=Mt([r],t.shape),o=this.max(t,i),s=En(o.shape,i),a=this.subtract(t,o.reshape(s)),l=this.exp(a),u=this.sum(l,i).reshape(s);return this.realDivide(l,u)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,o,s,a){return{real:i-s,imag:o-a}})):this.broadcastedBinaryOp(t,r,Vt(t.dtype,r.dtype),(function(i,o){return i-o}))},e.prototype.pow=function(t,r){return Q([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return Math.pow(i,o)}))},e.prototype.batchMatMul=function(t,r,i,o){Q([t,r],"matMul");for(var s=i?t.shape[1]:t.shape[2],a=i?t.shape[2]:t.shape[1],l=o?r.shape[1]:r.shape[2],u=t.shape[0],c=this.readSync(t.dataId),d=this.readSync(r.dataId),h=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=h[0],p=h[1],g=h[2],m=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=m[0],y=m[1],b=m[2],x=a*l,w=we([u,a,l],t.dtype),_=w.values,C=this.blockSize,E=0;E<u;E++)for(var S=0;S<a;S+=C)for(var D=0;D<l;D+=C)for(var k=0;k<s;k+=C)for(var M=Math.min(S+C,a),B=Math.min(D+C,l),H=Math.min(k+C,s),F=S;F<M;F++)for(var W=D;W<B;W++){for(var j=0,U=k;U<H;U++)j+=c[E*f+F*p+U*g]*d[U*v+W*y+E*b];_[E*x+(F*l+W)]+=j}return w.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,s=t.transposeB,a=t.bias,l=t.activation,u=t.preluActivationWeights,c=this.batchMatMul(r,i,o,s);return a&&(c=this.add(c,a)),l&&(c=Ih(this,c,l,u)),c},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,o,s,a){return{real:i*s-o*a,imag:i*a+o*s}})):this.broadcastedBinaryOp(t,r,Vt(t.dtype,r.dtype),(function(i,o){return i*o}))},e.prototype.realDivide=function(t,r){return Q([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",(function(i,o){return i/o}))},e.prototype.floorDiv=function(t,r){return Q([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",(function(i,o){return Math.floor(i/o)}))},e.prototype.sum=function(t,r){Q(t,"sum"),Nn("sum",r,t.rank);for(var i=Gt(t.shape,r),o=i[0],s=i[1],a=et(o,Vt(t.dtype,"int32")),l=le(s),u=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*l,f=0,p=0;p<l;++p)f+=c[h+p];u[d]=f}return a},e.prototype.prod=function(t,r){Q(t,"sum");for(var i=Gt(t.shape,r),o=i[0],s=i[1],a=et(o,Vt(t.dtype,"int32")),l=le(s),u=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*l,f=1,p=0;p<l;++p)f*=c[h+p];u[d]=f}return a},e.prototype.unsortedSegmentSum=function(t,r,i){Q(t,"unsortedSegmentSum");for(var o=[],s=t.rank-r.rank,a=0;a<s;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var l=te(a,"int32"),u=rE(l,r).asType("float32").mul(t).sum(0);o.push(u)}return Vn(o)},e.prototype.argMin=function(t,r){Q(t,"argMin");var i=[r];Nn("argMin",i,t.rank);for(var o=Gt(t.shape,i),s=o[0],a=o[1],l=et(s,"int32"),u=le(a),c=this.readSync(l.dataId),d=this.readSync(t.dataId),h=0;h<c.length;++h){for(var f=h*u,p=d[f],g=0,m=0;m<u;++m){var v=d[f+m];v<p&&(p=v,g=m)}c[h]=g}return l},e.prototype.argMax=function(t,r){Q(t,"argMax");var i=[r];Nn("argMax",i,t.rank);for(var o=Gt(t.shape,i),s=o[0],a=o[1],l=et(s,"int32"),u=le(a),c=this.readSync(l.dataId),d=this.readSync(t.dataId),h=0;h<c.length;++h){for(var f=h*u,p=d[f],g=0,m=0;m<u;++m){var v=d[f+m];v>p&&(p=v,g=m)}c[h]=g}return l},e.prototype.cumsum=function(t,r,i,o){if(Q(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var s=Vt(t.dtype,"int32"),a=et(t.shape,s),l=this.readSync(a.dataId),u=this.readSync(t.dataId),c=t.shape[t.rank-1],d=o?function(m,v){return m+c-v-1}:function(m,v){return m+v},h=0;h<u.length;h+=c)for(var f=0;f<c;f++){var p=d(h,f);if(f===0)l[p]=i?0:u[p];else{var g=d(h,f-1);l[p]=i?u[g]+l[g]:u[p]+l[g]}}return a},e.prototype.equal=function(t,r){return Q([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i===o?1:0}))},e.prototype.notEqual=function(t,r){return Q([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i!==o?1:0}))},e.prototype.less=function(t,r){return Q([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i<o?1:0}))},e.prototype.lessEqual=function(t,r){return Q([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i<=o?1:0}))},e.prototype.greater=function(t,r){return Q([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i>o?1:0}))},e.prototype.greaterEqual=function(t,r){return Q([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i>=o?1:0}))},e.prototype.logicalNot=function(t){Q(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Q([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i&&o}))},e.prototype.logicalOr=function(t,r){return Q([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i||o}))},e.prototype.select=function(t,r,i){Q([t,r,i],"select");for(var o=this.readSync(t.dataId),s=this.readSync(r.dataId),a=this.readSync(i.dataId),l=et(r.shape,Vt(r.dtype,i.dtype)),u=this.readSync(l.dataId),c=0,d=t.rank===0||t.rank>1||r.rank===1?1:le(r.shape.slice(1)),h=0;h<o.length;h++)for(var f=0;f<d;f++)o[h]===1?u[c++]=s[h]:u[c++]=a[h];return l},e.prototype.where=function(t){Q([t],"where");var r=this.readSync(t.dataId);return Cg(t.shape,r)},e.prototype.topk=function(t,r,i){return Q(t,"topk"),PC(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Q(t,"min"),Nn("min",r,t.rank);for(var i=Gt(t.shape,r),o=i[0],s=i[1],a=et(o,t.dtype),l=le(s),u=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*l,f=c[h],p=0;p<l;++p){var g=c[h+p];g<f&&(f=g)}u[d]=f}return a},e.prototype.minimum=function(t,r){return Q([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return Math.min(i,o)}))},e.prototype.mod=function(t,r){return Q([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){var s=i%o;return i<0&&o<0||i>=0&&o>=0?s:(s+o)%o}))},e.prototype.max=function(t,r){Q(t,"max"),Nn("max",r,t.rank);for(var i=Gt(t.shape,r),o=i[0],s=i[1],a=et(o,t.dtype),l=le(s),u=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*l,f=c[h],p=0;p<l;++p){var g=c[h+p];g>f&&(f=g)}u[d]=f}return a},e.prototype.maximum=function(t,r){return Q([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return Math.max(i,o)}))},e.prototype.all=function(t,r){Q(t,"all"),Nn("all",r,t.rank);for(var i=Gt(t.shape,r),o=i[0],s=i[1],a=et(o,t.dtype),l=le(s),u=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*l,f=c[h],p=0;p<l;++p){var g=c[h+p];f=f&&g}u[d]=f}return a},e.prototype.any=function(t,r){Q(t,"any"),Nn("any",r,t.rank);for(var i=Gt(t.shape,r),o=i[0],s=i[1],a=et(o,t.dtype),l=le(s),u=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*l,f=c[h],p=0;p<l;++p){var g=c[h+p];f=f||g}u[d]=f}return a},e.prototype.squaredDifference=function(t,r){return Q([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){var s=i-o;return s*s}))},e.prototype.ceil=function(t){Q(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Q(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Q(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Q(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Q(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Q(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Q(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=Math.floor(r[o]);r[o]-s<.5?i[o]=Math.floor(r[o]):r[o]-s>.5?i[o]=Math.ceil(r[o]):i[o]=s%2==0?s:s+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Q(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Q(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Q(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.log(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Q(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.log1p(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Q(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.sqrt(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Q(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=1/Math.sqrt(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Q(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Q(t,"relu");for(var r=et(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),s=0;s<o.length;++s)i[s]=Math.max(0,o[s]);return r},e.prototype.relu6=function(t){Q(t,"relu");for(var r=et(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),s=0;s<o.length;++s)i[s]=Math.min(Math.max(0,o[s]),6);return r},e.prototype.prelu=function(t,r){return Q([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return i<0?o*i:i}))},e.prototype.elu=function(t){Q(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Q([t,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),s=this.readSync(t.dataId),a=0;a<o.length;++a){var l=o[a];i[a]=l>=1?s[a]:s[a]*(l+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){Q(t,"selu");for(var r=Sg,i=Dg,o=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var l=s[a];o[a]=l>=0?i*l:r*(Math.exp(l)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,r,i){Q(t,"clip");for(var o=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var l=s[a];o[a]=l>i?i:l<r?r:l}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o){var s=i[2*o],a=i[2*o+1];r[o]=Math.hypot(s,a)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Q(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Q(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Q(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var a=o[s]>-r,l=o[s]<r,u=Math.exp(o[s]),c=void 0;c=l?u:a?o[s]:Math.log(1+u),i[s]=c}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Q(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Q(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Q(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Q(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Q(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Q(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Q([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return Math.atan2(i,o)}))},e.prototype.sinh=function(t){Q(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Q(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Q(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=yz(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Q(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Q(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Q(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Q(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var s=Math.sign(i[o]),a=Math.abs(i[o]),l=1/(1+.3275911*a);r[o]=s*(1-((((1.061405429*l-1.453152027)*l+1.421413741)*l-.284496736)*l+.254829592)*l*Math.exp(-a*a))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Q(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var a=o[s];isNaN(a)?i[s]=NaN:i[s]=a>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,s=t.bias,a=t.activation,l=t.preluActivationWeights,u=this.conv2d(r,i,o);return s&&(u=this.add(u,s)),a&&(u=Ih(this,u,a,l)),u},e.prototype.conv2d=function(t,r,i){Q([t,r],"conv2d");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,l=i.dilationWidth,u=i.padInfo.left,c=i.padInfo.top,d=i.dataFormat==="channelsLast",h=we(i.outShape,t.dtype),f=t.strides[0],p=d?t.strides[1]:t.strides[2],g=d?t.strides[2]:1,m=d?1:t.strides[1],v=h.strides[0],y=d?h.strides[1]:h.strides[2],b=d?h.strides[2]:1,x=d?1:h.strides[1],w=this.readSync(t.dataId),_=this.readSync(r.dataId),C=h.values,E=0;E<i.batchSize;++E)for(var S=E*f,D=E*v,k=0;k<i.outHeight;++k)for(var M=D+k*y,B=k*i.strideHeight-c,H=0;H<o;H++){var F=B+H*a;if(!(F<0||F>=i.inHeight))for(var W=H*r.strides[0],j=S+F*p,U=0;U<i.outWidth;++U)for(var q=M+U*b,K=U*i.strideWidth-u,J=0;J<s;J++){var ee=K+J*l;if(!(ee<0||ee>=i.inWidth))for(var re=j+ee*g,fe=W+J*r.strides[1],pe=0;pe<i.inChannels;++pe){for(var ve=w[re+pe*m],Ae=0;Ae<i.outChannels;++Ae)C[q+Ae*x]+=ve*_[fe+Ae];fe+=i.outChannels}}}return h.toTensor()},e.prototype.conv3d=function(t,r,i){for(var o=i.filterDepth,s=i.filterHeight,a=i.filterWidth,l=i.dilationDepth,u=i.dilationHeight,c=i.dilationWidth,d=i.padInfo.front,h=i.padInfo.left,f=i.padInfo.top,p=we(i.outShape,t.dtype),g=this.readSync(t.dataId),m=this.readSync(r.dataId),v=p.values,y=0;y<i.batchSize;++y)for(var b=y*t.strides[0],x=y*p.strides[0],w=0;w<i.outDepth;++w)for(var _=x+w*p.strides[1],C=w*i.strideDepth-d,E=0;E<o;E++){var S=C+E*l;if(!(S<0||S>=i.inDepth))for(var D=E*r.strides[0],k=b+S*t.strides[1],M=0;M<i.outHeight;++M)for(var B=_+M*p.strides[2],H=M*i.strideHeight-f,F=0;F<s;F++){var W=H+F*u;if(!(W<0||W>=i.inHeight))for(var j=D+F*r.strides[1],U=k+W*t.strides[2],q=0;q<i.outWidth;++q)for(var K=B+q*i.outChannels,J=q*i.strideWidth-h,ee=0;ee<a;ee++){var re=J+ee*c;if(!(re<0||re>=i.inWidth))for(var fe=j+ee*r.strides[2],pe=U+re*i.inChannels,ve=fe,Ae=0;Ae<i.inChannels;++Ae){for(var Ce=g[pe+Ae],ke=0;ke<i.outChannels;++ke)v[K+ke]+=Ce*m[ve+ke];ve+=i.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){Q([t,r],"conv2dDerInput");for(var o=we(i.inShape,"float32"),s=o.values,a=this.readSync(t.dataId),l=this.readSync(r.dataId),u=r.strides,c=u[0],d=u[1],h=u[2],f=i.batchSize,p=i.filterHeight,g=i.filterWidth,m=i.inChannels,v=i.inHeight,y=i.inWidth,b=i.outChannels,x=i.outHeight,w=i.outWidth,_=i.strideHeight,C=i.strideWidth,E=i.dataFormat,S=p-1-i.padInfo.top,D=g-1-i.padInfo.left,k=E==="channelsLast",M=o.strides[0],B=k?o.strides[1]:o.strides[2],H=k?o.strides[2]:1,F=k?1:o.strides[1],W=t.strides[0],j=k?t.strides[1]:t.strides[2],U=k?t.strides[2]:1,q=k?1:t.strides[1],K=0;K<f;++K)for(var J=0;J<m;++J)for(var ee=0;ee<v;++ee)for(var re=ee-S,fe=Math.max(0,Math.ceil(re/_)),pe=Math.min(x,(p+re)/_),ve=0;ve<y;++ve){for(var Ae=ve-D,Ce=Math.max(0,Math.ceil(Ae/C)),ke=Math.min(w,(g+Ae)/C),dt=0,Re=fe;Re<pe;++Re)for(var Be=Re*_-re,He=Ce;He<ke;++He)for(var rt=W*K+j*Re+U*He,Ke=c*(p-1-Be)+d*(g-1-(He*C-Ae))+h*J,Ze=0;Ze<b;++Ze)dt+=a[rt+q*Ze]*l[Ke+Ze];s[M*K+B*ee+H*ve+F*J]=dt}return o.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var o=we(i.inShape,"float32"),s=o.values,a=o.strides,l=a[0],u=a[1],c=a[2],d=a[3],h=this.readSync(t.dataId),f=t.strides,p=f[0],g=f[1],m=f[2],v=f[3],y=this.readSync(r.dataId),b=r.strides,x=b[0],w=b[1],_=b[2],C=b[3],E=i.batchSize,S=i.filterDepth,D=i.filterHeight,k=i.filterWidth,M=i.inChannels,B=i.inDepth,H=i.inHeight,F=i.inWidth,W=i.outChannels,j=i.outDepth,U=i.outHeight,q=i.outWidth,K=i.strideDepth,J=i.strideHeight,ee=i.strideWidth,re=S-1-i.padInfo.front,fe=D-1-i.padInfo.top,pe=k-1-i.padInfo.left,ve=0;ve<E;++ve)for(var Ae=0;Ae<M;++Ae)for(var Ce=0;Ce<B;++Ce)for(var ke=Ce-re,dt=Math.max(0,Math.ceil(ke/K)),Re=Math.min(j,(S+ke)/K),Be=0;Be<H;++Be)for(var He=Be-fe,rt=Math.max(0,Math.ceil(He/J)),Ke=Math.min(U,(D+He)/J),Ze=0;Ze<F;++Ze){for(var Dn=Ze-pe,An=Math.max(0,Math.ceil(Dn/ee)),Ot=Math.min(q,(k+Dn)/ee),ui=0,Qn=dt;Qn<Re;++Qn)for(var Jn=Qn*K-ke,kn=rt;kn<Ke;++kn)for(var Br=kn*J-He,hn=An;hn<Ot;++hn)for(var Ls=p*ve+g*Qn+m*kn+v*hn,Hr=x*(S-1-Jn)+w*(D-1-Br)+_*(k-1-(hn*ee-Dn))+C*Ae,Un=0;Un<W;++Un)ui+=h[Ls+Un]*y[Hr+Un];s[l*ve+u*Ce+c*Be+d*Ze+Ae]=ui}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){Q([t,r],"conv2dDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,l=i.filterWidth,u=i.dataFormat==="channelsLast",c=we(i.filterShape,"float32"),d=i.padInfo.left,h=i.padInfo.top,f=this.bufferSync(t),p=this.bufferSync(r),g=0;g<a;++g)for(var m=Math.max(0,Math.ceil((h-g)/o)),v=Math.min(i.outHeight,(i.inHeight+h-g)/o),y=0;y<l;++y)for(var b=Math.max(0,Math.ceil((d-y)/s)),x=Math.min(i.outWidth,(i.inWidth+d-y)/s),w=0;w<i.inChannels;++w)for(var _=0;_<i.outChannels;++_){for(var C=0,E=0;E<i.batchSize;++E)for(var S=m;S<v;++S)for(var D=g+S*o-h,k=b;k<x;++k){var M=y+k*s-d;C+=u?f.get(E,D,M,w)*p.get(E,S,k,_):f.get(E,w,D,M)*p.get(E,_,S,k)}c.set(C,g,y,w,_)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,l=i.filterDepth,u=i.filterHeight,c=i.filterWidth,d=we(i.filterShape,"float32"),h=d.values,f=d.strides,p=f[0],g=f[1],m=f[2],v=f[3],y=this.readSync(r.dataId),b=r.strides,x=b[0],w=b[1],_=b[2],C=b[3],E=this.readSync(t.dataId),S=t.strides,D=S[0],k=S[1],M=S[2],B=S[3],H=i.padInfo.front,F=i.padInfo.left,W=i.padInfo.top,j=0;j<l;++j)for(var U=Math.max(0,Math.ceil((H-j)/o)),q=Math.min(i.outDepth,(i.inDepth+H-j)/o),K=j*p,J=0;J<u;++J)for(var ee=Math.max(0,Math.ceil((W-J)/s)),re=Math.min(i.outHeight,(i.inHeight+W-J)/s),fe=J*g+K,pe=0;pe<c;++pe)for(var ve=Math.max(0,Math.ceil((F-pe)/a)),Ae=Math.min(i.outWidth,(i.inWidth+F-pe)/a),Ce=pe*m+fe,ke=0;ke<i.inChannels;++ke)for(var dt=ke*v+Ce,Re=0;Re<i.outChannels;++Re){for(var Be=0,He=0;He<i.batchSize;++He)for(var rt=He*D,Ke=He*x,Ze=U;Ze<q;++Ze)for(var Dn=(j+Ze*o-H)*k+rt,An=Ze*w+Ke,Ot=ee;Ot<re;++Ot)for(var ui=(J+Ot*s-W)*M+Dn,Qn=Ot*_+An,Jn=ve;Jn<Ae;++Jn){var kn=Jn*C+Qn;Be+=E[(pe+Jn*a-F)*B+ui+ke]*y[kn+Re]}h[dt+Re]=Be}return d.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,o=t.convInfo,s=t.bias,a=t.activation,l=t.preluActivationWeights,u=this.depthwiseConv2D(r,i,o);return s&&(u=this.add(u,s)),a&&(u=Ih(this,u,a,l)),u},e.prototype.depthwiseConv2D=function(t,r,i){Q([t,r],"depthwiseConv2D");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,l=i.dilationWidth,u=i.padInfo.left,c=i.padInfo.top,d=i.outChannels/i.inChannels,h=we(i.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(r.dataId),g=h.values,m=0;m<i.batchSize;++m)for(var v=m*t.strides[0],y=m*h.strides[0],b=0;b<i.outHeight;++b)for(var x=y+b*h.strides[1],w=b*i.strideHeight-u,_=0;_<o;++_){var C=w+_*a;if(!(C<0||C>=i.inHeight))for(var E=_*r.strides[0],S=v+C*t.strides[1],D=0;D<i.outWidth;++D)for(var k=x+D*h.strides[2],M=D*i.strideWidth-c,B=0;B<s;++B){var H=M+B*l;if(!(H<0||H>=i.inWidth))for(var F=E+B*r.strides[1],W=S+H*i.inChannels,j=k,U=F,q=0;q<i.inChannels;++q){for(var K=f[W+q],J=0;J<d;++J)g[j+J]+=K*p[U+J];j+=d,U+=d}}}return h.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){Q([t,r],"depthwiseConv2DDerInput");for(var o=we(i.inShape,"float32"),s=o.values,a=o.strides,l=a[0],u=a[1],c=a[2],d=this.readSync(t.dataId),h=t.strides,f=h[0],p=h[1],g=h[2],m=this.readSync(r.dataId),v=r.strides,y=v[0],b=v[1],x=v[2],w=i.batchSize,_=i.filterHeight,C=i.filterWidth,E=i.inChannels,S=i.inHeight,D=i.inWidth,k=i.outChannels,M=i.outHeight,B=i.outWidth,H=i.strideHeight,F=i.strideWidth,W=_-1-i.padInfo.top,j=C-1-i.padInfo.left,U=k/E,q=0;q<w;++q)for(var K=0;K<E;++K)for(var J=0;J<S;++J)for(var ee=J-W,re=Math.max(0,Math.ceil(ee/H)),fe=Math.min(M,(_+ee)/H),pe=0;pe<D;++pe){for(var ve=pe-j,Ae=Math.max(0,Math.ceil(ve/F)),Ce=Math.min(B,(C+ve)/F),ke=0,dt=re;dt<fe;++dt)for(var Re=dt*H-ee,Be=Ae;Be<Ce;++Be)for(var He=f*q+p*dt+g*Be,rt=y*(_-1-Re)+b*(C-1-(Be*F-ve))+x*K,Ke=0;Ke<U;++Ke)ke+=d[He+(K*U+Ke)]*m[rt+Ke];s[l*q+u*J+c*pe+K]=ke}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){Q([t,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,l=i.filterWidth,u=we(i.filterShape,"float32"),c=i.padInfo.left,d=i.padInfo.top,h=i.outChannels/i.inChannels,f=this.bufferSync(t),p=this.bufferSync(r),g=0;g<a;++g)for(var m=Math.max(0,Math.ceil((d-g)/o)),v=Math.min(i.outHeight,(i.inHeight+d-g)/o),y=0;y<l;++y)for(var b=Math.max(0,Math.ceil((c-y)/s)),x=Math.min(i.outWidth,(i.inWidth+c-y)/s),w=0;w<i.outChannels;++w){for(var _=Math.trunc(w/h),C=w%h,E=0,S=0;S<i.batchSize;++S)for(var D=m;D<v;++D)for(var k=g+D*o-d,M=b;M<x;++M){var B=y+M*s-c;E+=f.get(S,k,B,_)*p.get(S,D,M,w)}u.set(E,g,y,_,C)}return u.toTensor()},e.prototype.tile=function(t,r){return Q(t,"tile"),OC(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){Q(t,"pad");var o=r.map((function(h,f){return h[0]+t.shape[f]+h[1]})),s=r.map((function(h){return h[0]})),a=this.bufferSync(t),l=we(o,t.dtype);i!==0&&l.values.fill(i);for(var u=0;u<t.size;u++){var c=a.indexToLoc(u),d=c.map((function(h,f){return h+s[f]}));l.set.apply(l,[a.get.apply(a,c)].concat(d))}return l.toTensor()},e.prototype.transpose=function(t,r){Q(t,"transpose");for(var i=new Array(t.rank),o=0;o<i.length;o++)i[o]=t.shape[r[o]];var s=this.readSync(t.dataId),a=we(i,t.dtype),l=this.bufferSync(t);for(o=0;o<t.size;++o){for(var u=l.indexToLoc(o),c=new Array(u.length),d=0;d<c.length;d++)c[d]=u[r[d]];var h=a.locToIndex(c);a.values[h]=s[o]}return a.toTensor()},e.prototype.gather=function(t,r,i){Q([t,r],"gather");var o=t.shape.slice(),s=this.readSync(r.dataId);o[i]=s.length;for(var a=we(o,t.dtype),l=this.bufferSync(t),u=0;u<a.size;++u){var c=a.indexToLoc(u),d=c.slice();d[i]=s[c[i]];var h=l.locToIndex(d);a.values[u]=l.values[h]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){Q([t],"batchToSpaceND");var o=r.reduce((function(d,h){return d*h})),s=ic(t.shape,r,o),a=oc(s.length,r.length),l=sc(t.shape,r,o),u=xC(i,r.length),c=wC(l,i,r.length);return t.reshape(s).transpose(a).reshape(l).slice(u,c)},e.prototype.spaceToBatchND=function(t,r,i){Q([t],"spaceToBatchND");var o=r.reduce((function(h,f){return h*f})),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<t.shape.length;++a)s.push([0,0]);var l=t.pad(s),u=ic(l.shape,r,o,!1),c=oc(u.length,r.length,!1),d=sc(l.shape,r,o,!1);return l.reshape(u).transpose(c).reshape(d)},e.prototype.pool=function(t,r,i){Q(t,"pool");for(var o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,l=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,f=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(t.dataId),g=we(r.outShape,t.dtype),m=g.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],b=r.outShape[3],x=0;x<r.batchSize;++x)for(var w=x*v,_=x*t.strides[0],C=0;C<r.inChannels;++C)for(var E=0;E<r.outHeight;++E)for(var S=E*o-d,D=Math.max(0,S),k=Math.min(r.inHeight,u+S),M=w+E*y,B=0;B<r.outWidth;++B){for(var H=B*s-h,F=Math.max(0,H),W=Math.min(r.inWidth,c+H),j=f,U=0,q=0,K=D;K<k;K+=a){for(var J=_+K*t.strides[1],ee=F;ee<W;ee+=l){var re=p[J+ee*t.strides[2]+C];i==="max"&&re>j?j=re:i==="avg"&&(U+=re,q++)}if(isNaN(j))break}m[M+B*b+C]=i==="avg"?U/q:j}return g.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var i=we(r.outShape,"int32"),o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,l=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,f=this.bufferSync(t),p=0;p<r.batchSize;++p)for(var g=0;g<r.inChannels;++g)for(var m=0;m<r.outHeight;++m){for(var v=m*o-d,y=v;y<0;)y+=a;for(var b=Math.min(r.inHeight,u+v),x=0;x<r.outWidth;++x){for(var w=x*s-h,_=w;_<0;)_+=l;for(var C=Math.min(r.inWidth,c+w),E=Number.NEGATIVE_INFINITY,S=-1,D=y;D<b;D+=a)for(var k=D-v,M=_;M<C;M+=l){var B=M-w,H=f.get(p,D,M,g);H>E&&(E=H,S=k*c+B)}i.set(S,p,m,x,g)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,o){Q([r,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,o),a=o.strideHeight,l=o.strideWidth,u=o.dilationHeight,c=o.dilationWidth,d=o.effectiveFilterHeight,h=o.effectiveFilterWidth,f=h-1-o.padInfo.left,p=d-1-o.padInfo.top,g=we(r.shape,"float32"),m=this.bufferSync(s),v=this.bufferSync(t),y=0;y<o.batchSize;++y)for(var b=0;b<o.inChannels;++b)for(var x=0;x<o.inHeight;++x)for(var w=0;w<o.inWidth;++w){for(var _=x-p,C=w-f,E=0,S=0;S<d;S+=u){var D=(_+S)/a;if(!(D<0||D>=o.outHeight||Math.floor(D)!==D))for(var k=0;k<h;k+=c){var M=(C+k)/l;if(!(M<0||M>=o.outWidth||Math.floor(M)!==M)){var B=d*h-1-m.get(y,D,M,b)===S*h+k?1:0;B!==0&&(E+=v.get(y,D,M,b)*B)}}}g.set(E,y,x,w,b)}return g.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){Q([t,r],"avgPoolBackprop");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,l=i.filterWidth,u=i.dilationHeight,c=i.dilationWidth,d=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=h-1-i.padInfo.left,p=d-1-i.padInfo.top,g=we(r.shape,"float32"),m=1/(a*l),v=this.bufferSync(t),y=0;y<i.batchSize;++y)for(var b=0;b<i.inChannels;++b)for(var x=0;x<i.inHeight;++x)for(var w=0;w<i.inWidth;++w){for(var _=x-p,C=w-f,E=0,S=0;S<d;S+=u){var D=(_+S)/o;if(!(D<0||D>=i.outHeight||Math.floor(D)!==D))for(var k=0;k<h;k+=c){var M=(C+k)/s;M<0||M>=i.outWidth||Math.floor(M)!==M||(E+=v.get(y,D,M,b))}}g.set(E*m,y,x,w,b)}return g.toTensor()},e.prototype.pool3d=function(t,r,i){Q(t,"pool3d");for(var o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(t.dataId),b=we(r.outShape,t.dtype),x=b.values,w=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],E=r.outShape[4],S=0;S<r.batchSize;++S)for(var D=S*w,k=S*t.strides[0],M=0;M<r.inChannels;++M)for(var B=0;B<r.outDepth;++B){for(var H=B*o-p,F=H;F<0;)F+=l;for(var W=Math.min(r.inDepth,d+H),j=D+B*_,U=0;U<r.outHeight;++U){for(var q=U*s-g,K=q;K<0;)K+=u;for(var J=Math.min(r.inHeight,h+q),ee=j+U*C,re=0;re<r.outWidth;++re){for(var fe=re*a-m,pe=fe;pe<0;)pe+=c;for(var ve=Math.min(r.inWidth,f+fe),Ae=ee+re*E,Ce=v,ke=0,dt=0,Re=F;Re<W;Re+=l){for(var Be=k+Re*t.strides[1],He=K;He<J;He+=u){for(var rt=Be+He*t.strides[2],Ke=pe;Ke<ve;Ke+=c){var Ze=y[rt+Ke*t.strides[3]+M];if(i==="max"&&Ze>Ce?Ce=Ze:i==="avg"&&(ke+=Ze,dt++),isNaN(Ce))break}if(isNaN(Ce))break}if(isNaN(Ce))break}x[Ae+M]=i==="avg"?ke/dt:Ce}}}return b.toTensor()},e.prototype.avgPool3d=function(t,r){return Q(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){Q([t,r],"avgPool3dBackprop");for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,l=i.filterDepth,u=i.filterHeight,c=i.filterWidth,d=i.dilationDepth,h=i.dilationHeight,f=i.dilationWidth,p=i.effectiveFilterDepth,g=i.effectiveFilterHeight,m=i.effectiveFilterWidth,v=p-1-i.padInfo.front,y=m-1-i.padInfo.left,b=g-1-i.padInfo.top,x=we(r.shape,"float32"),w=1/(l*u*c),_=this.bufferSync(t),C=0;C<i.batchSize;++C)for(var E=0;E<i.inChannels;++E)for(var S=0;S<i.inDepth;++S)for(var D=0;D<i.inHeight;++D)for(var k=0;k<i.inWidth;++k){for(var M=S-v,B=D-b,H=k-y,F=0,W=0;W<p;W+=d){var j=(M+W)/o;if(!(j<0||j>=i.outDepth||Math.floor(j)!==j))for(var U=0;U<g;U+=h){var q=(B+U)/s;if(!(q<0||q>=i.outHeight||Math.floor(q)!==q))for(var K=0;K<m;K+=f){var J=(H+K)/a;J<0||J>=i.outWidth||Math.floor(J)!==J||(F+=_.get(C,j,q,J,E))}}}x.set(F*w,C,S,D,k,E)}return x.toTensor()},e.prototype.maxPool3d=function(t,r){return Q(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=we(r.outShape,"int32"),o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v=this.bufferSync(t),y=0;y<r.batchSize;++y)for(var b=0;b<r.inChannels;++b)for(var x=0;x<r.outDepth;++x){for(var w=x*o-p,_=w;_<0;)_+=l;for(var C=Math.min(r.inDepth,d+w),E=0;E<r.outHeight;++E){for(var S=E*s-g,D=S;D<0;)D+=u;for(var k=Math.min(r.inHeight,h+S),M=0;M<r.outWidth;++M){for(var B=M*a-m,H=B;H<0;)H+=c;for(var F=Math.min(r.inWidth,f+B),W=Number.NEGATIVE_INFINITY,j=-1,U=_;U<C;U+=l)for(var q=U-w,K=D;K<k;K+=u)for(var J=K-S,ee=H;ee<F;ee+=c){var re=ee-B,fe=v.get(y,U,K,ee,b);fe>=W&&(W=fe,j=q*h*f+J*h+re)}i.set(j,y,x,E,M,b)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,o){Q([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,o),a=o.strideDepth,l=o.strideHeight,u=o.strideWidth,c=o.dilationDepth,d=o.dilationHeight,h=o.dilationWidth,f=o.effectiveFilterDepth,p=o.effectiveFilterHeight,g=o.effectiveFilterWidth,m=f-1-o.padInfo.front,v=g-1-o.padInfo.left,y=p-1-o.padInfo.top,b=we(r.shape,"float32"),x=this.bufferSync(s),w=this.bufferSync(t),_=0;_<o.batchSize;++_)for(var C=0;C<o.inChannels;++C)for(var E=0;E<o.inDepth;++E)for(var S=0;S<o.inHeight;++S)for(var D=0;D<o.inWidth;++D){for(var k=E-m,M=S-y,B=D-v,H=0,F=0;F<f;F+=c){var W=(k+F)/a;if(!(W<0||W>=o.outDepth||Math.floor(W)!==W))for(var j=0;j<p;j+=d){var U=(M+j)/l;if(!(U<0||U>=o.outHeight||Math.floor(U)!==U))for(var q=0;q<g;q+=h){var K=(B+q)/u;if(!(K<0||K>=o.outWidth||Math.floor(K)!==K)){var J=f*p*g-1-x.get(_,W,U,K,C)===F*p*g+j*g+q?1:0;J!==0&&(H+=w.get(_,W,U,K,C)*J)}}}}b.set(H,_,E,S,D,C)}return b.toTensor()},e.prototype.cast=function(t,r){return RC(t,r,this)},e.prototype.reshape=function(t,r){return Gf(t,r)},e.prototype.avgPool=function(t,r){return Q(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,i,o){Q(t,"resizeBilinear");for(var s=t.shape,a=s[0],l=s[1],u=s[2],c=s[3],d=this.readSync(t.dataId),h=new Float32Array(le([a,r,i,c])),f=[o&&r>1?l-1:l,o&&i>1?u-1:u],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],g=0,m=f[0]/p[0],v=f[1]/p[1],y=0;y<a;y++)for(var b=0;b<r;b++)for(var x=m*b,w=Math.floor(x),_=x-w,C=Math.min(l-1,Math.ceil(x)),E=y*t.strides[0]+w*t.strides[1],S=y*t.strides[0]+C*t.strides[1],D=0;D<i;D++)for(var k=v*D,M=Math.floor(k),B=k-M,H=Math.min(u-1,Math.ceil(k)),F=E+M*t.strides[2],W=S+M*t.strides[2],j=E+H*t.strides[2],U=S+H*t.strides[2],q=0;q<c;q++){var K=d[F+q],J=d[W+q],ee=K+(d[j+q]-K)*B,re=ee+(J+(d[U+q]-J)*B-ee)*_;h[g++]=re}return Ut(h,[a,r,i,c])},e.prototype.resizeBilinearBackprop=function(t,r,i){Q([t,r],"resizeBilinearBackprop");for(var o=r.shape,s=o[0],a=o[1],l=o[2],u=o[3],c=t.shape,d=c[1],h=c[2],f=new Float32Array(s*a*l*u),p=[i&&d>1?a-1:a,i&&h>1?l-1:l],g=[i&&d>1?d-1:d,i&&h>1?h-1:h],m=p[0]/g[0],v=p[1]/g[1],y=this.readSync(t.dataId),b=0,x=0;x<s;x++)for(var w=x*r.strides[0],_=0;_<d;_++)for(var C=_*m,E=Math.floor(C),S=Math.min(Math.ceil(C),a-1),D=w+E*r.strides[1],k=w+S*r.strides[1],M=C-E,B=1-M,H=0;H<h;H++)for(var F=H*v,W=Math.floor(F),j=Math.min(Math.ceil(F),l-1),U=F-W,q=1-U,K=D+W*r.strides[2],J=D+j*r.strides[2],ee=k+W*r.strides[2],re=k+j*r.strides[2],fe=B*q,pe=B*U,ve=M*q,Ae=M*U,Ce=0;Ce<u;Ce++){var ke=y[b++];f[K+Ce]+=ke*fe,f[J+Ce]+=ke*pe,f[ee+Ce]+=ke*ve,f[re+Ce]+=ke*Ae}return vn(f,[s,l,a,u],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,o){Q(t,"resizeNearestNeighbor");for(var s=t.shape,a=s[0],l=s[1],u=s[2],c=s[3],d=this.readSync(t.dataId),h=new Float32Array(a*r*i*c),f=[o&&r>1?l-1:l,o&&i>1?u-1:u],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],g=f[0]/p[0],m=f[1]/p[1],v=0,y=0;y<a;y++)for(var b=y*t.strides[0],x=0;x<r;x++)for(var w=g*x,_=b+Math.min(l-1,o?Math.round(w):Math.floor(w))*t.strides[1],C=0;C<i;C++)for(var E=m*C,S=_+Math.min(u-1,o?Math.round(E):Math.floor(E))*t.strides[2],D=0;D<c;D++){var k=d[S+D];h[v++]=k}return Ut(h,[a,r,i,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){Q([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,s=o[0],a=o[1],l=o[2],u=o[3],c=t.shape,d=c[1],h=c[2],f=new Float32Array(s*a*l*u),p=this.readSync(t.dataId),g=[i&&d>1?a-1:a,i&&h>1?l-1:l],m=[i&&d>1?d-1:d,i&&h>1?h-1:h],v=g[0]/m[0],y=g[1]/m[1],b=1/v,x=1/y,w=2*Math.ceil(b)+2,_=2*Math.ceil(x)+2,C=0;C<s;C++)for(var E=C*r.strides[0],S=0;S<a;S++)for(var D=E+S*r.strides[1],k=Math.floor(S*b),M=Math.floor(k-w/2),B=0;B<l;B++)for(var H=D+B*r.strides[2],F=Math.floor(B*x),W=Math.floor(F-_/2),j=0;j<u;j++){for(var U=0,q=0;q<w;q++){var K=q+M;if(!(K<0||K>=d)){var J=E+K*t.strides[1],ee=K*v;if(S===Math.min(a-1,i?Math.round(ee):Math.floor(ee)))for(var re=0;re<_;re++){var fe=re+W;if(!(fe<0||fe>=h)){var pe=J+fe*t.strides[2],ve=fe*y;B===Math.min(l-1,i?Math.round(ve):Math.floor(ve))&&(U+=p[pe+j])}}}}f[H+j]=U}return vn(f,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,o,s,a){Q([t,r,i,s,a],"batchNorm");for(var l=this.readSync(t.dataId),u=this.readSync(r.dataId),c=this.readSync(i.dataId),d=s?this.readSync(s.dataId):new Float32Array([1]),h=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(l.length),p=h.length,g=d.length,m=c.length,v=u.length,y=0,b=0,x=0,w=0,_=0;_<l.length;++_)f[_]=h[y++]+(l[_]-u[b++])*d[x++]/Math.sqrt(c[w++]+o),y>=p&&(y=0),b>=v&&(b=0),x>=g&&(x=0),w>=m&&(w=0);return vn(f,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,o,s){Q(t,"localResponseNormalization4D");var a=t.shape[3],l=a-1,u=this.readSync(t.dataId),c=t.size,d=new Float32Array(c);function h(m){for(var v=m%a,y=m-v+Math.max(0,v-r),b=m-v+Math.min(v+r,l),x=0;y<=b;y++){var w=u[y];x+=w*w}return x}for(var f=0;f<c;f++){var p=h(f),g=u[f]*Math.pow(i+o*p,-s);d[f]=g}return vn(d,t.shape)},e.prototype.LRNGrad=function(t,r,i,o,s,a,l){Q(t,"LRNGrad");for(var u=t.shape[3],c=this.readSync(t.dataId),d=this.readSync(r.dataId),h=this.readSync(i.dataId),f=new Float32Array(t.size),p=t.size,g=0;g<p;g++){for(var m=g%u,v=g-m+Math.max(0,m-o),y=g-m+Math.min(u,m+o+1),b=0,x=v;x<y;x++)b+=Math.pow(d[x],2);for(b=a*b+s,x=v;x<y;x++){var w=-2*a*l*d[x]*h[g]/b;g===x&&(w+=Math.pow(b,-l)),w*=c[g],f[x]+=w}}return vn(f,t.shape)},e.prototype.multinomial=function(t,r,i,o){Q(t,"multinomial");for(var s=r?t:ii(t),a=s.shape[0],l=s.shape[1],u=et([a,i],"int32"),c=this.readSync(u.dataId),d=this.readSync(s.dataId),h=0;h<a;++h){var f=h*l,p=new Float32Array(l-1);p[0]=d[f];for(var g=1;g<p.length;++g)p[g]=p[g-1]+d[f+g];for(var m=$c(o.toString()),v=h*i,y=0;y<i;++y){var b=m();c[v+y]=p.length;for(var x=0;x<p.length;x++)if(b<p[x]){c[v+y]=x;break}}}return u},e.prototype.oneHot=function(t,r,i,o){Q(t,"oneHot");var s=new Float32Array(t.size*r);s.fill(o);for(var a=this.readSync(t.dataId),l=0;l<t.size;++l)a[l]>=0&&a[l]<r&&(s[l*r+a[l]]=i);return ki(s,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,o,s){return Q(t,"nonMaxSuppression"),wg(this.readSync(t.dataId),this.readSync(r.dataId),i,o,s)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],o=t.shape[1],s=we(t.shape,"float32"),a=we(t.shape,"float32"),l=Yn(t).as2D(i,o),u=Er(t).as2D(i,o),c=0;c<i;c++)for(var d=l.slice([c,0],[1,o]),h=u.slice([c,0],[1,o]),f=zt(d,h),p=this.readSync(this.fftImpl(f,r).dataId),g=0;g<o;g++){var m=m0(p,g);s.values[c*o+g]=m.real,a.values[c*o+g]=m.imag}return zt(s.toTensor(),a.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var s=this.fftRadix2(i,o,r).as2D(t.shape[0],t.shape[1]);return r&&(s=zt(Yn(s).div(te(o)),Er(s).div(te(o)))),s}var a=this.readSync(t.dataId),l=(function(u){for(var c=new Float32Array(u.length/2),d=new Float32Array(u.length/2),h=0;h<u.length;h+=2)c[h/2]=u[h],d[h/2]=u[h+1];return{real:c,imag:d}})(this.fourierTransformByMatmul(a,o,r));return zt(l.real,l.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var o=this.readSync(t.dataId),s=r/2,a=(function(v){for(var y=Math.ceil(v.length/4),b=new Float32Array(y),x=new Float32Array(y),w=0;w<v.length;w+=4)b[Math.floor(w/4)]=v[w],x[Math.floor(w/4)]=v[w+1];return{real:b,imag:x}})(o),l=zt(a.real,a.imag).as1D(),u=(function(v){for(var y=Math.floor(v.length/4),b=new Float32Array(y),x=new Float32Array(y),w=2;w<v.length;w+=4)b[Math.floor(w/4)]=v[w],x[Math.floor(w/4)]=v[w+1];return{real:b,imag:x}})(o),c=zt(u.real,u.imag).as1D();l=this.fftRadix2(l,s,i),c=this.fftRadix2(c,s,i);var d=(function(v,y){for(var b=new Float32Array(v/2),x=new Float32Array(v/2),w=0;w<Math.ceil(v/2);w++){var _=(y?2:-2)*Math.PI*(w/v);b[w]=Math.cos(_),x[w]=Math.sin(_)}return{real:b,imag:x}})(r,i),h=zt(d.real,d.imag).mul(c),f=l.add(h),p=l.sub(h),g=Yn(f).concat(Yn(p)),m=Er(f).concat(Er(p));return zt(g,m).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var o=new Float32Array(2*r),s=0;s<r;s++){for(var a=0,l=0,u=0;u<r;u++){var c=QV(s*u,r,i),d=m0(t,u);a+=d.real*c.real-d.imag*c.imag,l+=d.real*c.imag+d.imag*c.real}i&&(a/=r,l/=r),KV(o,a,l,s)}return o},e.prototype.depthToSpace=function(t,r,i){T(i==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i})),T(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));for(var o=t.shape[0],s=t.shape[1],a=t.shape[2],l=t.shape[3],u=s*r,c=a*r,d=l/(r*r),h=this.readSync(t.dataId),f=new Float32Array(o*u*c*d),p=0,g=0;g<o;++g)for(var m=0;m<u;++m)for(var v=Math.floor(m/r),y=m%r,b=0;b<c;++b)for(var x=Math.floor(b/r),w=(y*r+b%r)*d,_=0;_<d;++_){var C=_+w+l*(x+a*(v+s*g));f[p++]=h[C]}return vn(f,[o,u,c,d])},e.prototype.broadcastedBinaryOp=function(t,r,i,o){var s=Oe(t.shape,r.shape),a=we(s,i),l=this.readSync(t.dataId),u=this.readSync(r.dataId),c=Ei(t.shape,s),d=Ei(r.shape,s),h=a.values;if(c.length+d.length===0)for(var f=0;f<h.length;++f)h[f]=o(l[f%l.length],u[f%u.length]);else{var p=this.bufferSync(t),g=this.bufferSync(r),m=function(v){var y=a.indexToLoc(v),b=y.slice(-t.rank);c.forEach((function(C){return b[C]=0}));var x=p.locToIndex(b),w=y.slice(-r.rank);d.forEach((function(C){return w[C]=0}));var _=g.locToIndex(w);h[v]=o(l[x],u[_])};for(f=0;f<h.length;++f)m(f)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var o=Oe(t.shape,r.shape),s=we(o,"float32"),a=we(o,"float32"),l=this.readSync(t.dataId),u=this.readSync(r.dataId),c=Ei(t.shape,o),d=Ei(r.shape,o),h=s.values,f=a.values;if(c.length+d.length===0)for(var p=0;p<h.length;p++){var g=p%l.length,m=p%u.length,v=i(l[2*g],l[2*g+1],u[2*m],u[2*m+1]);h[p]=v.real,f[p]=v.imag}else{var y=this.bufferSync(this.data.get(t.dataId).complexTensors.real),b=this.bufferSync(this.data.get(r.dataId).complexTensors.real),x=function(w){var _=s.indexToLoc(w),C=_.slice(-t.rank);c.forEach((function(M){return C[M]=0}));var E=y.locToIndex(C),S=_.slice(-r.rank);d.forEach((function(M){return S[M]=0}));var D=b.locToIndex(S),k=i(l[2*E],l[2*E+1],u[2*D],u[2*D+1]);h[w]=k.real,f[w]=k.imag};for(p=0;p<h.length;p++)x(p)}return this.complex(s.toTensor(),a.toTensor())},e.prototype.split=function(t,r,i){return MC(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,o,s,a){for(var l=t.shape,u=l[0],c=l[1],d=l[2],h=l[3],f=r.shape[0],p=o[0],g=o[1],m=we([f,p,g,h],"float32"),v=this.readSync(r.dataId),y=this.readSync(i.dataId),b=this.readSync(t.dataId),x=t.strides,w=m.strides,_=0;_<f;_++){var C=4*_,E=v[C],S=v[C+1],D=v[C+2],k=v[C+3],M=y[_];if(!(M>=u))for(var B=p>1?(D-E)*(c-1)/(p-1):0,H=g>1?(k-S)*(d-1)/(g-1):0,F=0;F<p;F++){var W=p>1?E*(c-1)+F*B:.5*(E+D)*(c-1);if(W<0||W>c-1)for(var j=0;j<g;j++)for(var U=0;U<h;U++){var q=U+j*w[2]+F*w[1]+_*w[0];m.values[q]=a}else if(s==="bilinear"){var K=Math.floor(W),J=Math.ceil(W),ee=W-K;for(j=0;j<g;j++)if((Re=g>1?S*(d-1)+j*H:.5*(S+k)*(d-1))<0||Re>d-1)for(U=0;U<h;U++)q=U+j*w[2]+F*w[1]+_*w[0],m.values[q]=a;else{var re=Math.floor(Re),fe=Math.ceil(Re),pe=Re-re;for(U=0;U<h;U++){var ve=b[q=U+re*x[2]+K*x[1]+M*x[0]],Ae=b[q=U+fe*x[2]+K*x[1]+M*x[0]],Ce=b[q=U+re*x[2]+J*x[1]+M*x[0]],ke=ve+(Ae-ve)*pe,dt=Ce+(b[q=U+fe*x[2]+J*x[1]+M*x[0]]-Ce)*pe;q=U+j*w[2]+F*w[1]+_*w[0],m.values[q]=ke+(dt-ke)*ee}}}else for(j=0;j<g;++j){var Re;if((Re=g>1?S*(d-1)+j*H:.5*(S+k)*(d-1))<0||Re>d-1)for(U=0;U<h;U++)q=U+j*w[2]+F*w[1]+_*w[0],m.values[q]=a;else{var Be=Math.round(Re),He=Math.round(W);for(U=0;U<h;U++){var rt=U+Be*x[2]+He*x[1]+M*x[0],Ke=U+j*w[2]+F*w[1]+_*w[0];m.values[Ke]=b[rt]}}}}}return m.toTensor()},e.prototype.sparseToDense=function(t,r,i,o){var s=ac(0,t,i),a=s.sliceRank,l=s.numUpdates,u=s.sliceSize,c=s.strides,d=s.outputSize;return this.scatter(t,r,i,d,u,l,a,c,o,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],s=_C(t,r),a=s[0],l=s[1],u=s[2],c=s[3];if(l===0)return Ut([],a,t.dtype);for(var d=new La([l,u],t.dtype),h=this.readSync(r.dataId),f=this.readSync(t.dataId),p=0;p<l;p++){for(var g=[],m=0,v=0;v<o;v++){var y=h[p*o+v];m+=y*c[v],g.push(y)}if(m<0||m>=t.size/u)throw new Error("Invalid indices: "+g+" does not index into "+t.shape);for(var b=0;b<u;b++)d.values[p*u+b]=f[m*u+b]}return d.toTensor().reshape(a)},e.prototype.scatterND=function(t,r,i){var o=ac(0,t,i),s=o.sliceRank,a=o.numUpdates,l=o.sliceSize,u=o.strides,c=o.outputSize,d=te(0);return this.scatter(t,r,i,c,l,a,s,u,d,!0)},e.prototype.fill=function(t,r,i){var o=Qu(i=i||tl(r),le(t));return o.fill(r),N.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=Qu(t.dtype,le(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return TC(t,r,i)},e.prototype.scatter=function(t,r,i,o,s,a,l,u,c,d){var h=[o/s,s],f=this.readSync(t.dataId),p=this.readSync(r.dataId);if(o===0)return Ut([],i,r.dtype);var g=new La(h,r.dtype);g.values.fill(this.readSync(c.dataId)[0]);for(var m=0;m<a;m++){for(var v=[],y=0,b=0;b<l;b++){var x=f[m*l+b];v.push(x),y+=x*u[b]}if(y<0||y>=o/s)throw new Error("Invalid indices: "+v+" does not index into "+i);for(var w=0;w<s;w++)d?g.values[y*s+w]+=p[m*s+w]:g.values[y*s+w]=r.rank===0?p[0]:p[m*s+w]}return g.toTensor().reshape(i)},e})(AC);N.registerBackend("cpu",(function(){return new vG}),1);for(var Mh=0,B0=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e,o=i.boxes,s=i.scores,a=r,l=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,d=a.softNmsSigma,h=t;Q(o,"NonMaxSuppressionWithScore");var f=_g(h.data.get(o.dataId).values,h.data.get(s.dataId).values,l,u,c,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t;Q(r,"square");for(var o=i.data.get(r.dataId).values,s=new Float32Array(o.length),a=0;a<o.length;++a){var l=o[a];s[a]=l*l}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Wa,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,o=r.b,s=t;Q([i,o],Wa);var a=s.data.get(i.dataId).values,l=s.data.get(o.dataId).values,u=(function(h,f,p,g,m,v){var y=Oe(h,f),b=y.length,x=Rr(y),w=Fa(m,le(y)),_=h.length,C=f.length,E=Rr(h),S=Rr(f),D=Ei(h,y),k=Ei(f,y);if(D.length+k.length===0)for(var M=0;M<w.length;++M)w[M]=v(p[M%p.length],g[M%g.length]);else{var B=function(H){var F=Az(H,b,x),W=F.slice(-_);D.forEach((function(K){return W[K]=0}));var j=a0(W,_,E),U=F.slice(-C);k.forEach((function(K){return U[K]=0}));var q=a0(U,C,S);w[H]=v(p[j],g[q])};for(M=0;M<w.length;++M)B(M)}return[w,y]})(i.shape,o.shape,a,l,i.dtype,(function(h,f){var p=h-f;return p*p})),c=u[0],d=u[1];return{dataId:s.write(c,d,i.dtype),shape:d,dtype:i.dtype}}}];Mh<B0.length;Mh++)tC(B0[Mh]);var qo,yG=function(n){this.variableNames=["A"];var e=Qt(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},bG=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Qt(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var Oh=0,H0=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e.pixels,o=r.numChannels,s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,l=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=l[0],c=l[1],d=[c,u],h=[c,u,o];(a||s)&&(qo==null&&(qo=document.createElement("canvas").getContext("2d")),qo.canvas.width=u,qo.canvas.height=c,qo.drawImage(i,0,0,u,c),i=qo.canvas);var f=t.makeTensorInfo(d,"int32");t.texData.get(f.dataId).usage=Ln.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),i);var p=X().getBool("WEBGL_PACK")?new bG(h):new yG(h),g=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;tc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,s=i.scores,a=r,l=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,d=a.softNmsSigma,h=t,f=_g(h.readSync(o.dataId),h.readSync(s.dataId),l,u,c,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t,o=new De(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:Wa,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,o=r.b,s=t,a=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r("return (a - b) * (a - b);",i.shape,o.shape):new vt("return (a - b) * (a - b);",i.shape,o.shape);return s.compileAndRun(a,[i,o])}}];Oh<H0.length;Oh++)tC(H0[Oh]);for(var Ph=0,W0=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:Wa,gradFunc:function(n,e){var t=e[0],r=e[1],i=te(2);return{a:function(){return en(n,en(i,It(t,r)))},b:function(){return en(n,en(i,It(r,t)))}}}}];Ph<W0.length;Ph++)mz(W0[Ph]);var xG=(function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n})();X().get("IS_BROWSER")&&X().setPlatform("browser",new xG);var Nh,wG=function(){return require("node-fetch")},_G=(function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return X().global.fetch!=null?X().global.fetch(e,t):(Nh==null&&(Nh=wG()),Nh(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n})();X().get("IS_NODE")&&X().setPlatform("node",new _G);var Xf={float32:4,int32:4,uint16:2,uint8:1,bool:1},pc=4;function EE(n,e){for(var t={},r=0,i=function(a){var l=a.name,u=a.dtype,c=a.shape,d=le(c),h=void 0;if("quantization"in a){var f=a.quantization;if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error("Weight "+a.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Xf[f.dtype],g=n.slice(r,r+d*p),m=f.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(u==="float32")h=Float32Array.from(m,(function(_){return _*f.scale+f.min}));else{if(u!=="int32")throw new Error("Unsupported dtype in weight '"+l+"': "+u);h=Int32Array.from(m,(function(_){return Math.round(_*f.scale+f.min)}))}r+=d*p}else if(u==="string"){var v=le(a.shape);h=[];for(var y=0;y<v;y++){var b=new Uint32Array(n.slice(r,r+pc))[0];r+=pc;var x=new Uint8Array(n.slice(r,r+b));h.push(x),r+=b}}else{var w=Xf[u];if(g=n.slice(r,r+d*w),u==="float32")h=new Float32Array(g);else if(u==="int32")h=new Int32Array(g);else{if(u!=="bool")throw new Error("Unsupported dtype in weight '"+l+"': "+u);h=new Uint8Array(g)}r+=d*w}t[l]=Ut(h,c,u)},o=0,s=e;o<s.length;o++)i(s[o]);return t}function CG(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach((function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)}));var r=new Uint8Array(e),i=0;return t.forEach((function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength})),r.buffer}var Kf=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function z0(n){return Kf?Buffer.byteLength(n):new Blob([n]).size}function zg(n){var e=0;n.forEach((function(i){e+=i.byteLength}));var t=new Uint8Array(e),r=0;return n.forEach((function(i){t.set(new Uint8Array(i),r),r+=i.byteLength})),t.buffer}function V0(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function ll(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:z0(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:z0(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Bn=(function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach((function(o){var s=o(e,r);s!==null&&i.push(s)})),i},n})(),ms="://",Ri=(function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){T(e!=null,(function(){return"scheme must not be undefined or null."})),e.endsWith(ms)&&(e=e.slice(0,e.indexOf(ms))),T(e.length>0,(function(){return"scheme must not be an empty string."}));var r=n.getInstance();T(r.managers[e]==null,(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n})();function bu(n){if(n.indexOf(ms)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ri.getSchemes().join(","));return{scheme:n.split(ms)[0],path:n.split(ms)[1]}}function U0(n,e,t){return t===void 0&&(t=!1),oe(this,void 0,void 0,(function(){var r,i,o,s,a,l,u,c,d;return se(this,(function(h){switch(h.label){case 0:return T(n!==e,(function(){return"Old path and new path are the same: '"+n+"'"})),T((r=Bn.getLoadHandlers(n)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+n+"."})),T(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."})),i=r[0],T((o=Bn.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),T(o.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),s=o[0],a=bu(n).scheme,l=bu(n).path,u=a===bu(n).scheme,[4,i.load()];case 1:return c=h.sent(),t&&u?[4,Ri.getManager(a).removeModel(l)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,s.save(c)];case 4:return d=h.sent(),!t||u?[3,6]:[4,Ri.getManager(a).removeModel(l)];case 5:h.sent(),h.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var po="models_store",Si="model_info_store";function SE(){if(!X().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Qf(n){var e=n.result;e.createObjectStore(po,{keyPath:"modelPath"}),e.createObjectStore(Si,{keyPath:"modelPath"})}var vs=(function(){function n(e){if(this.indexedDB=SE(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return oe(this,void 0,void 0,(function(){return se(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},n.prototype.load=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},n.prototype.databaseAction=function(e,t){var r=this;return new Promise((function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Qf(s)},s.onsuccess=function(){var a=s.result;if(t==null){var l=a.transaction(po,"readonly"),u=l.objectStore(po).get(r.modelPath);u.onsuccess=function(){if(u.result==null)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(u.result.modelArtifacts)},u.onerror=function(g){return a.close(),o(u.error)},l.oncomplete=function(){return a.close()}}else{var c,d=ll(t),h=a.transaction(Si,"readwrite"),f=h.objectStore(Si),p=f.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var g=(c=a.transaction(po,"readwrite")).objectStore(po).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:d});g.onsuccess=function(){return i({modelArtifactsInfo:d})},g.onerror=function(m){var v=(f=h.objectStore(Si)).delete(r.modelPath);v.onsuccess=function(){return a.close(),o(g.error)},v.onerror=function(y){return a.close(),o(g.error)}}},p.onerror=function(g){return a.close(),o(p.error)},h.oncomplete=function(){c==null?a.close():c.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}}))},n.URL_SCHEME="indexeddb://",n})(),j0=function(n){return X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(vs.URL_SCHEME)?(e=n.slice(vs.URL_SCHEME.length),new vs(e)):null;var e};Bn.registerSaveRouter(j0),Bn.registerLoadRouter(j0);var EG=(function(){function n(){this.indexedDB=SE()}return n.prototype.listModels=function(){return oe(this,void 0,void 0,(function(){var e=this;return se(this,(function(t){return[2,new Promise((function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Qf(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(Si,"readonly"),l=a.objectStore(Si).getAll();l.onsuccess=function(){for(var u={},c=0,d=l.result;c<d.length;c++){var h=d[c];u[h.modelPath]=h.modelArtifactsInfo}r(u)},l.onerror=function(u){return s.close(),i(l.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}}))]}))}))},n.prototype.removeModel=function(e){return oe(this,void 0,void 0,(function(){var t=this;return se(this,(function(r){var i;return e=(i=e).startsWith(vs.URL_SCHEME)?i.slice(vs.URL_SCHEME.length):i,[2,new Promise((function(o,s){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Qf(a)},a.onsuccess=function(){var l,u=a.result,c=u.transaction(Si,"readwrite"),d=c.objectStore(Si),h=d.get(e);h.onsuccess=function(){if(h.result==null)return u.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var f=d.delete(e),p=function(){var g=(l=u.transaction(po,"readwrite")).objectStore(po).delete(e);g.onsuccess=function(){return o(h.result.modelArtifactsInfo)},g.onerror=function(m){return s(h.error)}};f.onsuccess=p,f.onerror=function(g){return p(),u.close(),s(h.error)}},h.onerror=function(f){return u.close(),s(h.error)},c.oncomplete=function(){l==null?u.close():l.oncomplete=function(){return u.close()}}},a.onerror=function(l){return s(a.error)}}))]}))}))},n})();if(X().getBool("IS_BROWSER"))try{Ri.registerManager(vs.URL_SCHEME,new EG)}catch{}var qr="/",es="tensorflowjs_models",DE="info",SG="model_topology",DG="weight_specs",AG="weight_data",kG="model_metadata";function AE(n){return{info:[es,n,DE].join(qr),topology:[es,n,SG].join(qr),weightSpecs:[es,n,DG].join(qr),weightData:[es,n,AG].join(qr),modelMetadata:[es,n,kG].join(qr)}}function RG(n){var e=n.split(qr);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(qr)}var ys=(function(){function n(e){if(!X().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=AE(this.modelPath)}return n.prototype.save=function(e){return oe(this,void 0,void 0,(function(){var t,r,i;return se(this,(function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=ll(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(function(s){if(Kf)return Buffer.from(s).toString("base64");for(var a=new Uint8Array(s),l="",u=0,c=a.length;u<c;u++)l+=String.fromCharCode(a[u]);return btoa(l)})(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]}))}))},n.prototype.load=function(){return oe(this,void 0,void 0,(function(){var e,t,r,i,o,s,a;return se(this,(function(l){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(o),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,t.userDefinedMetadata=s.userDefinedMetadata),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(u){if(Kf){var c=Buffer.from(u,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var d=atob(u),h=new Uint8Array(d.length),f=0;f<d.length;++f)h.set([d.charCodeAt(f)],f);return h.buffer})(a),[2,t]}))}))},n.URL_SCHEME="localstorage://",n})(),$0=function(n){return X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ys.URL_SCHEME)?(e=n.slice(ys.URL_SCHEME.length),new ys(e)):null;var e};Bn.registerSaveRouter($0),Bn.registerLoadRouter($0);var TG=(function(){function n(){T(X().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),T(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return n.prototype.listModels=function(){return oe(this,void 0,void 0,(function(){var e,t,r,i,o,s;return se(this,(function(a){for(e={},t=es+qr,r=qr+DE,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(s=RG(o),e[s]=JSON.parse(this.LS.getItem(o)));return[2,e]}))}))},n.prototype.removeModel=function(e){return oe(this,void 0,void 0,(function(){var t,r;return se(this,(function(i){var o;if(e=(o=e).startsWith(ys.URL_SCHEME)?o.slice(ys.URL_SCHEME.length):o,t=AE(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},n})();if(X().getBool("IS_BROWSER"))try{Ri.registerManager(ys.URL_SCHEME,new TG)}catch{}var IG="model",MG=".json",OG=".weights.bin";function G0(n){return new Promise((function(e){return setTimeout(e)})).then(n)}var Fh=(function(){function n(e){if(!X().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=IG),this.modelTopologyFileName=e+MG,this.weightDataFileName=e+OG}return n.prototype.save=function(e){return oe(this,void 0,void 0,(function(){var t,r,i,o,s,a;return se(this,(function(l){switch(l.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,G0((function(){return s.dispatchEvent(new MouseEvent("click"))}))];case 2:return l.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,G0((function(){return a.dispatchEvent(new MouseEvent("click"))}))]);case 3:l.sent(),l.label=4;case 4:return[2,{modelArtifactsInfo:ll(e)}]}}))}))},n.URL_SCHEME="downloads://",n})(),PG=(function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return oe(this,void 0,void 0,(function(){var e,t,r=this;return se(this,(function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(o,s){var a=new FileReader;a.onload=function(l){var u=JSON.parse(l.target.result),c=u.modelTopology;if(c!=null){t.length===0&&o({modelTopology:c});var d=u.weightsManifest;if(d!=null){var h;try{h=r.checkManifestAndWeightFiles(d,t)}catch(m){return void s(m)}var f=[],p=[],g=[];d.forEach((function(m){m.paths.forEach((function(v){p.push(v),g.push(null)})),f.push.apply(f,m.weights)})),d.forEach((function(m){m.paths.forEach((function(v){var y=new FileReader;y.onload=function(b){var x=b.target.result,w=p.indexOf(v);g[w]=x,g.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:f,weightData:zg(g),format:u.format,generatedBy:u.generatedBy,convertedBy:u.convertedBy,userDefinedMetadata:u.userDefinedMetadata})},y.onerror=function(b){return s("Failed to weights data from file of path '"+v+"'.")},y.readAsArrayBuffer(h[v])}))}))}else s(new Error("weightManifest field is missing from file "+e.name))}else s(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(l){return s("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map((function(l){return V0(l.name)})),o={},s=0,a=e;s<a.length;s++)a[s].paths.forEach((function(l){var u=V0(l);if(r.indexOf(u)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+u+"'");if(r.push(u),i.indexOf(u)===-1)throw new Error("Weight file with basename '"+u+"' is not provided.");o[l]=t[i.indexOf(u)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},n})();function q0(n,e,t,r){(function(o){T(o!=null&&Array.isArray(o)&&o.length>0,(function(){return"promises must be a none empty array"}))})(n),(function(o,s){T(o>=0&&o<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o})),T(s>=0&&s<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s})),T(s>=o,(function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s}))})(t=t??0,r=r??1);var i=0;return Promise.all(n.map((function(o){return o.then((function(s){var a=t+ ++i/n.length*(r-t);return e(a),s})),o})))}function kE(n,e){return oe(this,void 0,void 0,(function(){var t,r,i,o,s,a,l,u,c;return se(this,(function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?X().platform.fetch:e.fetchFunc,r=n.map((function(h){return t(h,e.requestInit,{isBinary:!0})})),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=d.sent(),[3,4];case 2:return[4,q0(r,e.onProgress,i,o)];case 3:s=d.sent(),d.label=4;case 4:return a=s.map((function(h){return h.arrayBuffer()})),l=.5,u=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return c=d.sent(),[3,8];case 6:return[4,q0(a,e.onProgress,l,u)];case 7:c=d.sent(),d.label=8;case 8:return[2,c]}}))}))}function Y0(n){var e=this;return function(t,r,i){return r===void 0&&(r=""),oe(e,void 0,void 0,(function(){var o,s,a,l,u,c,d,h,f,p;return se(this,(function(g){switch(g.label){case 0:if(o=t.map((function(){return!1})),s={},a=i!=null?i.map((function(){return!1})):[],l=[],t.forEach((function(m,v){var y=0;m.weights.forEach((function(b){var x="quantization"in b?b.quantization.dtype:b.dtype,w=Xf[x]*le(b.shape),_=function(){o[v]=!0,s[v]==null&&(s[v]=[]),s[v].push({manifestEntry:b,groupOffset:y,sizeBytes:w})};i!=null?i.forEach((function(C,E){C===b.name&&(_(),a[E]=!0)})):_(),l.push(b.name),y+=w}))})),!a.every((function(m){return m})))throw u=i.filter((function(m,v){return!a[v]})),new Error("Could not find weights in manifest with names: "+u.join(", ")+`. 
Manifest JSON has weights with names: `+l.join(", ")+".");return c=o.reduce((function(m,v,y){return v&&m.push(y),m}),[]),d=[],c.forEach((function(m){t[m].paths.forEach((function(v){var y=r+(r.endsWith("/")?"":"/")+v;d.push(y)}))})),[4,n(d)];case 1:return h=g.sent(),f={},p=0,c.forEach((function(m){for(var v=t[m].paths.length,y=0,b=0;b<v;b++)y+=h[p+b].byteLength;for(var x=new ArrayBuffer(y),w=new Uint8Array(x),_=0,C=0;C<v;C++){var E=new Uint8Array(h[p+C]);w.set(E,_),_+=E.byteLength}s[m].forEach((function(S){var D=EE(x.slice(S.groupOffset,S.groupOffset+S.sizeBytes),[S.manifestEntry]);for(var k in D)f[k]=D[k]})),p+=v})),[2,f]}}))}))}}Bn.registerSaveRouter((function(n){return X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Fh.URL_SCHEME)?(function(e){return e===void 0&&(e="model"),new Fh(e)})(n.slice(Fh.URL_SCHEME.length)):null}));var RE=(function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(T(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=X().platform.fetch,T(e!=null&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&T(e.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return oe(this,void 0,void 0,(function(){var t,r,i,o;return se(this,(function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:ll(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}}))}))},n.prototype.load=function(){return oe(this,void 0,void 0,(function(){var e,t,r,i,o,s,a,l,u,c,d,h;return se(this,(function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,s=t.generatedBy,a=t.convertedBy,l=t.format,u=t.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:h=f.sent(),c=h[0],d=h[1],f.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:d,userDefinedMetadata:u,generatedBy:s,convertedBy:a,format:l}]}}))}))},n.prototype.loadWeights=function(e){return oe(this,void 0,void 0,(function(){var t,r,i,o,s,a,l,u,c,d,h;return se(this,(function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(p){var g=p.lastIndexOf("/"),m=p.lastIndexOf("?"),v=p.substring(0,g),y=m>g?p.substring(m):"";return[v+"/",y]})(t),i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],l=0,u=e;l<u.length;l++)c=u[l],a.push.apply(a,c.weights);return d=[],e.forEach((function(p){p.paths.forEach((function(g){d.push(s+g+o)}))})),[4,kE(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=f.sent(),[2,[a,zg(h)]]}}))}))},n.URL_SCHEME_REGEX=/^https?:\/\//,n})();function Jf(n){return n.match(RE.URL_SCHEME_REGEX)!=null}var X0=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every((function(t){return Jf(t)})):Jf(n))?Zf(n,{onProgress:e}):null};function Zf(n,e){return new RE(n,e)}Bn.registerSaveRouter(X0),Bn.registerLoadRouter(X0);var Lh=(function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(e){return[2,this.modelArtifacts]}))}))},n})(),NG=(function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return oe(this,void 0,void 0,(function(){return se(this,(function(t){return[2,this.saveHandler(e)]}))}))},n})(),TE=Object.freeze({browserFiles:function(n){return new PG(n)},browserHTTPRequest:function(n,e){return Zf(n,e)},concatenateArrayBuffers:zg,decodeWeights:EE,encodeWeights:function(n,e){return oe(this,void 0,void 0,(function(){var t,r,i,o,s,a=this;return se(this,(function(l){switch(l.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map((function(u){return u.name})):Object.keys(n),o=function(u){var c=i[u],d=Array.isArray(n)?n[u].tensor:n[c];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+d.dtype);var h={name:c,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var f=new Promise((function(p){return oe(a,void 0,void 0,(function(){var g,m,v,y,b,x,w;return se(this,(function(_){switch(_.label){case 0:return[4,d.bytes()];case 1:for(g=_.sent(),m=g.reduce((function(C,E){return C+E.length}),0)+pc*g.length,v=new Uint8Array(m),y=0,b=0;b<g.length;b++)x=g[b],w=new Uint8Array(new Uint32Array([x.length]).buffer),v.set(w,y),y+=pc,v.set(x,y),y+=x.length;return p(v),[2]}}))}))}));r.push(f)}else r.push(d.data());e!=null&&(h.group=e),t.push(h)},s=0;s<i.length;++s)o(s);return[4,Promise.all(r)];case 1:return[2,{data:CG(l.sent()),specs:t}]}}))}))},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new Lh(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Lh({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Lh({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return Bn.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:ll,getSaveHandlers:function(n){return Bn.getSaveHandlers(n)},http:Zf,isHTTPScheme:Jf,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),oe(this,void 0,void 0,(function(){return se(this,(function(i){return[2,Y0((function(o){return kE(o,{requestInit:r})}))(n,e,t)]}))}))},registerLoadRouter:function(n){return Bn.registerLoadRouter(n)},registerSaveRouter:function(n){return Bn.registerSaveRouter(n)},weightsLoaderFactory:Y0,withSaveHandler:function(n){return new NG(n)},copyModel:function(n,e){return oe(this,void 0,void 0,(function(){return se(this,(function(t){return[2,U0(n,e,!1)]}))}))},listModels:function(){return oe(this,void 0,void 0,(function(){var n,e,t,r,i,o,s;return se(this,(function(a){switch(a.label){case 0:n=Ri.getSchemes(),e={},t=0,r=n,a.label=1;case 1:return t<r.length?(i=r[t],[4,Ri.getManager(i).listModels()]):[3,4];case 2:for(s in o=a.sent())e[i+ms+s]=o[s];a.label=3;case 3:return t++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(n,e){return oe(this,void 0,void 0,(function(){return se(this,(function(t){return[2,U0(n,e,!0)]}))}))},removeModel:function(n){return oe(this,void 0,void 0,(function(){var e;return se(this,(function(t){return e=bu(n),[2,Ri.getManager(e.scheme).removeModel(e.path)]}))}))}}),Yo;P({confusionMatrix_:function(n,e,t){var r=A(n,"labels","confusionMatrix"),i=A(e,"predictions","confusionMatrix");T(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),T(r.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),T(i.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),T(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),T(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var o=jf(r.asType("int32"),t),s=jf(i.asType("int32"),t);return o.transpose().matMul(s).asType("int32")}});var FG=P({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,o=!1,s=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);s=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(eC("FromPixels",N.backendName)!=null)return N.runKernel("FromPixels",{pixels:n},{numChannels:e});var a,l,u=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=u[0],d=u[1];if(s?a=n.getContext("2d").getImageData(0,0,c,d).data:r||t?a=n.data:(o||i)&&(Yo==null&&(Yo=document.createElement("canvas").getContext("2d")),Yo.canvas.width=c,Yo.canvas.height=d,Yo.drawImage(n,0,0,c,d),a=Yo.getImageData(0,0,c,d).data),e===4)l=new Int32Array(a);else{var h=c*d;l=new Int32Array(h*e);for(var f=0;f<h;f++)for(var p=0;p<e;++p)l[f*e+p]=a[4*f+p]}return mg(l,[d,c,e],"int32")}}),Vg=Object.freeze({toPixels:function(n,e){return oe(this,void 0,void 0,(function(){var t,r,i,o,s,a,l,u,c,d,h,f,p,g,m,v,y,b,x,w,_,C,E;return se(this,(function(S){switch(S.label){case 0:if(t=A(n,"img","toPixels"),n instanceof ft||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(s=t.rank===2?1:t.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,t.data()];case 1:return a=S.sent(),l=t.min(),u=t.max(),[4,Promise.all([l.data(),u.data()])];case 2:if(c=S.sent(),d=c[0],h=c[1],f=d[0],p=h[0],l.dispose(),u.dispose(),t.dtype==="float32"){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(g=t.dtype==="float32"?255:1,m=new Uint8ClampedArray(o*i*4),v=0;v<i*o;++v)y=void 0,b=void 0,x=void 0,w=void 0,s===1?(y=a[v]*g,b=a[v]*g,x=a[v]*g,w=255):s===3?(y=a[3*v]*g,b=a[3*v+1]*g,x=a[3*v+2]*g,w=255):s===4&&(y=a[4*v]*g,b=a[4*v+1]*g,x=a[4*v+2]*g,w=a[4*v+3]*g),m[(_=4*v)+0]=Math.round(y),m[_+1]=Math.round(b),m[_+2]=Math.round(x),m[_+3]=Math.round(w);return e!=null&&(e.width=o,e.height=i,C=e.getContext("2d"),E=new ImageData(m,o,i),C.putImageData(E,0,0)),t!==n&&t.dispose(),[2,m]}}))}))},fromPixels:FG}),LG=(function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n})(),BG=(function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n})();function Lo(n){T(n.className!=null,(function(){return"Class being registered does not have the static className property defined."})),T(typeof n.className=="string",(function(){return"className is required to be a string, but got type "+typeof n.className})),T(n.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),BG.register(n)}var Bo=(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return cr(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),s=o.value,a=o.grads;if(i!=null){var l=i.map((function(u){return{name:u.name,tensor:a[u.name]}}));this.applyGradients(l)}else this.applyGradients(a);return Cn(a),r?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return YV(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Cn(this.iterations_)},e.prototype.saveIterations=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:te(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return oe(this,void 0,void 0,(function(){return se(this,(function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return oe(this,void 0,void 0,(function(){var r;return se(this,(function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}}))}))},e})(LG);Object.defineProperty(Bo,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var HG=(function(n){function e(t,r,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=N.backend.epsilon()),o}return cr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var s=N.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:ie((function(){return Le(s).variable(!1)}))}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:ie((function(){return Le(s).variable(!1)}))});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var l=r.accumulatedGrads[o].variable,u=r.accumulatedUpdates[o].variable;ie((function(){var c=l.mul(r.rho).add(a.square().mul(1-r.rho)),d=u.add(r.epsilon).sqrt().div(l.add(r.epsilon).sqrt()).mul(a),h=u.mul(r.rho).add(d.square().mul(1-r.rho));l.assign(c),u.assign(h);var f=d.mul(-r.learningRate).add(s);s.assign(f)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Cn(this.accumulatedGrads.map((function(t){return t.variable}))),Cn(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return oe(this,void 0,void 0,(function(){var t;return se(this,(function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return oe(this,void 0,void 0,(function(){var r;return se(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(r,2*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e})(Bo);Lo(HG);var WG=(function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return cr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var s=N.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:ie((function(){return Tr(s.shape,r.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var l=r.accumulatedGrads[o].variable;ie((function(){var u=l.add(a.square());l.assign(u);var c=a.div(u.add(N.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(c)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Cn(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return oe(this,void 0,void 0,(function(){return se(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e})(Bo);Lo(WG);var zG=(function(n){function e(t,r,i,o){o===void 0&&(o=null);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],ie((function(){s.accBeta1=te(r).variable(),s.accBeta2=te(i).variable()})),o==null&&(s.epsilon=N.backend.epsilon()),s}return cr(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t);ie((function(){var o=It(1,r.accBeta1),s=It(1,r.accBeta2);i.forEach((function(a,l){var u=N.registeredVariables[a];r.accumulatedFirstMoment[l]==null&&(r.accumulatedFirstMoment[l]={originalName:a+"/m",variable:ie((function(){return Le(u).variable(!1)}))}),r.accumulatedSecondMoment[l]==null&&(r.accumulatedSecondMoment[l]={originalName:a+"/v",variable:ie((function(){return Le(u).variable(!1)}))});var c=Array.isArray(t)?t[l].tensor:t[a];if(c!=null){var d=r.accumulatedFirstMoment[l].variable,h=r.accumulatedSecondMoment[l].variable,f=d.mul(r.beta1).add(c.mul(1-r.beta1)),p=h.mul(r.beta2).add(c.square().mul(1-r.beta2)),g=f.div(o),m=p.div(s);d.assign(f),h.assign(p);var v=g.div(m.sqrt().add(r.epsilon)).mul(-r.learningRate).add(u);u.assign(v)}})),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Cn(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&Cn(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return oe(this,void 0,void 0,(function(){var t;return se(this,(function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return oe(this,void 0,void 0,(function(){var r,i=this;return se(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),ie((function(){i.accBeta1.assign(hc(i.beta1,i.iterations_+1)),i.accBeta2.assign(hc(i.beta2,i.iterations_+1))})),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(r,2*r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e})(Bo);Lo(zG);var VG=(function(n){function e(t,r,i,o,s){o===void 0&&(o=null),s===void 0&&(s=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],ie((function(){a.iteration=te(0).variable(),a.accBeta1=te(r).variable()})),o==null&&(a.epsilon=N.backend.epsilon()),a}return cr(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t);ie((function(){var o=It(1,r.accBeta1),s=nr(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach((function(a,l){var u=N.registeredVariables[a];r.accumulatedFirstMoment[l]==null&&(r.accumulatedFirstMoment[l]={originalName:a+"/m",variable:Le(u).variable(!1)}),r.accumulatedWeightedInfNorm[l]==null&&(r.accumulatedWeightedInfNorm[l]={originalName:a+"/v",variable:Le(u).variable(!1)});var c=Array.isArray(t)?t[l].tensor:t[a];if(c!=null){var d=r.accumulatedFirstMoment[l].variable,h=r.accumulatedWeightedInfNorm[l].variable,f=d.mul(r.beta1).add(c.mul(1-r.beta1)),p=h.mul(r.beta2),g=c.abs(),m=p.maximum(g);d.assign(f),h.assign(m);var v=s.div(o).mul(f.div(m.add(r.epsilon))).add(u);u.assign(v)}})),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Cn(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&Cn(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return oe(this,void 0,void 0,(function(){return se(this,(function(r){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e})(Bo);Lo(VG);var IE=(function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return cr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var a=N.registeredVariables[i];ie((function(){var l=r.c.mul(s).add(a);a.assign(l)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=lV(te(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return oe(this,void 0,void 0,(function(){return se(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e})(Bo);Lo(IE);var UG=(function(n){function e(t,r,i){i===void 0&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=te(o.momentum),o}return cr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var s=N.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:ie((function(){return Le(s).variable(!1)}))});var a=r.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&ie((function(){var u,c=r.m.mul(a).add(l);u=r.useNesterov?r.c.mul(l.add(c.mul(r.m))).add(s):r.c.mul(c).add(s),a.assign(c),s.assign(u)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Cn(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return oe(this,void 0,void 0,(function(){return se(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return oe(this,void 0,void 0,(function(){return se(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e})(IE);Lo(UG);var jG=(function(n){function e(t,r,i,o,s){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),s===void 0&&(s=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,o==null&&(a.epsilon=N.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return cr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var s=N.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:ie((function(){return Le(s).variable(!1)}))}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:ie((function(){return Le(s).variable(!1)}))}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:ie((function(){return Le(s).variable(!1)}))});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var l=r.accumulatedMeanSquares[o].variable,u=r.accumulatedMoments[o].variable;ie((function(){var c=l.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,h=d.mul(r.decay).add(a.mul(1-r.decay)),f=u.mul(r.momentum).add(a.mul(r.learningRate).div(c.sub(h.square().add(r.epsilon)).sqrt()));l.assign(c),d.assign(h),u.assign(f);var p=s.sub(f);s.assign(p)}else{var g=l.mul(r.decay).add(a.square().mul(1-r.decay));f=u.mul(r.momentum).add(a.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),l.assign(g),u.assign(f),p=s.sub(f),s.assign(p)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Cn(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&Cn(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&Cn(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return oe(this,void 0,void 0,(function(){var t;return se(this,(function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return oe(this,void 0,void 0,(function(){var r;return se(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(r,2*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e})(Bo);Lo(jG);ft.prototype.squaredDifference=function(n){return GC(this,n)},G=mG;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ep=function(n,e){return ep=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},ep(n,e)};function xe(n,e){ep(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Yt=function(){return Yt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Yt.apply(this,arguments)};function de(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{u(r.next(c))}catch(d){s(d)}}function l(c){try{u(r.throw(c))}catch(d){s(d)}}function u(c){c.done?o(c.value):i(c.value).then(a,l)}u((r=r.apply(n,[])).next())})}function he(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function ba(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var xo=(function(){function n(e,t){if(!wo(e)||!wo(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n})();function Zc(n,e){return n instanceof ft&&n.shape.length===e}function $G(n){return Zc(n,2)}function ed(n){return Zc(n,3)}function Ti(n){return Zc(n,4)}function GG(n){return n%1!==0}function K0(n){return n%2===0}function qG(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function Q0(n){return n&&n.width&&n.height}function YG(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new xo(Math.round(t*i),Math.round(r*i))}function Ug(n){return n.reduce(function(e,t){return e.add(t)},new Ue(0,0)).div(new Ue(n.length,n.length))}function za(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function wo(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function J0(n){return wo(n)&&0<=n&&n<=1}var Ue=(function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n})(),Li=(function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(wo),o=[r.x,r.y,r.width,r.height].every(wo);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=s[0],l=s[1],u=s[2],c=s[3];n.assertIsValidBox({x:a,y:l,width:u,height:c},"Box.constructor",t),this._x=a,this._y=l,this._width=u,this._height=c}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(wo)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Ue(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Ue(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Ue(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Ue(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,o=e.height,s=Math.abs(i-o);return i<o&&(t-=s/2,i+=s),o<i&&(r-=s/2,o+=s),new n({x:t,y:r,width:i,height:o})},n.prototype.rescale=function(e){var t=Q0(e)?e.width:e,r=Q0(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=r[0],o=r[1],s=r[2],a=r[3];return new n({x:i,y:o,width:s,height:a})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.x,o=r.y,s=r.right,a=r.bottom,l=Math.max(i,0),u=Math.max(o,0),c=s-l,d=a-u,h=Math.min(c,e-l),f=Math.min(d,t-u);return new n({x:l,y:u,width:h,height:f}).floor()},n.prototype.shift=function(e,t){var r=this,i=r.width,o=r.height,s=this.x+e,a=this.y+t;return new n({x:s,y:a,width:i,height:o})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,o=1,s=1,a=r,l=i,u=this.left,c=this.top,d=this.right,h=this.bottom;return d>t&&(a=-d+t+r,d=t),h>e&&(l=-h+e+i,h=e),u<1&&(l=2-u,u=1),c<1&&(l=2-c,c=1),{dy:s,edy:l,dx:o,edx:a,y:c,ey:h,x:u,ex:d,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n})(),td=(function(n){xe(e,n);function e(t,r,i,o,s){return s===void 0&&(s=!1),n.call(this,{left:t,top:r,right:i,bottom:o},s)||this}return e})(Li),ME=(function(){function n(e,t,r,i,o){this._imageDims=new xo(o.width,o.height),this._score=e,this._classScore=t,this._className=r,this._box=new Li(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Li(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n})(),hr=(function(n){xe(e,n);function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r),o=i.score,s=i.relativeBox,a=i.imageDims;return new e(o,s,a)},e})(ME);function XG(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),i=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),o=r*i;return t?o/(n.area+e.area-o):o/Math.min(n.area,e.area)}function KG(n){var e=n.map(function(a){return a.x}),t=n.map(function(a){return a.y}),r=e.reduce(function(a,l){return l<a?l:a},1/0),i=t.reduce(function(a,l){return l<a?l:a},1/0),o=e.reduce(function(a,l){return a<l?l:a},0),s=t.reduce(function(a,l){return a<l?l:a},0);return new td(r,i,o,s)}function Va(n,e,t,r){r===void 0&&(r=!0);for(var i=e.map(function(a,l){return{score:a,boxIndex:l}}).sort(function(a,l){return a.score-l.score}).map(function(a){return a.boxIndex}),o=[],s=function(){var a=i.pop();o.push(a);for(var l=i,u=[],c=0;c<l.length;c++){var d=l[c],h=n[a],f=n[d];u.push(XG(h,f,r))}i=i.filter(function(p,g){return u[g]<=t})};i.length>0;)s();return o}function ul(n,e){return ie(function(){var t=e[0],r=e[1],i=e[2],o=Tr(ba(n.shape.slice(0,3),[1]),t),s=Tr(ba(n.shape.slice(0,3),[1]),r),a=Tr(ba(n.shape.slice(0,3),[1]),i),l=kt([o,s,a],3);return It(n,l)})}function QG(n,e){return e===void 0&&(e=!1),ie(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var o=Math.abs(r-i),s=Math.round(o*(e?.5:1)),a=r>i?2:1,l=function(f){var p=n.shape.slice();return p[a]=f,Tr(p,0)},u=l(s),c=o-u.shape[a],d=e&&c?l(c):null,h=[d,n,u].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return kt(h,a)})}function Bh(n){return 1/(1+Math.exp(-n))}var jg=(function(n){xe(e,n);function e(t,r,i,o,s){return s===void 0&&(s=!1),n.call(this,{x:t,y:r,width:i,height:o},s)||this}return e})(Li),JG=.5,ZG=.43,eq=.45,Ua=(function(){function n(e,t,r){r===void 0&&(r=new Ue(0,0));var i=t.width,o=t.height;this._imgDims=new xo(i,o),this._shift=r,this._positions=e.map(function(s){return s.mul(new Ue(i,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Ue(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Ue(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Ue(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof hr?e.box.floor():new Li(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=i.useDlibAlignment,s=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(s)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],i=e[2],o=function(d){return i.sub(d).magnitude()},s=(o(t)+o(r))/2,a=Math.floor(s/eq),l=Ug(e),u=Math.floor(Math.max(0,l.x-JG*a)),c=Math.floor(Math.max(0,l.y-ZG*a));return new jg(u,c,Math.min(a,this.imageWidth+u),Math.min(a,this.imageHeight+c))},n.prototype.alignMinBbox=function(e){var t=KG(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n})(),tq=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],Ug([t[3],t[4]])]},e})(Ua),nq=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Ug)},e})(Ua),Z0=(function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+qG(this.distance)+")":"")},n})(),ex=(function(n){xe(e,n);function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(t,r){if(Li.assertIsValidBox(t,r),!wo(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e})(Li),tu=(function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n})();(function(n){xe(e,n);function e(t,r,i,o){var s=n.call(this,t,r)||this;return s._score=i,s._classScore=o,s}return e.assertIsValidPredictedBox=function(t,r){if(ex.assertIsValidLabeledBox(t,r),!J0(t.score)||!J0(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(ex);function OE(n){return n.detection instanceof hr}function ja(n,e){var t={detection:e};return Object.assign({},n,t)}function PE(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function NE(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(i,o){n.readFile(r,function(s,a){return s?o(s):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function FE(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=NE();return Yt({Canvas:n||(function(){function s(){}return s})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function s(){}return s})(),Image:e||(function(){function s(){}return s})(),ImageData:global.ImageData||(function(){function s(){}return s})(),Video:global.HTMLVideoElement||(function(){function s(){}return s})(),createCanvasElement:t,createImageElement:r,fetch:i},o)}function LE(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function BE(){return typeof global=="object"&&typeof require=="function"&&typeof yS<"u"&&typeof process<"u"&&!!process.version}var Dt;function rq(){if(!Dt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Dt}function tp(n){Dt=n}function $g(){LE()&&tp(PE()),BE()&&tp(FE())}function iq(n){if(Dt||$g(),!Dt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?Dt.Canvas:e,r=n.Image,i=r===void 0?Dt.Image:r;Dt.Canvas=t,Dt.Image=i,Dt.createCanvasElement=n.createCanvasElement||(function(){return new t}),Dt.createImageElement=n.createImageElement||(function(){return new i}),Dt.ImageData=n.ImageData||Dt.ImageData,Dt.Video=n.Video||Dt.Video,Dt.fetch=n.fetch||Dt.fetch,Dt.readFile=n.readFile||Dt.readFile}var nn={getEnv:rq,setEnv:tp,initialize:$g,createBrowserEnv:PE,createFileSystem:NE,createNodejsEnv:FE,monkeyPatch:iq,isBrowser:LE,isNodejs:BE};$g();function HE(n){return!nn.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function Ro(n){var e=nn.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var i=HE(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var tx;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(tx||(tx={}));function WE(n){var e=nn.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function oq(n){return new Promise(function(e,t){if(n instanceof nn.getEnv().Canvas||WE(n))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}n.addEventListener("load",r),n.addEventListener("error",i)})}function zE(n){var e=nn.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new xo(n.naturalWidth,n.naturalHeight):n instanceof r?new xo(n.videoWidth,n.videoHeight):new xo(n.width,n.height)}function nd(n){var e=n.width,t=n.height,r=nn.getEnv().createCanvasElement,i=r();return i.width=e,i.height=t,i}function Gg(n,e){var t=nn.getEnv().ImageData;if(!(n instanceof t)&&!WE(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=zE(n),i=r.width,o=r.height,s=nd({width:i,height:o});return n instanceof t?Ro(s).putImageData(n,0,0):Ro(s).drawImage(n,0,0,i,o),s}function sq(n,e){return de(this,void 0,void 0,function(){var t,r,i,o,s,a;return he(this,function(l){switch(l.label){case 0:return t=nn.getEnv().createCanvasElement(),r=n.shape.slice(Ti(n)?1:0),i=r[0],o=r[1],s=r[2],a=ie(function(){return n.as3D(i,o,s).toInt()}),[4,Vg.toPixels(a,t)];case 1:return l.sent(),a.dispose(),[2,t]}})})}function nx(n){var e=nn.getEnv(),t=e.Image,r=e.Canvas,i=e.Video;return n instanceof t||n instanceof r||n instanceof i}function aq(n,e,t){t===void 0&&(t=!1);var r=nn.getEnv(),i=r.Image,o=r.Canvas;if(!(n instanceof i||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=zE(n),a=e/Math.max(s.height,s.width),l=a*s.width,u=a*s.height,c=nd({width:e,height:e}),d=n instanceof o?n:Gg(n),h=Math.abs(l-u)/2,f=t&&l<u?h:0,p=t&&u<l?h:0;return Ro(c).drawImage(d,f,p,l,u),c}var gc=(function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(ed(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(Ti(i)){var s=i.shape[0];if(s!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var a=i instanceof nn.getEnv().Canvas?i:Gg(i);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return za(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return YG({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,ie(function(){var i=za(r.batchSize,0,1).map(function(s){var a=r.getInput(s);if(a instanceof ft){var l=Ti(a)?a:a.expandDims();return l=QG(l,t),(l.shape[1]!==e||l.shape[2]!==e)&&(l=Fg.resizeBilinear(l,[e,e])),l.as3D(e,e,3)}if(a instanceof nn.getEnv().Canvas)return Vg.fromPixels(aq(a,e,t));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),o=Vn(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,e,e,3);return o})},n})();function Bt(n){return de(this,void 0,void 0,function(){var e,t,r;return he(this,function(i){switch(i.label){case 0:if(n instanceof gc)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(n)?" at input index "+o+":":""},r=e.map(HE),r.forEach(function(o,s){if(!nx(o)&&!ed(o)&&!Ti(o))throw typeof e[s]=="string"?new Error("toNetInput -"+t(s)+" string passed, but could not resolve HTMLElement for element id "+e[s]):new Error("toNetInput -"+t(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Ti(o)){var a=o.shape[0];if(a!==1)throw new Error("toNetInput -"+t(s)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return nx(o)&&oq(o)}))];case 1:return i.sent(),[2,new gc(r,Array.isArray(n))]}})})}function qg(n,e){return de(this,void 0,void 0,function(){var t,r,i,o,s,a,l;return he(this,function(u){switch(u.label){case 0:return t=nn.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,Bt(n)];case 1:if(i=u.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof t?(s=o,[3,4]):[3,2];case 2:return[4,sq(o)];case 3:s=u.sent(),u.label=4;case 4:r=s,u.label=5;case 5:return a=Ro(r),l=e.map(function(c){return c instanceof hr?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,l.map(function(c){var d=c.x,h=c.y,f=c.width,p=c.height,g=nd({width:f,height:p});return Ro(g).putImageData(a.getImageData(d,h,f,p),0,0),g})]}})})}function Yg(n,e){return de(this,void 0,void 0,function(){return he(this,function(t){if(!ed(n)&&!Ti(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Ti(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ie(function(){var r=n.shape.slice(Ti(n)?1:0),i=r[0],o=r[1],s=r[2],a=e.map(function(u){return u instanceof hr?u.forSize(o,i).box:u}).map(function(u){return u.clipAtImageBorders(o,i)}),l=a.map(function(u){var c=u.x,d=u.y,h=u.width,f=u.height;return fE(n.as3D(i,o,s),[d,c,0],[f,h,s])});return l})]})})}function lq(n,e){return de(this,void 0,void 0,function(){var t,r;return he(this,function(i){switch(i.label){case 0:return t=nn.getEnv().fetch,[4,t(n,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function uq(n){return de(this,void 0,void 0,function(){return he(this,function(e){switch(e.label){case 0:return[4,lq(n)];case 1:return[2,e.sent().json()]}})})}function VE(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var i=n.split("/").filter(function(a){return a}),o=n.endsWith(".json")?i[i.length-1]:t,s=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return s=n.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:s==="/"?"/"+o:s+"/"+o}}function cq(n,e){return de(this,void 0,void 0,function(){var t,r,i,o;return he(this,function(s){switch(s.label){case 0:return t=VE(n,e),r=t.manifestUri,i=t.modelBaseUri,[4,uq(r)];case 1:return o=s.sent(),[2,TE.loadWeights(o,i)]}})})}var si=(function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,i=t.objProp;return r[i]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Rs})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Rs)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;e.reassignParamFromPath(r,i.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,o=Ut(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return de(this,void 0,void 0,function(){return he(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return de(this,void 0,void 0,function(){var t;return he(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,cq(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return de(this,void 0,void 0,function(){var t,r,i,o,s,a,l,u,c,d;return he(this,function(h){switch(h.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=nn.getEnv().readFile,r=VE(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,s=function(f){return Promise.all(f.map(function(p){return t(p).then(function(g){return g.buffer})}))},a=TE.weightsLoaderFactory(s),c=(u=JSON).parse,[4,t(i)];case 1:return l=c.apply(u,[h.sent().toString()]),[4,a(l,o)];case 2:return d=h.sent(),this.loadFromWeightMap(d),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,s){if(!o.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+e);return{obj:o.nextObj,objProp:s,nextObj:o.nextObj[s]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof ft))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n})();function Hn(n,e,t){return ie(function(){var r=Ig(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=Ie(r,e.bias),r})}function Hh(n,e,t){return t===void 0&&(t=!1),ie(function(){var r=pt(t?Ie(Kn(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):Hn(n,e.conv0,[2,2])),i=Hn(r,e.conv1,[1,1]),o=pt(Ie(r,i)),s=Hn(o,e.conv2,[1,1]);return pt(Ie(r,Ie(i,s)))})}function nu(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),ie(function(){var i=pt(t?Ie(Kn(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Hn(n,e.conv0,r?[2,2]:[1,1])),o=Hn(i,e.conv1,[1,1]),s=pt(Ie(i,o)),a=Hn(s,e.conv2,[1,1]),l=pt(Ie(i,Ie(o,a))),u=Hn(l,e.conv3,[1,1]);return pt(Ie(i,Ie(o,Ie(a,u))))})}function sr(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),ie(function(){var i=Ie(Kn(n,e.filters,[1,1],t),e.bias);return r?pt(i):i})}function ai(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function rd(n,e){return function(t,r,i,o){var s=vn(n(t*r*i*i),[i,i,t,r]),a=Et(n(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:s,bias:a}}}function Xg(n,e){return function(t,r,i){var o=ki(n(t*r),[t,r]),s=Et(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:s}}}var UE=(function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n})();function Kg(n,e){return function(t,r,i){var o=vn(n(9*t),[3,3,t,1]),s=vn(n(t*r),[1,1,t,r]),a=Et(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new UE(o,s,a)}}function Qg(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new UE(t,r,i)}}function ji(n,e){return function(t,r,i){var o=n[t];if(!Zc(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function li(n){var e=n;function t(i){var o=e.slice(0,i);return e=e.slice(i),o}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function jE(n,e){var t=rd(n,e),r=Kg(n,e);function i(s,a,l,u){u===void 0&&(u=!1);var c=u?t(s,a,3,l+"/conv0"):r(s,a,l+"/conv0"),d=r(a,a,l+"/conv1"),h=r(a,a,l+"/conv2");return{conv0:c,conv1:d,conv2:h}}function o(s,a,l,u){u===void 0&&(u=!1);var c=i(s,a,l,u),d=c.conv0,h=c.conv1,f=c.conv2,p=r(a,a,l+"/conv3");return{conv0:d,conv1:h,conv2:f,conv3:p}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function dq(n){var e=[],t=li(n),r=t.extractWeights,i=t.getRemainingWeights,o=jE(r,e).extractDenseBlock4Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),l=o(64,128,"dense2"),u=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:l,dense3:u}}}function $E(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function GE(n,e){var t=ji(n,e),r=$E(t),i=Qg(t);function o(a,l){l===void 0&&(l=!1);var u=l?r(a+"/conv0"):i(a+"/conv0"),c=i(a+"/conv1"),d=i(a+"/conv2");return{conv0:u,conv1:c,conv2:d}}function s(a,l){l===void 0&&(l=!1);var u=l?r(a+"/conv0"):i(a+"/conv0"),c=i(a+"/conv1"),d=i(a+"/conv2"),h=i(a+"/conv3");return{conv0:u,conv1:c,conv2:d,conv3:h}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:s}}function hq(n){var e=[],t=GE(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return ai(n,e),{params:r,paramMappings:e}}var qE=(function(n){xe(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ie(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=ul(i,o).div(te(255)),a=nu(s,r.dense0,!0);return a=nu(a,r.dense1),a=nu(a,r.dense2),a=nu(a,r.dense3),a=al(a,[7,7],[2,2],"valid"),a})},e.prototype.forward=function(t){return de(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return hq(t)},e.prototype.extractParams=function(t){return dq(t)},e})(si);function Sr(n,e){return ie(function(){return Ie(Kc(n,e.weights),e.bias)})}function fq(n,e,t){var r=[],i=li(n),o=i.extractWeights,s=i.getRemainingWeights,a=Xg(o,r),l=a(e,t,"fc");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:l}}}function pq(n){var e=[],t=ji(n,e);function r(o){var s=t(o+"/weights",2),a=t(o+"/bias",1);return{weights:s,bias:a}}var i={fc:r("fc")};return ai(n,e),{params:i,paramMappings:e}}function YE(n){var e={},t={};return Object.keys(n).forEach(function(r){var i=r.startsWith("fc")?t:e;i[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var XE=(function(n){xe(e,n);function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ie(function(){var o=t instanceof gc?r.faceFeatureExtractor.forwardInput(t):t;return Sr(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return fq(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=YE(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),pq(o)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,s=t.slice(0,t.length-o),a=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},e})(si),rx=["neutral","happy","sad","angry","fearful","disgusted","surprised"],gq=(function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);rx.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return rx.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n})(),mq=(function(n){xe(e,n);function e(t){return t===void 0&&(t=new qE),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return ie(function(){return ii(r.runNet(t))})},e.prototype.forward=function(t){return de(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return de(this,void 0,void 0,function(){var r,i,o,s,a=this;return he(this,function(l){switch(l.label){case 0:return[4,Bt(t)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return i=l.sent(),[4,Promise.all(Rt(i).map(function(u){return de(a,void 0,void 0,function(){var c;return he(this,function(d){switch(d.label){case 0:return[4,u.data()];case 1:return c=d.sent(),u.dispose(),[2,c]}})})}))];case 3:return o=l.sent(),i.dispose(),s=o.map(function(u){return new gq(u)}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e})(XE);function KE(n,e){var t={expressions:e};return Object.assign({},n,t)}function QE(n){return OE(n)&&n.landmarks instanceof Ua&&n.unshiftedLandmarks instanceof Ua&&n.alignedRect instanceof hr}function id(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),o=n.detection.imageDims,s=new hr(n.detection.score,i.rescale(o.reverse()),o),a={landmarks:r,unshiftedLandmarks:e,alignedRect:s};return Object.assign({},n,a)}function vq(n,e){var t=rd(n,e),r=Kg(n,e);function i(s,a,l){var u=r(s,a,l+"/separable_conv0"),c=r(a,a,l+"/separable_conv1"),d=t(s,a,1,l+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:d}}function o(s,a){var l=r(s,s,a+"/separable_conv0"),u=r(s,s,a+"/separable_conv1"),c=r(s,s,a+"/separable_conv2");return{separable_conv0:l,separable_conv1:u,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function yq(n,e){var t=[],r=li(n),i=r.extractWeights,o=r.getRemainingWeights,s=vq(i,t),a=s.extractConvParams,l=s.extractSeparableConvParams,u=s.extractReductionBlockParams,c=s.extractMainBlockParams,d=a(3,32,3,"entry_flow/conv_in"),h=u(32,64,"entry_flow/reduction_block_0"),f=u(64,128,"entry_flow/reduction_block_1"),p={conv_in:d,reduction_block_0:h,reduction_block_1:f},g={};za(e,0,1).forEach(function(b){g["main_block_"+b]=c(128,"middle_flow/main_block_"+b)});var m=u(128,256,"exit_flow/reduction_block"),v=l(256,512,"exit_flow/separable_conv"),y={reduction_block:m,separable_conv:v};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:g,exit_flow:y}}}function bq(n,e){var t=ji(n,e),r=$E(t),i=Qg(t);function o(a){var l=i(a+"/separable_conv0"),u=i(a+"/separable_conv1"),c=r(a+"/expansion_conv");return{separable_conv0:l,separable_conv1:u,expansion_conv:c}}function s(a){var l=i(a+"/separable_conv0"),u=i(a+"/separable_conv1"),c=i(a+"/separable_conv2");return{separable_conv0:l,separable_conv1:u,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:s}}function xq(n,e){var t=[],r=bq(n,t),i=r.extractConvParams,o=r.extractSeparableConvParams,s=r.extractReductionBlockParams,a=r.extractMainBlockParams,l=i("entry_flow/conv_in"),u=s("entry_flow/reduction_block_0"),c=s("entry_flow/reduction_block_1"),d={conv_in:l,reduction_block_0:u,reduction_block_1:c},h={};za(e,0,1).forEach(function(m){h["main_block_"+m]=a("middle_flow/main_block_"+m)});var f=s("exit_flow/reduction_block"),p=o("exit_flow/separable_conv"),g={reduction_block:f,separable_conv:p};return ai(n,t),{params:{entry_flow:d,middle_flow:h,exit_flow:g},paramMappings:t}}function JE(n,e,t){return Ie(Kn(n,e.filters,t,"same"),e.bias)}function Wh(n,e,t){t===void 0&&(t=!0);var r=t?pt(n):n;return r=Hn(r,e.separable_conv0,[1,1]),r=Hn(pt(r),e.separable_conv1,[1,1]),r=Pt(r,[3,3],[2,2],"same"),r=Ie(r,JE(n,e.expansion_conv,[2,2])),r}function wq(n,e){var t=Hn(pt(n),e.separable_conv0,[1,1]);return t=Hn(pt(t),e.separable_conv1,[1,1]),t=Hn(pt(t),e.separable_conv2,[1,1]),t=Ie(t,n),t}var _q=(function(n){xe(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return ie(function(){var o=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],a=ul(o,s).div(te(256)),l=pt(JE(a,i.entry_flow.conv_in,[2,2]));return l=Wh(l,i.entry_flow.reduction_block_0,!1),l=Wh(l,i.entry_flow.reduction_block_1),za(r._numMainBlocks,0,1).forEach(function(u){l=wq(l,i.middle_flow["main_block_"+u])}),l=Wh(l,i.exit_flow.reduction_block),l=pt(Hn(l,i.exit_flow.separable_conv,[1,1])),l})},e.prototype.forward=function(t){return de(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return xq(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return yq(t,this._numMainBlocks)},e})(si);function Cq(n){var e=[],t=li(n),r=t.extractWeights,i=t.getRemainingWeights,o=Xg(r,e),s=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:s,gender:a}}}}function Eq(n){var e=[],t=ji(n,e);function r(o){var s=t(o+"/weights",2),a=t(o+"/bias",1);return{weights:s,bias:a}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return ai(n,e),{params:i,paramMappings:e}}var mc;(function(n){n.FEMALE="female",n.MALE="male"})(mc||(mc={}));var Sq=(function(n){xe(e,n);function e(t){t===void 0&&(t=new _q(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ie(function(){var o=t instanceof gc?r.faceFeatureExtractor.forwardInput(t):t,s=al(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),a=Sr(s,i.fc.age).as1D(),l=Sr(s,i.fc.gender);return{age:a,gender:l}})},e.prototype.forwardInput=function(t){var r=this;return ie(function(){var i=r.runNet(t),o=i.age,s=i.gender;return{age:o,gender:ii(s)}})},e.prototype.forward=function(t){return de(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return de(this,void 0,void 0,function(){var r,i,o,s,a,l,u=this;return he(this,function(c){switch(c.label){case 0:return[4,Bt(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),o=Rt(i.age),s=Rt(i.gender),a=o.map(function(d,h){return{ageTensor:d,genderTensor:s[h]}}),[4,Promise.all(a.map(function(d){var h=d.ageTensor,f=d.genderTensor;return de(u,void 0,void 0,function(){var p,g,m,v,y;return he(this,function(b){switch(b.label){case 0:return[4,h.data()];case 1:return p=b.sent()[0],[4,f.data()];case 2:return g=b.sent()[0],m=g>.5,v=m?mc.MALE:mc.FEMALE,y=m?g:1-g,h.dispose(),f.dispose(),[2,{age:p,gender:v,genderProbability:y}]}})})}))];case 3:return l=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?l:l[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return Cq(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=YE(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),Eq(o)},e.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e})(si),ZE=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,i){var o=i.map(function(a){var l=a.width,u=a.height,c=r/Math.max(u,l);return{width:l*c,height:u*c}}),s=o.length;return ie(function(){var a=function(h,f){return Vn([Tr([68],h),Tr([68],f)],1).as2D(1,136).as1D()},l=function(h,f){var p=o[h],g=p.width,m=p.height;return f(g,m)?Math.abs(g-m)/2:0},u=function(h){return l(h,function(f,p){return f<p})},c=function(h){return l(h,function(f,p){return p<f})},d=t.mul(Tr([s,136],r)).sub(Vn(Array.from(Array(s),function(h,f){return a(u(f),c(f))}))).div(Vn(Array.from(Array(s),function(h,f){return a(o[f].width,o[f].height)})));return d})},e.prototype.forwardInput=function(t){var r=this;return ie(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){var s=o[0],a=o[1];return{height:s,width:a}}))})},e.prototype.forward=function(t){return de(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return de(this,void 0,void 0,function(){var r,i,o,s=this;return he(this,function(a){switch(a.label){case 0:return[4,Bt(t)];case 1:return r=a.sent(),i=ie(function(){return Rt(s.forwardInput(r))}),[4,Promise.all(i.map(function(l,u){return de(s,void 0,void 0,function(){var c,d,h,f,p;return he(this,function(g){switch(g.label){case 0:return h=(d=Array).from,[4,l.data()];case 1:return c=h.apply(d,[g.sent()]),f=c.filter(function(m,v){return K0(v)}),p=c.filter(function(m,v){return!K0(v)}),[2,new nq(Array(68).fill(0).map(function(m,v){return new Ue(f[v],p[v])}),{height:r.getInputHeight(u),width:r.getInputWidth(u)})]}})})}))];case 2:return o=a.sent(),i.forEach(function(l){return l.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e})(XE),eS=(function(n){xe(e,n);function e(t){return t===void 0&&(t=new qE),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e})(ZE);function Dq(n){var e=[],t=GE(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return ai(n,e),{params:r,paramMappings:e}}function Aq(n){var e=[],t=li(n),r=t.extractWeights,i=t.getRemainingWeights,o=jE(r,e).extractDenseBlock3Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),l=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:l}}}var kq=(function(n){xe(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ie(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=ul(i,o).div(te(255)),a=Hh(s,r.dense0,!0);return a=Hh(a,r.dense1),a=Hh(a,r.dense2),a=al(a,[14,14],[2,2],"valid"),a})},e.prototype.forward=function(t){return de(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Dq(t)},e.prototype.extractParams=function(t){return Aq(t)},e})(si),Rq=(function(n){xe(e,n);function e(t){return t===void 0&&(t=new kq),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e})(ZE);(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(eS);function Tq(n,e){return Ie(en(n,e.weights),e.biases)}function Jg(n,e,t,r,i){i===void 0&&(i="same");var o=e.conv,s=o.filters,a=o.bias,l=Kn(n,s,t,i);return l=Ie(l,a),l=Tq(l,e.scale),r?pt(l):l}function Iq(n,e){return Jg(n,e,[1,1],!0)}function tS(n,e){return Jg(n,e,[1,1],!1)}function nS(n,e){return Jg(n,e,[2,2],!0,"valid")}function Mq(n,e){function t(a,l,u){var c=n(a),d=c.length/(l*u*u);if(GG(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+c.length+", numFilters: "+l+", filterSize: "+u);return ie(function(){return Fi(vn(c,[l,d,u,u]),[2,3,1,0])})}function r(a,l,u,c){var d=t(a,l,u),h=Et(n(l));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:d,bias:h}}function i(a,l){var u=Et(n(a)),c=Et(n(a));return e.push({paramPath:l+"/weights"},{paramPath:l+"/biases"}),{weights:u,biases:c}}function o(a,l,u,c){var d=r(a,l,u,c+"/conv"),h=i(l,c+"/scale");return{conv:d,scale:h}}function s(a,l,u,c,d){d===void 0&&(d=!1);var h=o((d?.5:1)*a,l,u,c+"/conv1"),f=o(a,l,u,c+"/conv2");return{conv1:h,conv2:f}}return{extractConvLayerParams:o,extractResidualLayerParams:s}}function Oq(n){var e=li(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=Mq(t,i),s=o.extractConvLayerParams,a=o.extractResidualLayerParams,l=s(4704,32,7,"conv32_down"),u=a(9216,32,3,"conv32_1"),c=a(9216,32,3,"conv32_2"),d=a(9216,32,3,"conv32_3"),h=a(36864,64,3,"conv64_down",!0),f=a(36864,64,3,"conv64_1"),p=a(36864,64,3,"conv64_2"),g=a(36864,64,3,"conv64_3"),m=a(147456,128,3,"conv128_down",!0),v=a(147456,128,3,"conv128_1"),y=a(147456,128,3,"conv128_2"),b=a(589824,256,3,"conv256_down",!0),x=a(589824,256,3,"conv256_1"),w=a(589824,256,3,"conv256_2"),_=a(589824,256,3,"conv256_down_out"),C=ie(function(){return Fi(ki(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var E={conv32_down:l,conv32_1:u,conv32_2:c,conv32_3:d,conv64_down:h,conv64_1:f,conv64_2:p,conv64_3:g,conv128_down:m,conv128_1:v,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:w,conv256_down_out:_,fc:C};return{params:E,paramMappings:i}}function Pq(n,e){var t=ji(n,e);function r(s){var a=t(s+"/scale/weights",1),l=t(s+"/scale/biases",1);return{weights:a,biases:l}}function i(s){var a=t(s+"/conv/filters",4),l=t(s+"/conv/bias",1),u=r(s);return{conv:{filters:a,bias:l},scale:u}}function o(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function Nq(n){var e=[],t=Pq(n,e),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,o=r("conv32_down"),s=i("conv32_1"),a=i("conv32_2"),l=i("conv32_3"),u=i("conv64_down"),c=i("conv64_1"),d=i("conv64_2"),h=i("conv64_3"),f=i("conv128_down"),p=i("conv128_1"),g=i("conv128_2"),m=i("conv256_down"),v=i("conv256_1"),y=i("conv256_2"),b=i("conv256_down_out"),x=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!$G(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:o,conv32_1:s,conv32_2:a,conv32_3:l,conv64_down:u,conv64_1:c,conv64_2:d,conv64_3:h,conv128_down:f,conv128_1:p,conv128_2:g,conv256_down:m,conv256_1:v,conv256_2:y,conv256_down_out:b,fc:x};return ai(n,e),{params:w,paramMappings:e}}function vr(n,e){var t=Iq(n,e.conv1);return t=tS(t,e.conv2),t=Ie(t,n),t=pt(t),t}function ru(n,e){var t=nS(n,e.conv1);t=tS(t,e.conv2);var r=al(n,2,2,"valid"),i=et(r.shape),o=r.shape[3]!==t.shape[3],s=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(s){var a=ba(t.shape);a[1]=1;var l=et(a);t=kt([t,l],1);var u=ba(t.shape);u[2]=1;var c=et(u);t=kt([t,c],2)}return r=o?kt([r,i],3):r,t=Ie(r,t),t=pt(t),t}var Fq=(function(n){xe(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ie(function(){var i=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],s=ul(i,o).div(te(256)),a=nS(s,r.conv32_down);a=Pt(a,3,2,"valid"),a=vr(a,r.conv32_1),a=vr(a,r.conv32_2),a=vr(a,r.conv32_3),a=ru(a,r.conv64_down),a=vr(a,r.conv64_1),a=vr(a,r.conv64_2),a=vr(a,r.conv64_3),a=ru(a,r.conv128_down),a=vr(a,r.conv128_1),a=vr(a,r.conv128_2),a=ru(a,r.conv256_down),a=vr(a,r.conv256_1),a=vr(a,r.conv256_2),a=ru(a,r.conv256_down_out);var l=a.mean([1,2]),u=Kc(l,r.fc);return u})},e.prototype.forward=function(t){return de(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return de(this,void 0,void 0,function(){var r,i,o,s=this;return he(this,function(a){switch(a.label){case 0:return[4,Bt(t)];case 1:return r=a.sent(),i=ie(function(){return Rt(s.forwardInput(r))}),[4,Promise.all(i.map(function(l){return l.data()}))];case 2:return o=a.sent(),i.forEach(function(l){return l.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Nq(t)},e.prototype.extractParams=function(t){return Oq(t)},e})(si);function rS(n,e){var t={descriptor:e};return Object.assign({},n,t)}function iS(n,e){var t={age:e};return Object.assign({},n,t)}function oS(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var sS=(function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,s=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=a,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(l){return typeof l!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(l){return typeof l!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n})();function Lq(n,e){function t(l,u){var c=vn(n(9*l),[3,3,l,1]),d=Et(n(l)),h=Et(n(l)),f=Et(n(l)),p=Et(n(l));return e.push({paramPath:u+"/filters"},{paramPath:u+"/batch_norm_scale"},{paramPath:u+"/batch_norm_offset"},{paramPath:u+"/batch_norm_mean"},{paramPath:u+"/batch_norm_variance"}),{filters:c,batch_norm_scale:d,batch_norm_offset:h,batch_norm_mean:f,batch_norm_variance:p}}function r(l,u,c,d,h){var f=vn(n(l*u*c*c),[c,c,l,u]),p=Et(n(u));return e.push({paramPath:d+"/filters"},{paramPath:d+"/"+(h?"batch_norm_offset":"bias")}),{filters:f,bias:p}}function i(l,u,c,d){var h=r(l,u,c,d,!0),f=h.filters,p=h.bias;return{filters:f,batch_norm_offset:p}}function o(l,u,c){var d=t(l,c+"/depthwise_conv"),h=i(l,u,1,c+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:h}}function s(){var l=i(3,32,3,"mobilenetv1/conv_0"),u=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),d=o(128,128,"mobilenetv1/conv_3"),h=o(128,256,"mobilenetv1/conv_4"),f=o(256,256,"mobilenetv1/conv_5"),p=o(256,512,"mobilenetv1/conv_6"),g=o(512,512,"mobilenetv1/conv_7"),m=o(512,512,"mobilenetv1/conv_8"),v=o(512,512,"mobilenetv1/conv_9"),y=o(512,512,"mobilenetv1/conv_10"),b=o(512,512,"mobilenetv1/conv_11"),x=o(512,1024,"mobilenetv1/conv_12"),w=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:l,conv_1:u,conv_2:c,conv_3:d,conv_4:h,conv_5:f,conv_6:p,conv_7:g,conv_8:m,conv_9:v,conv_10:y,conv_11:b,conv_12:x,conv_13:w}}function a(){var l=i(1024,256,1,"prediction_layer/conv_0"),u=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),d=i(128,256,3,"prediction_layer/conv_3"),h=i(256,128,1,"prediction_layer/conv_4"),f=i(128,256,3,"prediction_layer/conv_5"),p=i(256,64,1,"prediction_layer/conv_6"),g=i(64,128,3,"prediction_layer/conv_7"),m=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),y=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),b=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),x=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),w=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),C=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),D=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),k=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),M={box_encoding_predictor:m,class_predictor:v},B={box_encoding_predictor:y,class_predictor:b},H={box_encoding_predictor:x,class_predictor:w},F={box_encoding_predictor:_,class_predictor:C},W={box_encoding_predictor:E,class_predictor:S},j={box_encoding_predictor:D,class_predictor:k};return{conv_0:l,conv_1:u,conv_2:c,conv_3:d,conv_4:h,conv_5:f,conv_6:p,conv_7:g,box_predictor_0:M,box_predictor_1:B,box_predictor_2:H,box_predictor_3:F,box_predictor_4:W,box_predictor_5:j}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:a}}function Bq(n){var e=[],t=li(n),r=t.extractWeights,i=t.getRemainingWeights,o=Lq(r,e),s=o.extractMobilenetV1Params,a=o.extractPredictionLayerParams,l=s(),u=a(),c=mg(r(5118*4),[1,5118,4]),d={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:l,prediction_layer:u,output_layer:d},paramMappings:e}}function Hq(n,e){var t=ji(n,e);function r(u,c,d){var h=t(u+"/Conv2d_"+c+"_pointwise/weights",4,d+"/filters"),f=t(u+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:h,batch_norm_offset:f}}function i(u){var c="mobilenetv1/conv_"+u,d="MobilenetV1/Conv2d_"+u+"_depthwise",h=c+"/depthwise_conv",f=c+"/pointwise_conv",p=t(d+"/depthwise_weights",4,h+"/filters"),g=t(d+"/BatchNorm/gamma",1,h+"/batch_norm_scale"),m=t(d+"/BatchNorm/beta",1,h+"/batch_norm_offset"),v=t(d+"/BatchNorm/moving_mean",1,h+"/batch_norm_mean"),y=t(d+"/BatchNorm/moving_variance",1,h+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:g,batch_norm_offset:m,batch_norm_mean:v,batch_norm_variance:y},pointwise_conv:r("MobilenetV1",u,f)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function s(u,c){var d=t(u+"/weights",4,c+"/filters"),h=t(u+"/biases",1,c+"/bias");return{filters:d,bias:h}}function a(u){var c=s("Prediction/BoxPredictor_"+u+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+u+"/box_encoding_predictor"),d=s("Prediction/BoxPredictor_"+u+"/ClassPredictor","prediction_layer/box_predictor_"+u+"/class_predictor");return{box_encoding_predictor:c,class_predictor:d}}function l(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:l}}function Wq(n){var e=[],t=Hq(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!ed(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return ai(n,e),{params:s,paramMappings:e}}function xr(n,e,t){return ie(function(){var r=Kn(n,e.filters,t,"same");return r=Ie(r,e.batch_norm_offset),Ag(r,0,6)})}var zq=.0010000000474974513;function Vq(n,e,t){return ie(function(){var r=Xc(n,e.filters,t,"same");return r=JC(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,zq),Ag(r,0,6)})}function Uq(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function jq(n,e){return ie(function(){var t=null,r=xr(n,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,s){var a=s+1,l=Uq(a);r=Vq(r,o.depthwise_conv,l),r=xr(r,o.pointwise_conv,[1,1]),a===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function $q(n,e,t,r,i){var o=n.shape[0],s=Math.min(t,o),a=e.map(function(c,d){return{score:c,boxIndex:d}}).filter(function(c){return c.score>i}).sort(function(c,d){return d.score-c.score}),l=function(c){return c<=r?1:0},u=[];return a.forEach(function(c){if(!(u.length>=s)){for(var d=c.score,h=u.length-1;h>=0;--h){var f=Gq(n,c.boxIndex,u[h]);if(f!==0&&(c.score*=l(f),c.score<=i))break}d===c.score&&u.push(c.boxIndex)}}),u}function Gq(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),s=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),l=Math.min(r[t][0],r[t][2]),u=Math.min(r[t][1],r[t][3]),c=Math.max(r[t][0],r[t][2]),d=Math.max(r[t][1],r[t][3]),h=(s-i)*(a-o),f=(c-l)*(d-u);if(h<=0||f<=0)return 0;var p=Math.max(i,l),g=Math.max(o,u),m=Math.min(s,c),v=Math.min(a,d),y=Math.max(m-p,0)*Math.max(v-g,0);return y/(h+f-y)}function qq(n){var e=Rt(Fi(n,[1,0])),t=[It(e[2],e[0]),It(e[3],e[1])],r=[Ie(e[0],nr(t[0],te(2))),Ie(e[1],nr(t[1],te(2)))];return{sizes:t,centers:r}}function Yq(n,e){var t=qq(n),r=t.sizes,i=t.centers,o=Rt(Fi(e,[1,0])),s=nr(en(Yf(nr(o[2],te(5))),r[0]),te(2)),a=Ie(en(nr(o[0],te(10)),r[0]),i[0]),l=nr(en(Yf(nr(o[3],te(5))),r[1]),te(2)),u=Ie(en(nr(o[1],te(10)),r[1]),i[1]);return Fi(Vn([It(a,s),It(u,l),Ie(a,s),Ie(u,l)]),[1,0])}function Xq(n,e,t){return ie(function(){var r=n.shape[0],i=Yq(or(ps(t.extra_dim,[r,1,1]),[-1,4]),or(n,[-1,4]));i=or(i,[r,i.shape[0]/r,4]);var o=YC(Or(e,[0,0,1],[-1,-1,-1])),s=Or(o,[0,0,0],[-1,-1,1]);s=or(s,[r,s.shape[1]]);var a=Rt(i),l=Rt(s);return{boxes:a,scores:l}})}function Xo(n,e){return ie(function(){var t=n.shape[0],r=or(sr(n,e.box_encoding_predictor),[t,-1,1,4]),i=or(sr(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function Kq(n,e,t){return ie(function(){var r=xr(n,t.conv_0,[1,1]),i=xr(r,t.conv_1,[2,2]),o=xr(i,t.conv_2,[1,1]),s=xr(o,t.conv_3,[2,2]),a=xr(s,t.conv_4,[1,1]),l=xr(a,t.conv_5,[2,2]),u=xr(l,t.conv_6,[1,1]),c=xr(u,t.conv_7,[2,2]),d=Xo(e,t.box_predictor_0),h=Xo(n,t.box_predictor_1),f=Xo(i,t.box_predictor_2),p=Xo(s,t.box_predictor_3),g=Xo(l,t.box_predictor_4),m=Xo(c,t.box_predictor_5),v=kt([d.boxPredictionEncoding,h.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,m.boxPredictionEncoding],1),y=kt([d.classPrediction,h.classPrediction,f.classPrediction,p.classPrediction,g.classPrediction,m.classPrediction],1);return{boxPredictions:v,classPredictions:y}})}var od=(function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n})(),aS=(function(n){xe(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ie(function(){var i=t.toBatchTensor(512,!1).toFloat(),o=It(en(i,te(.007843137718737125)),te(1)),s=jq(o,r.mobilenetv1),a=Kq(s.out,s.conv11,r.prediction_layer),l=a.boxPredictions,u=a.classPredictions;return Xq(l,u,r.output_layer)})},e.prototype.forward=function(t){return de(this,void 0,void 0,function(){var r;return he(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),de(this,void 0,void 0,function(){var i,o,s,a,l,u,c,d,h,f,p,g,m,v,y,b,x,w,_,C,E;return he(this,function(S){switch(S.label){case 0:return i=new od(r),o=i.maxResults,s=i.minConfidence,[4,Bt(t)];case 1:for(a=S.sent(),l=this.forwardInput(a),u=l.boxes,c=l.scores,d=u[0],h=c[0],f=1;f<u.length;f++)u[f].dispose(),c[f].dispose();return m=(g=Array).from,[4,h.data()];case 2:return p=m.apply(g,[S.sent()]),v=.5,y=$q(d,p,o,v,s),b=a.getReshapedInputDimensions(0),x=a.inputSize,w=x/b.width,_=x/b.height,C=d.arraySync(),E=y.map(function(D){var k=[Math.max(0,C[D][0]),Math.min(1,C[D][2])].map(function(j){return j*_}),M=k[0],B=k[1],H=[Math.max(0,C[D][1]),Math.min(1,C[D][3])].map(function(j){return j*w}),F=H[0],W=H[1];return new hr(p[D],new jg(F,M,W-F,B-M),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),d.dispose(),h.dispose(),[2,E]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Wq(t)},e.prototype.extractParams=function(t){return Bq(t)},e})(si);(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(aS);var Qq=.4,Jq=[new Ue(.738768,.874946),new Ue(2.42204,2.65704),new Ue(4.30971,7.04493),new Ue(10.246,4.59428),new Ue(12.6868,11.8741)],Zq=[new Ue(1.603231,2.094468),new Ue(6.041143,7.080126),new Ue(2.882459,3.518061),new Ue(4.266906,5.178857),new Ue(9.041765,10.66308)],e6=[117.001,114.697,97.404],t6="tiny_yolov2_model",n6="tiny_yolov2_separable_conv_model",iu=function(n){return typeof n=="number"};function r6(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!iu(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return iu(e.x)&&iu(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(iu)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function Zg(n){return ie(function(){var e=en(n,te(.10000000149011612));return Ie(pt(It(n,e)),e)})}function fi(n,e){return ie(function(){var t=No(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Kn(t,e.conv.filters,[1,1],"valid"),t=It(t,e.bn.sub),t=en(t,e.bn.truediv),t=Ie(t,e.conv.bias),Zg(t)})}function pi(n,e){return ie(function(){var t=No(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Ig(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=Ie(t,e.bias),Zg(t)})}function i6(n,e){var t=rd(n,e);function r(s,a){var l=Et(n(s)),u=Et(n(s));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:l,truediv:u}}function i(s,a,l){var u=t(s,a,3,l+"/conv"),c=r(a,l+"/bn");return{conv:u,bn:c}}var o=Kg(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function o6(n,e,t,r){var i=li(n),o=i.extractWeights,s=i.getRemainingWeights,a=[],l=i6(o,a),u=l.extractConvParams,c=l.extractConvWithBatchNormParams,d=l.extractSeparableConvParams,h;if(e.withSeparableConvs){var f=r[0],p=r[1],g=r[2],m=r[3],v=r[4],y=r[5],b=r[6],x=r[7],w=r[8],_=e.isFirstLayerConv2d?u(f,p,3,"conv0"):d(f,p,"conv0"),C=d(p,g,"conv1"),E=d(g,m,"conv2"),S=d(m,v,"conv3"),D=d(v,y,"conv4"),k=d(y,b,"conv5"),M=x?d(b,x,"conv6"):void 0,B=w?d(x,w,"conv7"):void 0,H=u(w||x||b,5*t,1,"conv8");h={conv0:_,conv1:C,conv2:E,conv3:S,conv4:D,conv5:k,conv6:M,conv7:B,conv8:H}}else{var f=r[0],p=r[1],g=r[2],m=r[3],v=r[4],y=r[5],b=r[6],x=r[7],w=r[8],_=c(f,p,"conv0"),C=c(p,g,"conv1"),E=c(g,m,"conv2"),S=c(m,v,"conv3"),D=c(v,y,"conv4"),k=c(y,b,"conv5"),M=c(b,x,"conv6"),B=c(x,w,"conv7"),H=u(w,5*t,1,"conv8");h={conv0:_,conv1:C,conv2:E,conv3:S,conv4:D,conv5:k,conv6:M,conv7:B,conv8:H}}if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:h,paramMappings:a}}function s6(n,e){var t=ji(n,e);function r(a){var l=t(a+"/sub",1),u=t(a+"/truediv",1);return{sub:l,truediv:u}}function i(a){var l=t(a+"/filters",4),u=t(a+"/bias",1);return{filters:l,bias:u}}function o(a){var l=i(a+"/conv"),u=r(a+"/bn");return{conv:l,bn:u}}var s=Qg(t);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:s}}function a6(n,e){var t=[],r=s6(n,t),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams,a;if(e.withSeparableConvs){var l=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:l>7?s("conv6"):void 0,conv7:l>8?s("conv7"):void 0,conv8:i("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return ai(n,t),{params:a,paramMappings:t}}var ix;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(ix||(ix={}));var em=(function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n})(),lS=(function(n){xe(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return r6(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=fi(t,r.conv0);return i=Pt(i,[2,2],[2,2],"same"),i=fi(i,r.conv1),i=Pt(i,[2,2],[2,2],"same"),i=fi(i,r.conv2),i=Pt(i,[2,2],[2,2],"same"),i=fi(i,r.conv3),i=Pt(i,[2,2],[2,2],"same"),i=fi(i,r.conv4),i=Pt(i,[2,2],[2,2],"same"),i=fi(i,r.conv5),i=Pt(i,[2,2],[1,1],"same"),i=fi(i,r.conv6),i=fi(i,r.conv7),sr(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?Zg(sr(t,r.conv0,"valid",!1)):pi(t,r.conv0);return i=Pt(i,[2,2],[2,2],"same"),i=pi(i,r.conv1),i=Pt(i,[2,2],[2,2],"same"),i=pi(i,r.conv2),i=Pt(i,[2,2],[2,2],"same"),i=pi(i,r.conv3),i=Pt(i,[2,2],[2,2],"same"),i=pi(i,r.conv4),i=Pt(i,[2,2],[2,2],"same"),i=pi(i,r.conv5),i=Pt(i,[2,2],[1,1],"same"),i=r.conv6?pi(i,r.conv6):i,i=r.conv7?pi(i,r.conv7):i,sr(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return ie(function(){var s=t.toBatchTensor(r,!1).toFloat();return s=i.config.meanRgb?ul(s,i.config.meanRgb):s,s=s.div(te(256)),i.config.withSeparableConvs?i.runMobilenet(s,o):i.runTinyYolov2(s,o)})},e.prototype.forward=function(t,r){return de(this,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Bt(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),de(this,void 0,void 0,function(){var i,o,s,a,l,u,c,d,h,f,p,g,m,v,y=this;return he(this,function(b){switch(b.label){case 0:return i=new em(r),o=i.inputSize,s=i.scoreThreshold,[4,Bt(t)];case 1:return a=b.sent(),[4,this.forwardInput(a,o)];case 2:return l=b.sent(),u=ie(function(){return Rt(l)[0].expandDims()}),c={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(u,a.getReshapedInputDimensions(0),s)];case 3:return d=b.sent(),l.dispose(),u.dispose(),h=d.map(function(x){return x.box}),f=d.map(function(x){return x.score}),p=d.map(function(x){return x.classScore}),g=d.map(function(x){return y.config.classes[x.label]}),m=Va(h.map(function(x){return x.rescale(o)}),f,this.config.iouThreshold,!0),v=m.map(function(x){return new ME(f[x],p[x],g[x],h[x],c)}),[2,v]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return a6(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return o6(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return de(this,void 0,void 0,function(){var o,s,a,l,u,c,d,h,f,p,g,m,v,y,b,x,w,_,C,E,S,D,k,M,B,H,F,W,j,U=this;return he(this,function(q){switch(q.label){case 0:return o=r.width,s=r.height,a=Math.max(o,s),l=a/o,u=a/s,c=t.shape[1],d=this.config.anchors.length,h=ie(function(){var K=t.reshape([c,c,d,U.boxEncodingSize]),J=K.slice([0,0,0,0],[c,c,d,4]),ee=K.slice([0,0,0,4],[c,c,d,1]),re=U.withClassScores?ii(K.slice([0,0,0,5],[c,c,d,U.config.classes.length]),3):te(0);return[J,ee,re]}),f=h[0],p=h[1],g=h[2],m=[],[4,p.array()];case 1:return v=q.sent(),[4,f.array()];case 2:y=q.sent(),b=0,q.label=3;case 3:if(!(b<c))return[3,12];x=0,q.label=4;case 4:if(!(x<c))return[3,11];w=0,q.label=5;case 5:return w<d?(_=Bh(v[b][x][w][0]),!i||_>i?(C=(x+Bh(y[b][x][w][0]))/c*l,E=(b+Bh(y[b][x][w][1]))/c*u,S=Math.exp(y[b][x][w][2])*this.config.anchors[w].x/c*l,D=Math.exp(y[b][x][w][3])*this.config.anchors[w].y/c*u,k=C-S/2,M=E-D/2,B={row:b,col:x,anchor:w},this.withClassScores?[4,this.extractPredictedClass(g,B)]:[3,7]):[3,9]):[3,10];case 6:return j=q.sent(),[3,8];case 7:j={classScore:1,label:0},q.label=8;case 8:H=j,F=H.classScore,W=H.label,m.push(Yt({box:new td(k,M,k+S,M+D),score:_,classScore:_*F,label:W},B)),q.label=9;case 9:return w++,[3,5];case 10:return x++,[3,4];case 11:return b++,[3,3];case 12:return f.dispose(),p.dispose(),g.dispose(),[2,m]}})})},e.prototype.extractPredictedClass=function(t,r){return de(this,void 0,void 0,function(){var i,o,s,a;return he(this,function(l){switch(l.label){case 0:return i=r.row,o=r.col,s=r.anchor,[4,t.array()];case 1:return a=l.sent(),[2,Array(this.config.classes.length).fill(0).map(function(u,c){return a[i][o][s][c]}).map(function(u,c){return{classScore:u,label:c}}).reduce(function(u,c){return u.classScore>c.classScore?u:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e})(si),l6=(function(n){xe(e,n);function e(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:Qq,classes:["face"]},t?{anchors:Zq,meanRgb:e6}:{anchors:Jq,withClassScores:!0});return r=n.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return de(this,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(s){return new hr(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?n6:t6},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(lS),np=(function(n){xe(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e})(em),cl=(function(){function n(){}return n.prototype.then=function(e){return de(this,void 0,void 0,function(){var t;return he(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return de(this,void 0,void 0,function(){return he(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n})();function sd(n,e,t,r,i){return i===void 0&&(i=function(o){var s=o.alignedRect;return s}),de(this,void 0,void 0,function(){var o,s,a,l,u;return he(this,function(c){switch(c.label){case 0:return o=n.map(function(d){return QE(d)?i(d):d.detection}),a=r,a?[3,5]:e instanceof ft?[4,Yg(e,o)]:[3,2];case 1:return l=c.sent(),[3,4];case 2:return[4,qg(e,o)];case 3:l=c.sent(),c.label=4;case 4:a=l,c.label=5;case 5:return s=a,[4,t(s)];case 6:return u=c.sent(),s.forEach(function(d){return d instanceof ft&&d.dispose()}),[2,u]}})})}function tm(n,e,t,r,i){return de(this,void 0,void 0,function(){var o=this;return he(this,function(s){return[2,sd([n],e,function(a){return de(o,void 0,void 0,function(){return he(this,function(l){return[2,t(a[0])]})})},r,i)]})})}function u6(n){return ie(function(){return Vn(Rt(n,3).reverse(),3)})}var ou=2,vc=12;function c6(n,e){var t=rd(n,e),r=Xg(n,e);function i(u,c){var d=Et(n(u));return e.push({paramPath:c}),d}function o(u,c,d){d===void 0&&(d=!1);var h=t(u[0],u[1],3,c+"/conv1"),f=i(u[1],c+"/prelu1_alpha"),p=t(u[1],u[2],3,c+"/conv2"),g=i(u[2],c+"/prelu2_alpha"),m=t(u[2],u[3],d?2:3,c+"/conv3"),v=i(u[3],c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:p,prelu2_alpha:g,conv3:m,prelu3_alpha:v}}function s(){var u=o([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),d=t(32,4,1,"pnet/conv4_2");return Yt(Yt({},u),{conv4_1:c,conv4_2:d})}function a(){var u=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),d=i(128,"rnet/prelu4_alpha"),h=r(128,2,"rnet/fc2_1"),f=r(128,4,"rnet/fc2_2");return Yt(Yt({},u),{fc1:c,prelu4_alpha:d,fc2_1:h,fc2_2:f})}function l(){var u=o([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),d=i(128,"onet/prelu4_alpha"),h=r(1152,256,"onet/fc1"),f=i(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),m=r(256,10,"onet/fc2_3");return Yt(Yt({},u),{conv4:c,prelu4_alpha:d,fc1:h,prelu5_alpha:f,fc2_1:p,fc2_2:g,fc2_3:m})}return{extractPNetParams:s,extractRNetParams:a,extractONetParams:l}}function d6(n){var e=li(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=c6(t,i),s=o.extractPNetParams,a=o.extractRNetParams,l=o.extractONetParams,u=s(),c=a(),d=l();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:u,rnet:c,onet:d},paramMappings:i}}function h6(n,e){var t=ji(n,e);function r(c){var d=t(c+"/weights",4,c+"/filters"),h=t(c+"/bias",1);return{filters:d,bias:h}}function i(c){var d=t(c+"/weights",2),h=t(c+"/bias",1);return{weights:d,bias:h}}function o(c){return t(c,1)}function s(c){var d=r(c+"/conv1"),h=o(c+"/prelu1_alpha"),f=r(c+"/conv2"),p=o(c+"/prelu2_alpha"),g=r(c+"/conv3"),m=o(c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:h,conv2:f,prelu2_alpha:p,conv3:g,prelu3_alpha:m}}function a(){var c=s("pnet"),d=r("pnet/conv4_1"),h=r("pnet/conv4_2");return Yt(Yt({},c),{conv4_1:d,conv4_2:h})}function l(){var c=s("rnet"),d=i("rnet/fc1"),h=o("rnet/prelu4_alpha"),f=i("rnet/fc2_1"),p=i("rnet/fc2_2");return Yt(Yt({},c),{fc1:d,prelu4_alpha:h,fc2_1:f,fc2_2:p})}function u(){var c=s("onet"),d=r("onet/conv4"),h=o("onet/prelu4_alpha"),f=i("onet/fc1"),p=o("onet/prelu5_alpha"),g=i("onet/fc2_1"),m=i("onet/fc2_2"),v=i("onet/fc2_3");return Yt(Yt({},c),{conv4:d,prelu4_alpha:h,fc1:f,prelu5_alpha:p,fc2_1:g,fc2_2:m,fc2_3:v})}return{extractPNetParams:a,extractRNetParams:l,extractONetParams:u}}function f6(n){var e=[],t=h6(n,e),r=t.extractPNetParams,i=t.extractRNetParams,o=t.extractONetParams,s=r(),a=i(),l=o();return ai(n,e),{params:{pnet:s,rnet:a,onet:l},paramMappings:e}}function rp(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function p6(n,e,t){for(var r=t[0],i=t[1],o=vc/n,s=[],a=Math.min(r,i)*o,l=0;a>=12;)s.push(o*Math.pow(e,l)),a=a*e,l+=1;return s}var nm=(function(n){xe(e,n);function e(t,r,i,o){return n.call(this,{left:t,top:r,right:i,bottom:o},!0)||this}return e})(Li);function uS(n){return ie(function(){return en(It(n,te(127.5)),te(.0078125))})}function bs(n,e){return ie(function(){return Ie(pt(n),en(e,dc(pt(dc(n)))))})}function rm(n,e,t){return t===void 0&&(t=!1),ie(function(){var r=sr(n,e.conv1,"valid");return r=bs(r,e.prelu1_alpha),r=Pt(r,t?[2,2]:[3,3],[2,2],"same"),r=sr(r,e.conv2,"valid"),r=bs(r,e.prelu2_alpha),r=t?r:Pt(r,[3,3],[2,2],"valid"),r=sr(r,e.conv3,"valid"),r=bs(r,e.prelu3_alpha),r})}function g6(n,e){return ie(function(){var t=rm(n,e,!0),r=sr(t,e.conv4_1,"valid"),i=qn(Qc(r,3),3),o=ii(It(r,i),3),s=sr(t,e.conv4_2,"valid");return{prob:o,regions:s}})}function m6(n,e){return ie(function(){var t=rp(e,n.shape.slice(1)),r=t.height,i=t.width,o=Fg.resizeBilinear(n,[r,i]),s=uS(o);return Fi(s,[0,2,1,3])})}function v6(n,e,t,r){for(var i=[],o=n.arraySync(),s=0;s<n.shape[0];s++)for(var a=0;a<n.shape[1];a++)o[s][a]>=r&&i.push(new Ue(a,s));var l=i.map(function(u){var c=new td(Math.round((u.y*ou+1)/t),Math.round((u.x*ou+1)/t),Math.round((u.y*ou+vc)/t),Math.round((u.x*ou+vc)/t)),d=o[u.y][u.x],h=e.arraySync(),f=new nm(h[u.y][u.x][0],h[u.y][u.x][1],h[u.y][u.x][2],h[u.y][u.x][3]);return{cell:c,score:d,region:f}});return l}function y6(n,e,t,r,i){i.stage1=[];var o=e.map(function(h){return ie(function(){var f={scale:h},p=m6(n,h),g=Date.now(),m=g6(p,r),v=m.prob,y=m.regions;f.pnet=Date.now()-g;var b=Rt(Rt(v,3)[1])[0],x=Rt(y)[0];return{scoresTensor:b,regionsTensor:x,scale:h,statsForScale:f}})}),s=o.map(function(h){var f=h.scoresTensor,p=h.regionsTensor,g=h.scale,m=h.statsForScale,v=v6(f,p,g,t);if(f.dispose(),p.dispose(),!v.length)return i.stage1.push(m),[];var y=Date.now(),b=Va(v.map(function(x){return x.cell}),v.map(function(x){return x.score}),.5);return m.nms=Date.now()-y,m.numBoxes=b.length,i.stage1.push(m),b.map(function(x){return v[x]})}),a=s.reduce(function(h,f){return h.concat(f)},[]),l=[],u=[];if(a.length>0){var c=Date.now(),d=Va(a.map(function(h){return h.cell}),a.map(function(h){return h.score}),.7);i.stage1_nms=Date.now()-c,u=d.map(function(h){return a[h].score}),l=d.map(function(h){return a[h]}).map(function(h){var f=h.cell,p=h.region;return new td(f.left+p.left*f.width,f.top+p.top*f.height,f.right+p.right*f.width,f.bottom+p.bottom*f.height).toSquare().round()})}return{boxes:l,scores:u}}function cS(n,e,t){var r=t.width,i=t.height;return de(this,void 0,void 0,function(){var o,s,a,l=this;return he(this,function(u){switch(u.label){case 0:return o=Ro(n),[4,Promise.all(e.map(function(c){return de(l,void 0,void 0,function(){var d,h,f,p,g,m,v,y;return he(this,function(b){return d=c.padAtBorders(n.height,n.width),h=d.y,f=d.ey,p=d.x,g=d.ex,m=p-1,v=h-1,y=o.getImageData(m,v,g-m,f-v),[2,nn.isNodejs()?Gg(y):createImageBitmap(y)]})})}))];case 1:return s=u.sent(),a=[],s.forEach(function(c){var d=nd({width:r,height:i}),h=Ro(d);h.drawImage(c,0,0,r,i);for(var f=h.getImageData(0,0,r,i).data,p=[],g=0;g<f.length;g+=4)p.push(f[g+2]),p.push(f[g+1]),p.push(f[g]);a.push(p)}),[2,a.map(function(c){var d=ie(function(){var h=Fi(vn(c,[1,r,i,3]),[0,2,1,3]).toFloat();return uS(h)});return d})]}})})}function b6(n,e){return ie(function(){var t=rm(n,e),r=or(t,[t.shape[0],e.fc1.weights.shape[0]]),i=Sr(r,e.fc1),o=bs(i,e.prelu4_alpha),s=Sr(o,e.fc2_1),a=qn(Qc(s,1),1),l=ii(It(s,a),1),u=Sr(o,e.fc2_2),c=Rt(l,1)[1];return{scores:c,regions:u}})}function x6(n,e,t,r,i){return de(this,void 0,void 0,function(){var o,s,a,l,u,c,d,h,f,p,g,m,v,y;return he(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,cS(n,e,{width:24,height:24})];case 1:return s=b.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(x){var w=b6(x,r);return x.dispose(),w}),i.stage2_rnet=Date.now()-o,l=a.length>1?kt(a.map(function(x){return x.scores})):a[0].scores,d=(c=Array).from,[4,l.data()];case 2:return u=d.apply(c,[b.sent()]),l.dispose(),h=u.map(function(x,w){return{score:x,idx:w}}).filter(function(x){return x.score>t}).map(function(x){var w=x.idx;return w}),f=h.map(function(x){return e[x]}),p=h.map(function(x){return u[x]}),g=[],m=[],f.length>0&&(o=Date.now(),v=Va(f,p,.7),i.stage2_nms=Date.now()-o,y=v.map(function(x){var w=a[h[x]].regions.arraySync();return new nm(w[0][0],w[0][1],w[0][2],w[0][3])}),m=v.map(function(x){return p[x]}),g=v.map(function(x,w){return f[x].calibrate(y[w])})),a.forEach(function(x){x.regions.dispose(),x.scores.dispose()}),[2,{boxes:g,scores:m}]}})})}function w6(n,e){return ie(function(){var t=rm(n,e);t=Pt(t,[2,2],[2,2],"same"),t=sr(t,e.conv4,"valid"),t=bs(t,e.prelu4_alpha);var r=or(t,[t.shape[0],e.fc1.weights.shape[0]]),i=Sr(r,e.fc1),o=bs(i,e.prelu5_alpha),s=Sr(o,e.fc2_1),a=qn(Qc(s,1),1),l=ii(It(s,a),1),u=Sr(o,e.fc2_2),c=Sr(o,e.fc2_3),d=Rt(l,1)[1];return{scores:d,regions:u,points:c}})}function _6(n,e,t,r,i){return de(this,void 0,void 0,function(){var o,s,a,l,u,c,d,h,f,p,g,m,v,y,b;return he(this,function(x){switch(x.label){case 0:return o=Date.now(),[4,cS(n,e,{width:48,height:48})];case 1:return s=x.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(w){var _=w6(w,r);return w.dispose(),_}),i.stage3_onet=Date.now()-o,l=a.length>1?kt(a.map(function(w){return w.scores})):a[0].scores,d=(c=Array).from,[4,l.data()];case 2:return u=d.apply(c,[x.sent()]),l.dispose(),h=u.map(function(w,_){return{score:w,idx:_}}).filter(function(w){return w.score>t}).map(function(w){var _=w.idx;return _}),f=h.map(function(w){var _=a[w].regions.arraySync();return new nm(_[0][0],_[0][1],_[0][2],_[0][3])}),p=h.map(function(w,_){return e[w].calibrate(f[_])}),g=h.map(function(w){return u[w]}),m=[],v=[],y=[],p.length>0&&(o=Date.now(),b=Va(p,g,.7,!1),i.stage3_nms=Date.now()-o,m=b.map(function(w){return p[w]}),v=b.map(function(w){return g[w]}),y=b.map(function(w,_){return Array(5).fill(0).map(function(C,E){var S=a[w].points.arraySync();return new Ue(S[0][E]*(m[_].width+1)+m[_].left,S[0][E+5]*(m[_].height+1)+m[_].top)})})),a.forEach(function(w){w.regions.dispose(),w.scores.dispose(),w.points.dispose()}),[2,{boxes:m,scores:v,points:y}]}})})}var C6=(function(n){xe(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return de(this,void 0,void 0,function(){return he(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return de(this,void 0,void 0,function(){return he(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),de(this,void 0,void 0,function(){var i,o,s,a,l,u,c,d,h,f,p,g,m,v,y,b,x,w,_,C,E;return he(this,function(S){switch(S.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},a=Date.now(),l=ie(function(){return u6(qn(Vg.fromPixels(o)).toFloat())}),u=function(D){return l.dispose(),s.total=Date.now()-a,D},c=l.shape.slice(1),d=c[0],h=c[1],f=new sS(r),p=f.minFaceSize,g=f.scaleFactor,m=f.maxNumScales,v=f.scoreThresholds,y=f.scaleSteps,b=(y||p6(p,g,[d,h])).filter(function(D){var k=rp(D,[d,h]);return Math.min(k.width,k.height)>vc}).slice(0,m),s.scales=b,s.pyramid=b.map(function(D){return rp(D,[d,h])}),x=Date.now(),[4,y6(l,b,v[0],i.pnet,s)];case 1:return w=S.sent(),s.total_stage1=Date.now()-x,w.boxes.length?(s.stage2_numInputBoxes=w.boxes.length,x=Date.now(),[4,x6(o,w.boxes,v[1],i.rnet,s)]):[2,u({results:[],stats:s})];case 2:return _=S.sent(),s.total_stage2=Date.now()-x,_.boxes.length?(s.stage3_numInputBoxes=_.boxes.length,x=Date.now(),[4,_6(o,_.boxes,v[2],i.onet,s)]):[2,u({results:[],stats:s})];case 3:return C=S.sent(),s.total_stage3=Date.now()-x,E=C.boxes.map(function(D,k){return id(ja({},new hr(C.scores[k],new jg(D.left/h,D.top/d,D.width/h,D.height/d),{height:d,width:h})),new tq(C.points[k].map(function(M){return M.sub(new Ue(D.left,D.top)).div(new Ue(D.width,D.height))}),{width:D.width,height:D.height}))}),[2,u({results:E,stats:s})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),de(this,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Bt(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),de(this,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Bt(t)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return f6(t)},e.prototype.extractParams=function(t){return d6(t)},e})(si),E6=.4,S6=[new Ue(1.603231,2.094468),new Ue(6.041143,7.080126),new Ue(2.882459,3.518061),new Ue(4.266906,5.178857),new Ue(9.041765,10.66308)],D6=[117.001,114.697,97.404],A6=(function(n){xe(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:E6,classes:["face"],anchors:S6,meanRgb:D6,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return de(this,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(s){return new hr(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(lS),ln={ssdMobilenetv1:new aS,tinyFaceDetector:new A6,tinyYolov2:new l6,mtcnn:new C6,faceLandmark68Net:new eS,faceLandmark68TinyNet:new Rq,faceRecognitionNet:new Fq,faceExpressionNet:new mq,ageGenderNet:new Sq},dS=(function(n){xe(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e})(cl),im=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r,i=this;return he(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,sd(t,this.input,function(s){return de(i,void 0,void 0,function(){return he(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(l){return ln.faceExpressionNet.predictExpressions(l)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(s,a){return KE(s,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new lm(this,this.input)},e})(dS),om=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r;return he(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,tm(t,this.input,function(o){return ln.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,KE(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new um(this,this.input)},e})(dS),sm=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new cm(this,this.input)},e.prototype.withFaceDescriptors=function(){return new hm(this,this.input)},e})(im),am=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new dm(this,this.input)},e.prototype.withFaceDescriptor=function(){return new fm(this,this.input)},e})(om),hS=(function(n){xe(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e})(cl),lm=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r,i=this;return he(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,sd(t,this.input,function(s){return de(i,void 0,void 0,function(){return he(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(l){return ln.ageGenderNet.predictAgeAndGender(l)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(s,a){var l=r[a],u=l.age,c=l.gender,d=l.genderProbability;return iS(oS(s,c,d),u)})]}})})},e.prototype.withFaceExpressions=function(){return new im(this,this.input)},e})(hS),um=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r,i,o,s;return he(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,tm(t,this.input,function(l){return ln.ageGenderNet.predictAgeAndGender(l)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,o=r.gender,s=r.genderProbability,[2,iS(oS(t,o,s),i)]}})})},e.prototype.withFaceExpressions=function(){return new om(this,this.input)},e})(hS),cm=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new sm(this,this.input)},e.prototype.withFaceDescriptors=function(){return new hm(this,this.input)},e})(lm),dm=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new am(this,this.input)},e.prototype.withFaceDescriptor=function(){return new fm(this,this.input)},e})(um),fS=(function(n){xe(e,n);function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return e})(cl),hm=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r;return he(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,sd(t,this.input,function(o){return Promise.all(o.map(function(s){return ln.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,s){return rS(t[s],o)})]}})})},e.prototype.withFaceExpressions=function(){return new sm(this,this.input)},e.prototype.withAgeAndGender=function(){return new cm(this,this.input)},e})(fS),fm=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r;return he(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,tm(t,this.input,function(o){return ln.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,rS(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new am(this,this.input)},e.prototype.withAgeAndGender=function(){return new dm(this,this.input)},e})(fS),pS=(function(n){xe(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ln.faceLandmark68TinyNet:ln.faceLandmark68Net},enumerable:!0,configurable:!0}),e})(cl),k6=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r,i,o,s,a=this;return he(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return t=l.sent(),r=t.map(function(u){return u.detection}),this.input instanceof ft?[4,Yg(this.input,r)]:[3,3];case 2:return o=l.sent(),[3,5];case 3:return[4,qg(this.input,r)];case 4:o=l.sent(),l.label=5;case 5:return i=o,[4,Promise.all(i.map(function(u){return a.landmarkNet.detectLandmarks(u)}))];case 6:return s=l.sent(),i.forEach(function(u){return u instanceof ft&&u.dispose()}),[2,t.map(function(u,c){return id(u,s[c])})]}})})},e.prototype.withFaceExpressions=function(){return new sm(this,this.input)},e.prototype.withAgeAndGender=function(){return new cm(this,this.input)},e.prototype.withFaceDescriptors=function(){return new hm(this,this.input)},e})(pS),R6=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r,i,o,s;return he(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?(r=t.detection,this.input instanceof ft?[4,Yg(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,qg(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return s=a.sent(),i.forEach(function(l){return l instanceof ft&&l.dispose()}),[2,id(t,s)]}})})},e.prototype.withFaceExpressions=function(){return new am(this,this.input)},e.prototype.withAgeAndGender=function(){return new dm(this,this.input)},e.prototype.withFaceDescriptor=function(){return new fm(this,this.input)},e})(pS),gS=(function(n){xe(e,n);function e(t,r){r===void 0&&(r=new od);var i=n.call(this)||this;return i.input=t,i.options=r,i}return e})(cl),mS=(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r,i,o;return he(this,function(s){switch(s.label){case 0:return t=this,r=t.input,i=t.options,i instanceof sS?[4,ln.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(a){return a.detection})];case 2:if(o=i instanceof np?function(a){return ln.tinyFaceDetector.locateFaces(a,i)}:i instanceof od?function(a){return ln.ssdMobilenetv1.locateFaces(a,i)}:i instanceof em?function(a){return ln.tinyYolov2.locateFaces(a,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return de(t,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(s){return ja({},s)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new k6(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new im(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new lm(this.runAndExtendWithFaceDetections(),this.input)},e})(gS);(function(n){xe(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return de(this,void 0,void 0,function(){var t,r;return he(this,function(i){switch(i.label){case 0:return[4,new mS(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return de(t,void 0,void 0,function(){var i;return he(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?ja({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new R6(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new om(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new um(this.runAndExtendWithFaceDetection(),this.input)},e})(gS);function ox(n,e){return e===void 0&&(e=new od),new mS(n,e)}function T6(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof tu)return s;if(s instanceof Float32Array)return new tu(o(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new tu(o(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return T6(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new Z0(o,t.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new Z0("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return tu.fromJSON(r)});return new n(t,e.distanceThreshold)},n})();function vS(n,e){var t=new xo(e.width,e.height),r=t.width,i=t.height;if(r<=0||i<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:i}));if(Array.isArray(n))return n.map(function(a){return vS(a,{width:r,height:i})});if(QE(n)){var o=n.detection.forSize(r,i),s=n.unshiftedLandmarks.forSize(o.box.width,o.box.height);return id(ja(n,o),s)}return OE(n)?ja(n,n.detection.forSize(r,i)):n instanceof Ua||n instanceof hr?n.forSize(r,i):n}const I6=(n="photo")=>({stream:null,isLoading:!0,isDetecting:!1,faceDetected:!1,faceQuality:null,qualityIssues:[],showQualityWarning:!1,qualityCheckCount:0,error:null,canvas:null,video:null,capturedImage:null,async init(){this.video=this.$refs.video,this.canvas=this.$refs.canvas;try{await this.loadModels(),await this.startWebcam(),this.detectFace(),this.isLoading=!1}catch(e){console.error("Initialization error:",e),this.error=this.getErrorMessage(e),this.isLoading=!1}},async loadModels(){const e="/models";await Promise.all([ln.tinyFaceDetector.loadFromUri(e),ln.faceLandmark68Net.loadFromUri(e),ln.faceExpressionNet.loadFromUri(e)])},async startWebcam(){try{return this.stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"},audio:!1}),this.video.srcObject=this.stream,new Promise(e=>{this.video.onloadedmetadata=()=>{this.video.play(),e()}})}catch{throw new Error("camera_access_denied")}},async detectFace(){if(!(!this.video||this.video.paused||this.video.ended)){this.isDetecting=!0;try{const e=await ox(this.video,new np({inputSize:416,scoreThreshold:.5})).withFaceLandmarks().withFaceExpressions();if(this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,e.length===0)this.faceDetected=!1,this.faceQuality=null,this.qualityIssues=[],this.showQualityWarning=!1,this.qualityCheckCount=0,this.error=null;else if(e.length>1)this.faceDetected=!1,this.faceQuality=null,this.qualityIssues=[],this.showQualityWarning=!1,this.qualityCheckCount=0,this.error="multiple_faces",this.drawDetections(e,"red");else{const r=e[0],i=this.checkFaceQuality(r);this.faceDetected=!0,this.faceQuality=i.isGood?"good":"poor",this.qualityIssues=i.issues,this.error=null,i.isGood?(this.qualityCheckCount=0,this.showQualityWarning=!1):(this.qualityCheckCount++,this.qualityCheckCount>=10&&(this.showQualityWarning=!0));const o=i.isGood?"green":"orange";this.drawDetections(e,o)}}catch(e){console.error("Detection error:",e)}this.isDetecting=!1,setTimeout(()=>this.detectFace(),100)}},checkFaceQuality(e){const t=[],r=e.detection.box,i=this.video.videoWidth*this.video.videoHeight,s=r.width*r.height/i;s<.1?t.push("face_too_small"):s>.7&&t.push("face_too_close");const a=r.x+r.width/2,l=r.y+r.height/2,u=this.video.videoWidth/2,c=this.video.videoHeight/2,d=Math.abs(a-u)/this.video.videoWidth,h=Math.abs(l-c)/this.video.videoHeight;if((d>.2||h>.2)&&t.push("face_not_centered"),e.landmarks){const p=e.landmarks.positions,g=p[36],m=p[45],v=p[30],y=(g.x+m.x)/2,b=Math.abs(v.x-y),x=Math.abs(m.x-g.x);b/x>.15&&t.push("face_not_frontal")}const f=e.detection.score;return f<.7&&t.push("low_confidence"),{isGood:t.length===0,issues:t,confidence:f}},drawDetections(e,t){const r=vS(e,{width:this.video.videoWidth,height:this.video.videoHeight}),i=this.canvas.getContext("2d");r.forEach(o=>{const s=o.detection.box;if(i.strokeStyle=t,i.lineWidth=3,i.strokeRect(s.x,s.y,s.width,s.height),o.landmarks){const a=o.landmarks.positions;i.fillStyle=t,a.forEach(l=>{i.beginPath(),i.arc(l.x,l.y,2,0,2*Math.PI),i.fill()})}})},async capture(){if(!this.faceDetected){this.error="no_face_detected";return}if(this.faceQuality==="poor"){this.error="poor_face_quality";return}try{const e=document.createElement("canvas");e.width=this.video.videoWidth,e.height=this.video.videoHeight,e.getContext("2d").drawImage(this.video,0,0);const r=await new Promise(a=>{e.toBlob(a,"image/jpeg",.95)}),i=await this.validateImage(r);if(!i.valid){this.error=i.error;return}const o=await this.performFinalFaceCheck(e);if(!o.valid){this.error=o.error;return}const s=new File([r],"face-capture.jpg",{type:"image/jpeg"});this.capturedImage=URL.createObjectURL(r),this.$wire.upload(n,s,()=>{this.stopWebcam()},a=>{console.error("Upload error:",a),this.error="upload_failed"})}catch(e){console.error("Capture error:",e),this.error="capture_failed"}},async performFinalFaceCheck(e){try{const t=await ox(e,new np({inputSize:416,scoreThreshold:.5})).withFaceLandmarks();return t.length===0?{valid:!1,error:"no_face_in_capture"}:t.length>1?{valid:!1,error:"multiple_faces_in_capture"}:this.checkFaceQuality(t[0]).isGood?{valid:!0}:{valid:!1,error:"poor_face_quality"}}catch(t){return console.error("Final face check error:",t),{valid:!1,error:"face_check_failed"}}},async validateImage(e){if(e.size>2*1024*1024)return{valid:!1,error:"file_too_large"};const t=await this.loadImage(e),r=t.width,i=t.height;return r<48||i<48?{valid:!1,error:"image_too_small"}:r>4096||i>4096?{valid:!1,error:"image_too_large"}:{valid:!0}},loadImage(e){return new Promise((t,r)=>{const i=new Image;i.onload=()=>t(i),i.onerror=r,i.src=URL.createObjectURL(e)})},retake(){this.capturedImage=null,this.error=null,this.startWebcam().then(()=>{this.detectFace()})},stopWebcam(){this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null)},getErrorMessage(e){return e.message==="camera_access_denied"?"camera_access_denied":"unknown_error"},destroy(){this.stopWebcam(),this.capturedImage&&URL.revokeObjectURL(this.capturedImage)}}),M6=(n="pin",e=4,t=6)=>({pin:"",isShaking:!1,init(){this.pin=""},addDigit(r){this.pin.length<t&&(this.pin+=r,this.updateWireModel())},deleteDigit(){this.pin.length>0&&(this.pin=this.pin.slice(0,-1),this.updateWireModel())},clear(){this.pin="",this.updateWireModel()},updateWireModel(){this.$wire.set(n,this.pin)},get displayPin(){return"•".repeat(this.pin.length)},get isMinLength(){return this.pin.length>=e},get isMaxLength(){return this.pin.length>=t},get isPinValid(){return this.pin.length>=e&&this.pin.length<=t},shake(){this.isShaking=!0,setTimeout(()=>{this.isShaking=!1},500)},handleKeyPress(r){const i=r.key;i>="0"&&i<="9"?(r.preventDefault(),this.addDigit(i)):i==="Backspace"?(r.preventDefault(),this.deleteDigit()):i==="Enter"&&this.isPinValid&&(r.preventDefault(),this.$wire.call("submit"))}});class O6{static getCurrentPosition(){return new Promise((e,t)=>{if(!navigator.geolocation){t(new Error("Geolocation is not supported by your browser."));return}navigator.geolocation.getCurrentPosition(r=>{e({latitude:r.coords.latitude,longitude:r.coords.longitude})},r=>{let i="Unable to retrieve your location.";switch(r.code){case r.PERMISSION_DENIED:i="Location permission denied. Please enable location access in your browser settings.";break;case r.POSITION_UNAVAILABLE:i="Location information is unavailable. Please try again.";break;case r.TIMEOUT:i="Location request timed out. Please try again.";break}t(new Error(i))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})}static getUserTimezone(){return Intl.DateTimeFormat().resolvedOptions().timeZone}static async getLocationData(){return{...await this.getCurrentPosition(),timezone:this.getUserTimezone()}}}window.GeolocationHelper=O6;const P6=window.location.pathname.split("/").filter(Boolean),ip=P6[0]||"en",sx={es:bR.Spanish,en:null},N6={es:{dateFormat:"Y-m-d",altFormat:"d/m/Y",altInput:!0,allowInput:!0},en:{dateFormat:"Y-m-d",altFormat:"m/d/Y",altInput:!0,allowInput:!0}};sx[ip]&&ht.localize(sx[ip]);ht.defaultConfig={...ht.defaultConfig,...N6[ip]};window.flatpickr=ht;window.TomSelect=dn;window.Cropper=Z1;window.Chart=dg;window.faceCapture=I6;window.pinPad=M6});export default F6();
